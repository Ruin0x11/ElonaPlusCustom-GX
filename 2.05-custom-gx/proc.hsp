#defcfunc efstatusfix int efstatusfix_arg1, int efstatusfix_arg2, int efstatusfix_arg3, int efstatusfix_arg4
	if ( efstatus <= (-2) ) {
		return efstatusfix_arg1
	}
	if ( efstatus == (-1) ) {
		return efstatusfix_arg2
	}
	if ( efstatus == 0 ) {
		return efstatusfix_arg3
	}
	return efstatusfix_arg4

*randomSite
	if ( map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 6) == 0 ) {
		return 0
	}
	if ( (feat(1) >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & feat(1) <= CELL_FEATURE_SAMPLING_SPOT_GARDENING) == 0 ) {
		return 0
	}
	atxspot = ATX_FIELD1
	atxlv = gdata(GDATA_LEVEL)
	if ( mdata(MDATA_TYPE) == MAP_TYPE_DUNGEON ) {
		atxspot = ATX_DUNGEON1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWER ) {
		atxspot = ATX_BUILDING1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
		atxspot = ATX_FOREST1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_FORT ) {
		atxspot = ATX_BUILDING1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_NEST ) {
		atxspot = ATX_REMAIN1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_CEMETERY ) {
		atxspot = ATX_FOREST1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_MINE ) {
		atxspot = ATX_MINE1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_LAKE ) {
		atxspot = ATX_WATER1
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		atxlv = cdata(CDATA_LEVEL, CHARA_PLAYER) / 2 + rnd(10)
		if ( atxlv > 30 ) {
			atxlv = 30 + rnd(rnd(atxlv - 30) + 1)
		}
		if ( 4 <= gdata(GDATA_WORLD_TILE) & gdata(GDATA_WORLD_TILE) < 9 ) {
			atxspot = ATX_FOREST1
		}
		if ( 264 <= gdata(GDATA_WORLD_TILE) & gdata(GDATA_WORLD_TILE) < 363 ) {
			atxspot = ATX_FIELD1
		}
		if ( 9 <= gdata(GDATA_WORLD_TILE) & gdata(GDATA_WORLD_TILE) < 13 ) {
			atxspot = ATX_FOREST1
		}
		if ( 13 <= gdata(GDATA_WORLD_TILE) & gdata(GDATA_WORLD_TILE) < 17 ) {
			atxspot = ATX_FIELD1
		}
	}
	cell_featread cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
	if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
		if ( mdata(MDATA_TYPE) == MAP_TYPE_DUNGEON ) {
			atxspot = ATX_DUNGEON1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWER ) {
			atxspot = ATX_BUILDING1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
			atxspot = ATX_FOREST1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_FORT ) {
			atxspot = ATX_BUILDING1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_NEST ) {
			atxspot = ATX_REMAIN1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_CEMETERY ) {
			atxspot = ATX_FOREST1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_MINE ) {
			atxspot = ATX_MINE1
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_LAKE ) {
			atxspot = ATX_WATER1
		}
	}
	if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
		atxspot = ATX_REMAIN1
	}
	if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
		atxspot = ATX_WATER1
	}
	if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
		atxspot = ATX_MINE1
	}
	if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
		atxspot = ATX_BUSH1
	}
	repeat 12
		if ( atxspot == ATX_MINE1 ) {
			if ( sdata(SKILL_NORMAL_MINING, CHARA_PLAYER) * 2 + 5 > rnd(atxlv + 1) | rnd(10) == 0 ) {
				matgetmain random_material(atxlv, 0), 1, 1
				matgetmain random_material(atxlv, 0), 1, 1
				matgetmain random_material(atxlv, 0), 1, 1
			}
			else {
				txt lang("採掘に失敗した。", "Your mining attempt fails.")
			}
			skillexp SKILL_NORMAL_MINING, CHARA_PLAYER, 50
			gdata(GDATA_GATHERING_ATTEMPS)++
		}
		if ( atxspot == ATX_WATER1 ) {
			if ( sdata(SKILL_NORMAL_FISHING, CHARA_PLAYER) * 2 + 5 > rnd(atxlv + 1) | rnd(10) == 0 ) {
				matgetmain random_material(atxlv, 0), 1, 2
				matgetmain random_material(atxlv, 0), 1, 2
				matgetmain random_material(atxlv, 0), 1, 2
			}
			else {
				txt lang("釣りに失敗した。", "Your fishing attempt fails.")
			}
			skillexp SKILL_NORMAL_FISHING, CHARA_PLAYER, 50
			gdata(GDATA_GATHERING_ATTEMPS)++
		}
		if ( atxspot == ATX_BUSH1 ) {
			if ( sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) * 2 + 5 > rnd(atxlv + 1) | rnd(10) == 0 ) {
				matgetmain random_material(atxlv, 0), 1, 3
				matgetmain random_material(atxlv, 0), 1, 3
				matgetmain random_material(atxlv, 0), 1, 3
			}
			else {
				txt lang("採取に失敗した。", "Your searching attempt fails.")
			}
			skillexp SKILL_NORMAL_GARDENING, CHARA_PLAYER, 50
			gdata(GDATA_GATHERING_ATTEMPS)++
		}
		if ( atxspot == ATX_REMAIN1 ) {
			if ( sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) * 2 + 5 > rnd(atxlv + 1) | rnd(10) == 0 ) {
				matgetmain random_material(atxlv, 0), 1, 4
				matgetmain random_material(atxlv, 0), 1, 4
				matgetmain random_material(atxlv, 0), 1, 4
			}
			else {
				txt lang("回収に失敗した。", "Your searching attempt fails.")
			}
			skillexp SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER, 50
			gdata(GDATA_GATHERING_ATTEMPS)++
		}
		if ( atxspot == ATX_RANDOM | atxspot == ATX_BUILDING1 | atxspot == ATX_FOREST1 | atxspot == ATX_DUNGEON1 ) {
			if ( sdata(SKILL_NORMAL_DETECTION, CHARA_PLAYER) * 2 + 5 > rnd(atxlv + 1) | rnd(10) == 0 ) {
				matgetmain random_material(atxlv, 0), 1, 5
				matgetmain random_material(atxlv, 0), 1, 5
				matgetmain random_material(atxlv, 0), 1, 5
			}
			else {
				txt lang("探索に失敗した。", "Your searching attempt fails.")
			}
			skillexp SKILL_NORMAL_DETECTION, CHARA_PLAYER, 50
			gdata(GDATA_GATHERING_ATTEMPS)++
		}
		if ( rnd(5 + trait(TRAIT_RACE_BONUS_MATERIAL) * 2) + 4 < gdata(GDATA_GATHERING_ATTEMPS) ) {
			if ( feat(1) != CELL_FEATURE_SAMPLING_SPOT_MINING & feat(1) != CELL_FEATURE_SAMPLING_SPOT_FISHING & feat(1) != CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				snd SOUNDLIST_DIG2
			}
			s = lang("もう何もない。", "You can't find anything else.")
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
				snd SOUNDLIST_WATER
				snd SOUNDLIST_FISH_CAST
				s = lang("泉は干上がった。", "The spring has dried up.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
				snd SOUNDLIST_DIG1
				s = lang("鉱石を掘りつくした。", "There's no more ore around.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				snd SOUNDLIST_BUSH1
				s = lang("もう目ぼしい植物は見当たらない。", "There are no more plants around.")
			}
			await 300
			txt s
			gdata(GDATA_GATHERING_ATTEMPS) = 0
			if ( feat(1) != CELL_FEATURE_DOWNSTAIRS & feat(1) != CELL_FEATURE_UPSTAIRS ) {
				map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 6) = 0
			}
			break
		}
	loop
	autosave2 = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
	return

*disarmTrap
	if ( feat(2) != CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS & feat(2) != CELL_SUB_FEATURE_TRAP_PITFALL ) {
		skillexp SKILL_NORMAL_DISARM_TRAP, cc, 50
		if ( sdata(SKILL_ATTR_LER, cc) > rnd(10000) ) {
			skillexp SKILL_NORMAL_DISARM_TRAP, cc, 50
		}
	}
	cell_featset movx, movy, 0
	txt lang("罠を解除した。", "The trap was disarmed.")
	if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
		if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_MINE | feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL ) {
			snd SOUNDLIST_DIG2
			qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF))++
			txtef COLOR_GREEN
			txt lang("撤去済み", "Removed ") + "(" + qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) + ") " + lang("撤去ノルマ", "Quota ") + "(" + qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) + ")"
		}
	}
	return

*procMove
	if ( cfg_scroll ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *screen_scroll
		}
	}
	map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 1) = 0
	cdata(CDATA_X, cc) = cdata(CDATA_X_NEW, cc)
	cdata(CDATA_Y, cc) = cdata(CDATA_Y_NEW, cc)
	map(cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc), 1) = cc + 1
	if ( cc == CHARA_PLAYER ) {
		if ( gdata(GDATA_RIDER) != 0 ) {
			cdata(CDATA_X, gdata(GDATA_RIDER)) = cdata(CDATA_X, CHARA_PLAYER)
			cdata(CDATA_Y, gdata(GDATA_RIDER)) = cdata(CDATA_Y, CHARA_PLAYER)
		}
	}
	if ( cdata(CDATA_IN_TAGTEAM, cc) == (-1) ) {
		if ( cdata(CDATA_IN_TAGTEAM, cc) != 0 ) {
			cdata(CDATA_X, cdata(CDATA_TAGTEAM_PARTNER, cc)) = cdata(CDATA_X, cc)
			cdata(CDATA_Y, cdata(CDATA_TAGTEAM_PARTNER, cc)) = cdata(CDATA_Y, cc)
		}
	}
	movx = cdata(CDATA_X, cc)
	movy = cdata(CDATA_Y, cc)
	if ( map(movx, movy, 6) != 0 ) {
		cell_featread movx, movy
		if ( feat(1) == CELL_FEATURE_TRAP ) {
			if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
				if ( cbit(CHARA_BIT_FLOAT, cc) == 1 & cdata(CDATA_CONDITION_GRAVITY, cc) == 0 | cbit(CHARA_BIT_IMMUNE_MINE, cc) == 1 | findbuff(cc, BUFF_GRAVITY_ACCEL) != (-1) ) {
					return
				}
				if ( feat(3) != 0 ) {
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						return
					}
				}
			}
			if ( feat(2) == CELL_SUB_FEATURE_TRAP_BLADE_STRINGS | feat(2) == CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS ) {
				if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) != 2 ) {
					if ( cbit(CHARA_BIT_FLOAT, cc) == TRUE & cdata(CDATA_CONDITION_GRAVITY, cc) == 0 | findbuff(cc, BUFF_GRAVITY_ACCEL) != (-1) ) {
						return
					}
				}
				if ( feat(3) != 0 ) {
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						return
					}
				}
			}
			if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL | feat(2) == CELL_SUB_FEATURE_TRAP_PITFALL ) {
				if ( cbit(CHARA_BIT_FLOAT, cc) == 1 & cdata(CDATA_CONDITION_GRAVITY, cc) == 0 | findbuff(cc, BUFF_GRAVITY_ACCEL) != (-1) ) {
					return
				}
				if ( feat(3) != 0 ) {
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						return
					}
				}
			}
			if ( feat(0) != tile_trap & cc == CHARA_PLAYER ) {
				gosub *calcSearch
				if ( stat == 1 ) {
					refx = movx
					refy = movy
					gosub *revealTrap
					feat(0) = tile_trap
				}
			}
			refdiff = 100 + gdata(GDATA_LEVEL) * 3 + gdata(STARTING_GDATA_FLAG + 379) * 3
			if ( feat(0) == tile_trap ) {
				refdiff = refdiff / 3
				if ( sdata(SKILL_NORMAL_DISARM_TRAP, cc) != 0 ) {
					gosub *calcDisarm
					if ( stat == 1 ) {
						gosub *disarmTrap
						return
					}
					else {
						txt lang("解除に失敗した。", name(cc) + " fail" + _s(cc) + " to disarm the trap.")
					}
				}
			}
			gosub *calcTrap
			if ( stat == 1 ) {
				if ( synccheck(cc, -1) ) {
					txt lang(name(cc) + "は罠を避けた。", name(cc) + " evade" + _s(cc) + " a trap.")
				}
				if ( cc == CHARA_PLAYER ) {
					refx = movx
					refy = movy
					gosub *revealTrap
				}
			}
			else {
				if ( cc == CHARA_PLAYER ) {
					refx = movx
					refy = movy
					gosub *revealTrap
					snd SOUNDLIST_TRAP1
				}
				efsource = 5
				if ( synccheck(cc, -1) ) {
					txt lang(aln(cc) + "罠にかかった！", name(cc) + " activate" + _s(cc) + " a trap!")
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_BLIND ) {
					if ( synccheck(cc, -1) ) {
						txt lang("墨が噴き出した。", "Gallons of ink spreads.")
					}
					cell_featset movx, movy, 0
					dmgcon cc, CONDITION_BLIND, 100 + gdata(GDATA_LEVEL) * 2
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_PARALYZE ) {
					if ( synccheck(cc, -1) ) {
						txt lang("刺激的な匂いがただよう。", "Stimulative gas spreads.")
					}
					cell_featset movx, movy, 0
					dmgcon cc, CONDITION_PARALYZE, 100 + gdata(GDATA_LEVEL) * 2
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_CONFUSION ) {
					if ( synccheck(cc, -1) ) {
						txt lang("臭い匂いがたちこめた。", "Smelly gas spreads.")
					}
					cell_featset movx, movy, 0
					dmgcon cc, CONDITION_CONFUSE, 100 + gdata(GDATA_LEVEL) * 2
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_TELEPORT ) {
					cell_featset movx, movy, 0
					if ( encfind(cc, ENCHANT_PREVENT_TELEPORT) != (-1) ) {
						if ( synccheck(cc, -1) ) {
							txt_noteleport
						}
						return
					}
					repeat 200
						cdata(CDATA_X_NEW, cc) = rnd(mdata(MDATA_WIDTH) - 2) + 1
						cdata(CDATA_Y_NEW, cc) = rnd(mdata(MDATA_HEIGHT) - 2) + 1
						cell_check cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc)
						if ( cellaccess == 1 ) {
							if ( synccheck(cc, -1) ) {
								snd SOUNDLIST_TELEPORT1
								txt lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
							}
							rowactend cc
							redraw 0
							gosub *screen_draw
							break
						}
					loop
					goto *procMove
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
					if ( synccheck(cc, -1) ) {
						txt lang("槍が地面から飛び出した。", "Several spears fly out from the ground.")
					}
					if ( cbit(CHARA_BIT_FLOAT, cc) == 1 & cdata(CDATA_CONDITION_GRAVITY, cc) == 0 | findbuff(cc, BUFF_GRAVITY_ACCEL) != (-1) ) {
						if ( synccheck(cc, -1) ) {
							txtmore
							txt lang("しかし" + name(cc) + "には届かなかった。", "But they don't reach " + name(cc) + ".")
						}
					}
					else {
						cell_featset movx, movy, 0
						dmghp cc, rnd(gdata(GDATA_LEVEL) * 2 + 10), DAMAGE_FROM_TRAP
					}
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_POISON ) {
					if ( synccheck(cc, -1) ) {
						txt lang("毒ガスが噴き出した。", "Poisonous gas spreads.")
					}
					cell_featset movx, movy, 0
					dmgcon cc, CONDITION_POISON, 100 + gdata(GDATA_LEVEL) * 2
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_SLEEP ) {
					if ( synccheck(cc, -1) ) {
						txt lang("催眠ガスが噴き出した。", "Sleeping gas spreads.")
					}
					cell_featset movx, movy, 0
					dmgcon cc, CONDITION_SLEEP, 100 + gdata(GDATA_LEVEL) * 2
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_MINE | feat(2) == CELL_SUB_FEATURE_TRAP_MINE ) {
					txtef COLOR_SKY_BLUE
					txt lang(" *チュドーン！* ", " *kabooom* ")
					aniref = 0
					animeid = ANIMATION_BALL
					anix = movx
					aniy = movy
					gosub *anime
					if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
						dmghp cc, 50 + limit(rnd(gdata(GDATA_LEVEL) + gdata(STARTING_GDATA_FLAG + 379) + 1) * 5, 1, 99999), DAMAGE_FROM_TRAP
					}
					if ( feat(2) == CELL_SUB_FEATURE_TRAP_MINE ) {
						dmghp cc, 50 + limit(rnd(gdata(GDATA_LEVEL) + 1) * 5, 1, 99999), DAMAGE_FROM_CHARA
					}
					if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
						if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
							qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF))++
							txtef COLOR_GREEN
							txt lang("撤去済み", "Removed ") + "(" + qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) + ") " + lang("撤去ノルマ", "Quota ") + "(" + qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) + ")"
						}
					}
					cell_featset movx, movy, 0
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_BLADE_STRINGS | feat(2) == CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS ) {
					txtef COLOR_SKY_BLUE
					txt lang(name(cc) + "は鋭い糸に突っ込んだ。", name(cc) + " " + was(cc) + " torn up in the sharp strings.")
					snd SOUNDLIST_STAB
					if ( feat(2) == CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS ) {
						hostileaction CHARA_PLAYER, cc
					}
					cell_featset movx, movy, 0
					dmghp cc, limit(sdata(SKILL_ATTR_SPD, cc) / 2 + limit(rnd(gdata(GDATA_LEVEL) + 1) * 2, 1, 9999) - cdata(CDATA_PV, cc), 1, 9999), DAMAGE_FROM_TRAP
				}
				if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL | feat(2) == CELL_SUB_FEATURE_TRAP_PITFALL ) {
					txtef COLOR_SKY_BLUE
					txt lang(name(cc) + "は落とし穴に転がり落ちた。", name(cc) + " fell into the pitfall trap.")
					snd SOUNDLIST_SNOW
					if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL ) {
						dmghp cc, limit((gdata(GDATA_LEVEL) + gdata(STARTING_GDATA_FLAG + 379)) / 2 + limit(rnd(gdata(GDATA_LEVEL) + gdata(STARTING_GDATA_FLAG + 379) + 1) * 2, 1, 9999) - cdata(CDATA_DV, cc), 2, 9999), DAMAGE_FROM_TRAP
					}
					if ( feat(2) == CELL_SUB_FEATURE_TRAP_PITFALL ) {
						dmghp cc, limit(gdata(GDATA_LEVEL) / 2 + limit(rnd(gdata(GDATA_LEVEL) + 1) * 2, 1, 9999) - cdata(CDATA_DV, cc), 2, 9999), DAMAGE_FROM_CHARA
					}
					if ( cdata(CDATA_CONDITION_INVERT, cc) < 2 ) {
						cdata(CDATA_CONDITION_INVERT, cc) = 2
					}
					if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
						if ( feat(2) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL ) {
							qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF))++
							txtef COLOR_GREEN
							txt lang("撤去済み", "Removed ") + "(" + qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) + ") " + lang("撤去ノルマ", "Quota ") + "(" + qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) + ")"
						}
					}
					cell_featset movx, movy, 0
				}
				efsource = 0
			}
		}
	}
	return

*perform
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_PERFORM
		cdata(CDATA_ACTION_PERIOD, cc) = 61
		if ( ens > 0 ) {
			cdata(CDATA_ACTION_PERIOD, cc) = 121
		}
		if ( ens == 0 ) {
			cdata(CDATA_ITEM_USING, cc) = ci
		}
		cdata(CDATA_PERFORM_SCORE, cc) = 40
		cdata(CDATA_PERFORM_GOLD, cc) = 0
		if ( cc == CHARA_PLAYER ) {
			performtips = 0
		}
		return
	}
	if ( cdata(CDATA_ID, cc) == CREATURE_ID_KARAVIKA ) {
		if ( cdata(CDATA_ALLIED, cc) == 0 ) {
			ens = 1
		}
	}
	if ( ens > 0 ) {
		ensci = limit(100 + ens, 100, 300)
	}
	else {
		ensci = inv(INV_ITEM_PARAM1, ci)
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MELODYUS ) {
		ensci = limit((sdata(SKILL_NORMAL_PERFORMER, cc) + 1) / 3, 5, 250)
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		ci = cdata(CDATA_ITEM_USING, cc)
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 10 == 0 ) {
			if ( synccheck(cc, -1) ) {
				if ( rnd(2) == 0 ) {
					txtef COLOR_BLUE
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_OCARINA | inv(INV_ITEM_ID, ci) == ITEM_ID_RECORDER | inv(INV_ITEM_ID, ci) == ITEM_ID_PAN_FLUTE ) {
						txt lang("ﾋﾟﾛｰ♪ ", "*Zip*"), lang("ﾌﾟｵｰ♪ ", "*Zingo*"), lang("ﾎﾟｰ♪ ", "*Yowl*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SERPENT | inv(INV_ITEM_ID, ci) == ITEM_ID_HORN ) {
						txt lang("ﾌﾞｵﾝ♪ ", "*Blare*"), lang("ﾌﾞｵｰ♪ ", "*Howl*"), lang("ﾎﾞｵｰ♪ ", "*Puff*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HARMONICA ) {
						txt lang("ﾎﾟｰ♪ ", "*Twang*"), lang("ﾋﾟｮｰ♪ ", "*Whizz*"), lang("ﾊﾟｰ♪ ", "*Puff*"), lang("ﾌﾟｵｰ♪ ", "*Twang*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_UPRIGHT_PIANO | inv(INV_ITEM_ID, ci) == ITEM_ID_GOULDS_PIANO | inv(INV_ITEM_ID, ci) == ITEM_ID_GRAND_PIANO ) {
						txt lang("ｼﾞｬﾝ♪ ", "*Cha*"), lang("ﾁｬﾗﾗ♪ ", "*Dan*"), lang("ﾀﾞｰﾝ♪ ", "*Tiki*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_STRADIVARIUS ) {
						txt lang("ｷｲｰ♪ ", "*Zip*"), lang("ｷﾛｰ♪ ", "*Plunk*"), lang("ｷｺ♪ ", "*Ping*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HARP | inv(INV_ITEM_ID, ci) == ITEM_ID_LUTE ) {
						txt lang("ﾁｬﾗﾝ♪ ", "*Tiki*"), lang("ﾎﾟﾛﾝ♪ ", "*Plunk*"), lang("ﾎﾟﾛﾛ♪ ", "*Ding*")
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_WADAIKO ) {
						txt lang("ﾄﾞﾝﾄﾞﾝ♪ ", "*Bam*"), lang("ｶｯｶ♪ ", "*Rat-a-tat*"), lang("ﾄﾞｺﾄﾞﾝ♪ ", "*Bash*"), lang("ﾄﾞｺﾄﾞｺ♪ ", "*Bump*")
					}
				}
				if ( rnd(10) == 0 ) {
					if ( cdata(CDATA_ID, cc) == CREATURE_ID_KARAVIKA ) {
						if ( rnd(2) == 0 ) {
							txtef COLOR_YELLOW
							txt lang(" ♪振り返れば消えていく足跡　褪せていく思い出♪ ", "*Lulu*"), lang(" ♪血を吐きながら　乗り越えた日々も♪ ", "*Laaa*"), lang(" ♪精一杯　胸に刻み込んで♪ ", "*Lulu*"), lang(" ♪君と僕の向かう先は違うけれど♪ ", "*Lulu*"), lang(" ♪明日は僕らの開拓地♪ ", "*Lala*"), lang(" ♪僕らは明日の開拓者♪ ", "*Lala*")
						}
						else {
							txtef COLOR_YELLOW
							txt lang(" ♪情熱が恐怖焼き尽くして♪ ", "*Lala*"), lang(" ♪向かい風も　不安の影も♪ ", "*Lala*"), lang(" ♪忘れたはずの約束が蘇る♪ ", "*Lala*"), lang(" ♪夢の残骸も　汗の結晶も　新たな道の礎だから♪ ", "*Lala*"), lang(" ♪それでも前へ　前へ進むのさ♪ ", "*Lala*")
						}
					}
				}
				if ( ens > 0 ) {
					if ( rnd(5) == 0 ) {
						txtef COLOR_YELLOW
						txt lang("ﾗﾗﾗ♪ ", "*Lulu*"), lang("ﾗｰ♪ ", "*Laaa*"), lang("ﾙﾙﾙ♪ ", "*Lala*")
					}
				}
				txtef COLOR_BLUE
				txt lang("〜♪ ", "*Cha*")
			}
		}
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 20 == 0 ) {
			gold = 0
			make_sound cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 5, 1, 1, cc
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 >= cdata(CDATA_INTEREST_RENEW, cnt) ) {
					cdata(CDATA_INTEREST, cnt) = 100
				}
				if ( synccheck(cc, -1) ) {
					if ( cdata(CDATA_SYNC, cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > 3 ) {
						continue
					}
				}
				if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				x = cdata(CDATA_X, cnt)
				y = cdata(CDATA_Y, cnt)
				if ( map(x, y, 1) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cdata(CDATA_RELATION, tc) == (-3) ) {
					if ( cdata(CDATA_AI_AGGRO, tc) == 0 ) {
						if ( synccheck(tc, -1) ) {
							txt lang(name(tc) + "は激怒した。", name(tc) + " get" + _s(tc) + " angry.")
						}
					}
					cdata(CDATA_AI_AGGRO, tc) = 30
					continue
				}
				if ( cc == CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						cdata(CDATA_INTEREST, tc) -= rnd(15)
						cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
					}
				}
				if ( sdata(SKILL_NORMAL_PERFORMER, cc) + ens / 2 < cdata(CDATA_LEVEL, tc) / 2 ) {
					if ( cdata(CDATA_ID, cc) != CREATURE_ID_KARAVIKA ) {
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							if ( rnd(3) == 0 ) {
								cdata(CDATA_PERFORM_SCORE, cc) -= cdata(CDATA_LEVEL, tc) / 2
								txtef COLOR_SKY_BLUE
								txt lang("「引っ込め！」", cnvtalk("Boo boo!")), lang("「うるさい！」", cnvtalk("Shut it!")), lang("「下手っぴ！」", cnvtalk("What are you doing!")), lang("「何のつもりだ！」", cnvtalk("You can't play shit."))
								txt lang("" + name(tc) + "は石を投げた。", name(tc) + " throw" + _s(tc) + " a rock.")
								dmg = rnd(cdata(CDATA_LEVEL, tc) + 1) + 1
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN ) {
									dmg = cdata(CDATA_LEVEL, tc) * 2 + rnd(100)
								}
								dmghp cc, dmg, DAMAGE_FROM_PERFORM
								if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_DEAD ) {
									break
								}
								continue
							}
						}
					}
				}
				if ( cdata(CDATA_INTEREST, tc) <= 0 ) {
					if ( synccheck(cc, -1) ) {
						if ( cdata(CDATA_ID, cc) != CREATURE_ID_KARAVIKA ) {
							txtef COLOR_SKY_BLUE
							txt lang("「飽きた」", cnvtalk("Boring.")), lang("「前にも聴いたよ」", cnvtalk("I've heard this before.")), lang("「またこの曲か…」", cnvtalk("This song again?"))
						}
					}
					cdata(CDATA_INTEREST, tc) = 0
					continue
				}
				if ( rnd(3) == 0 ) {
					if ( cdata(CDATA_INTEREST, tc) > 0 ) {
						p = limit((cdata(CDATA_PERFORM_SCORE, cc) * (100 + ensci) / 100 + ens / 5) * 2, 0, cdata(CDATA_LEVEL, tc) * 5)
						if ( tc < MAX_CHARA_FOLLOWER ) {
							p = rnd(limit(p, 1, 100)) + 1
						}
						if ( cdata(CDATA_ROLE, tc) >= ROLE_SHOP_MIN & cdata(CDATA_ROLE, tc) < ROLE_GUEST_MIN | cdata(CDATA_ROLE, tc) == ROLE_GUEST_MERCHANT ) {
							p /= 10
						}
						if ( charaIsSummoned(tc) ) {
							p = limit((p + 1) / 5 + 1, 1, 3000)
						}
						if ( p > cdata(CDATA_GOLD, tc) ) {
							p = cdata(CDATA_GOLD, tc)
						}
						cdata(CDATA_GOLD, tc) -= p
						cdata(CDATA_GOLD, cc) += p
						gold += p
						if ( cc == CHARA_PLAYER ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								cdata(CDATA_INTEREST, tc) -= 20
								cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
							}
						}
					}
				}
				if ( cdata(CDATA_LEVEL, tc) > sdata(SKILL_NORMAL_PERFORMER, cc) + ens ) {
					continue
				}
				p = rnd(cdata(CDATA_LEVEL, tc) + 1) + 1
				if ( charaIsSummoned(tc) ) {
					p = limit((p + 1) / 5 + 1, 1, 30)
				}
				if ( rnd(sdata(SKILL_NORMAL_PERFORMER, cc) + 1) + ens > rnd(cdata(CDATA_LEVEL, tc) * 2 + 1) ) {
					if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
						if ( tc >= 57 ) {
							cdata(CDATA_IMPRESSION, tc) += rnd(3)
							calcpartyscore
						}
					}
					if ( rnd(2) == 0 ) {
						cdata(CDATA_PERFORM_SCORE, cc) += p
					}
					else {
						if ( rnd(6) == 0 ) {
							cdata(CDATA_PERFORM_SCORE, cc) -= p
						}
					}
				}
				if ( encfindspec(ci, 60) != (-1) ) {
					if ( rnd(15) == 0 ) {
						dmgcon tc, CONDITION_DRUNK, 500
					}
				}
				if ( charaIsSummoned(tc) ) {
					continue
				}
				if ( rnd(sdata(SKILL_NORMAL_PERFORMER, cc) + 1) + ens > rnd(cdata(CDATA_LEVEL, tc) * 5 + 1) ) {
					if ( rnd(3) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_SKY_BLUE
							txt lang(name(tc) + "は歓声を上げた。", name(tc) + " clap" + _s(tc) + "."), lang(name(tc) + "は目を輝かせた。", name(tc) + " listen" + _s(tc) + " to " + name(cc) + your(cc) + " music joyfully."), lang("「ブラボー」", cnvtalk("Bravo!")), lang("「いいぞ！」", cnvtalk("Nice song.")), lang(name(tc) + "はうっとりした。", cnvtalk("Scut!")), lang(name(tc) + "は" + name(cc) + "の演奏を褒め称えた。", name(tc) + " " + is(tc) + " excited!")
						}
						if ( cc == CHARA_PLAYER ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								if ( rnd(performtips * 2 + 4) == 0 ) {
									x = limit(cdata(CDATA_X, cc) - 1 + rnd(3), 0, mdata(MDATA_WIDTH) - 1)
									y = limit(cdata(CDATA_Y, cc) - 1 + rnd(3), 0, mdata(MDATA_HEIGHT) - 1)
									cell_check x, y
									if ( cellaccess == 0 ) {
										continue
									}
									if ( fov_los(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), x, y) == 0 ) {
										continue
									}
									if ( ens > 50 ) {
										flt calcobjlv(cdata(CDATA_PERFORM_SCORE, cc) / 10 + ens / 5), calcfixlv(FIX_QUALITY_GREAT + (rnd(3) == 0))
									}
									if ( ens > 0 & ens <= 50 ) {
										flt calcobjlv(cdata(CDATA_PERFORM_SCORE, cc) / 10 + ens / 5), calcfixlv(FIX_QUALITY_GREAT + (rnd(20) == 0))
									}
									if ( ens == 0 ) {
										if ( encfindspec(ci, 49) != (-1) ) {
											flt calcobjlv(cdata(CDATA_PERFORM_SCORE, cc) / 8), calcfixlv(FIX_QUALITY_GREAT + (rnd(4) == 0))
										}
										else {
											flt calcobjlv(cdata(CDATA_PERFORM_SCORE, cc) / 10), calcfixlv(FIX_QUALITY_GREAT)
										}
									}
									flttypemajor = fsetperform(rnd(length(fsetperform)))
									dbid = 0
									if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
										if ( rnd(150) == 0 ) {
											dbid = ITEM_ID_SAFE
										}
										if ( rnd(200) == 0 ) {
											dbid = ITEM_ID_SMALL_MEDAL
										}
										if ( cdata(CDATA_LEVEL, tc) > 30 ) {
											if ( rnd(1000) == 0 ) {
												dbid = ITEM_ID_NAIL_STRADIVARIUS
											}
										}
										if ( cdata(CDATA_LEVEL, tc) > 15 ) {
											if ( rnd(800) == 0 ) {
												dbid = ITEM_ID_KILL_KILL_PIANO
											}
										}
										if ( cdata(CDATA_LEVEL, tc) > 10 ) {
											if ( rnd(600) == 0 ) {
												dbid = ITEM_ID_ALUD
											}
										}
									}
									else {
										if ( rnd(10) == 0 ) {
											dbid = ITEM_ID_MUSIC_TICKET
										}
										if ( rnd(250) == 0 ) {
											dbid = ITEM_ID_PLATINUM_COIN
										}
									}
									itemcreate -1, dbid, x, y, 1
									if ( stat != 0 ) {
										inv(INV_ITEM_NUM, ci)--
										cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
										ccbk = cc
										cc = tc
										animeid = ANIMATION_THROW
										aniref = inv(INV_ITEM_PIC, ci), inv(INV_ITEM_COL, ci)
										anix = inv(INV_ITEM_X, ci)
										aniy = inv(INV_ITEM_Y, ci)
										gosub *anime
										cc = ccbk
										inv(INV_ITEM_NUM, ci)++
										cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
										performtips++
									}
								}
							}
						}
					}
				}
			loop
			if ( gold != 0 ) {
				cdata(CDATA_PERFORM_GOLD, cc) += gold
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_GETGOLD1
				}
			}
		}
		return
	}
	repeat 1
		if ( cc != CHARA_PLAYER ) {
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 0 ) {
			txt lang("まるで駄目だ…", "It is a waste of time.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 20 ) {
			txt lang("不評だった…", "Almost everyone ignores you.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 40 ) {
			txt lang("もっと練習しなくては…", "You need to practice a lot more.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) == 40 ) {
			txt lang("演奏を終えた。", "You finish your performance.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 60 ) {
			txt lang("いまいちだ。", "Not good.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 80 ) {
			txt lang("手ごたえがあった。", "People seem to like your performance.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 100 ) {
			txt lang("納得できる演奏ができた。", "Your performance is successful.")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 120 ) {
			txt lang("大盛況だ！", "Wonderful!")
			break
		}
		if ( cdata(CDATA_PERFORM_SCORE, cc) < 150 ) {
			txt lang("素晴らしい！", "Great performance. Everyone cheers you.")
			break
		}
		txt lang("歴史に残る名演だ！", "A Legendary stage!")
		break
	loop
	if ( cdata(CDATA_PERFORM_SCORE, cc) > 40 ) {
		cdata(CDATA_PERFORM_SCORE, cc) = cdata(CDATA_PERFORM_SCORE, cc) * (100 + ensci / 5) / 100
	}
	if ( cdata(CDATA_PERFORM_GOLD, cc) != 0 ) {

		/********** ORIGINAL - BEGINNING **********

		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
		}

		 ********** ORIGINAL - ENDING **********/

		/********** ANNA CUSTOM - BEGINNING **********/ // Share Gold For Group Performance.

		if ( synccheck(cc, -1) ) {
			if ( TweakData(TWEAK_GAMEPLAY_SHARED_PERFORMANCE_GOLD, TWEAK_CATEGORY_GAMEPLAY) == 1 & EnsembleStart == 1 ) {
				TCount1 = 1

				repeat MAX_CHARA_FOLLOWER
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cnt == CHARA_PLAYER ) {
						continue
					}
					if ( sdata(SKILL_NORMAL_PERFORMER, cnt) > 0 ) {
						TCount1++
					}
				loop
				repeat MAX_CHARA_FOLLOWER
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cnt == CHARA_PLAYER ) {
						continue
					}
					if ( sdata(SKILL_NORMAL_PERFORMER, cnt) > 0 ) {
						cdata(CDATA_GOLD, cnt) += cdata(CDATA_PERFORM_GOLD, cc) / TCount1
						cdata(CDATA_GOLD, CHARA_PLAYER) -= cdata(CDATA_PERFORM_GOLD, cc) / TCount1
					}
				loop

				txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives your party a total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces. You keep " + cdata(CDATA_PERFORM_GOLD, cc)/TCount1 + " and share the rest with your allies.")
				EnsembleStart = 0
			}
			else {
				txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
			}
		}

		/********** ANNA CUSTOM - ENDING **********/

	}
	rew1 = limit(cdata(CDATA_PERFORM_SCORE, cc) - sdata(SKILL_NORMAL_PERFORMER, cc) - ens + 20, 1, 800)
	skillexp SKILL_NORMAL_PERFORMER, cc, rew1, 0, 0
	if ( cdata(CDATA_ID, cc) == CREATURE_ID_BARD | cdata(CDATA_ID, cc) == CREATURE_ID_KARAVIKA ) {
		skillexp SKILL_NORMAL_PERFORMER, cc, rew1, 0, 0
	}
	if ( cc == CHARA_PLAYER ) {
		if ( ens > 0 ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cnt >= MAX_CHARA_FOLLOWER ) {
						continue
					}
					else {
						if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, tc) ) {
							continue
						}
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				rew1 = limit(cdata(CDATA_PERFORM_SCORE, cc) - sdata(SKILL_NORMAL_PERFORMER, tc) - ens + 20, 1, 800)
				if ( rew1 > 0 ) {
					skillexp SKILL_NORMAL_PERFORMER, tc, rew1, 0, 0
				}
			loop
			ens = 0
		}
	}
	rowactend cc
	ensci = 0
	return

*start_writing
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は執筆を始めた。", name(cc) + " start" + _s(cc) + " writing.")
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_WRITING
		cdata(CDATA_ACTION_PERIOD, cc) = gdata(GDATA_FLAG_MANUSCRIPT_IDEAS) + 1
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 3 == 1 ) {
			snd SOUNDLIST_WRITE1
		}
		gdata(GDATA_FLAG_MANUSCRIPT_IDEAS)--
		booksitu = limit((rnd(sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) + sdata(SKILL_ATTR_PER, CHARA_PLAYER) + sdata(SKILL_ATTR_LER, CHARA_PLAYER) + 200) + 1) / 200, 0, 6)
		flt
		itemcreate -1, ITEM_ID_MANUSCRIPT, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_PARAM3, ci) = booksitu
		item_stack -1, ci, 0
		return
	}
	rowactend cc
	return

*perform_dance
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は踊り始めた。", name(cc) + " start" + _s(cc) + " dancing.")
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_PERFORM_DANCE
		cdata(CDATA_ACTION_PERIOD, cc) = 4
		if ( cc == CHARA_PLAYER ) {
			if ( mdatan(MDATAN_NAME) == lang("パーティー場", "Party Room") ) {
				cdata(CDATA_ACTION_PERIOD, cc) = 41
			}
		}
		cdata(CDATA_PERFORM_SCORE, cc) = 60
		cdata(CDATA_PERFORM_GOLD, cc) = 0
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 20 == 0 ) {
			gold = 0
			make_sound cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 5, 1, 1, cc
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 >= cdata(CDATA_INTEREST_RENEW, cnt) ) {
					cdata(CDATA_INTEREST, cnt) = 100
				}
				if ( synccheck(cc, -1) ) {
					if ( cdata(CDATA_SYNC, cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > 3 ) {
						continue
					}
				}
				if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_BLIND, cnt) > 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				x = cdata(CDATA_X, cnt)
				y = cdata(CDATA_Y, cnt)
				if ( map(x, y, 1) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cc == CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						cdata(CDATA_INTEREST, tc) -= rnd(15)
						cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
					}
				}
				if ( cdata(CDATA_INTEREST, tc) <= 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_SKY_BLUE
						txt lang("「飽きた」", cnvtalk("Boring.")), lang("「もうその踊りはいいよ」", cnvtalk("I've heard this before.")), lang("「まだ踊るのか…」", cnvtalk("You're still dancing?"))
					}
					cdata(CDATA_INTEREST, tc) = 0
					continue
				}
				if ( rnd(3) == 0 ) {
					if ( cdata(CDATA_INTEREST, tc) > 0 ) {
						p = limit(cdata(CDATA_PERFORM_SCORE, cc), 0, cdata(CDATA_LEVEL, tc) * 2)
						if ( tc < MAX_CHARA_FOLLOWER ) {
							p = 1
						}
						if ( cdata(CDATA_ROLE, tc) >= ROLE_SHOP_MIN & cdata(CDATA_ROLE, tc) < ROLE_GUEST_MIN | cdata(CDATA_ROLE, tc) == ROLE_GUEST_MERCHANT ) {
							p /= 100
						}
						if ( charaIsSummoned(tc) ) {
							p = limit((p + 1) / 5 + 1, 1, 3000)
						}
						if ( p > cdata(CDATA_GOLD, tc) ) {
							p = cdata(CDATA_GOLD, tc)
						}
						cdata(CDATA_GOLD, tc) -= p
						cdata(CDATA_GOLD, cc) += p
						gold += p
						if ( cc == CHARA_PLAYER ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								cdata(CDATA_INTEREST, tc) -= 20
								cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
							}
						}
					}
				}
				if ( cdata(CDATA_LEVEL, tc) * 4 > sdata(SKILL_ATTR_CHA, cc) ) {
					continue
				}
				p = rnd(cdata(CDATA_LEVEL, tc) / 2 + 2) + cdata(CDATA_LEVEL, tc) + 5
				if ( charaIsSummoned(tc) ) {
					p = limit((p + 1) / 5 + 1, 1, 30)
				}
				if ( rnd(sdata(SKILL_ATTR_CHA, cc) + 1) > rnd(cdata(CDATA_LEVEL, tc) * 4 + 5) ) {
					if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
						if ( tc >= 57 ) {
							if ( cdata(CDATA_IMPRESSION, tc) < 53 ) {
								cdata(CDATA_IMPRESSION, tc) += 2 + rnd(10)
								calcpartyscore
							}
						}
					}
					cdata(CDATA_PERFORM_SCORE, cc) += p
				}
			loop
			if ( gold > 0 ) {
				cdata(CDATA_PERFORM_GOLD, cc) += gold
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_GETGOLD1
				}
			}
		}
		return
	}
	if ( cdata(CDATA_PERFORM_GOLD, cc) != 0 ) {

		/********** ORIGINAL - BEGINNING **********

		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
		}

		 ********** ORIGINAL - ENDING **********/

		/********** ANNA CUSTOM - BEGINNING **********/ // Share Gold For Group Performance.

		if ( synccheck(cc, -1) ) {
			if ( TweakData(TWEAK_GAMEPLAY_SHARED_PERFORMANCE_GOLD, TWEAK_CATEGORY_GAMEPLAY) == 1 & EnsembleStart == 1 ) {
				TCount1 = 1

				repeat MAX_CHARA_FOLLOWER
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cnt == CHARA_PLAYER ) {
						continue
					}
					if ( sdata(SKILL_NORMAL_PERFORMER, cnt) > 0 ) {
						TCount1++
					}
				loop
				repeat MAX_CHARA_FOLLOWER
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cnt == CHARA_PLAYER ) {
						continue
					}
					if ( sdata(SKILL_NORMAL_PERFORMER, cnt) > 0 ) {
						cdata(CDATA_GOLD, cnt) += cdata(CDATA_PERFORM_GOLD, cc)/TCount1
						cdata(CDATA_GOLD, CHARA_PLAYER) -= cdata(CDATA_PERFORM_GOLD, cc)/TCount1
					}
				loop

				txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives your party a total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces. You keep " + cdata(CDATA_PERFORM_GOLD, cc)/TCount1 + " and share the rest with your allies.")
				EnsembleStart = 0
			}
			else {
				txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
			}
		}

		/********** ANNA CUSTOM - ENDING **********/

	}
	if ( cdata(CDATA_PERFORM_SCORE, cc) != 0 ) {
		rew1 = limit(cdata(CDATA_PERFORM_SCORE, cc) - sdata(SKILL_ATTR_CHA, cc), 10, 100)
		skillexp SKILL_ATTR_CHA, cc, rew1, 0, 0
	}
	snd SOUNDLIST_PRAY1
	animeload ANIMATION_GOLDENSTORM, cc
	rowactend cc
	repeat MAX_CHARA_TOTAL
		if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cdata(CDATA_RELATION, cc) == 10 | cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_RELATION, cnt) == 10 | cnt == CHARA_PLAYER ) {
				continue
			}
		}
		if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
			continue
		}
		if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
			continue
		}
		if ( cdata(CDATA_CONDITION_BLIND, cnt) > 0 ) {
			continue
		}
		if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
			continue
		}
		if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
			continue
		}
		if ( cc == cnt ) {
			continue
		}
		tc = cnt
		dx = cdata(CDATA_X, tc)
		dy = cdata(CDATA_Y, tc)
		if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
			continue
		}
		if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
			continue
		}
		if ( cdata(CDATA_ALLIED, cc) == 0 ) {
			if ( tc == CHARA_PLAYER ) {
				dmgsp CHARA_PLAYER, rnd(10) + 10
			}
		}
		if ( tc != CHARA_PLAYER ) {
			if ( cdata(CDATA_ALLIED, cc) == 0 | cdata(CDATA_ALLIED, tc) == 0 ) {
				dmgspt tc, rnd(10) + 10
			}
		}
		if ( cdata(CDATA_CONDITION_PARALYZE, tc) == (-1) ) {
			txt lang(name(tc) + "は落ち着いている。", name(tc) + " come" + _s(tc) + " to " + yourself(tc) + " again.")
			continue
		}
		if ( rnd(sdata(SKILL_ATTR_CHA, cc) + cdata(CDATA_IMPRESSION, tc)) >= rnd(sdata(SKILL_ATTR_WIL, tc)) ) {
			snd SOUNDLIST_PRAY1
			cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
			txtef COLOR_YELLOW
			txt lang(name(tc) + "の視線は釘づけだ！", name(tc) + " " + is(tc) + " crazy about " + name(cc) + "!"), lang(name(tc) + "は思わず生唾を飲み込んだ。", name(tc) + " " + is(tc) + " fascinated."), lang("「ビューティフォー…」", cnvtalk("Beautiful...")), lang("「…すごい」", cnvtalk("Amazing...")), lang(name(tc) + "は完全に見とれている。", name(tc) + " " + is(tc) + " deeply appreciative.")
			if ( cdata(CDATA_ALLIED, cc) == 0 ) {
				if ( tc == CHARA_PLAYER ) {
					dmgsp CHARA_PLAYER, rnd(10) + 10
				}
			}
			if ( tc != CHARA_PLAYER ) {
				if ( cdata(CDATA_ALLIED, cc) == 0 | cdata(CDATA_ALLIED, tc) == 0 ) {
					dmgspt tc, rnd(10) + 10
				}
			}
			if ( cdata(CDATA_CONDITION_PARALYZE, tc) == 0 ) {
				cdata(CDATA_CONDITION_PARALYZE, tc) = 1
			}
		}
		else {
			txtef COLOR_RED
			txt lang(name(tc) + "は平然としている！", name(tc) + " is nonchalant!"), lang(name(tc) + "は真顔で" + name(cc) + "を見ている…。", name(tc) + " gives " + name(cc) + " a serious look.")
		}
	loop
	return

*perform_begging
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は物乞いを始めた。", name(cc) + " start" + _s(cc) + " begging.")
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_BEGGING
		cdata(CDATA_ACTION_PERIOD, cc) = 61
		cdata(CDATA_PERFORM_GOLD, cc) = 0
		if ( cc == CHARA_PLAYER ) {
			performtips = 0
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 20 == 0 ) {
			gold = 0
			make_sound cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 5, 1, 1, cc
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 >= cdata(CDATA_INTEREST_RENEW, cnt) ) {
					cdata(CDATA_INTEREST, cnt) = 100
				}
				if ( synccheck(cc, -1) ) {
					if ( cdata(CDATA_SYNC, cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > 3 ) {
						continue
					}
				}
				if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == TRUE ) {
					continue
				}
				x = cdata(CDATA_X, cnt)
				y = cdata(CDATA_Y, cnt)
				if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cc == CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						cdata(CDATA_INTEREST, tc) -= rnd(15)
						cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
					}
				}
				if ( cdata(CDATA_INTEREST, tc) <= 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							txt "「目障り」", "「あっちいけ！」", "「シッシッ！」"
						}
						if ( en ) {
							txt cnvtalk("Go away!"), cnvtalk("You are an eyesore!")
						}
					}
					cdata(CDATA_INTEREST, tc) = 0
					continue
				}
				if ( cdata(CDATA_GOLD, cc) > cdata(CDATA_GOLD, tc) ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_SKY_BLUE
							if ( jp ) {
								txt "「" + _ore(3) + "よりお金持ってるみたい" + _dana(3) + "」"
							}
							if ( en ) {
								txt cnvtalk("You have more money than me!")
							}
							if ( 0 ) {
								if ( rnd(5) == 0 ) {
									cdata(CDATA_GOLD, CHARA_PLAYER) = 0
								}
							}
						}
						continue
					}
				}
				if ( rnd(3) == 0 ) {
					if ( cdata(CDATA_INTEREST, tc) > 0 ) {
						p = cdata(CDATA_LEVEL, tc) * 2 + 5
						if ( tc < MAX_CHARA_FOLLOWER ) {
							p = 1
						}
						if ( cdata(CDATA_ROLE, tc) >= ROLE_SHOP_MIN & cdata(CDATA_ROLE, tc) < ROLE_GUEST_MIN | cdata(CDATA_ROLE, tc) == ROLE_GUEST_MERCHANT ) {
							p /= 50
						}
						if ( charaIsSummoned(tc) ) {
							p = limit((p + 1) / 5 + 1, 1, 300)
						}
						if ( p > cdata(CDATA_GOLD, tc) ) {
							p = cdata(CDATA_GOLD, tc)
						}
						cdata(CDATA_GOLD, tc) -= p
						cdata(CDATA_GOLD, cc) += p
						gold += p
						if ( cc == CHARA_PLAYER ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								cdata(CDATA_INTEREST, tc) -= 20
								cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
							}
						}
						if ( jp ) {
							txt "「哀れな…」", "「すっごいかわいそ！」", "「みじめぇ！」"
						}
						if ( en ) {
							txt cnvtalk("Pathetic!"), cnvtalk("Very pitiful...")
						}
					}
				}
				if ( cc == CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						if ( rnd(performtips * 2 + 4) == 0 ) {
							x = limit(cdata(CDATA_X, cc) - 1 + rnd(3), 0, mdata(MDATA_WIDTH) - 1)
							y = limit(cdata(CDATA_Y, cc) - 1 + rnd(3), 0, mdata(MDATA_HEIGHT) - 1)
							cell_check x, y
							if ( cellaccess == 0 ) {
								continue
							}
							if ( fov_los(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), x, y) == 0 ) {
								continue
							}
							dbid = 0
							if ( rnd(5) == 0 ) {
								dbid = 187
							}
							if ( rnd(10) == 0 ) {
								dbid = 258
							}
							if ( rnd(20) == 0 ) {
								dbid = 812
							}
							if ( rnd(30) == 0 ) {
								dbid = 571
							}
							if ( dbid != 0 ) {
								flt
								itemcreate -1, dbid, x, y, 1
								inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
							}
							if ( dbid != 0 ) {
								inv(INV_ITEM_NUM, ci)--
								cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
								ccbk = cc
								cc = tc
								animeid = ANIMATION_THROW
								aniref = inv(INV_ITEM_PIC, ci), inv(INV_ITEM_COL, ci)
								anix = inv(INV_ITEM_X, ci)
								aniy = inv(INV_ITEM_Y, ci)
								gosub *anime
								cc = ccbk
								inv(INV_ITEM_NUM, ci)++
								cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
								performtips++
							}
						}
					}
				}
			loop
			if ( gold > 0 ) {
				cdata(CDATA_PERFORM_GOLD, cc) += gold
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_GETGOLD1
				}
			}
		}
		return
	}
	if ( cdata(CDATA_PERFORM_GOLD, cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "めぐんでもらった。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
		}
		decfame cc, 40
		p = stat
		if ( cc < MAX_CHARA_FOLLOWER ) {
			txtmore
			txtef COLOR_RED
			txt lang("名声値を" + p + "失った。", name(cc) + " lose " + p + " fame.")
		}
	}
	rowactend cc
	return

*perform_preach
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は説法を始めた。", name(cc) + " start" + _s(cc) + " preaching.")
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_PERFORM_PREACH
		cdata(CDATA_ACTION_PERIOD, cc) = 61
		cdata(CDATA_PERFORM_GOLD, cc) = 0
		performtips = 0
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 20 == 0 ) {
			gold = 0
			make_sound cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 5, 1, 1, cc
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 >= cdata(CDATA_INTEREST_RENEW, cnt) ) {
					cdata(CDATA_INTEREST, cnt) = 100
				}
				if ( synccheck(cc, -1) ) {
					if ( cdata(CDATA_SYNC, cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > 3 ) {
						continue
					}
				}
				if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				x = cdata(CDATA_X, cnt)
				y = cdata(CDATA_Y, cnt)
				if ( map(x, y, 1) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cdata(CDATA_RELATION, tc) == (-3) ) {
					if ( cdata(CDATA_AI_AGGRO, tc) == 0 ) {
						if ( synccheck(tc, -1) ) {
							txt lang(name(tc) + "は激怒した。", name(tc) + " get" + _s(tc) + " angry.")
						}
					}
					cdata(CDATA_AI_AGGRO, tc) = 30
					continue
				}
				if ( cc == CHARA_PLAYER ) {
					cdata(CDATA_INTEREST, tc) -= rnd(15)
					cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
				}
				if ( cdata(CDATA_INTEREST, tc) <= 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_SKY_BLUE
						txt lang("「飽きた」", cnvtalk("Boring.")), lang("「もうその話は聴いたよ」", cnvtalk("I've heard this before.")), lang("「まだ喋るのか…」", cnvtalk("You're still talking?"))
					}
					cdata(CDATA_INTEREST, tc) = 0
					continue
				}
				if ( sdata(SKILL_NORMAL_FAITH, cc) < sdata(SKILL_NORMAL_FAITH, tc) ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						if ( rnd(6) == 0 | (rnd(3) == 0 & cdata(CDATA_GOD, cc) != cdata(CDATA_GOD, tc)) ) {
							if ( synccheck(cc, -1) ) {
								txtef COLOR_SKY_BLUE
								txt lang("「引っ込め！」", cnvtalk("Take it back!")), lang("「うるさい！」", cnvtalk("Shut up!")), lang("「この不届き者！」", cnvtalk("You insolent piece of...!"))
								txt lang("" + name(tc) + "は石を投げた。", name(tc) + " throw" + _s(tc) + " a rock.")
							}
							dmg = rnd(sdata(SKILL_NORMAL_FAITH, tc) + 1) + 1
							if ( cdata(CDATA_ID, tc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN ) {
								dmg = cdata(CDATA_LEVEL, tc) * 2 + rnd(100)
							}
							dmghp cc, dmg, DAMAGE_FROM_PERFORM
							if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_DEAD ) {
								break
							}
							continue
						}
					}
				}
				if ( rnd(3) == 0 ) {
					if ( cdata(CDATA_INTEREST, tc) > 0 ) {
						p = limit(sdata(SKILL_NORMAL_FAITH, cc) * 10, 0, cdata(CDATA_LEVEL, tc) * 8)
						if ( tc < MAX_CHARA_FOLLOWER ) {
							p = 1
						}
						if ( cdata(CDATA_ROLE, tc) >= ROLE_SHOP_MIN & cdata(CDATA_ROLE, tc) < ROLE_GUEST_MIN | cdata(CDATA_ROLE, tc) == ROLE_GUEST_MERCHANT ) {
							p /= 50
						}
						if ( charaIsSummoned(tc) ) {
							p = limit((p + 1) / 5 + 1, 1, 3000)
						}
						if ( p > cdata(CDATA_GOLD, tc) ) {
							p = cdata(CDATA_GOLD, tc)
						}
						cdata(CDATA_GOLD, tc) -= p
						cdata(CDATA_GOLD, cc) += p
						gold += p
						if ( cc == CHARA_PLAYER ) {
							cdata(CDATA_INTEREST, tc) -= 20
							cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
						}
					}
				}
				if ( sdata(SKILL_NORMAL_FAITH, cc) < sdata(SKILL_NORMAL_FAITH, tc) ) {
					continue
				}
				if ( rnd(sdata(SKILL_NORMAL_FAITH, cc) + 1) > rnd(sdata(SKILL_NORMAL_FAITH, tc) * 3 + 1) ) {
					if ( rnd(3) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_SKY_BLUE
							kami = 0
							if ( cdata(CDATA_GOD, cc) == GOD_MANI ) {
								if ( cdata(CDATA_GOD, tc) == GOD_MANI ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEUS_EX_MANINA | cdata(CDATA_ID, tc) == CREATURE_ID_MANI ) {
										kami = 100
										txt lang("「見事な論理展開と言えるだろう」", cnvtalk("You could say this is a stunning logical development.")), lang("「ちゃんと録画しているぞ」", cnvtalk("Oh, I'm recording this one!"))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_LULWY ) {
								if ( cdata(CDATA_GOD, tc) == GOD_LULWY ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_LULWY | cdata(CDATA_ID, tc) == CREATURE_ID_DEVASTATE_LULWY ) {
										kami = 100
										txt lang("「あら、よくわかってるじゃない」", cnvtalk("Oh, you do get it.")), lang("「いい子ね。愚民にもっと教えてあげなさい」", cnvtalk("What a good child. Teach the ignorant more."))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_ITZPALT ) {
								if ( cdata(CDATA_GOD, tc) == GOD_ITZPALT ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_ITZPALT | cdata(CDATA_ID, tc) == CREATURE_ID_THE_ELEMENT ) {
										kami = 100
										txt lang("「皆、高らかに我が名を唱えよ」", cnvtalk("You all, chant my name higher!")), lang("「どうやら補足も不要のようだ」", cnvtalk("Complements are seemingly unnecessary."))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_EHEKATL ) {
								if ( cdata(CDATA_GOD, tc) == GOD_EHEKATL ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_EHEKATL | cdata(CDATA_ID, tc) == CREATURE_ID_GOD_INSIDE_EHEKATL ) {
										kami = 100
										txt lang("「えへへぇ」", cnvtalk("E-hehe")), lang("「褒めてくれてるの？くれてるの？」", cnvtalk("Are you praising me? Really, really?"))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_OPATOS ) {
								if ( cdata(CDATA_GOD, tc) == GOD_OPATOS ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_BUILDUP_OPATOS | cdata(CDATA_ID, tc) == CREATURE_ID_OPATOS ) {
										kami = 100
										txt lang("「フハー！その調子だ！」", cnvtalk("Muhan! That's the tune!")), lang("「フハハハハハーン！！！」", cnvtalk("Mwahahahan!!!"))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_JURE ) {
								if ( cdata(CDATA_GOD, tc) == GOD_JURE ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
										kami = 100
										txt lang("「ちょっ…そんなことまで言わなくていいの！」", cnvtalk("Tsk... Don't tell me things like that!")), lang("「な、なによ…恥ずかしいじゃない…」", cnvtalk("W-What? I'm not embarrassed..."))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_KUMIROMI ) {
								if ( cdata(CDATA_GOD, tc) == GOD_KUMIROMI ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_KUMIROMI | cdata(CDATA_ID, tc) == CREATURE_ID_INSANE_KUMIROMI ) {
										kami = 100
										txt lang("「僕のこと…もっと教えてあげるね…」", cnvtalk("I will... teach you more about me...")), lang("「ふふ…うれしいなぁ…」", cnvtalk("Fufu... I'm so happy..."))
									}
								}
							}
							if ( cdata(CDATA_GOD, cc) == GOD_YACATECT ) {
								if ( cdata(CDATA_GOD, tc) == GOD_YACATECT ) {
									if ( cdata(CDATA_ID, tc) == CREATURE_ID_YACATECT | cdata(CDATA_ID, tc) == CREATURE_ID_HYPER_YACATECT ) {
										kami = 100
										txt lang("「ん…照れるやんかぁ…」", cnvtalk("Hmm... Am I embarrassed...?")), lang("「ハイハイ、お布施はこちらまでー！」", cnvtalk("Yes, yes. Donations right this way!"))
									}
								}
							}
							p = sdata(SKILL_NORMAL_FAITH, tc) / 2 + 1
							if ( charaIsSummoned(tc) ) {
								p = limit((p + 1) / 5 + 1, 1, 30)
							}
							if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
								if ( tc >= 57 ) {
									if ( cdata(CDATA_IMPRESSION, tc) < 53 ) {
										cdata(CDATA_IMPRESSION, tc) += rnd(2)
										calcpartyscore
									}
								}
							}
							cdata(CDATA_PERFORM_SCORE, cc) += p
							if ( kami == 0 ) {
								txt lang(name(tc) + "は歓声を上げた。", name(tc) + " lets out a cheer."), lang("「なるほど」", cnvtalk("I see.")), lang("「素晴らしい！」", cnvtalk("That's amazing!")), lang(name(tc) + "はしきりに頷いている。", name(tc) + " nods in agreement.")
							}
							if ( tc != CHARA_PLAYER ) {
								inv_find ITEM_ID_NINE_GOD_SIGN, tc
								if ( stat == (-1) ) {
									if ( kami == 0 ) {
										if ( cdata(CDATA_GOD, tc) != cdata(CDATA_GOD, CHARA_PLAYER) ) {
											cdata(CDATA_GOD, tc) = cdata(CDATA_GOD, CHARA_PLAYER)
											txtef COLOR_GREEN
											txt lang("" + name(tc) + "は感激して" + godname(cdata(CDATA_GOD, tc)) + "に改宗した！", name(tc) + " converted to " + godname(cdata(CDATA_GOD, tc)) + " due to your inspiring words!")
											if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
												if ( tc >= 57 ) {
													if ( cdata(CDATA_IMPRESSION, tc) < 53 ) {
														cdata(CDATA_IMPRESSION, tc) += 2
														calcpartyscore
													}
												}
											}
											p = sdata(SKILL_NORMAL_FAITH, tc) * 2
											if ( charaIsSummoned(tc) ) {
												p = limit((p + 1) / 5 + 1, 1, 30)
											}
											cdata(CDATA_PERFORM_SCORE, cc) += p
											gdata(GDATA_FLAG_PEOPLE_CONVERTED)++
										}
									}
								}
							}
						}
					}
				}
			loop
			if ( gold > 0 ) {
				cdata(CDATA_PERFORM_GOLD, cc) += gold
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_GETGOLD1
				}
			}
		}
		return
	}
	if ( cdata(CDATA_PERFORM_GOLD, cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は合計 " + cdata(CDATA_PERFORM_GOLD, cc) + strgold + "のお布施を貰った。", "The audience gives " + name(cc) + " total of " + cdata(CDATA_PERFORM_GOLD, cc) + " gold pieces.")
		}
	}
	rowactend cc
	rew1 = limit(cdata(CDATA_PERFORM_SCORE, cc) / 2 + 20, 20, 500)
	skillexp SKILL_NORMAL_FAITH, cc, rew1, 0, 0
	if ( cc == CHARA_PLAYER ) {
		repeat MAX_CHARA_FOLLOWER - 1, 1
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			rew1 = limit(cdata(CDATA_PERFORM_SCORE, cc) / 2 + 20, 20, 500)
			if ( rew1 > 0 ) {
				skillexp SKILL_NORMAL_FAITH, tc, rew1, 0, 0
			}
		loop
	}
	return

*skill_charge
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_CHARGE
		cdata(CDATA_ACTION_PERIOD, cc) = 10
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は力をためはじめた。", name(cc) + " began to accumulate power.")
		}
		customtalk cc, DBMODE_FLAVOR_CHARGE_S
		gosub *convert_word
		if ( cc < MAX_CHARA_FOLLOWER ) {
			charp = 0
			repeat MAX_CHARA_FOLLOWER - 1, 1
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) != 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( dist(cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)) > 5 ) {
					continue
				}
				if ( rnd(3) == 0 ) {
					continue
				}
				charp++
				tc = cnt
				customtalk tc, DBMODE_FLAVOR_CHARGE
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					if ( jp ) {
						txt "「ここは任せて！」", "「時間は稼ぐよ！」", "「チャージの邪魔などさせるものか」", "「急いでね？」"
					}
				}
			loop
			if ( synccheck(cc, -1) ) {
				if ( charp != 0 ) {
					if ( cfg_animewait != 0 ) {
						await 100
					}
				}
			}
			charp = 0
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 5 == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は力をためている。", name(cc) + " is charging power.")
			}
		}
		return
	}
	txtef COLOR_RED
	txt lang("*フルチャージ！！*", "*Full Charge!!*")
	if ( synccheck(cc, -1) ) {
		animeid = ANIMATION_GENE
		anic = cc
		gosub *anime
	}
	if ( cc == CHARA_PLAYER ) {
		addbuff cc, BUFF_CHARGE, 400, 1
	}
	else {
		addbuff cc, BUFF_CHARGE, 400, 3
	}
	rowactend cc
	return

*skill_persuasion
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		gosub *findTarget
		if ( stat == 0 ) {
			powsel = 0
		}
		else {
			tc = cdata(CDATA_TARGET, cc)
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				efid = SKILL_SPACT_RESONANT_VOICE
				gosub *effect
				powsel = 0
				return
			}
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_PERSUASION
		cdata(CDATA_ACTION_PERIOD, cc) = 5
		ninzuu = 0
		kyouka = 0
		daihyou = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_TALKING ) {
				if ( findbuff(cnt, BUFF_HARMONIC_ASSAULT) != (-1) ) {
					ninzuu++
					kyouka += (sdata(SKILL_NORMAL_SENSE_QUALITY, cnt) + 10) / 5
					if ( daihyou == (-1) ) {
						daihyou = cnt
					}
					else {
						if ( rnd(4) == 0 ) {
							daihyou = cnt
						}
					}
				}
			}
		loop
		customtalk cc, DBMODE_FLAVOR_BTALK
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txt lang(name(cc) + "は説得を始めた。", name(cc) + " started to persuade.")
		}
		if ( daihyou >= 0 ) {
			if ( ninzuu == 1 ) {
				txt lang(name(daihyou) + "も説得に加わった！", name(daihyou) + " also joined the persuasion.")
			}
			if ( ninzuu > 1 ) {
				txt lang(name(daihyou) + "たちも説得に加わった！", name(daihyou) + " also joined the persuasion.")
			}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 & gdata(GDATA_TIME_STOP_TIME) == 0 & gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
				cdata(CDATA_CONDITION_DIM, tc) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			if ( rnd(sdata(SKILL_ATTR_WIL, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + kyouka) > rnd(sdata(SKILL_ATTR_WIL, tc)) ) {
				cdata(CDATA_EMO_ICON, tc) = 20 + 100
				cdata(CDATA_POWER_GAUGE, tc) -= 10
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				if ( rnd(20) == 0 ) {
					txt lang(name(tc) + "は動揺した。", name(tc) + " is upset.")
					if ( cdata(CDATA_CONDITION_CONFUSE, tc) == 0 ) {
						cdata(CDATA_CONDITION_CONFUSE, tc) = 1
					}
				}
				if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
					skillexp SKILL_ATTR_WIL, cc, 20
					skillexp SKILL_NORMAL_NEGOTIATION, cc, 20
				}
				talkfix = 1
				if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 2 ) {
					talkfix = 2
				}
				if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 3 ) {
					talkfix = 3
				}
				if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 4 ) {
					talkfix = 4
				}
				if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 5 ) {
					talkfix = 5
				}
				dmgtalk = (sdata(SKILL_ATTR_WIL, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc)) * 5 * talkfix / sdata(SKILL_ATTR_WIL, tc) + 1
				if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
					dmgtalk = dmgtalk / 5 + 1
				}
				dmgsptalk tc, dmgtalk
				if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
					skillexp SKILL_NORMAL_NEGOTIATION, cc, limit(cdata(CDATA_LEVEL, tc) * cdata(CDATA_LEVEL, tc) / 10, 10, 1000)
					cdata(CDATA_HP, tc) = -1
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
						}
						check_talk cc, tc
					}
					else {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は戦いに疲れ、静かに去っていった。", name(tc) + " got tired of fighting and quietly walked away.")
						}
						snd SOUNDLIST_EXITMAP1
						check_talk cc, tc
					}
				}
			}
			else {
				cdata(CDATA_EMO_ICON, tc) = 21 + 100
			}
		loop
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a little break.")
	rowactend cc
	return

*skill_peculiar_joke
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		gosub *findTarget
		if ( stat == 0 ) {
			powsel = 0
		}
		else {
			tc = cdata(CDATA_TARGET, cc)
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				efid = SKILL_SPACT_RESONANT_VOICE
				gosub *effect
				powsel = 0
				return
			}
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_PECULIAR_JOKE
		cdata(CDATA_ACTION_PERIOD, cc) = 5
		ninzuu = 0
		kyouka = 0
		daihyou = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_TALKING ) {
				if ( findbuff(cnt, BUFF_HARMONIC_ASSAULT) != (-1) ) {
					ninzuu++
					kyouka += (sdata(SKILL_NORMAL_SENSE_QUALITY, cnt) + 10) / 5
					if ( daihyou == (-1) ) {
						daihyou = cnt
					}
					else {
						if ( rnd(4) == 0 ) {
							daihyou = cnt
						}
					}
				}
			}
		loop
		customtalk cc, DBMODE_FLAVOR_BTALK
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txt lang(name(cc) + "は全力で笑わせにかかった。", name(cc) + " started telling a peculiar joke.")
		}
		if ( daihyou >= 0 ) {
			if ( ninzuu == 1 ) {
				txt lang(name(daihyou) + "もギャグに協力した！", name(daihyou) + " also joined the joke.")
			}
			if ( ninzuu > 1 ) {
				txt lang(name(daihyou) + "たちもギャグに協力した！", name(daihyou) + " also joined the joke.")
			}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 & gdata(GDATA_TIME_STOP_TIME) == 0 & gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
				cdata(CDATA_CONDITION_DIM, tc) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			if ( rnd(sdata(SKILL_ATTR_PER, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + kyouka) > rnd(sdata(SKILL_ATTR_PER, tc)) ) {
				cdata(CDATA_EMO_ICON, tc) = 20 + 100
				cdata(CDATA_POWER_GAUGE, tc) -= 10
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				if ( rnd(50) == 0 ) {
					txt lang(name(tc) + "は腹筋崩壊した。", name(tc) + " couldn't help laughing out loud.")
					if ( cdata(CDATA_CONDITION_PARALYZE, tc) == 0 ) {
						cdata(CDATA_CONDITION_PARALYZE, tc) = 1
					}
				}
				if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
					skillexp SKILL_ATTR_PER, cc, 20
					skillexp SKILL_NORMAL_NEGOTIATION, cc, 20
				}
				talkfix = 1
				if ( cdata(CDATA_POWER_GAUGE, tc) < 50 ) {
					talkfix = 2
				}
				dmgtalk = (sdata(SKILL_ATTR_PER, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc)) * 5 * talkfix / sdata(SKILL_ATTR_PER, tc) + 1
				if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
					dmgtalk = dmgtalk / 5 + 1
				}
				dmgsptalk tc, dmgtalk
				if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
					skillexp SKILL_NORMAL_NEGOTIATION, cc, limit(cdata(CDATA_LEVEL, tc) * cdata(CDATA_LEVEL, tc) / 10, 10, 1000)
					cdata(CDATA_HP, tc) = -1
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
						}
						check_talk cc, tc
					}
					else {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は上機嫌で去っていった。", name(tc) + " walks away in a good mood.")
						}
						snd SOUNDLIST_EXITMAP1
						check_talk cc, tc
					}
				}
			}
			else {
				cdata(CDATA_EMO_ICON, tc) = 21 + 100
			}
		loop
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a little break.")
	rowactend cc
	return

*skill_blended_lie
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		gosub *findTarget
		if ( stat == 0 ) {
			powsel = 0
		}
		else {
			tc = cdata(CDATA_TARGET, cc)
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				efid = SKILL_SPACT_RESONANT_VOICE
				gosub *effect
				powsel = 0
				return
			}
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_BLENDED_LIE
		cdata(CDATA_ACTION_PERIOD, cc) = 5
		ninzuu = 0
		kyouka = 0
		daihyou = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_TALKING ) {
				if ( findbuff(cnt, BUFF_HARMONIC_ASSAULT) != (-1) ) {
					ninzuu++
					kyouka += (sdata(SKILL_NORMAL_SENSE_QUALITY, cnt) + 10) / 5
					if ( daihyou == (-1) ) {
						daihyou = cnt
					}
					else {
						if ( rnd(4) == 0 ) {
							daihyou = cnt
						}
					}
				}
			}
		loop
		customtalk cc, DBMODE_FLAVOR_BTALK
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txt lang(name(cc) + "は嘘を交えて話し始めた。", name(cc) + " starts talking with mixed lies.")
		}
		if ( daihyou >= 0 ) {
			if ( ninzuu == 1 ) {
				txt lang(name(daihyou) + "が嘘を補強した！", name(daihyou) + " also joined the lie.")
			}
			if ( ninzuu > 1 ) {
				txt lang(name(daihyou) + "たちが嘘を補強した！", name(daihyou) + " also joined the lie.")
			}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 & gdata(GDATA_TIME_STOP_TIME) == 0 & gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
				cdata(CDATA_CONDITION_DIM, tc) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			if ( rnd(sdata(SKILL_ATTR_DEX, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + kyouka) > rnd(sdata(SKILL_ATTR_DEX, tc)) ) {
				cdata(CDATA_EMO_ICON, tc) = 20 + 100
				cdata(CDATA_POWER_GAUGE, tc) -= 10
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				if ( rnd(20) == 0 ) {
					txt lang(name(tc) + "は嘘を信じて不安になった。", name(tc) + " believed the lie and became uneasy.")
					if ( cdata(CDATA_CONDITION_ATROPHY, tc) == 0 ) {
						cdata(CDATA_CONDITION_ATROPHY, tc) = 1
					}
				}
				if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
					skillexp SKILL_ATTR_DEX, cc, 20
					skillexp SKILL_NORMAL_NEGOTIATION, cc, 20
				}
				talkfix = 1
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 9 / 10 ) {
					talkfix = 2
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 8 / 10 ) {
					talkfix = 3
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 7 / 10 ) {
					talkfix = 4
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 6 / 10 ) {
					talkfix = 5
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 5 / 10 ) {
					talkfix = 6
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 4 / 10 ) {
					talkfix = 7
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 3 / 10 ) {
					talkfix = 8
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 2 / 10 ) {
					talkfix = 9
				}
				if ( cdata(CDATA_MP, tc) < cdata(CDATA_MAX_MP, tc) * 1 / 10 ) {
					talkfix = 10
				}
				dmgtalk = (sdata(SKILL_ATTR_DEX, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc)) * 5 * talkfix / sdata(SKILL_ATTR_DEX, tc) + 1
				if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
					dmgtalk = dmgtalk / 5 + 1
				}
				dmgsptalk tc, dmgtalk
				if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
					skillexp SKILL_NORMAL_NEGOTIATION, cc, limit(cdata(CDATA_LEVEL, tc) * cdata(CDATA_LEVEL, tc) / 10, 10, 1000)
					cdata(CDATA_HP, tc) = -1
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
						}
						check_talk cc, tc
					}
					else {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "はすっかり騙されて去っていった。", name(tc) + " was completely fooled and left in a hurry.")
						}
						snd SOUNDLIST_EXITMAP1
						check_talk cc, tc
					}
				}
			}
			else {
				cdata(CDATA_EMO_ICON, tc) = 21 + 100
			}
		loop
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a little break.")
	rowactend cc
	return

*skill_intimidation
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		gosub *findTarget
		if ( stat == 0 ) {
			powsel = 0
		}
		else {
			tc = cdata(CDATA_TARGET, cc)
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				efid = SKILL_SPACT_RESONANT_VOICE
				gosub *effect
				powsel = 0
				return
			}
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_INTIMIDATION
		cdata(CDATA_ACTION_PERIOD, cc) = 5
		ninzuu = 0
		kyouka = 0
		daihyou = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_TALKING ) {
				if ( findbuff(cnt, BUFF_HARMONIC_ASSAULT) != (-1) ) {
					ninzuu++
					kyouka += (sdata(SKILL_NORMAL_SENSE_QUALITY, cnt) + 10) / 5
					if ( daihyou == (-1) ) {
						daihyou = cnt
					}
					else {
						if ( rnd(4) == 0 ) {
							daihyou = cnt
						}
					}
				}
			}
		loop
		customtalk cc, DBMODE_FLAVOR_BTALK
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txt lang(name(cc) + "は脅迫を始めた。", name(cc) + " started to intimidate.")
		}
		if ( daihyou >= 0 ) {
			if ( ninzuu == 1 ) {
				txt lang(name(daihyou) + "も脅迫に加担した！", name(daihyou) + " also joined the intimidation.")
			}
			if ( ninzuu > 1 ) {
				txt lang(name(daihyou) + "たちも脅迫に加担した！", name(daihyou) + " also joined the intimidation.")
			}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 & gdata(GDATA_TIME_STOP_TIME) == 0 & gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
				cdata(CDATA_CONDITION_DIM, tc) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			if ( rnd(sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + kyouka) > rnd(sdata(SKILL_ATTR_STR, tc)) ) {
				cdata(CDATA_EMO_ICON, tc) = 20 + 100
				cdata(CDATA_POWER_GAUGE, tc) -= 10
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				if ( rnd(50) == 0 ) {
					txt lang(name(tc) + "は恐怖した。", name(tc) + " was frightened.")
					if ( cdata(CDATA_CONDITION_FEAR, tc) == 0 ) {
						cdata(CDATA_CONDITION_FEAR, tc) = 1
					}
				}
				if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
					skillexp SKILL_ATTR_STR, cc, 20
					skillexp SKILL_NORMAL_NEGOTIATION, cc, 20
				}
				talkfix = 1
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 9 / 10 ) {
					talkfix = 2
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 8 / 10 ) {
					talkfix = 3
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 7 / 10 ) {
					talkfix = 4
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 6 / 10 ) {
					talkfix = 5
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 5 / 10 ) {
					talkfix = 6
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 4 / 10 ) {
					talkfix = 7
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 3 / 10 ) {
					talkfix = 8
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 2 / 10 ) {
					talkfix = 9
				}
				if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) * 1 / 10 ) {
					talkfix = 10
				}
				dmgtalk = (sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc)) * 5 * talkfix / sdata(SKILL_ATTR_STR, tc) + 1
				if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
					dmgtalk = dmgtalk / 5 + 1
				}
				dmgsptalk tc, dmgtalk
				if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
					skillexp SKILL_NORMAL_NEGOTIATION, cc, limit(cdata(CDATA_LEVEL, tc) * cdata(CDATA_LEVEL, tc) / 10, 10, 1000)
					cdata(CDATA_HP, tc) = -1
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
						}
						check_talk cc, tc
					}
					else {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は恐怖のあまり、慌てて逃げ去った。", name(tc) + " got scared and ran away quickly.")
						}
						snd SOUNDLIST_EXITMAP1
						check_talk cc, tc
					}
				}
			}
			else {
				cdata(CDATA_EMO_ICON, tc) = 21 + 100
			}
		loop
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a little break.")
	rowactend cc
	return

*skill_mysterious_song
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		gosub *findTarget
		if ( stat == 0 ) {
			powsel = 0
		}
		else {
			tc = cdata(CDATA_TARGET, cc)
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				efid = SKILL_SPACT_RESONANT_VOICE
				gosub *effect
				powsel = 0
				return
			}
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_MYSTERIOUS_SONG
		cdata(CDATA_ACTION_PERIOD, cc) = 5
		ninzuu = 0
		kyouka = 0
		daihyou = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_TALKING ) {
				if ( findbuff(cnt, BUFF_HARMONIC_ASSAULT) != (-1) ) {
					ninzuu++
					kyouka += (sdata(SKILL_NORMAL_SENSE_QUALITY, cnt) + 10) / 5
					if ( daihyou == (-1) ) {
						daihyou = cnt
					}
					else {
						if ( rnd(4) == 0 ) {
							daihyou = cnt
						}
					}
				}
			}
		loop
		customtalk cc, DBMODE_FLAVOR_BTALK
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txt lang(name(cc) + "は魔力を込めて歌い始めた。", name(cc) + " sing" + _s(cc) + " a magically charged song.")
		if ( daihyou >= 0 ) {
			if ( ninzuu == 1 ) {
				txt lang(name(daihyou) + "も歌声を重ねた！", name(daihyou) + " also joined the song.")
			}
			if ( ninzuu > 1 ) {
				txt lang(name(daihyou) + "たちも歌声を重ねた！", name(daihyou) + " also joined the song.")
			}
		}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 & gdata(GDATA_TIME_STOP_TIME) == 0 & gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
				cdata(CDATA_CONDITION_DIM, tc) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			if ( rnd(sdata(SKILL_ATTR_MAG, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + kyouka) > rnd(sdata(SKILL_ATTR_MAG, tc)) ) {
				cdata(CDATA_EMO_ICON, tc) = 20 + 100
				cdata(CDATA_POWER_GAUGE, tc) -= 10
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				if ( rnd(50) == 0 ) {
					txt lang(name(tc) + "は感激した。", name(tc) + " was deeply impressed.")
					if ( cdata(CDATA_CONDITION_PARALYZE, tc) == 0 ) {
						cdata(CDATA_CONDITION_PARALYZE, tc) = 1
					}
				}
				if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
					skillexp SKILL_ATTR_MAG, cc, 20
					skillexp SKILL_NORMAL_NEGOTIATION, cc, 20
				}
				talkfix = 1
				if ( cdata(CDATA_POWER_GAUGE, tc) > 50 ) {
					talkfix = 2
				}
				if ( cdata(CDATA_POWER_GAUGE, tc) > 100 ) {
					talkfix = 3
				}
				if ( cdata(CDATA_POWER_GAUGE, tc) > 150 ) {
					talkfix = 4
				}
				dmgtalk = (sdata(SKILL_ATTR_MAG, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc)) * 5 * talkfix / sdata(SKILL_ATTR_MAG, tc) + 1
				if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
					dmgtalk = dmgtalk / 5 + 1
				}
				dmgsptalk tc, dmgtalk
				if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
					cdata(CDATA_HP, tc) = -1
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
						}
						check_talk cc, tc
					}
					else {
						dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
						if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "は戦いに疲れ、静かに去っていった。", name(tc) + " got tired of fighting and quietly walked away.")
						}
						snd SOUNDLIST_EXITMAP1
						check_talk cc, tc
					}
				}
			}
			else {
				cdata(CDATA_EMO_ICON, tc) = 21 + 100
			}
		loop
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a little break.")
	rowactend cc
	return

*eat_meal
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_MEAL
		cdata(CDATA_ACTION_PERIOD, cc) = 20
		cdata(CDATA_EMO_ICON, cc) = 6 + 100 * 3
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は食事をはじめた。", name(cc) + " started having a meal.")
		}
		snd SOUNDLIST_EAT1
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		cdata(CDATA_EMO_ICON, cc) = 16 + 100
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 5 == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang("*むしゃむしゃ*", "*Munch munch*")
			}
		}
		return
	}
	txt lang(name(cc) + "は食事を終えた。", name(cc) + " finished a meal.")
	cdata(CDATA_HUNGER, cc) = 13000
	modgrowth cc, SKILL_ATTR_STR, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_CON, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_DEX, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_PER, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_LER, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_WIL, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_MAG, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_CHA, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_SPD, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	modgrowth cc, SKILL_ATTR_LUC, gdata(GDATA_FLAG_PICNIC_MULTIPLIER) * 4 + 5
	chara_anorexia cc
	rowactend cc
	return

*row_act_work
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		dmgsp CHARA_PLAYER, rnd(2)
		seikou = 1
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_A ) {
			if ( rnd(sdata(SKILL_ATTR_LER, CHARA_PLAYER) + 100) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 100) < rnd(200) ) {
				seikou = 0
				txt lang("失敗した。", "You have failed.")
			}
			if ( seikou == 1 ) {
				if ( gdata(GDATA_FLAG_WORK_B_REMAINING) > 500 | cdata(CDATA_SP, CHARA_PLAYER) < cdata(CDATA_MAX_SP, CHARA_PLAYER) / 2 ) {
					seikou = 0
					if ( cdata(CDATA_ACTION_PERIOD, cc) \ 51 == 0 ) {
						txt lang("…駄目だ、何かが足りていない！", "...Something is missing!")
						rowactend cc
						return
					}
				}
			}
			if ( seikou == 1 ) {
				gdata(GDATA_FLAG_WORK_A_REMAINING) -= 1 + rnd(2)
			}
			if ( gdata(GDATA_FLAG_WORK_A_REMAINING) < 0 ) {
				gdata(GDATA_FLAG_WORK_A_REMAINING) = 0
			}
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_B ) {
			if ( rnd(sdata(SKILL_ATTR_LER, CHARA_PLAYER) + 100) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 100) < rnd(200) ) {
				seikou = 0
				txt lang("失敗した。", "You have failed.")
			}
			if ( seikou == 1 ) {
				if ( gdata(GDATA_FLAG_WORK_C_REMAINING) \ 2 == 1 | gdata(GDATA_SLEEP) >= 30 ) {
					seikou = 0
					if ( cdata(CDATA_ACTION_PERIOD, cc) \ 51 == 0 ) {
						txt lang("…駄目だ、何かが足りていない！", "...Something is missing!")
						rowactend cc
						return
					}
				}
			}
			if ( seikou == 1 ) {
				gdata(GDATA_FLAG_WORK_B_REMAINING) -= 1 + rnd(2)
			}
			if ( gdata(GDATA_FLAG_WORK_B_REMAINING) < 0 ) {
				gdata(GDATA_FLAG_WORK_B_REMAINING) = 0
			}
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_C ) {
			if ( rnd(sdata(SKILL_ATTR_LER, CHARA_PLAYER) + 100) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 100) < rnd(200) ) {
				seikou = 0
				txt lang("失敗した。", "You have failed.")
			}
			if ( seikou == 1 ) {
				if ( seiton < 3 | gdata(GDATA_HOUR) < 8 | gdata(GDATA_HOUR) > 17 ) {
					seikou = 0
					if ( cdata(CDATA_ACTION_PERIOD, cc) \ 51 == 0 ) {
						txt lang("…駄目だ、何かが足りていない！", "...Something is missing!")
						rowactend cc
						return
					}
				}
			}
			if ( seikou == 1 ) {
				gdata(GDATA_FLAG_WORK_C_REMAINING) -= 1 + rnd(2)
			}
			if ( gdata(GDATA_FLAG_WORK_C_REMAINING) < 0 ) {
				gdata(GDATA_FLAG_WORK_C_REMAINING) = 0
			}
		}
		return
	}
	txt lang(name(cc) + "は一息ついた。", name(cc) + " took a small break.")
	rowactend cc
	return

*eat_meal_xmas_cake
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_XMAS_CAKE
		cdata(CDATA_ACTION_PERIOD, cc) = 20
		cdata(CDATA_EMO_ICON, cc) = 6 + 100 * 3
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は食事をはじめた。", name(cc) + " started having a meal.")
		}
		snd SOUNDLIST_EAT1
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		cdata(CDATA_EMO_ICON, cc) = 16 + 100
		if ( cdata(CDATA_ACTION_PERIOD, cc) \ 5 == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang("*むしゃむしゃ*", "*Munch munch*")
			}
		}
		return
	}
	txt lang(name(cc) + "は食事を終えた。", name(cc) + " finished " + his(cc) + " meal.")
	cdata(CDATA_HUNGER, cc) = 13000
	if ( gdata(GDATA_MONTH) == 12 | int(gettime(1)) == 12 ) {
		skillexp SKILL_NORMAL_FAITH, cc, 1000
		skillexp SKILL_ATTR_MAG, cc, 1000
		skillexp SKILL_ATTR_LUC, cc, 1000
		addbuff cc, BUFF_LUCK, 250, 1000
	}
	chara_anorexia cc
	rowactend cc
	return

*sexsex
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_SEX
		cdata(CDATA_ACTION_PERIOD, cc) = 25 + rnd(10)
		cdata(CDATA_ROW_ACT_TC, cc) = tc
		cdata(CDATA_ROW_ACT, tc) = ACTION_SEX, cdata(CDATA_ACTION_PERIOD, cc) * 2
		cdata(CDATA_ROW_ACT_TC, tc) = cc + 10000
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は服を脱ぎ始めた。", name(cc) + " begin" + _s(cc) + " to take " + his(cc) + " clothes off.")
		}
		return
	}
	sexhost = 1
	tc = cdata(CDATA_ROW_ACT_TC, cc)
	if ( tc >= 10000 ) {
		tc -= 10000
		sexhost = 0
	}
	if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE | cdata(CDATA_ROW_ACT, tc) != ACTION_SEX ) {
		if ( synccheck(cc, -1) ) {
			txt lang("「そ、その" + _sex2(cdata(CDATA_SEX, tc)) + "とは体だけの関係" + _da() + _ore(3) + "は何も知らないから、命だけは…！」", "\"I-I don't really know that " + _sex2(cdata(CDATA_SEX, tc)) + ". Please spare my life!\"")
		}
		rowactend cc
		rowactend tc
		return
	}
	if ( cc == CHARA_PLAYER ) {
		actionsp CHARA_PLAYER, 1 + rnd(2)
		if ( stat == 0 ) {
			txt_exhausted
			rowactend cc
			rowactend tc
			return
		}
	}
	cdata(CDATA_EMO_ICON, cc) = 17 + 100 * 3
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( sexhost == 0 ) {
			if ( cdata(CDATA_ACTION_PERIOD, cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt "「きくぅ」", "「もふもふ」", "「くやしい、でも…」", "「はぁはぁ！」", "「ウフフフ」"
					}
					if ( en ) {
						txt cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("Come on!")
					}
				}
			}
		}
		return
	}
	if ( sexhost == 0 ) {
		rowactend cc
		return
	}
	repeat 2
		if ( cnt == 0 ) {
			c = cc
		}
		else {
			c = tc
		}
		cdata(CDATA_CONDITION_DRUNK, cc) = 0
		if ( cnt == 1 ) {
			if ( rnd(3) == 0 ) {
				dmgcon c, CONDITION_INSANE, 500
			}
			if ( rnd(5) == 0 ) {
				dmgcon c, CONDITION_PARALYZE, 500
			}
			dmgcon c, CONDITION_INSANE, 300
			healsan c, 10
			skillexp SKILL_ATTR_CON, c, 250 + (c >= MAX_CHARA_SAVE) * 1000
			skillexp SKILL_ATTR_WIL, c, 250 + (c >= MAX_CHARA_SAVE) * 1000
		}
		if ( cdata(CDATA_ID, cc) == CREATURE_ID_PROSTITUTE | cdata(CDATA_ID, cc) == CREATURE_ID_SILVIA_THE_PRINCESS ) {
			skillexp SKILL_ATTR_CON, cc, 250
			skillexp SKILL_ATTR_WIL, cc, 250
		}
		if ( rnd(15) == 0 ) {
			dmgcon c, CONDITION_SICK, 200
		}
		skillexp SKILL_ATTR_CHA, c, 250 + (c >= MAX_CHARA_SAVE) * 1000
	loop
	sexvalue = sdata(SKILL_ATTR_CHA, cc) * (50 + rnd(50)) + 100
	if ( cc == CHARA_PLAYER | tc == CHARA_PLAYER ) {
		gdata(GDATA_FLAG_PROSTITUTION_COUNTER)++
	}
	if ( synccheck(cc, -1) ) {
		txtef COLOR_SKY_BLUE
		if ( jp ) {
			txt "「よかった" + _yo(3), "「す、すごい" + _yo(3), "「も、もうだめ" + _da(3), "「は、激しかった" + _yo(3), "「か、完敗" + _da(3)
		}
		if ( en ) {
			txt "\"You are awesome!", "\"Oh my god...", "\"Okay, okay, you win!", "\"Holy...!"
		}
		txtef COLOR_TALK
		if ( tc == CHARA_PLAYER ) {
			txt lang("」", "\"")
		}
	}
	if ( tc != CHARA_PLAYER ) {
		if ( cdata(CDATA_GOLD, tc) >= sexvalue ) {
			if ( synccheck(cc, -1) ) {
				txt lang("！さあ、小遣いを受け取って" + _kure(3) + "」", "Here, take this.\"")
			}
		}
		else {
			if ( synccheck(cc, -1) ) {
				txt lang("！これが" + _ore(3) + "の財布の中身の全て" + _da() + "」", "Take this money, it's all I have!\"")
				if ( rnd(3) == 0 ) {
					if ( cc != CHARA_PLAYER ) {
						txt lang(name(cc) + "は激怒した。「なめてんの？」", name(cc) + " gets furious, " + cnvtalk("And you think you can just run away?"))
						cdata(CDATA_TARGET, cc) = tc
						cdata(CDATA_AI_AGGRO, cc) = 20
					}
				}
			}
			if ( cdata(CDATA_GOLD, tc) <= 0 ) {
				cdata(CDATA_GOLD, tc) = 1
			}
			sexvalue = cdata(CDATA_GOLD, tc)
		}
		cdata(CDATA_GOLD, tc) -= sexvalue
		if ( cc == CHARA_PLAYER ) {
			modimp tc, 5
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), sexvalue
			txt_questitem
			modkarma CHARA_PLAYER, -1
		}
		else {
			cdata(CDATA_GOLD, cc) += sexvalue
			if ( cc < MAX_CHARA_FOLLOWER ) {
                txt lang(name(cc) + "は" + sexvalue + "gp稼いだ。", name(cc) + " earned " + sexvalue + "gp.")
                snd SOUNDLIST_GETGOLD1
            }
		}
	}
	rowactend cc
	rowactend tc
	return

*skill_tuin_der_lusten
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_TUIN_DER_LUSTEN
		cdata(CDATA_ACTION_PERIOD, cc) = limit(sdata(SKILL_ATTR_SPD, cc) / 10, 10, 50)
		cdata(CDATA_ROW_ACT_TC, cc) = tc
		cdata(CDATA_ROW_ACT, tc) = ACTION_TUIN_DER_LUSTEN
		cdata(CDATA_ACTION_PERIOD, tc) = 100
		cdata(CDATA_ROW_ACT_TC, tc) = cc + 10000
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は服を脱ぎ始めた。", name(cc) + " begin" + _s(cc) + " to take " + his(cc) + " clothes off.")
		}
		return
	}
	sexhost = 1
	tc = cdata(CDATA_ROW_ACT_TC, cc)
	if ( tc >= 10000 ) {
		tc -= 10000
		sexhost = 0
	}
	cdata(CDATA_EMO_ICON, cc) = 17 + 100 * 3
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( sexhost == 0 ) {
			if ( cdata(CDATA_ACTION_PERIOD, cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt "「もふもふ」", "「くやしい、でも…」", "「はぁはぁ！」", "「ウフフフ」"
					}
					if ( en ) {
						txt cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("Come on!")
					}
				}
			}
		}
		return
	}
	if ( sexhost == 0 ) {
		rowactend cc
		return
	}
	repeat 2
		if ( cnt == 0 ) {
			c = cc
		}
		else {
			c = tc
		}
		cdata(CDATA_CONDITION_DRUNK, cc) = 0
		if ( cnt == 1 ) {
			skillexp SKILL_ATTR_CON, c, 250 + (c >= 57) * 1000
			skillexp SKILL_ATTR_WIL, c, 250 + (c >= 57) * 1000
		}
		if ( cdata(CDATA_ID, cc) == 335 | cdata(CDATA_ID, cc) == 352 ) {
			skillexp SKILL_ATTR_CON, cc, 250
			skillexp SKILL_ATTR_WIL, cc, 250
		}
		if ( rnd(15) == 0 ) {
			dmgcon c, CONDITION_SICK, 200
		}
		skillexp SKILL_ATTR_CHA, c, 250 + (c >= 57) * 1000
	loop
	sexvalue = sdata(SKILL_ATTR_CHA, cc) * (50 + rnd(50)) + 100
	if ( cc == CHARA_PLAYER | tc == CHARA_PLAYER ) {
		gdata(GDATA_FLAG_PROSTITUTION_COUNTER)++
	}
	if ( synccheck(cc, -1) ) {
		txtef COLOR_SKY_BLUE
		if ( jp ) {
			txt "「よかった" + _yo(3) + "」", "「す、すごい" + _yo(3) + "」", "「も、もうだめ" + _da(3) + "」", "「は、激しかった" + _yo(3) + "」", "「か、完敗" + _da(3) + "」"
		}
		if ( en ) {
			txt "\"You are awesome!", "\"Oh my god...", "\"Okay, okay, you win!", "\"Holy...!"
		}
		txtef COLOR_TALK
		if ( tc == CHARA_PLAYER ) {
			txt lang("」", "\"")
		}
	}
	if ( tc != CHARA_PLAYER ) {
		snd SOUNDLIST_AMMO
		if ( cdata(CDATA_GOLD, tc) >= sexvalue ) {
			if ( synccheck(cc, -1) ) {
				txt lang("！さあ、小遣いを受け取って" + _kure(3) + "」", "Here, take this.\"")
			}
		}
		else {
			if ( synccheck(cc, -1) ) {
				txt lang("！これが" + _ore(3) + "の財布の中身の全て" + _da() + "」", "Take this money, it's all I have!\"")
				if ( rnd(3) == 0 ) {
					if ( cc != 0 ) {
						txt lang(name(cc) + "は激怒した。「なめてんの？」", name(cc) + " gets furious, " + cnvtalk("And you think you can just run away?"))
						cdata(CDATA_TARGET, cc) = tc
						cdata(CDATA_AI_AGGRO, cc) = 20
					}
				}
			}
			if ( cdata(CDATA_GOLD, tc) <= 0 ) {
				cdata(CDATA_GOLD, tc) = 1
			}
			sexvalue = cdata(CDATA_GOLD, tc)
		}
		cdata(CDATA_GOLD, tc) -= sexvalue
		if ( cc == CHARA_PLAYER ) {
			modimp tc, 5
			flt
			itemcreate -1, 54, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), sexvalue
			txt_questitem
			modkarma 0, -1
		}
		else {
			cdata(CDATA_GOLD, cc) += sexvalue
			if ( cc < MAX_CHARA_FOLLOWER ) {
                txt lang(name(cc) + "は" + sexvalue + "gp稼いだ。", name(cc) + " earned " + sexvalue + "gp.")
                snd SOUNDLIST_GETGOLD1
            }
		}
	}
	rowactend cc
	rowactend tc
	return

*generalAct
	if ( cc != CHARA_PLAYER ) {
		rowactend cc
		return
	}
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_GENERAL
		cdata(CDATA_ITEM_USING, cc) = ci
		cdata(CDATA_ROW_ACT_TC, cc) = tc
		if ( gdata(GDATA_ROW_ACT) == ACTION_STEAL ) {
			txt lang(itemname(ci, 1) + "に目星をつけた。", "You target " + itemname(ci, 1) + ".")
			cdata(CDATA_ACTION_PERIOD, cc) = 2 + limit(inv(INV_ITEM_WEIGHT, ci) / 500, 0, 50)
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_SLEEP ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_HOME | mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
				txt lang("寝る仕度を始めた。", "You lie down.")
				cdata(CDATA_ACTION_PERIOD, cc) = 5
			}
			else {
				txt lang("露営の準備を始めた。", "You start to camp.")
				cdata(CDATA_ACTION_PERIOD, cc) = 20
			}
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_CONSTRUCT ) {
			txt lang(itemname(ci, 1) + "の建設を始めた。", "You start to construct " + itemname(ci, 1) + ".")
			cdata(CDATA_ACTION_PERIOD, cc) = 25
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_OPEN_HATCH ) {
			txt lang(itemname(ci, 1) + "のハッチを回し始めた。", "You start to pull the hatch.")
			cdata(CDATA_ACTION_PERIOD, cc) = 10
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_HARVEST ) {
			txt lang(itemname(ci, 1) + "を掘り始めた。", "You start to pick " + itemname(ci, 1) + ".")
			cdata(CDATA_ACTION_PERIOD, cc) = 10 + limit(inv(INV_ITEM_WEIGHT, ci) / (1 + sdata(SKILL_ATTR_STR, CHARA_PLAYER) * 10 + sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) * 40), 1, 100)
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_CUT_TREE ) {
			txt lang("あなたは" + itemname(ci) + "の伐採を始めた。", "You start to cut tree.")
			cdata(CDATA_ACTION_PERIOD, cc) = limit(axeitem - sdata(SKILL_WEAPON_AXE, CHARA_PLAYER) / 8, 20, 100)
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_TRAIN ) {
			if ( gdata(GDATA_WEATHER) == WEATHER_CLEAR | gdata(GDATA_WEATHER) == WEATHER_RAIN ) {
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
					if ( gdata(GDATA_SKILLBOOK_COOLDOWN) > gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 ) {
						txt lang("もう飽きた。", "You are bored.")
						rowactend cc
						return
					}
				}
				else {
					if ( gdata(GDATA_NEXT_TRAIN) > gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 ) {
						txt lang("もう飽きた。", "You are bored.")
						rowactend cc
						return
					}
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
				txt lang(skillname(inv(INV_ITEM_BOOK_ID, ci)) + "の学習を始めた。", "You begin to study " + skillname(inv(INV_ITEM_BOOK_ID, ci)) + ".")
			}
			else {
				txt lang("トレーニングを始めた。", "You start training.")
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
				gdata(GDATA_SKILLBOOK_COOLDOWN) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 48
				item_find ITEM_ID_BOOKMARK_OF_ITZPALT, 3, 1
				if ( stat != (-1) ) {
					if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
						txt lang("古霜の栞も用意した。", "You also use the bookmark.")
						gdata(GDATA_SKILLBOOK_COOLDOWN) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 4
					}
				}
			}
			else {
				opatra = 0
				item_find ITEM_ID_DUMBBELL_OF_OPATOS, 3, 1
				if ( stat != (-1) ) {
					if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
						txt lang("ヘヴィダンベルも用意した。", "You also use the dumbbell.")
						opatra = 100
					}
				}
				gdata(GDATA_NEXT_TRAIN) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 48
			}
			if ( gdata(GDATA_WEATHER) != WEATHER_CLEAR & gdata(GDATA_WEATHER) != WEATHER_RAIN ) {
				if ( gdata(GDATA_AREA) == AREA_SHELTER | (mdata(MDATA_FIELD) == 1 & (mdata(MDATA_TYPE) == MAP_TYPE_HOME | mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE)) ) {
					txt lang("外が悪天候なので、じっくりと取り組むことにした。", "The weather's bad outside, you have plenty of time to waste.")
				}
			}
			cdata(CDATA_ACTION_PERIOD, cc) = 50
		}
		gosub *screen_draw
		return
	}
	tc = cdata(CDATA_ROW_ACT_TC, cc)
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( gdata(GDATA_ROW_ACT) == ACTION_CUT_TREE ) {
			if ( rnd(5) == 0 ) {
				skillexp SKILL_WEAPON_AXE, cc, 20
			}
			if ( rnd(6) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_STR, cc) + 25 ) {
					skillexp SKILL_ATTR_STR, cc, 50
				}
			}
			if ( rnd(3) == 0 ) {
				cdata(CDATA_SP, cc)--
			}
			if ( axeitem == 30 ) {
				repeat 5
					snd SOUNDLIST_GET1
					await 20
				loop
				txtef COLOR_SKY_BLUE
				txt lang(" *ギュイイイイイン* ", " *vroom* "), lang(" *バリバリ* ", " *whir* ")
			}
			if ( axeitem != 30 ) {
				if ( cdata(CDATA_ACTION_PERIOD, cc) \ 10 == 0 ) {
					snd SOUNDLIST_DIG1
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt " *カツーン* ", " *♪* ", " *ズシュ* ", " *メキ…* "
					}
					if ( en ) {
						txt " *sing* ", " *thud* ", " *rumble* "
					}
				}
			}
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_HARVEST ) {
			if ( rnd(5) == 0 ) {
				skillexp SKILL_NORMAL_GARDENING, CHARA_PLAYER, 40, 4
			}
			if ( rnd(6) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_STR, cc) + 25 ) {
					skillexp SKILL_ATTR_STR, cc, 50
				}
			}
			if ( rnd(8) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_CON, cc) + 28 ) {
					skillexp SKILL_ATTR_CON, cc, 50
				}
			}
			if ( rnd(10) == 0 ) {
				skillexp SKILL_ATTR_WIL, cc, 50
			}
			if ( rnd(4) == 0 ) {
				txtef COLOR_SKY_BLUE
				if ( jp ) {
					txt " *ザクッ* ", " *♪* ", " *ズシュ* ", " *ジャリ* "
				}
				if ( en ) {
					txt " *sing* ", " *pull* ", " *thud* ", " *rumble* ", " *gasp* "
				}
			}
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_TRAIN ) {
			p = 25
			if ( gdata(GDATA_WEATHER) != WEATHER_CLEAR & gdata(GDATA_WEATHER) != WEATHER_RAIN ) {
				if ( gdata(GDATA_AREA) == AREA_SHELTER ) {
					p = 5
				}
				if ( gdata(GDATA_AREA) != AREA_SHELTER & mdata(MDATA_FIELD) == 1 ) {
					if ( mdata(MDATA_TYPE) == MAP_TYPE_HOME | mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
						p = 5
						gdata(GDATA_MIN) += 30
					}
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
				if ( rnd(p) == 0 ) {
					skillexp inv(INV_ITEM_BOOK_ID, ci), cc, 25
				}
			}
			else {
				if ( opatra == 100 ) {
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MOKU_JIN ) {
						if ( rnd(p) == 0 ) {
							skillexp randwskill(), cc, 350
						}
						else {
							skillexp randwskill(), cc, 50
						}
					}
					if ( inv(INV_ITEM_ID, ci) != ITEM_ID_MOKU_JIN ) {
						if ( rnd(p) == 0 ) {
							skillexp randattb(), cc, 175
						}
						else {
							skillexp randattb(), cc, 25
						}
					}
				}
				else {
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MOKU_JIN ) {
						if ( rnd(p) == 0 ) {
							skillexp randwskill(), cc, 50
						}
					}
					if ( inv(INV_ITEM_ID, ci) != ITEM_ID_MOKU_JIN ) {
						if ( rnd(p) == 0 ) {
							skillexp randattb(), cc, 25
						}
					}
				}
			}
		}
		if ( gdata(GDATA_ROW_ACT) == ACTION_STEAL ) {
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_IRON_MAIDEN ) {
				if ( rnd(15) == 0 ) {
					rowactend cc
					txt lang("突然ふたが閉まった！", "Suddenly, the iron maiden falls forward.")
					dmghp cc, 9999, DAMAGE_FROM_MAIDEN
					return
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GUILLOTINE ) {
				if ( rnd(15) == 0 ) {
					rowactend cc
					txt lang("突然ギロチンが落ちてきた！", "Suddenly, the guillotine is activated.")
					dmghp cc, 9999, DAMAGE_FROM_GUILLOTINE
					return
				}
			}
			f = 0
			f2 = 0
			tg = inv_getowner(ci)
			if ( tg != (-1) ) {
				if ( cdata(CDATA_RELATION_ORG, tg) == (-3) ) {
					f2 = 1
				}
			}
			i = sdata(SKILL_ACTIVE_PICKPOCKET, CHARA_PLAYER) * 5 + sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 25
			if ( gdata(GDATA_HOUR) >= 19 | gdata(GDATA_HOUR) < 7 ) {
				i = i * 15 / 10
			}
			if ( inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_GREAT ) {
				i = i * 8 / 10
			}
			if ( inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_MIRACLE ) {
				i = i * 5 / 10
			}
			if ( inv(INV_ITEM_QUALITY, ci) > FIX_QUALITY_MIRACLE ) {
				i = i / 25
			}
			make_sound cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 5, 8
			repeat MAX_CHARA_TOTAL - MAX_CHARA_FOLLOWER, MAX_CHARA_FOLLOWER
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cnt) != 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				if ( dist(cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)) > 5 ) {
					continue
				}
				if ( f2 == 1 ) {
					if ( cnt != tg ) {
						continue
					}
				}
				if ( cnt != tg ) {
					if ( map(cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt), 5) != 0 ) {
						if ( mapitemfind(cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt), ITEM_ID_LULWYS_PHOTO_COLLECTION) != (-1) ) {
							if ( cdata(CDATA_ID, cnt) != CREATURE_ID_LULWY & cdata(CDATA_ID, cnt) != CREATURE_ID_DEVASTATE_LULWY ) {
								continue
							}
						}
					}
				}
				p = rnd(i + 1) * (80 + (synccheck(cnt, -1) == 0) * 50 + dist(cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)) * 20) / 100
				if ( cnt < 57 ) {
					p = p * 2 / 3
				}
				if ( rnd(sdata(SKILL_ATTR_PER, cnt) + 1) > p ) {
					if ( synccheck(cnt, -1) ) {
						txt lang(name(cnt) + "は窃盗を見咎めた。", name(cnt) + " notice" + _s(cnt) + " you,")
					}
					else {
						txt lang(name(cnt) + "は不審な物音に気づいた。", name(cnt) + " hear" + _s(cnt) + " a loud noise,")
					}
					if ( cdata(CDATA_ROLE, cnt) == ROLE_GUARD ) {
						txt lang("「貴様、何をしている！」", cnvtalk("You there, stop!"))
						modimp cnt, -5
					}
					else {
						txt lang("「ガード！ガード！」", cnvtalk("Guards! Guards!"))
						modimp cnt, -5
					}
					cdata(CDATA_EMO_ICON, cnt) = 20 + 100 * 5
					f = 1
				}
			loop
			if ( f ) {
				txtmore
				txt lang("盗みを見咎められた！", "You are found stealing.")
				modkarma CHARA_PLAYER, -5
				p = inv_getowner(ci)
				if ( tg != (-1) ) {
					if ( cdata(CDATA_ID, p) != CREATURE_ID_EBON_THE_FIRE_GIANT ) {
						if ( cdata(CDATA_CONDITION_SLEEP, tg) == 0 ) {
							cdata(CDATA_RELATION, tg) = -2
							hostileaction CHARA_PLAYER, tg
							modimp tg, -20
						}
					}
				}
				gohostile
			}
			if ( tg != (-1) ) {
				if ( cdata(CDATA_EXIST, tg) != CHAR_STATE_ALIVE ) {
					if ( f != 1 ) {
						txt lang("対象は死んでいる", "The target is dead.")
						f = 1
					}
				}
				if ( cdata(CDATA_ROLE, tg) == ROLE_USER ) {
					if ( f != 1 ) {
						txt lang("それは盗めない。", "It can't be stolen.")
						f = 1
					}
				}
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tg), cdata(CDATA_Y, tg)) >= 3 ) {
					if ( f != 1 ) {
						txt lang("対象が見当たらない。", "You lose the target.")
						f = 0
					}
				}
			}
			if ( inv(INV_ITEM_NUM, ci) <= 0 ) {
				f = 1
			}
			if ( ibit(ITEM_BIT_PRECIOUS, ci) == 1 ) {
				if ( f != 1 ) {
					txt lang("それは盗めない。", "It can't be stolen.")
					f = 1
				}
			}
			if ( inv(INV_ITEM_WEIGHT, ci) >= sdata(SKILL_ATTR_STR, CHARA_PLAYER) * 500 ) {
				if ( f != 1 ) {
					txt lang("重すぎて手に負えない。", "It's too heavy.")
					f = 1
				}
			}
			if ( itemusingfind(ci, 1) != (-1) | (refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_AMMO & inv(INV_ITEM_EQUIP, ci) != 0) ) {
				if ( f != 1 ) {
					txt lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
					f = 1
				}
			}
			if ( f ) {
				txt lang("行動を中断した。", "You abort stealing.")
				rowactend cc
			}
		}
		return
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_STEAL ) {
		tg = inv_getowner(ci)
		if ( tg != (-1) ) {
			if ( cdata(CDATA_EXIST, tg) != CHAR_STATE_ALIVE ) {
				txt lang("行動を中断した。", "You abort stealing.")
				rowactend cc
				return
			}
		}
		in = 1
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_PIECE ) {
			in = inv(INV_ITEM_NUM, ci)
		}
		ti = inv_getfreeid(CHARA_PLAYER)
		if ( ti == (-1) ) {
			txt_invfull2
			return
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			if ( inv_sum(CHARA_PLAYER) > 20 ) {
				txt_invfull
				return
			}
		}
		ibitmod ITEM_BIT_DROP, ci, 0
		if ( inv(INV_ITEM_EQUIP, ci) != 0 ) {
			tc = inv_getowner(ci)
			if ( tc != (-1) ) {
				p = inv(INV_ITEM_EQUIP, ci)
				cdata(p, tc) = cdata(p, tc) / 10000 * 10000
			}
			inv(INV_ITEM_EQUIP, ci) = 0
			r1 = tc
			gosub *charaRefresh
		}
		item_copy ci, ti
		inv(INV_ITEM_NUM, ti) = in
		ibitmod ITEM_BIT_STOLEN, ti, 1
		inv(INV_ITEM_PROPERTY, ti) = PROP_NONE
		inv(INV_ITEM_NUM, ci) -= in
		if ( inv(INV_ITEM_NUM, ci) <= 0 ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		txt lang(itemname(ti) + "を盗んだ。", "You successfully steal " + itemname(ti) + ".")
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_PIECE ) {
			snd SOUNDLIST_GETGOLD1
			inv(INV_ITEM_NUM, ti) = 0
			cdata(CDATA_GOLD, CHARA_PLAYER) += in
		}
		else {
			item_stack CHARA_PLAYER, ti, 1
			snd SOUNDLIST_GET1 + rnd(2)
		}
		gosub *calcBurdenPc
		skillexp SKILL_ACTIVE_PICKPOCKET, CHARA_PLAYER, limit(inv(INV_ITEM_WEIGHT, ti) / 25, 0, 450) + 50
		gdata(GDATA_FLAG_STOLEN_GOODS)++
		if ( cdata(CDATA_KARMA, CHARA_PLAYER) >= (-30) ) {
			if ( rnd(3) == 0 ) {
				txtmore
				txt lang("あなたは良心の呵責を感じた。", "You feel the stings of conscience.")
				modkarma CHARA_PLAYER, -1
			}
		}
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_SLEEP ) {
		txt lang("あなたは眠り込んだ。", "You fall asleep.")
		gosub *sleep
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_CONSTRUCT ) {
		snd SOUNDLIST_BUILD1
		txt lang(itemname(ci, 1) + "を作り終えた。", "You finish constructing " + itemname(ci, 1) + ".")
		in = 1
		dropval = 1
		gosub *act_drop
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_OPEN_HATCH ) {
		txt lang(itemname(ci, 1) + "のハッチを回し終えた。", "You finish pulling the hatch of " + itemname(ci, 1) + ".")
		chatteleport = 1
		gdata(GDATA_RETURN_AREA) = gdata(GDATA_AREA), gdata(GDATA_LEVEL), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		gdata(GDATA_TELEPORT_AREA) = AREA_SHELTER
		gdata(GDATA_TELEPORT_LEVEL) = 5 + inv(INV_ITEM_FILE, ci) \ 50
		if ( inv(INV_ITEM_PARAM2, ci) <= 10 ) {
			shelterd = 6
			inv(INV_ITEM_PARAM2, ci) = 100
		}
		levelexitby = 2
		snd SOUNDLIST_EXITMAP1
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_HARVEST ) {
		txt lang(itemname(ci, 1) + "を収穫した(" + cnvweight(inv(INV_ITEM_WEIGHT, ci)) + ")", "You harvest " + itemname(ci, 1) + ". (" + cnvweight(inv(INV_ITEM_WEIGHT, ci)) + ")")
		gosub *act_get
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_CUT_TREE ) {
		snd SOUNDLIST_POP3
		snd SOUNDLIST_POP3
		snd SOUNDLIST_POP3
		gdata(GDATA_FLAG_TREES_FELLED)++
		txt lang("樹木を切り倒し、材木を作り出した。", "You cut off tree.")
		inv(INV_ITEM_NUM, citree)--
		cell_refresh cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		flt
		itemcreate -1, ITEM_ID_STUMP, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
		flt
		itemcreate -1, ITEM_ID_WOOD_MATERIAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
	}
	if ( gdata(GDATA_ROW_ACT) == ACTION_TRAIN ) {
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
			txt lang(skillname(inv(INV_ITEM_BOOK_ID, ci)) + "の学習を終えた。", "You finish studying " + skillname(inv(INV_ITEM_BOOK_ID, ci)) + ".")
		}
		else {
			txt lang("トレーニングを終えた。", "You finish training.")
		}
		opatra = 0
	}
	rowactend cc
	return

*sleep_draw
	redraw 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh - inf_verh
	gmode 2
	gosub *screen_drawStatus
	if ( screenupdate == 0 ) {
		redraw 1
	}
	screenupdate = 0
	return

*sleep_draw_init
	gsel 4
	gmode 0
	pos 0, 0
	picload exedir + "\\graphic\\bg_night.bmp", 1
	pos 0, 0
	gzoom windoww, windowh - inf_verh, 4, 0, 0, 640, 480, 1
	gsel 0
	return

*sleep
	if ( gdata(GDATA_AREA) == AREA_QUEST | (gdata(GDATA_AREA) == AREA_OL_DRAN & gdata(GDATA_LEVEL) == 5) ) {
		txtmore
		txt lang("しかし、大事な用を思い出して飛び起きた。", "But you can't sleep right now.")
		gdata(GDATA_SLEEP_GENE) = 0
		return
	}
	if ( gdata(GDATA_GOD_TALK) ) {
		txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_SLEEP
	}
	redraw 0
	gosub *sleep_draw_init
	musicloop = 1
	music = MUSICLIST_MCCODA
	gosub *music_play
	msg_halt
	repeat 20
		gmode 4, , , cnt * 10
		gosub *sleep_draw
		await 200
	loop
	gmode 2
	cc = CHARA_PLAYER
	repeat MAX_CHARA_TOTAL
		tc = cnt
		cdata(CDATA_CONDITION_WET, tc) = 0
		cdata(CDATA_CONDITION_MPOISON, tc) = 0
		cdata(CDATA_CONDITION_POISON, tc) = 0
		cdata(CDATA_CONDITION_SLEEP, tc) = 0
		cdata(CDATA_CONDITION_CONFUSE, tc) = 0
		cdata(CDATA_CONDITION_BLIND, tc) = 0
		cdata(CDATA_CONDITION_PARALYZE, tc) = 0
		cdata(CDATA_CONDITION_DIM, tc) = 0
		cdata(CDATA_CONDITION_DRUNK, tc) = 0
		cdata(CDATA_CONDITION_BLEED, tc) = 0
		gdata(GDATA_SLEEP) = 0
		cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc)
		cdata(CDATA_MP, tc) = cdata(CDATA_MAX_MP, tc)
		cdata(CDATA_SP, tc) = cdata(CDATA_MAX_SP, tc)
		if ( tc != CHARA_PLAYER ) {
			cdata(CDATA_EVOCHAT_POINTS, tc) = 0
		}
		healcon tc, CONDITION_SICK, 7 + rnd(7)
		if ( cbit(CHARA_BIT_ANOREXIA, tc) ) {
			cdata(CDATA_VOMIT, tc) -= rnd(5) + 1
		}
		else {
			cdata(CDATA_VOMIT, tc) -= rnd(2) + 1
		}
		if ( cdata(CDATA_VOMIT, tc) <= 0 ) {
			cure_anorexia tc
			cdata(CDATA_VOMIT, tc) = 0
		}
		healsan tc, 10
		if ( cbit(CHARA_BIT_LAY_HANDS, tc) | cdata(CDATA_ID, tc) == CREATURE_ID_GOOSE | cdata(CDATA_ID, tc) == CREATURE_ID_CUTE_FAIRY ) {
			cbitmod CHARA_BIT_EXCLUSIVE_SKILL_CHARGE, tc, 1
		}
	loop
	cdata(CDATA_EVOCHAT_POINTS, CHARA_PLAYER) = 10
	mode = MODELIST_TXT_ADV
	timeslept = 7 + rnd(5)
	item_find ITEM_ID_MANIS_ALARM_CLOCK, 3, 1
	if ( stat != (-1) ) {
		ci = stat
		if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
			timeslept = 8
		}
	}
	repeat timeslept
		gdata(GDATA_HOUR)++
		gosub *advance_hour
		if ( mode != MODELIST_TXT_ADV ) {
			gosub *sleep_draw_init
			mode = MODELIST_TXT_ADV
		}
		gdata(GDATA_SLEEP) = 0
		gdata(GDATA_MIN) = 0
		cc = CHARA_PLAYER
		gosub *sleep_draw
		await 500
	loop
	if ( cdata(CDATA_GOLD, CHARA_PLAYER) < 500 ) {
		if ( spact(SKILL_SPACT_SERIOUS_BEGGING - STARTING_SKILL_SPACT) == 0 ) {
			spact(SKILL_SPACT_SERIOUS_BEGGING - STARTING_SKILL_SPACT) = 1
			txtmore
			txtef COLOR_YELLOW
			txt lang("あなたは「" + skillname(SKILL_SPACT_SERIOUS_BEGGING) + "」の能力を得た。", "You have learned a new ability, " + skillname(SKILL_SPACT_SERIOUS_BEGGING) + ".")
		}
	}
	if ( gdata(GDATA_SLEEP_GENE) != 0 ) {
		tc = -1
		repeat MAX_CHARA_FOLLOWER - 1, 1
			if ( cbit(CHARA_BIT_MAKE_GENE, cnt) == 1 ) {
				if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
					tc = cnt
					break
				}
			}
		loop
		if ( tc != (-1) ) {
			s = lang("遺伝子", "Gene")
			file = "bg_re14"
			buff = lang("" + name(tc) + "とあなたは熱い一夜を供にした。新たな遺伝子が生成された。", "You spent a night with " + name(tc) + ". A new gene is created.")
			listmax = 0
			chatList 1, lang("ふぅ", "Sweet.")
			cbitmod CHARA_BIT_MAKE_GENE, tc, 0
			gosub *re_select
			gosub *generate_gene
		}
	}
	gosub *sleep_draw
	gdata(GDATA_SLEEP_GENE) = 0
	mode = MODELIST_MAIN
	wake_up
	cdata(CDATA_HUNGER, cc) -= 1500 / (trait(TRAIT_RACE_SLOW_DIGESTION) + 1)
	if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
		cdata(CDATA_THIRST, cc) -= 1500 / 2
	}
	item_find ITEM_ID_MANIS_ALARM_CLOCK, 3, 1
	if ( stat != (-1) ) {
		ci = stat
		if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
			kaiwa = rnd(4)
			if ( kaiwa == 0 ) {
				txt lang("「時間だ。再起動しろ」", cnvtalk("It's time. Restarting."))
			}
			if ( kaiwa == 1 ) {
				txt lang("「そろそろスリープモードを解除しろ」", cnvtalk("It is almost time to cancel sleep mode."))
			}
			if ( kaiwa == 2 ) {
				txt lang("「脳に覚醒信号を流すぞ」", cnvtalk("I will send an awakening signal to your brain."))
			}
			if ( kaiwa == 3 ) {
				txt lang("「強制起床プログラムを開始」", cnvtalk("I will start a forced wake-up program."))
			}
		}
	}
	txtef COLOR_GREEN
	txt lang("" + timeslept + "時間眠った。あなたはリフレッシュした。", "You have slept for " + timeslept + " hours. You are refreshed.")
	if ( gdata(GDATA_FLAG_DESTINY_TIMES_SLEPT) < 3 ) {
		gdata(GDATA_FLAG_DESTINY_TIMES_SLEPT)++
		if ( gdata(GDATA_FLAG_DESTINY_TIMES_SLEPT) >= 3 ) {
			if ( gdata(GDATA_FLAG_DESTINY_LETTERS) < 7 ) {
				gdata(GDATA_FLAG_DESTINY_LETTERS)++
			}
		}
	}

 	gdata(GDATA_FLAG_SLEEP_PREVENTION) = 0
	gdata(GDATA_FLAG_HOURS_SLEPT) += timeslept
	f = 0
	if ( cdata(CDATA_ITEM_USING, CHARA_PLAYER) == (-1) ) {
		f = 1
	}
	else {
		ci = cdata(CDATA_ITEM_USING, CHARA_PLAYER)
		if ( inv(INV_ITEM_PARAM1, ci) == 0 | inv(INV_ITEM_NUM, ci) == 0 | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) != FILTER_FURNITURE_BED ) {
			f = 1
		}
	}
	if ( f ) {
		txt lang("まあまあの目覚めだ。", "You wake up feeling so-so.")
		gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE)++
		if ( gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE) > 9 ) {
			gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE) = 9
		}
	}
	else {
		growns = 0
		gdata(GDATA_SLEEP_EXP) = gdata(GDATA_SLEEP_EXP) / 100
		gdata(GDATA_SLEEP_EXP) = gdata(GDATA_SLEEP_EXP) * inv(INV_ITEM_PARAM1, ci)
		sleepexpbk = gdata(GDATA_SLEEP_EXP)
		repeat MAX_CHARA_FOLLOWER
			expler = 0
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			tc = cnt
			i = 0
			repeat MAX_SKILL_ATTR_BASIC, STARTING_SKILL_ATTR
				i += limit(sorg(cnt, tc), 1, 300)
			loop
			i = limit(i / 6, 10, 1000)
			exp = i * i * i / 10
			repeat MAX_SPELL - STARTING_SKILL_SPELL, STARTING_SKILL_SPELL
				expsp += limit(sorg(cnt, tc), 10, 300)
			loop
			if ( tc == CHARA_PLAYER ) {
				repeat
					if ( gdata(GDATA_SLEEP_EXP) >= exp ) {
						gdata(GDATA_SLEEP_EXP) -= exp
					}
					else {
						if ( cnt != 0 ) {
							break
						}
					}
					expler++
					modgrowth tc, STARTING_SKILL_ATTR + rnd(MAX_SKILL_ATTR_BASIC), 3
					grown += 3
					if ( cnt > 6 ) {
						if ( rnd(5) == 0 ) {
							gdata(GDATA_SLEEP_EXP) = 0
							break
						}
					}
				loop
			}
			else {
				sleepexpc = sleepexpbk
				repeat
					if ( sleepexpc >= exp ) {
						sleepexpc -= exp
					}
					else {
						if ( cnt != 0 ) {
							break
						}
					}
					expler++
					modgrowth tc, STARTING_SKILL_ATTR + rnd(MAX_SKILL_ATTR_BASIC), 3
					if ( cnt > 6 ) {
						if ( rnd(5) == 0 ) {
							sleepexpc = 0
							break
						}
					}
				loop
			}
			if ( cdatan(CDATAN_CLASS, tc) == "warrior" ) {
				modgrowth tc, SKILL_ATTR_STR, 4
				modgrowth tc, SKILL_ATTR_CON, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "thief" ) {
				modgrowth tc, SKILL_ATTR_DEX, 4
				modgrowth tc, SKILL_ATTR_PER, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "wizard" ) {
				modgrowth tc, SKILL_ATTR_WIL, 4
				modgrowth tc, SKILL_ATTR_MAG, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "farmer" ) {
				modgrowth tc, SKILL_ATTR_CON, 4
				modgrowth tc, SKILL_ATTR_LER, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "predator" ) {
				modgrowth tc, SKILL_ATTR_CON, 4
				modgrowth tc, SKILL_ATTR_DEX, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "archer" ) {
				modgrowth tc, SKILL_ATTR_STR, 4
				modgrowth tc, SKILL_ATTR_DEX, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "warmage" ) {
				modgrowth tc, SKILL_ATTR_STR, 4
				modgrowth tc, SKILL_ATTR_MAG, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "tourist" ) {
				modgrowth tc, SKILL_ATTR_SPD, 10
				if ( tc == CHARA_PLAYER ) {
					grown += 10
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "pianist" ) {
				modgrowth tc, SKILL_ATTR_LER, 4
				modgrowth tc, SKILL_ATTR_CHA, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "gunner" ) {
				modgrowth tc, SKILL_ATTR_PER, 4
				modgrowth tc, SKILL_ATTR_LER, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "priest" ) {
				modgrowth tc, SKILL_ATTR_WIL, 4
				modgrowth tc, SKILL_ATTR_MAG, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			if ( cdatan(CDATAN_CLASS, tc) == "claymore" ) {
				modgrowth tc, SKILL_ATTR_STR, 4
				modgrowth tc, SKILL_ATTR_PER, 4
				if ( tc == CHARA_PLAYER ) {
					grown += 8
				}
			}
			expler = limit(expler, 1, 10)
			repeat expler
				repeat MAX_SKILL_ACTIVE - STARTING_SKILL_WEAPON, STARTING_SKILL_WEAPON
					if ( sorg(cnt, tc) == 0 ) {
						continue
					}
					if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
						if ( rnd(sdata(SKILL_ATTR_LER, tc) + 100) > rnd(500) ) {
							modgrowth tc, cnt, 2
							if ( tc == CHARA_PLAYER ) {
								growns += 2
							}
						}
					}
					modgrowth tc, cnt, 2
					if ( tc == CHARA_PLAYER ) {
						growns += 2
					}
				loop
            loop
		loop
		sleepexpsp = sleepexpbk
		repeat
			if ( sleepexpsp >= expsp ) {
				sleepexpsp -= expsp
			}
			else {
				if ( cnt != 0 ) {
					break
				}
			}
			repeat MAX_SPELL - STARTING_SKILL_SPELL, STARTING_SKILL_SPELL
				if ( spell(cnt - STARTING_SKILL_SPELL) <= 0 ) {
					continue
				}
				modgrowth CHARA_PLAYER, cnt, (gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE) + 1) * 3
				grownsp += (gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE) + 1) * 3
			loop
			if ( cnt > 20 ) {
				sleepexpsp = 0
				break
			}
		loop
		gdata(GDATA_FLAG_SPELL_POTENTIAL_RECOVERY_POSTPONE) = 0
		txtmore
		txtef COLOR_GREEN
		txt lang("心地よい目覚めだ。潜在能力が伸びた(主能力計" + grown + "%)(スキル計" + growns + "%)(魔法計" + grownsp + "%)", "You wake up feeling good. Your potential increases. (Total:" + grown + "%)(SkillTotal:" + growns + "%)(SpellTotal:" + grownsp + "%)")
	}
	msg_halt
	gosub *music_play
	autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
	if ( gdata(GDATA_FLAG_INSIDE_DEEP_SEA_CASTLE) == 100 ) {
		gdata(GDATA_FLAG_INSIDE_DEEP_SEA_CASTLE) = 0
	}
	gdata(STARTING_GDATA_FLAG + 376) = 0
	breakfast = 0
	if ( gdata(GDATA_HOUR) >= 4 & gdata(GDATA_HOUR) <= 9 ) {
		breakfast = 100
		gosub *random_event
	}
	if ( gdata(GDATA_HOUR) >= 4 & gdata(GDATA_HOUR) <= 12 ) {
		breakfast = 200
		gosub *random_event
	}
	if ( gdata(GDATA_HOUR) >= 4 & gdata(GDATA_HOUR) <= 12 ) {
		breakfast = 300
		gosub *random_event
	}
	breakfast = 0
	repeat MAX_CHARA_FOLLOWER
		tc = CHARA_PLAYER
		kinenflag = 0
		if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cnt == 0 ) {
			continue
		}
		if ( cdata(CDATA_IMPRESSION, cnt) < 150 ) {
			continue
		}
		if ( cdata(CDATA_JOIN_DATE_MONTH, cnt) == gdata(GDATA_MONTH) & cdata(CDATA_JOIN_DATE_DAY, cnt) == gdata(GDATA_DAY) & cdata(CDATA_JOIN_DATE_YEAR, cnt) < gdata(GDATA_YEAR) ) {
			tc = cnt
			break
		}
	loop
	if ( tc != CHARA_PLAYER ) {
		cdata(CDATA_EMO_ICON, tc) = 6 + 100 * 3
		kinenflag = 1
		gosub *chat
		if ( gdata(GDATA_FLAG_PET_ANNIVERSARY_ACTIVE) == 1 ) {
			gdata(GDATA_FLAG_RAGNAROK_STARTED)++
			gdata(GDATA_WEATHER) = WEATHER_ETHER
			envonly = 1
			gosub *music_play
			if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_CURTAIN_CALL, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
				txt lang("終末の日が訪れた。", "Let's Ragnarok!")
				msg_halt
			}
			else {
				if ( gdata(GDATA_FLAG_CURTAIN_CALL) < 9999 & gdata(GDATA_FLAG_CURTAIN_CALL) >= 0 ) {
					txt lang("終末の日が訪れた。", "Let's Ragnarok!")
					msg_halt
				}
				if ( gdata(GDATA_FLAG_CURTAIN_CALL) >= 9999 | gdata(GDATA_FLAG_CURTAIN_CALL) < 0 ) {
					txt lang("*カーテンコール*", " *Curtain Call* ")
					await 2000
				}
			}
			animeid = ANIMATION_RAGNA
			gosub *anime
			repeat 200
				repeat 2
					x = rnd(mdata(MDATA_WIDTH))
					y = rnd(mdata(MDATA_HEIGHT))
					map(x, y, 0) = 37
				loop
				x = rnd(inf_screenw) + scx
				y = rnd(inf_screenh) + scy
				if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) | rnd(5) == 0 ) {
					x = rnd(mdata(MDATA_WIDTH))
					y = rnd(mdata(MDATA_HEIGHT))
				}
				addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
				mapitem_fire x, y
				if ( cnt \ 4 == 0 ) {
					if ( gdata(STARTING_GDATA_FLAG + 380) == 0 ) {
						flt 100, calcfixlv(FIX_QUALITY_GREAT)
						if ( rnd(4) ) {
							fltnrace = "dragon"
						}
						else {
							fltnrace = "giant"
						}
						characreate -1, CREATURE_ID_BUG, x, y
						if ( stat != 0 ) {
							cbitmod CHARA_BIT_SUMMONED, rc, 1
						}
						if ( gdata(GDATA_AREA) != AREA_VOID ) {
							if ( gdata(GDATA_DEEPEST_LEVEL) < 60 ) {
								if ( cdata(CDATA_LEVEL, rc) > 50 ) {
									chara_vanquish rc
								}
							}
						}
					}
				}
				if ( cnt \ 4 == 0 ) {
					if ( gdata(STARTING_GDATA_FLAG + 380) != 0 ) {
						flt
						characreate -1, CREATURE_ID_UNIVERSE_INVADER, x, y
						if ( stat != 0 ) {
							cbitmod CHARA_BIT_SUMMONED, rc, 1
						}
					}
				}
				if ( cnt \ 7 == 0 ) {
					gosub *screen_draw
					if ( rnd(7) ) {
						snd SOUNDLIST_FIRE1
					}
					else {
						snd SOUNDLIST_CRUSH1
					}
					await 25
				}
			loop
			gdata(STARTING_GDATA_FLAG + 380) = 0
		}
		kinenflag = 0
	}
	return

*rest
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_REST
		cdata(CDATA_ACTION_PERIOD, cc) = r1
		txt lang("あなたは横になった。", "You lie down to rest.")
		gosub *screen_draw
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_DRAIN_HP, cnt) > 0 ) {
				cdata(CDATA_DRAIN_HP, cnt) -= 2
				if ( cdata(CDATA_DRAIN_HP, cnt) == 100 | cdata(CDATA_DRAIN_HP, cnt) == 99 ) {
					cdata(CDATA_DRAIN_HP, cnt) = 0
				}
			}
			if ( cdata(CDATA_ACTION_PERIOD, cc) \ 2 == 0 ) {
				healsp cnt, 1, FALSE
			}
			if ( cdata(CDATA_ACTION_PERIOD, cc) \ 3 == 0 ) {
				healhp cnt, 1, FALSE
				healmp cnt, 1, FALSE
			}
		loop
		return
	}
	if ( gdata(GDATA_SLEEP) >= 30 ) {
		f = 0
		if ( gdata(GDATA_SLEEP) >= 50 ) {
			f = 1
		}
		else {
			if ( rnd(2) == 0 ) {
				f = 1
			}
		}
		if ( f == 1 ) {
			txt lang("あなたはそのまま眠りにおちた…", "After a short while, you drop off to sleep.")
			cdata(CDATA_ITEM_USING, cc) = -1
			gosub *sleep
			rowactend cc
			return
		}
	}
	txt lang("あなたは休息を終えた。", "You finished taking a rest.")
	rowactend cc
	return

*travel
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_TRAVEL
		cdata(CDATA_ACTION_PERIOD, cc) = 20
		if ( gdata(GDATA_WEATHER) == WEATHER_RAIN ) {
			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 13 / 10
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN ) {
			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 16 / 10
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_SNOW | chipm(CHIPM_ROLE, map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)) == MAP_CHIP_ROLE_SNOW ) {
			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 22 / 10
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 5 / 10
		}
		cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 100 / (100 + gdata(GDATA_TRAVEL_SPEED) + sdata(SKILL_NORMAL_TRAVELING, CHARA_PLAYER))
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) > VEHICLE_NONE ) {
			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 3 / 5
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_TRUCK ) {
			if ( xy2pic(0, 1) <= map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) & map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) < xy2pic(24, 1) & map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) != xy2pic(11, 1) ) {
				cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 3 / 5
			}
		}
		return
	}
	if ( cdata(CDATA_HUNGER, CHARA_PLAYER) <= 1600 & rnd(10) == 0 ) {
		inv_getheader cc
		f = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE) == FILTER_CARGO_FOOD ) {
				f = 1
				ci = cnt
				break
			}
		loop
		if ( f == 1 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
			}

			if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
				if ( cdata(CDATA_THIRST, cc) < 12000 ) {
					if ( synccheck(cc, -1) ) {
						txt lang("さらに、付属していた飲み物も飲んだ。", name(cc) + " also drank the beverage that came with the food.")
					}
					cdata(CDATA_THIRST, cc) += 2000
				}
			}

			gosub *insta_eat
		}
	}
	if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) != VEHICLE_MAGIC_LOCOMOTIVE ) {
        if ( gdata(GDATA_WEATHER) == WEATHER_SNOW | chipm(CHIPM_ROLE, map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)) == MAP_CHIP_ROLE_SNOW ) {
            if ( gdata(GDATA_RES_WEATHER) == 0 ) {
                if ( rnd(100) == 0 ) {
                    if ( cbit(CHARA_BIT_FLOAT, CHARA_PLAYER) == 0 | cdata(CDATA_CONDITION_GRAVITY, CHARA_PLAYER) > 0 ) {
                        txtef COLOR_SKY_BLUE
                        if ( jp ) {
                            txt " *ずぶっ* ", " *ザシュ* ", " *ズボ* ", " *ズサッ* "
                        }
                        if ( en ) {
                            txt " *kisssh* ", " *thudd* ", " *siz* ", " *clump* ", " *skritch* "
                        }
                        cdata(CDATA_ACTION_PERIOD, cc) += 10
                    }
                }
                if ( rnd(1000) == 0 ) {
                    txtef COLOR_PURPLE
                    txt lang("積雪のせいで旅程が遅れている。", "Snow delays your travel."), lang("雪道を進むのは大変な苦労だ。", "You are caught in a snowdrift."), lang("深い雪に脚をとられている。", "It's hard to walk on a snowy road.")
                    cdata(CDATA_ACTION_PERIOD, cc) += 50
                }
            }
            if ( cdata(CDATA_HUNGER, CHARA_PLAYER) <= 1200 ) {
                if ( cbit(CHARA_BIT_ANOREXIA, CHARA_PLAYER) == 0 ) {
                    snd SOUNDLIST_EAT1
                    txt lang("空腹のあまり、あなたは積もっている雪を腹にかきこんだ。", "You are too hungry. You chow down snow.")
                    cdata(CDATA_HUNGER, cc) += 5000
                    gosub *eat_finish
                    dmgcon CHARA_PLAYER, CONDITION_DIM, 1000
                }
            }
        }
    }
	if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) != VEHICLE_LAND_BATTLESHIP ) {
        if ( chipm(CHIPM_ROLE, map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)) == MAP_CHIP_ROLE_SAND ) {
            if ( rnd(15) == 0 ) {
                if ( cbit(CHARA_BIT_FLOAT, CHARA_PLAYER) == 0 | cdata(CDATA_CONDITION_GRAVITY, CHARA_PLAYER) > 0 ) {
                    if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) != VEHICLE_MAGIC_LOCOMOTIVE ) {
                        txtef COLOR_SKY_BLUE
                        if ( jp ) {
                            txt " *ずぶっ* ", " *ザシュ* ", " *ズボ* ", " *ズサッ* "
                        }
                        if ( en ) {
                            txt " *kisssh*", "*thudd*", "*siz*", "*clump*", "*skritch*"
                        }
                    }
                }
                cdata(CDATA_CONDITION_WET, CHARA_PLAYER) = 0
            }
            if ( gdata(GDATA_WEATHER) == WEATHER_CLEAR & rnd(20) == 0 & (gdata(GDATA_HOUR) > 7 & gdata(GDATA_HOUR) < 19) ) {
                txtef COLOR_RED
                txt lang("砂漠の熱気が体力を奪う。", "The desert heat robs me of my strength."), lang("太陽が容赦なく照りつける…。", "The sun shines mercilessly...")
                cdata(CDATA_CONDITION_WET, CHARA_PLAYER) = 0
                dmgcon cc, CONDITION_DIM, 200
                cdata(CDATA_SP, CHARA_PLAYER) -= 30
				if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
					cdata(CDATA_THIRST, CHARA_PLAYER) -= 3000
				}
                dmghp CHARA_PLAYER, rnd(10) + cdata(CDATA_MAX_HP, CHARA_PLAYER) / 20 + 1, DAMAGE_FROM_DESERT
            }
        }
    }
	if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN ) {
		if ( gdata(GDATA_RES_WEATHER) == 0 ) {
			if ( rnd(100) == 0 ) {
				if ( cbit(CHARA_BIT_FLOAT, CHARA_PLAYER) == 0 | cdata(CDATA_CONDITION_GRAVITY, CHARA_PLAYER) > 0 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt " *びしゃ* ", " *ザブッ* ", " *パシャッ* ", " *ざぶ* "
					}
					if ( en ) {
						txt " *drip* ", " *sip* ", " *drizzle* ", " *splash* ", " *kissh* "
					}
					cdata(CDATA_ACTION_PERIOD, cc) += 5
				}
			}
			if ( cdata(CDATA_CONDITION_CONFUSE, CHARA_PLAYER) == 0 ) {
				if ( rnd(500) == 0 ) {
					txtef COLOR_PURPLE
					txt lang("雨が激しすぎてどこを歩いているかもわからない！", "It's raining heavily. You lose your way."), lang("あまりにも視界が悪すぎる。", "You can't see a thing!"), lang("豪雨のせいで前が全く見えない。", "You can't see an inch of front of you.")
					cdata(CDATA_CONDITION_CONFUSE, CHARA_PLAYER) = 10
				}
			}
			else {
				if ( rnd(5) == 0 ) {
					cdata(CDATA_CONDITION_CONFUSE, CHARA_PLAYER) = 10
				}
			}
		}
		cdata(CDATA_CONDITION_BLIND, CHARA_PLAYER) = 3
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		gdata(GDATA_MIN)++
		return
	}
	if ( gdata(GDATA_FLAG_MANUSCRIPT_IDEAS) < 100 ) {
		if ( rnd(10000) > rnd(sdata(SKILL_NORMAL_TRAVELING, CHARA_PLAYER) + 1000) ) {
			gdata(GDATA_FLAG_MANUSCRIPT_IDEAS)++
		}
	}
	traveldone = 1
	gdata(GDATA_TRAVEL_DISTANCE) += 4
	gdata(GDATA_FLAG_MILES_TRAVELED) += 4
	if ( gdata(GDATA_FLAG_MILES_TRAVELED) >= 1000000000 ) {
		gdata(GDATA_FLAG_MILES_TRAVELED) = 0
	}
	if ( gdata(GDATA_PETS_IN_DOJO) != 0 & gdata(GDATA_DOJO_TURNS) < 100000 ) {
		gdata(GDATA_DOJO_TURNS) += 1
	}
	rowactend cc
	return

*choose_fish
	if ( rowactre != 0 ) {
		return
	}
	turi = cdata(CDATA_ITEM_USING, CHARA_PLAYER)
	basyo = 0
	dbmax = 0
	dbsum = 0
	repeat MAX_FISH
		if ( fishdata(FISHDATA_PIC, cnt) == 0 ) {
			continue
		}
		i = limit(inv(INV_ITEM_FISHING_BAIT, ci) + (rnd(5) == 0) - (rnd(5) == 0), 0, 5)
		if ( gdata(GDATA_WORLD) == AREA_AIMWELL ) {
			i = 6
		}
		if ( gdata(GDATA_WORLD) == AREA_SOUTH_TYRIS ) {
			i += 200
		}
		if ( gdata(GDATA_WORLD) == AREA_LOST_YLVA ) {
			i += 300
		}
		if ( fishdata(FISHDATA_LEVEL, cnt) != i ) {
			continue
		}
		dblist(0, dbmax) = cnt, fishdata(FISHDATA_RARE, cnt) + dbsum
		dbsum += fishdata(FISHDATA_RARE, cnt)
		dbmax++
	loop
	fish = 1
	if ( dbsum != 0 ) {
		exrand_rnd dbtmp, dbsum
		repeat dbmax
			if ( dblist(1, cnt) > dbtmp ) {
				fish = dblist(0, cnt)
				break
			}
		loop
	}
	return

*get_fish
	flt
	itemcreate 0, fishdata(FISHDATA_ID, fish), -1, -1, 0
	inv(INV_ITEM_SUB_NAME, ci) = fish
	inv(INV_ITEM_PIC, ci) = fishdata(FISHDATA_PIC, fish)
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_FISH ) {
		fishsize = (rnd(10) * rnd(10) + 80) / 10
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_FISH_JUNK ) {
		fishsize = 10
	}
	inv(INV_ITEM_VALUE, ci) = fishdata(FISHDATA_VALUE, fish) / 10 * fishsize
	inv(INV_ITEM_WEIGHT, ci) = fishdata(FISHDATA_WEIGHT, fish) / 10 * fishsize
	if ( gdata(GDATA_WORLD) == AREA_SOUTH_TYRIS ) {
		inv(INV_ITEM_COL, ci) = 5
	}
	if ( gdata(GDATA_WORLD) == AREA_LOST_YLVA ) {
		inv(INV_ITEM_COL, ci) = 7
	}
	txt lang(itemname(ci, 1) + "を釣り上げた！", "You get " + itemname(ci, 1) + "!")
	item_stack CHARA_PLAYER, ci, 1
	inv(INV_ITEM_CHARGE, turi)--
	fishsize = 0
	return

*fishing
	if ( rowactre != 0 ) {
		txt lang("釣りを始めた。", "You start fishing.")
		snd SOUNDLIST_FISH_CAST
		gosub *randomSite
		return
	}
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		txt lang("釣りを始めた。", "You start fishing.")
		snd SOUNDLIST_FISH_CAST
		if ( rowactre == 0 ) {
			cdata(CDATA_ITEM_USING, cc) = ci
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_FISH
		cdata(CDATA_ACTION_PERIOD, cc) = 30
		racount = 0
		fishstat = 0
		if ( rowactre == 0 ) {
			item_find ITEM_ID_SUPER_LURE, 3
			if ( stat != (-1) ) {
				gdata(GDATA_USING_SUPER_LURE) = 1
				txt lang("マシンルアーも使用した。", "You also use the super lure.")
			}
			else {
				gdata(GDATA_USING_SUPER_LURE) = 0
			}
		}
		if ( gdata(GDATA_USING_SUPER_LURE) == 1 ) {
			snd SOUNDLIST_WATER2
			snd SOUNDLIST_FISH_GET
			gosub *choose_fish
			gosub *get_fish
			rowactend cc
			if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
				cdata(CDATA_SP, cc) -= 3
			}
			else {
				cdata(CDATA_SP, cc) -= 15
			}
			if ( rnd(10) == 0 ) {
				gosub *expFishing
			}
			return
		}
		gsel 9
		pos 0, 0
		picload exedir + "\\graphic\\fishing.bmp"
		gsel 0
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( tulimit <= gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 & tulihun <= gdata(GDATA_MIN) | inv(INV_ITEM_CHARGE, turi) <= 0 ) {
			txt lang("釣りを切り上げた。", "You stop fishing...")
			rowactend cc
		}
		if ( inv_getspace(cc) == 0 ) {
			txt_invfull
			txt lang("釣りを切り上げた。", "You stop fishing...")
			rowactend cc
            return
		}
		if ( rnd(3) == 0 ) {
			fishstat = 1
			gosub *choose_fish
		}
		if ( fishstat == 1 ) {
			if ( rnd(2) == 0 ) {
				repeat 4 + rnd(4)
					redraw 0
					fishanime = 1, 3 + rnd(3)
					addefmap fishx, fishy, 4, 2
					scrturn++
					gosub *screen_draw
					redraw 1
					await cfg_wait1 * 2
				loop
				if ( rnd(3) == 0 ) {
					fishstat = 2
				}
				if ( rnd(6) == 0 ) {
					fishstat = 0
				}
				fishanime = 0
			}
		}
		if ( fishstat == 2 ) {
			fishanime = 2
			snd SOUNDLIST_WATER2
			cdata(CDATA_EMO_ICON, CHARA_PLAYER) = 20 + 100 * 2
			repeat 8 + rnd(10)
				redraw 0
				scrturn++
				gosub *screen_draw
				redraw 1
				await cfg_wait1 * 2
			loop
			if ( rnd(10) ) {
				fishstat = 3
			}
			else {
				fishstat = 0
			}
			fishanime = 0
		}
		if ( fishstat == 3 ) {
			fishanime = 3
			repeat 28 + rnd(15)
				if ( cnt \ 7 == 0 ) {
					snd SOUNDLIST_FISH_FIGHT
				}
				redraw 0
				fishanime(1) = cnt
				scrturn++
				gosub *screen_draw
				addefmap fishx, fishy, 5, 2
				redraw 1
				await cfg_wait1 * 2
			loop
			if ( fishdata(FISHDATA_POWER, fish) >= rnd(sdata(SKILL_NORMAL_FISHING, CHARA_PLAYER) + 1) ) {
				fishstat = 0
			}
			else {
				fishstat = 4
			}
			fishanime = 0
		}
		if ( fishstat == 4 ) {
			fishanime = 4
			snd SOUNDLIST_FISH_GET
			repeat 21
				redraw 0
				fishanime(1) = cnt
				if ( cnt == 1 ) {
					addefmap fishx, fishy, 1, 3
				}
				scrturn++
				gosub *screen_draw
				redraw 1
				await cfg_wait1 * 2
			loop
			snd SOUNDLIST_GET1 + rnd(2)
			fishanime = 0
			gosub *get_fish
			if ( tulimit > gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 | tulihun > gdata(GDATA_MIN) & inv(INV_ITEM_CHARGE, turi) > 0 ) {
				racount = 0
				fishstat = 0
				cdata(CDATA_ACTION_PERIOD, cc) = 30
			}
			else {
				rowactend cc
			}
			gosub *expFishing
			cdata(CDATA_EMO_ICON, CHARA_PLAYER) = 6 + 100 * 3
		}
		if ( rnd(50) == 0 ) {
			dmgsp cc, 1
		}
		return
	}
	txt lang("何も釣れなかった…", "A waste of time...")
	if ( tulimit > gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 | tulihun > gdata(GDATA_MIN) & inv(INV_ITEM_CHARGE, turi) > 0 ) {
		racount = 0
		fishstat = 0
		cdata(CDATA_ACTION_PERIOD, cc) = 30
	}
	else {
		rowactend cc
	}
	return

*plant
	if ( rowactre != 0 ) {
		txt lang("採取を始めた。", "You start to search the spot.")
		gosub *randomSite
		return
	}
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_PLANT
		cdata(CDATA_ACTION_PERIOD, cc) = 40
		txt lang("採取を始めた。", "You start to search the spot.")
		racount = 0
		return
	}
	rowactend cc
	return

*search
	if ( rowactre != 0 ) {
		txt lang("探索を始めた。", "You start to dig the spot.")
		gosub *randomSite
		return
	}
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_SEARCH
		cdata(CDATA_ACTION_PERIOD, cc) = 20
		if ( rowactre == 0 ) {
			txt lang("地面を掘り始めた。", "You start to dig the ground.")
		}
		else {
			txt lang("探索を始めた。", "You start to dig the spot.")
		}
		racount = 0
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( cdata(CDATA_TURN, cc) \ 5 == 0 ) {
			txtmore
			txtef COLOR_BLUE
			txt lang(" *ざくっ* ", " *clink* "), lang(" *カキン* ", " *smash* "), lang(" *ごつっ* ", " *thud* "), lang(" *じゃり* ", " *sing* "), lang(" *♪* ", " *sigh* ")
		}
		return
	}
	txt lang("地面を掘り終えた。", "You finish digging.")
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		inv_getheader 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_TREASURE_MAP ) {
				if ( inv(INV_ITEM_PARAM1, cnt) != 0 ) {
					if ( inv(INV_ITEM_PARAM1, cnt) == cdata(CDATA_X, CHARA_PLAYER) ) {
						if ( inv(INV_ITEM_PARAM2, cnt) == cdata(CDATA_Y, CHARA_PLAYER) ) {
							gdata(GDATA_FLAG_TREASURE_FOUND)++
							snd SOUNDLIST_CHEST1
							txtef COLOR_YELLOW
							txt lang(" *ガチッ* …何かがある！", "*click* ...There's something here!")
							msg_halt
							snd SOUNDLIST_DING2
							flt
							itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 2 + rnd(3)
							flt
							itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1 + rnd(3)
							flt
							itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), rnd(10000) + 2000
							if ( rnd(100) == 0 ) {
								flt
								itemcreate -1, ITEM_ID_ROD_WISHING, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
							}
							repeat 4
								flt calcobjlv(cdata(CDATA_LEVEL, CHARA_PLAYER) + 10), calcfixlv(FIX_QUALITY_GREAT)
								if ( cnt == 0 ) {
									fixlv = FIX_QUALITY_GODLY
								}
								flttypemajor = fsetchest(rnd(length(fsetchest)))
								itemcreate -1, ITEM_ID_DUMMY, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
							loop
							txt_questitem
							autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
							inv(INV_ITEM_NUM, cnt)--
							break
						}
					}
				}
			}
		loop
		spillfrag refx, refy, 1
	}
	else {
		if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 6) != 0 ) {
			return
		}
		txt lang("落とし穴ができた。", name(cc) + " set a pitfall trap.")
		cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_PITFALL, cc
		if ( cc == CHARA_PLAYER ) {
			cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tile_trap, -1, -1
		}
	}
	rowactend cc
	return

*dig
	if ( rowactre != 0 ) {
		txt lang("鉱石を掘り始めた。", "You start to dig the mining spot.")
		gosub *randomSite
		return
	}
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_DIG
		cdata(CDATA_ACTION_PERIOD, cc) = 40
		if ( rowactre == 0 ) {
			txt lang("壁を掘りはじめた。", "You start to dig the wall.")
		}
		else {
			txt lang("鉱石を掘り始めた。", "You start to dig the mining spot.")
		}
		if ( chipm(CHIPM_ROLE, map(refx, refy, 0)) == MAP_CHIP_ROLE_HARD_WALL ) {
			txt lang("この壁はとても固そうだ！", "These walls look pretty hard!")
		}
		countdig = 0
		racount = 0
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		if ( rnd(5) == 0 ) {
			dmgsp cc, 1
		}
		countdig++
		f = 0
		if ( chipm(CHIPM_ROLE, map(refx, refy, 0)) == MAP_CHIP_ROLE_HARD_WALL ) {
			if ( rnd(12000) < sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_NORMAL_MINING, cc) * 10 ) {
				f = 1
			}
			p = 30 - sdata(SKILL_NORMAL_MINING, cc) / 2
			if ( p > 0 ) {
				if ( countdig <= p ) {
					f = 0
				}
			}
		}
		else {
			if ( rnd(1500) < sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_NORMAL_MINING, cc) * 10 ) {
				f = 1
			}
			p = 20 - sdata(SKILL_NORMAL_MINING, cc) / 2
			if ( p > 0 ) {
				if ( countdig <= p ) {
					f = 0
				}
			}
		}
		if ( f == 1 | (gdata(GDATA_FLAG_TUTORIAL) == 2 & gdata(GDATA_AREA) == AREA_HOME) ) {
			rtval = 0
			if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
				if ( rnd(3) == 0 ) {
					rtval = ITEM_ID_GOLD_PIECE
				}
				if ( rnd(30) == 0 ) {
					rtval = ITEM_ID_GOLD_BAR
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_DUNGEON | mdata(MDATA_TYPE) == MAP_TYPE_LAKE ) {
				if ( rnd(5) == 0 ) {
					rtval = -1
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
				if ( rnd(5) == 0 ) {
					rtval = ITEM_ID_ACORN
				}
				if ( rnd(100) == 0 ) {
					rtval = ITEM_ID_GOLD_ACORN
				}
				if ( rnd(200) == 0 ) {
					rtval = ITEM_ID_FOUR_LEAF_CLOVER
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWER | mdata(MDATA_TYPE) == MAP_TYPE_FORT ) {
				if ( rnd(8) == 0 ) {
					rtval = ITEM_ID_STONE_MATERIAL
				}
				if ( rnd(120) == 0 ) {
					rtval = ITEM_ID_SAFE
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_NEST ) {
				if ( rnd(5) == 0 ) {
					rtval = ITEM_ID_SHIT
				}
				if ( rnd(10) == 0 ) {
					rtval = ITEM_ID_EGG
				}
				if ( rnd(20) == 0 ) {
					rtval = ITEM_ID_JERKY
				}
				if ( rnd(130) == 0 ) {
					rtval = ITEM_ID_MYSTERIOUS_FOSSIL
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_CEMETERY ) {
				if ( rnd(10) == 0 ) {
					rtval = ITEM_ID_LARGE_BOUQUET
				}
				if ( rnd(20) == 0 ) {
					rtval = ITEM_ID_PLUSH_DOLL
				}
				if ( rnd(30) == 0 ) {
					rtval = ITEM_ID_COFFIN
				}
				if ( rnd(180) == 0 ) {
					rtval = ITEM_ID_BOOK_RESURRECTION
				}
			}
			if ( mdata(MDATA_TYPE) == MAP_TYPE_MINE ) {
				if ( rnd(5) == 0 ) {
					rtval = ITEM_ID_SULFUR
				}
				if ( rnd(10) == 0 ) {
					rtval = ITEM_ID_CLAY
				}
				if ( rnd(40) == 0 ) {
					rtval = ITEM_ID_BLACK_CRYSTAL
				}
				if ( rnd(300) == 0 ) {
					rtval = ITEM_ID_STARDUST
				}
			}
			item_find ITEM_ID_DOWSING_OPATOS, 3, 1
			if ( stat != (-1) ) {
				ci = stat
				if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
					if ( rtval == 0 ) {
						if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
							if ( rnd(3) == 0 ) {
								rtval = ITEM_ID_GOLD_PIECE
							}
							if ( rnd(30) == 0 ) {
								rtval = ITEM_ID_GOLD_BAR
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_DUNGEON | mdata(MDATA_TYPE) == MAP_TYPE_LAKE ) {
							if ( rnd(5) == 0 ) {
								rtval = -1
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
							if ( rnd(5) == 0 ) {
								rtval = ITEM_ID_ACORN
							}
							if ( rnd(100) == 0 ) {
								rtval = ITEM_ID_GOLD_ACORN
							}
							if ( rnd(200) == 0 ) {
								rtval = ITEM_ID_FOUR_LEAF_CLOVER
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWER | mdata(MDATA_TYPE) == MAP_TYPE_FORT ) {
							if ( rnd(8) == 0 ) {
								rtval = ITEM_ID_STONE_MATERIAL
							}
							if ( rnd(120) == 0 ) {
								rtval = ITEM_ID_SAFE
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_NEST ) {
							if ( rnd(5) == 0 ) {
								rtval = ITEM_ID_SHIT
							}
							if ( rnd(10) == 0 ) {
								rtval = ITEM_ID_EGG
							}
							if ( rnd(20) == 0 ) {
								rtval = ITEM_ID_JERKY
							}
							if ( rnd(130) == 0 ) {
								rtval = ITEM_ID_MYSTERIOUS_FOSSIL
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_CEMETERY ) {
							if ( rnd(10) == 0 ) {
								rtval = ITEM_ID_LARGE_BOUQUET
							}
							if ( rnd(20) == 0 ) {
								rtval = ITEM_ID_PLUSH_DOLL
							}
							if ( rnd(30) == 0 ) {
								rtval = ITEM_ID_COFFIN
							}
							if ( rnd(180) == 0 ) {
								rtval = ITEM_ID_BOOK_RESURRECTION
							}
						}
						if ( mdata(MDATA_TYPE) == MAP_TYPE_MINE ) {
							if ( rnd(5) == 0 ) {
								rtval = ITEM_ID_SULFUR
							}
							if ( rnd(10) == 0 ) {
								rtval = ITEM_ID_CLAY
							}
							if ( rnd(40) == 0 ) {
								rtval = ITEM_ID_BLACK_CRYSTAL
							}
							if ( rnd(300) == 0 ) {
								rtval = ITEM_ID_STARDUST
							}
						}
						if ( rtval != 0 ) {
							kaiwa = rnd(4)
							if ( kaiwa == 0 ) {
								txt lang("「フハハハ!フハハハ!」", cnvtalk("Muwahaha! Muwahaha!"))
							}
							if ( kaiwa == 1 ) {
								txt lang("「フハーン!」", cnvtalk("Muhan!"))
							}
							if ( kaiwa == 2 ) {
								txt lang("「ここだ！フハハハッ！」", cnvtalk("Mwahaha! Here it is!"))
							}
							if ( kaiwa == 3 ) {
								txt lang("「ここ掘れフハハ！」", cnvtalk("Dig! Dig! Mwahahaha!"))
							}
						}
					}
				}
			}
			if ( map(refx, refy, 6) != 0 ) {
				cell_featread refx, refy
				if ( feat(1) == CELL_FEATURE_HIDDEN_PATH ) {
					gosub *revealHiddenPath
				}
			}
			map(refx, refy, 0) = tile_tunnel
			if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_SHOP ) {
				dblistmax = 0
				inv_getheader -1
				repeat invrange, invhead
					if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
						continue
					}
					if ( chipm(CHIPM_ROLE, map(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), 0)) == MAP_CHIP_ROLE_DISPLAY_SPACE ) {
						inv(INV_ITEM_SHOP_SAMPLE, cnt) = 100
					}
					else {
						inv(INV_ITEM_SHOP_SAMPLE, cnt) = 0
					}
				loop
			}
			spillfrag refx, refy, 2
			x = refx
			y = refy
			snd SOUNDLIST_CRUSH1
			animeid = ANIMATION_CRUSH
			aniref = 5
			gosub *anime
			txt lang("壁を掘り終えた。", "You finished digging the wall.")
			if ( gdata(GDATA_FLAG_TUTORIAL) == 2 & gdata(GDATA_AREA) == AREA_HOME ) {
				flt
				itemcreate -1, ITEM_ID_WORTHLESS_FAKE_GOLD_BAR, digx, digy, 0
				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
				txt lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				gdata(GDATA_FLAG_TUTORIAL) = 3
			}
			else {
				if ( rtval != 0 & gdata(GDATA_AREA) != AREA_SHELTER ) {
					if ( rtval > 0 ) {
						flt
						itemcreate -1, rtval, digx, digy, 0
						if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MYSTERIOUS_FOSSIL ) {
							inv(INV_ITEM_PARAM2, ci) = limit(rnd((gdata(GDATA_LEVEL) + 3) / 3 + 2), 0, 99)
						}
					}
					else {
						if ( rtval == (-1) ) {
							flt calcobjlv(gdata(GDATA_LEVEL)), calcfixlv(FIX_QUALITY_GREAT)
							flttypemajor = FILTER_ORE
							itemcreate -1, ITEM_ID_DUMMY, digx, digy, 0
						}
					}
					txt lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				}
			}
			gdata(GDATA_FLAG_WALLS_MINED)++
			gosub *expDig
			rowactend cc
		}
		else {
			if ( cdata(CDATA_TURN, cc) \ 5 == 0 ) {
				txtmore
				txtef COLOR_BLUE
				txt lang(" *ざくっ* ", " *clink* "), lang(" *カキン* ", " *smash* "), lang(" *ごつっ* ", " *thud* "), lang(" *じゃり* ", " *sing* "), lang(" *♪* ", " *sigh* ")
			}
		}
		return
	}
	txt lang("背中が痛い…掘るのを諦めた。", "Your back hurts... You give up digging.")
	rowactend cc
	return

*eat
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		cdata(CDATA_ROW_ACT, cc) = ACTION_EAT
		cdata(CDATA_ACTION_PERIOD, cc) = 8
		if ( cc == CHARA_PLAYER ) {
			if ( trait(TRAIT_ETHER_MULTIPLE_MOUTHS) != 0 ) {
				cdata(CDATA_ACTION_PERIOD, cc) = 4
			}
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RICE_BALL ) {
			cdata(CDATA_ACTION_PERIOD, cc) = 1
		}
		cdata(CDATA_ITEM_USING, cc) = ci
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_EAT1
			if ( inv(INV_ITEM_PROPERTY, ci) == PROP_NPC & cc < MAX_CHARA_FOLLOWER ) {
				gdata(GDATA_FLAG_TIMES_EATEN_IN_SECRET)++
				txt lang(name(cc) + "は" + itemname(ci, 1) + "をこっそりと口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + " in secret.")
			}
			else {
				txt lang(name(cc) + "は" + itemname(ci, 1) + "を口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + ".")
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CORPSE & inv(INV_ITEM_SUB_NAME, ci) == CREATURE_ID_MAMMOTH ) {
				txt lang("「いただきマンモス」", cnvtalk("Let's eatammoth."))
			}
		}
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		return
	}
	if ( cdata(CDATA_TAMER_WHIP_PICKUP, cc) == 10 ) {
		if ( ci >= RANGE_INV2 ) {
			modimp2 cc, -20
		}
	}
	if ( synccheck(cc, -1) ) {
		txt lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_CARGO) == 1 & TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE) {
		if ( cdata(CDATA_THIRST, cc) < 12000 ) {
			if ( synccheck(cc, -1) ) {
				txt lang("さらに、付属していた飲み物も飲んだ。", name(cc) + " also drank the beverage that came with the food.")
			}
			cdata(CDATA_THIRST, cc) += 2000
		}
	}
	gosub *insta_eat
	rowactend cc
	return

*insta_eat
	cieat = ci
	gosub *eatEffect
	ci = cieat
	if ( cc == CHARA_PLAYER ) {
		item_identify ci, ITEM_KNOWN_NAME
	}
	chara_unequip ci
	if ( stat == 1 ) {
		r1 = cc
		gosub *charaRefresh
	}
	inv(INV_ITEM_NUM, ci)--
	if ( ci >= RANGE_INV2 ) {
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
	}
	else {
		if ( cc == CHARA_PLAYER ) {
			gosub *calcBurdenPc
		}
	}
	if ( cc == CHARA_PLAYER ) {
		gosub *eat_finish
	}
	else {
		if ( ci == cdata(CDATA_AI_ITEM, cc) ) {
			cdata(CDATA_AI_ITEM, cc) = 0
		}
		if ( cbit(CHARA_BIT_POISON_FLAG, cc) ) {
			if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_RAW ) {
				if ( inv(INV_ITEM_ROT, ci) < 0 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt "「うぐぐ！なんだこの飯は！」", "「うっ！」", "「……！！」", "「あれれ…」", "「…これは何の嫌がらせですか」", "「まずい！」"
					}
					if ( en ) {
						txt cnvtalk("Yuck!!"), cnvtalk("...!!"), cnvtalk("W-What..."), cnvtalk("Are you teasing me?"), cnvtalk("You fool!")
					}
					dmghp cc, 999, DAMAGE_FROM_BAD_FOOD
					if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
						if ( cdata(CDATA_RELATION, cc) > 0 ) {
							modkarma CHARA_PLAYER, -5
						}
						else {
							modkarma CHARA_PLAYER, -1
						}
					}
					modimp tc, -25
					return
				}
			}
		}
	}
	chara_anorexia cc
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_KAGAMI_MOCHI & rnd(3) | (inv(INV_ITEM_ID, ci) == ITEM_ID_MOCHI & rnd(10) == 0) | (inv(INV_ITEM_ID, ci) == ITEM_ID_OZOUNI & rnd(3) == 0) | (inv(INV_ITEM_ID, ci) == ITEM_ID_OSIRUKO & rnd(3) == 0) ) {
		if ( synccheck(cc, -1) ) {
			txtef COLOR_PURPLE
			txt lang(name(cc) + "はもちを喉につまらせた！", name(cc) + " choke" + _s(cc) + " on mochi!")
			txt lang("「むがっ」", cnvtalk("Mm-ghmm"))
		}
		cdata(CDATA_CONDITION_SUFFOCATION, cc) = 100 + rnd(100)
	}
	return

*eat_finish
	txtmore
	txtef COLOR_GREEN
	if ( cdata(CDATA_HUNGER, cc) >= 12000 ) {
		txt lang("もう当分食べなくてもいい。", "Phew! You are pretty bloated."), lang("こんなに食べたことはない！", "You've never eaten this much before!"), lang("信じられないぐらい満腹だ！", "Your stomach is unbelievably full!")
		return
	}
	if ( cdata(CDATA_HUNGER, cc) >= 10000 ) {
		txt lang("あなたは満足した。", "You are satisfied!"), lang("満腹だ！", "This hearty meal has filled your stomach."), lang("あなたは食欲を満たした。", "You really ate!"), lang("あなたは幸せそうに腹をさすった。", "You pat your stomach contentedly.")
		return
	}
	if ( cdata(CDATA_HUNGER, cc) >= 5000 ) {
		txt lang("まだ食べられるな…", "You can eat more."), lang("あなたは腹をさすった。", "You pat your stomach."), lang("少し食欲を満たした。", "You satisfied your appetite a little.")
		return
	}
	if ( cdata(CDATA_HUNGER, cc) >= 2000 ) {
		txt lang("まだまだ食べたりない。", "You are still a bit hungry."), lang("物足りない…", "Not enough..."), lang("まだ空腹だ。", "You want to eat more."), lang("少しは腹の足しになったか…", "Your stomach is still somewhat empty.")
		return
	}
	if ( cdata(CDATA_HUNGER, cc) >= 1000 ) {
		txt lang("全然食べたりない！", "No, it was not enough at all."), lang("腹の足しにもならない。", "You still feel very hungry."), lang("すぐにまた腹が鳴った。", "You aren't satisfied.")
		return
	}
	txt lang("こんな量では意味がない！", "It didn't help you from starving!"), lang("これぐらいでは、死を少し先に延ばしただけだ。", "It prolonged your death for seconds."), lang("無意味だ…もっと栄養をとらなければ。", "Empty! Your stomach is still empty!")
	return

*readSpellbook
	if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ANCIENT_BOOK ) {
			if ( inv(INV_ITEM_PARAM2, ci) != 0 ) {
				txt lang("それは既に解読済みだ。", "You have already decoded the book.")
				return
			}
		}
		if ( cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
			}
			return
		}
		cdata(CDATA_ROW_ACT, cc) = ACTION_READ
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RECIPE ) {
			p = 50
		}
		else {
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ANCIENT_BOOK ) {
				p = 50 + inv(INV_ITEM_PARAM1, ci) * 50 + inv(INV_ITEM_PARAM1, ci) * inv(INV_ITEM_PARAM1, ci) * 20
			}
			else {
				p = sdataref(SKILL_DATAREF_DIFF, efid)
			}
		}
		cdata(CDATA_ACTION_PERIOD, cc) = p / (2 + sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER)) + 1
		if ( ens2 > 0 ) {
			cdata(CDATA_ACTION_PERIOD, cc) += cdata(CDATA_ACTION_PERIOD, cc) / 2 + 5
		}
		cdata(CDATA_ITEM_USING, cc) = ci
		if ( synccheck(cc, -1) ) {
			txt lang(npcn(cc) + itemname(ci, 1) + "を読み始めた。", name(cc) + " start" + _s(cc) + " to read " + itemname(ci, 1) + ".")
		}
		item_separate ci
		return
	}
	if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
		ci = cdata(CDATA_ITEM_USING, cc)
		cibkread = ci
		gosub *expLiteracy
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RECIPE ) {
			return
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ANCIENT_BOOK ) {
			r2 = 50 + inv(INV_ITEM_PARAM1, ci) * 50 + inv(INV_ITEM_PARAM1, ci) * inv(INV_ITEM_PARAM1, ci) * 20
			r3 = 0
		}
		else {
			r2 = sdataref(SKILL_DATAREF_DIFF, efid)
			r3 = efid
		}
		if ( inv(INV_ITEM_STATUS, ci) >= ITEM_STATUS_BLESSED ) {
			r2 = r2 * 100 / 120
		}
		if ( inv(INV_ITEM_STATUS, ci) <= ITEM_STATUS_CURSED ) {
			r2 = r2 * 150 / 100
		}
		gosub *calcReadCheck
		ci = cibkread
		if ( stat == 0 ) {
			rowactend cc
			inv(INV_ITEM_CHARGE, ci)--
			if ( inv(INV_ITEM_CHARGE, ci) < 0 ) {
				inv(INV_ITEM_CHARGE, ci) = 0
			}
			if ( inv(INV_ITEM_CHARGE, ci) == 0 ) {
				inv(INV_ITEM_NUM, ci)--
				if ( ci >= RANGE_INV2 ) {
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				}
				else {
					gosub *calcBurdenPc
				}
				if ( synccheck(cc, -1) ) {
					txt lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
				}
			}
		}
		return
	}
	if ( synccheck(cc, -1) ) {
		txt lang(npcn(cc) + itemname(ci, 1) + "を読み終えた。", name(cc) + " " + have(cc) + " finished reading the book.")
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RECIPE ) {
		if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
			rowactend cc
			return 1
		}
		txt lang(itemname(ci, 1) + "を覚えた！", "You learned the recipe!")
		recipememory(inv(INV_ITEM_SUB_NAME, ci))++
		item_identify ci, ITEM_KNOWN_NAME
		removeitem ci, 1
		if ( synccheck(cc, -1) ) {
			txt lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
		}
		rowactend cc
		return 1
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ANCIENT_BOOK ) {
		item_identify ci, ITEM_KNOWN_FULL
		gdata(GDATA_FLAG_ABYSS_POWER) += (inv(INV_ITEM_PARAM1, ci) + 1) * 100
		if ( gdata(GDATA_FLAG_ABYSS_POWER) > 100000 ) {
			gdata(GDATA_FLAG_ABYSS_POWER) = 100000
		}
		txt lang(itemname(ci, 1) + "を解読した！", "You finished decoding " + itemname(ci, 1) + "!")
		inv(INV_ITEM_PARAM2, ci) = 1
		inv(INV_ITEM_CHARGE, ci) = 1
		ibitmod ITEM_BIT_CHARGE_ITEM, ci, 0
		txt lang("[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
		item_stack CHARA_PLAYER, ci, 1
	}
	else {
		skillgain cc, efid, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(SKILL_NORMAL_MEMORIZATION, cc) + (sdata(SKILL_NORMAL_MEMORIZATION, cc) > 0) * 20) / 200 + 100
		gosub *expMemorize
		if ( itemmemory(2, inv(INV_ITEM_ID, ci)) == 0 ) {
			itemmemory(2, inv(INV_ITEM_ID, ci)) = 1
		}
	}
	if ( ens2 > 0 ) {
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
				else {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, tc) ) {
						continue
					}
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			skillexp SKILL_NORMAL_LITERACY, tc, 400
			if ( inv(INV_ITEM_ID, ci) != ITEM_ID_ANCIENT_BOOK ) {
				skillexp SKILL_NORMAL_MEMORIZATION, tc, 10 + sdataref(SKILL_DATAREF_DIFF, efid) / 2
			}
		loop
		ens2 = 0
	}
	item_identify ci, ITEM_KNOWN_NAME
	if ( inv(INV_ITEM_ID, ci) != ITEM_ID_ANCIENT_BOOK ) {
		inv(INV_ITEM_CHARGE, ci)--
		if ( inv(INV_ITEM_CHARGE, ci) < 0 ) {
			inv(INV_ITEM_CHARGE, ci) = 0
		}
		if ( inv(INV_ITEM_CHARGE, ci) == 0 ) {
			removeitem ci, 1
			if ( synccheck(cc, -1) ) {
				txt lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
			}
		}
	}
	rowactend cc
	return 1

*read
	if ( cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		return
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_LICENCE_THE_VOID_EXPLORER ) {
		snd SOUNDLIST_BOOK1
		txt lang("すくつの探索を許可する、という内容の文面が形式的に書いてある。", "According to the card, you are permitted to explore the void now.")
		return 1
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKILLBOOK ) {
		gosub *com_train
		if ( stat == 1 ) {
			return 1
		}
		else {
			return 0
		}
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOOK_RACHEL ) {
		snd SOUNDLIST_BOOK1
		txt lang("レイチェルという作家による、心あたたまる童話集だ。", "It's a lovely fairy tale written by Rachel.")
		return 1
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_LULWYS_PHOTO_COLLECTION ) {
		snd SOUNDLIST_BOOK1
		txt lang("なんとも過激だ…。", "Extreme photos are arranged...")
		return 1
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_PRODUCED_BOOK ) {
		snd SOUNDLIST_BOOK1
		if ( inv(INV_ITEM_PARAM3, ci) <= 0 ) {
			txt lang("どうして思った通りのものが作れないのだろう…。", "Why am I unable to express the ideas I have in my head...?")
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 1 ) {
			txt lang("今見ると痛々しい…。", "Reading this now makes me cringe...")
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 2 ) {
			txt lang("…これは王道なんだ。誰が何を言おうと王道なんだ。", "...I don't care if it's cliche. It's tried-and-true formula of storytelling.")
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 3 ) {
			txt lang("粗削りな部分も多いけれど…確かな魅力を感じる。", "It has its flaws, but... it also carries its own unique charm.")
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 4 ) {
			txt lang("悪くないけど、もっともっと上達できるはず…！", "It's not bad, but it could have been so much better...!")
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 5 ) {
			txt lang("…普通にお気に入りだ！", "...This is my favorite work!")
		}
		if ( inv(INV_ITEM_PARAM3, ci) >= 6 ) {
			txt lang("よくこんなの作れたな…。", "I'm surprised that I managed to write something *this* good...")
		}
		return 1
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_AURTEHOM ) {
		if ( gdata(GDATA_FLAG_ABYSS_POWER) > 100000000 ) {
			gdata(GDATA_FLAG_ABYSS_POWER) = 100000000
		}
		if ( 0 ) {
			gdata(GDATA_FLAG_ABYSS_POWER) += 3000
		}
		txt lang("[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
		txtvalid = 0
		txt lang("開いたページから異様な冷気が溢れ出ている…。", "A strange air exudes from the open book...")
		txtsetabyss 10
		repeat 10
			promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
			promptmax++
		loop
		val = promptx, prompty, 500, 1
		gosub *prompt_key
		if ( stat == 0 ) {
			gosub *screen_draw
			return 1
		}
		if ( rtval == 0 ) {
			gosub *screen_draw
			return 1
		}
		cc = CHARA_PLAYER
		if ( rtval == 2 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 500 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 50
			gdata(GDATA_FLAG_ABYSS_POWER) -= 50
			txtef COLOR_YELLOW
			txt lang(name(cc) + "は不可視の刃を放った。", name(tc) + " emanated invisible blades.")
			cc = CHARA_PLAYER
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE & cdata(CDATA_RELATION, cnt) >= RELATION_DISLIKE) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				snd SOUNDLIST_ATKSWORD
				dmghp tc, ((sdata(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) + 1) / 5 + 4) * ((sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) + 1) / 5 + 3) * 2 + rnd(sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) * 2 + 5) + 1, cc, SKILL_RESDMG_CUT, 1000
				if ( cdata(CDATA_HP, tc) >= 0 ) {
					if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
						attackskill = SKILL_WEAPON_LONGSWORD
						efid = SKILL_SPACT_DECAPITATION2
						gosub *effect
					}
				}
			loop
		}
		if ( rtval == 3 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 1000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 200
			gdata(GDATA_FLAG_ABYSS_POWER) -= 200
			txt lang("周囲を深い闇が包んでいく…。", "Deep darkness wraps around...")
			redraw 0
			gosub *screen_draw
			gosub *screen_fade
			gsel BUFFER_BUF
			pos 0, 0
			picload exedir + "graphic\\face1" + devfile + ".bmp", 1
			gsel BUFFER_SCREEN
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE & cdata(CDATA_RELATION, cnt) >= RELATION_DISLIKE) ) {
						continue
					}
				}
				if ( cdata(CDATA_ALLIED, cnt) == 100 ) {
					continue
				}
				if ( cbit(CHARA_BIT_SUMMONED, cnt) != TRUE ) {
					continue
				}
				cdata(CDATA_HP, cnt) = 0
				dmghp cnt, cdata(CDATA_MAX_HP, cnt), DAMAGE_FROM_UNSEEN
			loop
		}
		if ( rtval == 4 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 2000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			if ( gdata(GDATA_AREA) == AREA_REMIDO & gdata(GDATA_LEVEL) == 129 | (gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179) ) {
				snd SOUNDLIST_FAIL1
				txt lang("この階層では脱出が出来ないようだ。", "This floor gradually loses power.")
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 500
			gdata(GDATA_FLAG_ABYSS_POWER) -= 500
			txt lang("あなたは意を決し、おぞましい暗闇の中へ踏み込んだ…。", "You jumped into the darkness that appeared in front of you...")
			gdata(GDATA_TELEPORT_AREA) = gdata(GDATA_WORLD), 1
			gdata(GDATA_RETURN) = 1
		}
		if ( rtval == 5 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 3000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 150
			gdata(GDATA_FLAG_ABYSS_POWER) -= 150
			necrolv = sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) + (sdata(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) + 10) / 2
			if ( necrolv > gdata(GDATA_DEEPEST_LEVEL) * 3 / 2 ) {
				necrolv = gdata(GDATA_DEEPEST_LEVEL) * 3 / 2
			}
			if ( findchara(CREATURE_ID_GREEN_DARK_GUARDIAN) == 0 ) {
				flt
				initlv = necrolv
				novoidlv = 1
				fixlv = FIX_QUALITY_GOOD
				characreate -1, CREATURE_ID_GREEN_DARK_GUARDIAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_RELATION, rc) = RELATION_ALLY
				cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
				cbitmod CHARA_BIT_NECRO, rc, TRUE
				cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
			}
			if ( findchara(CREATURE_ID_BLUE_DARK_GUARDIAN) == 0 ) {
				flt
				initlv = necrolv
				novoidlv = 1
				fixlv = FIX_QUALITY_GOOD
				characreate -1, CREATURE_ID_BLUE_DARK_GUARDIAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_RELATION, rc) = RELATION_ALLY
				cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
				cbitmod CHARA_BIT_NECRO, rc, TRUE
				cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
			}
			if ( findchara(CREATURE_ID_CRIMSON_DARK_GUARDIAN) == 0 ) {
				flt
				initlv = necrolv
				novoidlv = 1
				fixlv = FIX_QUALITY_GOOD
				characreate -1, CREATURE_ID_CRIMSON_DARK_GUARDIAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_RELATION, rc) = RELATION_ALLY
				cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
				cbitmod CHARA_BIT_NECRO, rc, TRUE
				cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
			}
		}
		if ( rtval == 6 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 4000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 300
			gdata(GDATA_FLAG_ABYSS_POWER) -= 300
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE & cdata(CDATA_RELATION, cnt) >= RELATION_DISLIKE) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				snd SOUNDLIST_MIZU
				addbuff tc, BUFF_MIST_OF_SILENCE, sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) * 200, 200
				if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) < 15 ) {
					cdata(CDATA_CONDITION_SUFFOCATION, tc) = 15
				}
			loop
		}
		if ( rtval == 7 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 5000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 450
			gdata(GDATA_FLAG_ABYSS_POWER) -= 450
			repeat MAX_CHARA_TOTAL
				if ( cc == cnt ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALLY_DEAD & cdata(CDATA_EXIST, cnt) != CHAR_STATE_SPIRIT ) {
					continue
				}
				if ( cbit(CHARA_BIT_GUARD_TEMP, cnt) == TRUE ) {
					continue
				}
				if ( cdata(CDATA_CAN_REVIVE, cnt) <= 0 ) {
					continue
				}
				snd SOUNDLIST_CURSE2
				rc = cnt
				gosub *resurrect
				cxinit = cdata(CDATA_X, cc)
				cyinit = cdata(CDATA_Y, cc)
				gosub *place_chara
				cdata(CDATA_AREA, rc) = AREA_NONE
				txtef COLOR_YELLOW
				txt cnven(cdatan(CDATAN_NAME, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
				txtvalid = 0
				txt lang("「苦しい…」", cnvtalk("It hurts..."))
				cdata(CDATA_CAN_REVIVE, rc)--
			loop
		}
		if ( rtval == 8 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 6000 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 600
			gdata(GDATA_FLAG_ABYSS_POWER) -= 600
			animeid = ANIMATION_GIGA
			gosub *anime
			snd SOUNDLIST_BREATH1
			repeat mdata(MDATA_HEIGHT)
				dy = cnt
				repeat mdata(MDATA_WIDTH)
					dx = cnt
					f = 0
					if ( map(dx, dy, MAP_TILE_ID) == xy2pic(24, 16) | map(dx, dy, MAP_TILE_ID) == xy2pic(31, 25) | map(dx, dy, MAP_TILE_ID) == xy2pic(18, 19) | map(dx, dy, MAP_TILE_ID) == xy2pic(8, 21) ) {
						f = 1
					}
					if ( f == 0 ) {
						if ( map(dx, dy, MAP_TILE_ID) >= xy2pic(0, 12) ) {
							f = 1
							if ( rnd(5) == 0 ) {
								snd SOUNDLIST_CRUSH1
								f = 0
							}
						}
					}
					if ( chipm(CHIPM_ROLE, map(dx, dy, MAP_TILE_ID)) == MAP_CHIP_ROLE_WATER ) {
						f = 0
					}
					if ( f == 0 ) {
						map(dx, dy, MAP_TILE_ID) = xy2pic(3, 5)
					}
					if ( cnt \ 10 == 1 ) {
						snd SOUNDLIST_MIZU
					}
					if ( map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
						tc = map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) - 1
						if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
							if ( tc != CHARA_PLAYER ) {
								if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
								}
								txt lang(name(tc) + "は" + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + "をかばった！", name(tc) + " guarded " + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + ".")
							}
						}
						wet tc, 5
						dmg = 1000 + limit((sdata(SKILL_NORMAL_LITERACY, CHARA_PLAYER) + 10) * (sdata(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) + 10) / 3, 1, 99999)
						dmghp tc, dmg, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), SKILL_RESDMG_CRUSH, 1000
						if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
							if ( cc >= MAX_CHARA_FOLLOWER | tc >= MAX_CHARA_FOLLOWER ) {
								dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, SKILL_RESDMG_CRUSH, 1000
								if ( synccheck(tc, -1) ) {
									txtef COLOR_PURPLE
									txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected magic.")
								}
							}
						}
					}
				loop
			loop
			p = 1
			repeat p
				repeat mdata(MDATA_HEIGHT)
					y = cnt
					repeat mdata(MDATA_WIDTH)
						x = cnt
						p = dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), x, y)
						map(x, y, MAP_TILE_ID_MEMORY) = map(x, y, MAP_TILE_ID)
					loop
				loop
			loop
		}
		if ( rtval == 9 ) {
			if ( gdata(GDATA_FLAG_ABYSS_POWER) < 6666 ) {
				snd SOUNDLIST_FAIL1
				return 1
			}
			snd SOUNDLIST_BREATH1
			animeload 82, 0
			dmgsan CHARA_PLAYER, 400
			gdata(GDATA_FLAG_ABYSS_POWER) -= 400
			snd SOUNDLIST_ENC
			animeload 40, 0
			if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
				cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = 5
			}
		}
		if ( rtval == 1 ) {
			txtef COLOR_RED
			txt lang("落ちているアイテムの全てが深淵に呑み込まれる。本当にこの魔術を使う？", "All the dropped items are swallowed in the abyss. Do you really use this magic?")
			txtselectuse 2
			repeat 2
				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
				promptmax++
			loop
			val = promptx, prompty, 200, 1
			gosub *prompt_key
			if ( stat == 0 ) {
				gosub *screen_draw
				return 1
			}
			if ( rtval == 1 ) {
				snd SOUNDLIST_BREATH1
				animeload 82, 0
				dmgsan CHARA_PLAYER, 10
				await 200
				snd SOUNDLIST_SONIC
				repeat MAX_MAP_INV, RANGE_INV2
					if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
						continue
					}
					if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_AURTEHOM ) {
						continue
					}
					if ( inv(INV_ITEM_PROPERTY, cnt) == PROP_NPC | inv(INV_ITEM_PROPERTY, cnt) == PROP_SPECIAL ) {
						continue
					}
					inv(INV_ITEM_NUM, cnt) = 0
					gdata(GDATA_FLAG_ABYSS_POWER)++
					cell_refresh inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt)
				loop
				txt lang("[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
			}
		}
		return 1
	}
	tc = cc
	item_identify ci, ITEM_KNOWN_NAME
	gosub *com_book
	return 1

#deffunc calcmagiccontrol int calcmagiccontrol_arg1, int calcmagiccontrol_arg2
	if ( sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1) != 0 | sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2) != 0 ) {
		if ( cdata(CDATA_RELATION, calcmagiccontrol_arg1) >= 0 & cdata(CDATA_RELATION, calcmagiccontrol_arg2) >= 0 | (cdata(CDATA_RELATION, calcmagiccontrol_arg1) == (-1) & cdata(CDATA_RELATION, calcmagiccontrol_arg2) == (-1)) | (cdata(CDATA_RELATION, calcmagiccontrol_arg1) < (-1) & cdata(CDATA_RELATION, calcmagiccontrol_arg2) < (-1)) ) {
			if ( sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1) * 5 + sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2) > rnd(dmg + 1) ) {
				dmg = 0
			}
			else {
				dmg = rnd(dmg * 100 / (100 + sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1) * 10 + sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2) * 2) + 1)
			}
			if ( dmg < 1 ) {
				if ( synccheck(calcmagiccontrol_arg2, -1) ) {
					txt lang(name(calcmagiccontrol_arg2) + "は巻き込みを免れた。", "The spell passes through " + name(calcmagiccontrol_arg2) + ".")
				}
				if ( sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2) != 0 ) {
					skillexp SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2, 8, 4
				}
				skillexp SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1, 8, 4
				return 1
			}
			if ( sdata(SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2) != 0 ) {
				skillexp SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg2, 30, 2
			}
			skillexp SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1, 30, 2
		}
	}
	return 0

*cast
	spellbk = efid
	ccbk = cc
	gosub *cast_proc
	if ( stat == 1 ) {
		cc = ccbk
		r1 = cc
		r2 = spellbk
		gosub *expCasting
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( powsel == 100 ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BOLT | sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_ARROW | (sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BALL & efid != SKILL_SPACT_RAIN_OF_SANITY & efid != SKILL_SPELL_HEALING_RAIN) ) {
					efid = SKILL_SPACT_DIFFUSION_WAVE
					gosub *effect
					powsel = 0
				}
			}
		}
		return 1
	}
	return 0

*cast_proc
	efsource = 3
	efstatus = 0
	efp = calcspellpower(efid, cc)
	if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( (calcspellcostmp(efid, cc) > cdata(CDATA_MP, cc)) & TweakData(TWEAK_CONVENIENCE_REMOVE_SPELL_OVER_CAST_CONFIRMATION, TWEAK_CATEGORY_CONVENIENCE) == FALSE) {
				txt lang("マナが足りないが、それでも詠唱を試みる？", "You are going to over-cast the spell. Are you sure?")
				promptYesNo
				if ( rtval != 0 ) {
					gosub *screen_draw
					efsource = 0
					return 0
				}
			}
			screenupdate = -1
			gosub *screen_draw
		}
		gosub *effect_selectTg
		if ( stat == 0 ) {
			efsource = 0
			return 0
		}
		if ( TweakData(TWEAK_GAMEPLAY_DISABLE_ATTACK_STAMINA_DEPLETION, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			if ( cdata(CDATA_SP, cc) > (-50) ) {
				cdata(CDATA_SP, cc)--
			}
			if ( cc != CHARA_PLAYER ) {
				if ( cdata(CDATA_SP, cc) > (-50) ) {
					cdata(CDATA_SP, cc)--
				}
			}
		}
		if ( cdata(CDATA_DRAIN_HP, cc) < 99 ) {
			cdata(CDATA_DRAIN_HP, cc)++
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_DRAIN_HP, cc) < 99 ) {
				cdata(CDATA_DRAIN_HP, cc)++
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_SUMMON ) {
				procid = (procid + 1) \ 4
				proclist(procid) = "skSummon" + " ct:" + ct
				if ( cdata(CDATA_RELATION, cc) == 10 | gdata(GDATA_AREA) == AREA_PET_ARENA ) {
					efsource = 0
					return 0
				}
				if ( gdata(GDATA_TURN) \ 10 > 4 ) {
					efsource = 0
					return 0
				}
			}
		}
		if ( cc == CHARA_PLAYER | (cc != CHARA_PLAYER & npccostmp == 1) ) {
			if ( cc == CHARA_PLAYER ) {
				spell(efid - STARTING_SKILL_SPELL) -= calcspellcoststock(efid, cc)
				if ( spell(efid - STARTING_SKILL_SPELL) < 0 ) {
					spell(efid - STARTING_SKILL_SPELL) = 0
				}
			}
			mp = calcspellcostmp(efid, cc)
			if ( cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_EHEKATL ) {
					mp = rnd(mp * 140 / 100 + 1) + 1
				}
			}
			if ( cdata(CDATA_ID, cc) != CREATURE_ID_ANOTHER_WORLD_CHEATAH ) {
				dmgmp cc, mp
			}
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				efsource = 0
				return 1
			}
		}
		if ( cdata(CDATA_CONDITION_CONFUSE, cc) != 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は混乱しながらも魔法を試みた。", name(cc) + " try" + _s(cc) + " to cast a spell in confusion.")
				txtmore
			}
			gosub *calcReadCheck
			if ( stat == 0 ) {
				efsource = 0
				return 1
			}
		}
		else {
			if ( synccheck(cc, -1) ) {
				if ( cc == CHARA_PLAYER ) {
					txt lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cdata(CDATA_CAST_STYLE, cc)), name(cc) + " cast " + skillname(efid) + ".")
					txtmore
				}
				else {
					txt lang(name(cc) + "は" + _cast(cdata(CDATA_CAST_STYLE, cc)), name(cc) + "" + _cast(cdata(CDATA_CAST_STYLE, cc)))
					txtmore
				}
			}
		}
		if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 8) != 0 ) {
			i = map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 8) - 1
			if ( mef(0, i) == 8 ) {
				if ( rnd(4) == 0 ) {
					if ( synccheck(cc, -1) ) {
						txtmore
						txt lang(name(cc) + "は光の霧に目が眩み詠唱に失敗した。", name(cc) + " fail" + _s(cc) + " to cast by glare of mist.")
					}
					efsource = 0
					return 1
				}
			}
		}
		if ( findbuff(cc, BUFF_MIST_OF_SILENCE) != (-1) ) {
			if ( synccheck(cc, -1) ) {
				txt lang("沈黙の霧が魔力の発生を阻止した。", "The mist of silence interrupts a spell.")
			}
			efsource = 0
			return 1
		}
		if ( rnd(100) >= calcspellfail(efid, cc) ) {
			if ( synccheck(cc, -1) ) {
				if ( cdata(CDATA_CAST_STYLE, cc) == 0 ) {
					txt lang(name(cc) + "は詠唱に失敗した。", name(cc) + " fail" + _s(cc) + " to cast a spell.")
				}
				else {
					txt lang("しかしうまく決まらなかった。", name(cc) + " fail" + _s(cc) + " to cast a spell.")
				}
				animeid = ANIMATION_FIZZLE
				gosub *anime
			}
			efsource = 0
			return 1
		}
		if ( TweakData(TWEAK_GAMEPLAY_DISABLE_ATTACK_STAMINA_DEPLETION, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			if ( cdata(CDATA_SP, cc) < 50 ) {
				if ( rnd(2) == 0 ) {
					if ( synccheck(cc, -1) ) {
						txt lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						animeid = ANIMATION_FIZZLE
						gosub *anime
					}
					efsource = 0
					return 1
				}
			}
		}
		if ( noeffect == 1 ) {
			txt_nothinghappens
			efsource = 0
			return 1
		}
	}
	efp = calcspellpower(efid, cc)
	efpori = calcspellpower(efid, cc)
	if ( efid == SKILL_SPELL_DIVINE_WISDOM ) {
		hoseim = limit(cdata(CDATA_ENHANCE_SPELL, cc) * 2 / 3, 0, 1000) / 10
	}
	if ( efid != SKILL_SPELL_DIVINE_WISDOM ) {
		hoseim = limit(cdata(CDATA_ENHANCE_SPELL, cc) * 2 / 3, 0, 1000) / 10 + limit(sdata(SKILL_ATTR_MAG, cc) / 5, 0, 300)
	}
	efp = efp * (100 + hoseim) / 100
	efpori = efp
	if ( cdata(CDATA_EQUIP_WEIGHT, cc) < 35000 & cdata(CDATA_EQUIP_WEIGHT, cc) >= 15000 & findbuff(cc, BUFF_MAGIC_EQUIP) != (-1) ) {
		efp = efp * 6 / 5
	}
	if ( cbit(CHARA_BIT_UPLIFTED_WHILE_CASTING, cc) ) {
		cdata(CDATA_POWER_GAUGE, cc) += 5
		if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
			if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
				cdata(CDATA_POWER_GAUGE, cc) = 100
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
			cdata(CDATA_POWER_GAUGE, cc) = 200
		}
	}
	rapidmagic = 0
	if ( cbit(CHARA_BIT_RAPID_MAGIC, cc) & sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_ARROW ) {
		rapidmagic = 3
	}
	if ( efid == SKILL_SPELL_FIRE_CLAW | efid == SKILL_SPELL_COLD_BLADE | efid == SKILL_SPELL_FIRE_BOLT | efid == SKILL_SPELL_ICE_BOLT | efid == SKILL_SPELL_FIRE_BALL | efid == SKILL_SPELL_ICE_BALL ) {
		fusifc = encfindpower(cc, ENCHANT_FIRE_AND_COLD)
	}
	if ( efid == SKILL_SPELL_MIND_THORN | efid == SKILL_SPELL_SOUND_CANNONBALL | efid == SKILL_SPELL_MIND_BOLT | efid == SKILL_SPELL_SOUND_BOLT | efid == SKILL_SPELL_ILLUSION_ROAR | efid == SKILL_SPELL_RAGING_ROAR ) {
		fusims = encfindpower(cc, ENCHANT_MIND_AND_SOUND)
	}
	if ( efid == SKILL_SPELL_NERVE_ARROW | efid == SKILL_SPELL_POISON_MUCUS | efid == SKILL_SPELL_NERVE_BOLT | efid == SKILL_SPELL_POISON_BOLT | efid == SKILL_SPELL_ANGUISH_JAIL | efid == SKILL_SPELL_POISON_STORM ) {
		fusipn = encfindpower(cc, ENCHANT_POISON_AND_NERVE)
	}
	if ( efid == SKILL_SPELL_DARK_EYE | efid == SKILL_SPELL_NETHER_ARROW | efid == SKILL_SPELL_DARKNESS_BOLT | efid == SKILL_SPELL_NETHER_BOLT | efid == SKILL_SPELL_ECLIPSE | efid == SKILL_SPELL_NETHER_WAVE ) {
		fusidne = encfindpower(cc, ENCHANT_DARKNESS_AND_NETHER)
	}
	if ( rapidmagic ) {
		repeat rapidmagic
			gosub *effect
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				break
			}
		loop
		rapidmagic = 0
	}
	else {
		gosub *effect
	}
	return 1

*drinkPotion
	tc = cc
	efsource = 4
	if ( potionthrow ) {
		cc = ccthrowpotion
	}
	if ( potionspill | potionthrow ) {
		if ( potionthrow ) {
			efp = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 5 + efp * potionthrow / 100
			efstatus = inv(INV_ITEM_STATUS, ci)
		}
	}
	else {
		efp = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 5 + efp
		efstatus = inv(INV_ITEM_STATUS, ci)
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_DRINK1
			txt lang(npcn(tc) + itemname(ci, 1) + "を飲み干した。", name(tc) + " drink" + _s(tc) + " " + itemname(ci, 1) + ".")
		}
	}
	gosub *effect
	if ( ibit(ITEM_BIT_HAZARD, ci) == 1 ) {
		snd SOUNDLIST_ATK_POISON
		txtef COLOR_RED
		txt lang(name(tc) + "の意識が現実を離れ、幻覚に呑み込まれていく…。", name(tc) + " regretted being born.")
		dmg = (sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) + 3) / 2 * sqrt(sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) + 4) + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) * 3 + 5)
		dmghp tc, (dmg + 10) / 10 * (rnd(200) + limit(sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) * 2, 200, 2000)) / 100 + 1, CHARA_PLAYER, SKILL_RES_MIND, 1000
	}
	if ( inv(INV_ITEM_ID, ci) != ITEM_ID_HANDFUL_SNOW & inv(INV_ITEM_ID, ci) != ITEM_ID_BOTTLE_DYE ) {
		if ( potionthrow != 90 ) {
			skillexp SKILL_NORMAL_MAGIC_DEVICE, cc, 40
		}
		else {
			skillexp SKILL_NORMAL_MAGIC_DEVICE, cc, 2
		}
		if ( potionthrow != 90 ) {
			skillexp SKILL_NORMAL_ALCHEMY, cc, 40
		}
		else {
			skillexp SKILL_NORMAL_ALCHEMY, cc, 2
		}
	}
	if ( potionspill | potionthrow ) {
		potionspill = 0
		potionthrow = 0
		if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			cdata(CDATA_THIRST, tc) += 400
		}
		cdata(CDATA_HUNGER, tc) += 30
	}
	else {
		if ( obvious == 1 ) {
			if ( tc == CHARA_PLAYER ) {
				item_identify ci, ITEM_KNOWN_NAME
			}
		}
		inv(INV_ITEM_NUM, ci)--
		if ( ci >= RANGE_INV2 ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		else {
			if ( tc == CHARA_PLAYER ) {
				gosub *calcBurdenPc
			}
		}
		if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			cdata(CDATA_THIRST, tc) += 2000
		}
		cdata(CDATA_HUNGER, tc) += 150
	}
	if ( cdata(CDATA_HUNGER, tc) > 12000 * 2 ) {
		if ( rnd(5) == 0 ) {
			chara_vomit tc
		}
	}
	if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
		if ( cdata(CDATA_THIRST, tc) >= 12000 * 2 ) {
			if ( rnd(5) == 0 ) {
				chara_morasi tc
			}
		}
	}
	return 1

*drinkWell
	if ( inv(INV_ITEM_PARAM1, ci) < (-5) | inv(INV_ITEM_PARAM3, ci) >= 20 | (inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL & gdata(GDATA_FLAG_HOLY_WELL) <= 0) ) {
		valn = itemname(ci)
		txt lang(valn + "は涸れている。", valn + " is dry.")
		return 1
	}
	snd SOUNDLIST_DRINK1
	osakana = 0
	item_find ITEM_ID_MUG_OF_EHEKATL, 3, 1
	if ( stat != (-1) ) {
		if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
			if ( cc == CHARA_PLAYER ) {
				osakana = 100
			}
		}
	}
	if ( osakana == 0 ) {
		valn = itemname(ci)
		txt lang(name(cc) + "は" + valn + "の水をすくって飲んだ。", name(cc) + " draw" + _s(cc) + " water from " + valn + ".")
		txtmore
	}
	if ( osakana == 100 ) {
		valn = itemname(ci)
		txt lang(name(cc) + "は" + valn + "の水をマグカップですくって飲んだ。", name(cc) + " draw" + _s(cc) + " water from " + valn + " by Mug of Ehekatl.")
		txtmore
	}
	tc = cc
	cibk = ci
	p = rnd(100)
	repeat 1
		if ( cc != CHARA_PLAYER ) {
			if ( rnd(15) == 0 ) {
				txt lang(name(cc) + "は井戸に落ちた！ ", name(cc) + " falls in the well!")
				txtmore
				txtef COLOR_SKY_BLUE
				txt name(cc) + lang("「手を伸ばせー」", " yells, " + cnvtalk("G-Give me your hands!"))
				if ( cbit(CHARA_BIT_FLOAT, cc) == 1 & cdata(CDATA_CONDITION_GRAVITY, cc) == 0 | findbuff(cc, BUFF_GRAVITY_ACCEL) != (-1) ) {
					txtmore
					txt lang("しかしすぐに浮いてきた… ", "Soon " + he(cc) + " floats up to the surface.")
				}
				else {
					dmghp cc, 9999, DAMAGE_FROM_TRAP
				}
				break
			}
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL ) {
			if ( rnd(2) == 0 ) {
				efid = SKILL_EFFECT_POTION_POTENTIAL
				gosub *effect
				break
			}
		}
		if ( p > 70 ) {
			if ( osakana == 100 ) {
				txt_freshwater
				break
			}
			p = rnd(5)
			if ( p == 0 ) {
				efid = SKILL_EFFECT_SLEEP
				efp = 100
				gosub *effect
				break
			}
			if ( p == 1 ) {
				efid = SKILL_EFFECT_PARALYZE
				efp = 100
				gosub *effect
				break
			}
			if ( p == 2 ) {
				efid = SKILL_EFFECT_BLIND
				efp = 100
				gosub *effect
				break
			}
			if ( p == 3 ) {
				efid = SKILL_EFFECT_CONFUSE
				efp = 100
				gosub *effect
				break
			}
			if ( p == 4 ) {
				efid = SKILL_EFFECT_POISON
				efp = 100
				gosub *effect
				break
			}
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}
		if ( p > 55 ) {
			num = rnd(sdata(SKILL_NORMAL_DETECTION, cc) / 2 * 50 + 100) + 1
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), num
			txt lang(name(cc) + "は水の中に金貨を見つけた。", name(cc) + " find" + _s(cc) + " some gold pieces in water.")
			break
		}
		if ( p > 45 ) {
			if ( osakana == 100 ) {
				txt_freshwater
				break
			}
			p = rnd(MAX_SKILL_ATTR_BASIC) + STARTING_SKILL_ATTR
			if ( rnd(5) > 2 ) {
				skillmod p, cc, 1000
			}
			else {
				skillmod p, cc, -1000
			}
			break
		}
		if ( p > 40 ) {
			if ( osakana == 100 ) {
				txt_freshwater
				break
			}
			if ( cdata(CDATA_LEVEL, cc) < 5 ) {
				break
			}
			if ( synccheck(cc, -1) ) {
				txt lang("" + name(cc) + "は何かいけないものを飲み込んだ。", name(cc) + " swallow" + _s(cc) + " something bad.")
			}
			tc = cc
			gosub *alien_effect
			break
		}
		if ( p > 35 ) {
			if ( osakana == 100 ) {
				txt_freshwater
				break
			}
			txt lang("井戸から何かが出てきた！", "Something comes out from the well!")
			repeat 1 + rnd(3)
				flt calcobjlv(cdata(CDATA_LEVEL, cc) * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
				characreate -1, CREATURE_ID_BUG, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
				cbitmod CHARA_BIT_SUMMONED, rc, 1
			loop
			break
		}
		if ( p > 33 ) {
			efid = SKILL_EFFECT_POTION_POTENTIAL
			gosub *effect
			break
		}
		if ( p > 20 ) {
			if ( osakana == 100 ) {
				txt_freshwater
				break
			}
			efid = SKILL_EFFECT_MUTATE
			gosub *effect
			break
		}
		if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
			if ( cdata(CDATA_KARMA, CHARA_PLAYER) > 0 ) {
				if ( p > 20 - cdata(CDATA_KARMA, CHARA_PLAYER) / 10 ) {
					if ( rnd(gdata(GDATA_WELL_WISH) + 1) ) {
						txtef COLOR_YELLOW
						txt lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
						break
					}
					if ( gdata(GDATA_AREA) != AREA_CHAOS_CRADLE | gdata(GDATA_LEVEL) != 179 ) {
						gdata(GDATA_WELL_WISH)++
					}
					efid = SKILL_SPELL_WISH
					gosub *effect
					break
				}
			}
			if ( p == 0 ) {
				if ( rnd(gdata(GDATA_WELL_WISH) + 1) ) {
					txtef COLOR_YELLOW
					txt lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
					break
				}
				gdata(GDATA_WELL_WISH)++
				efid = SKILL_SPELL_WISH
				gosub *effect
				break
			}
		}
		if ( cc == CHARA_PLAYER ) {
			txt_freshwater
		}
	loop
	osakana = 0
	ci = cibk
	if ( cc != CHARA_PLAYER ) {
		cdata(CDATA_HUNGER, cc) += 4000
	}
	else {
		cdata(CDATA_HUNGER, cc) += 500
	}
	if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
		cdata(CDATA_THIRST, cc) += 2000
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL ) {
		gdata(GDATA_FLAG_HOLY_WELL)--
	}
	else {
		inv(INV_ITEM_PARAM1, ci) -= rnd(3)
		inv(INV_ITEM_PARAM3, ci) += rnd(3)
		if ( inv(INV_ITEM_PARAM3, ci) >= 20 ) {
			txt lang(itemname(ci) + "は完全に干上がった。", itemname(ci) + " has completely dried up.")
			return 1
		}
	}
	if ( inv(INV_ITEM_PARAM1, ci) < (-5) ) {
		txt lang(itemname(ci) + "は干上がった。", itemname(ci) + " has dried up.")
	}
	return 1

*readScroll
	tc = cc
	tlocx = cdata(CDATA_X, cc)
	tlocy = cdata(CDATA_Y, cc)
	efstatus = inv(INV_ITEM_STATUS, ci)
	efsource = 2
	if ( cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		efsource = 0
		return
	}
	if ( cdata(CDATA_CONDITION_CONFUSE, cc) != 0 ) {
		if ( rnd(4) != 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "はふらふらした。", name(cc) + " stagger" + _s(cc) + ".")
			}
			efsource = 0
			return
		}
	}
	if ( synccheck(cc, -1) ) {
		txt lang(npcn(cc) + itemname(ci, 1) + "を読んだ。", name(cc) + " read" + _s(cc) + " " + itemname(ci, 1) + ".")
		txtmore
	}
	if ( inv(INV_ITEM_ID, ci) != ITEM_ID_TREASURE_MAP & inv(INV_ITEM_ID, ci) != ITEM_ID_MAP & inv(INV_ITEM_ID, ci) != ITEM_ID_DEED_OF_LAND_BATTLESHIP & inv(INV_ITEM_ID, ci) != ITEM_ID_DEED_OF_MAGIC_LOCOMOTIVE & inv(INV_ITEM_ID, ci) != ITEM_ID_DEED_OF_TRUCK & inv(INV_ITEM_ID, ci) != ITEM_ID_DEED_OF_CARRIAGE ) {
		inv(INV_ITEM_NUM, ci)--
		if ( ci >= RANGE_INV2 ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		else {
			gosub *calcBurdenPc
		}
		skillexp SKILL_NORMAL_LITERACY, cc, 25, 2
	}
	gosub *effect
	if ( cc == CHARA_PLAYER ) {
		if ( obvious == 1 ) {
			item_identify ci, ITEM_KNOWN_NAME
		}
	}
	return 1

*zapStaff
	if ( inv(INV_ITEM_CHARGE, ci) <= 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は" + itemname(ci, 1) + "を振った。", name(cc) + " zap " + itemname(ci, 1) + ".")
			txt_nothinghappens
		}
		if ( cc == CHARA_PLAYER ) {
			item_stack CHARA_PLAYER, ci, 1
		}
		return
	}
	efstatus = inv(INV_ITEM_STATUS, ci)
	if ( efstatus >= 1 ) {
		efstatus = 0
	}
	efsource = 1
	gosub *effect_selectTg
	if ( stat == 0 ) {
		efsource = 0
		return 0
	}
	if ( efid >= STARTING_SKILL_SPELL & efid < MAX_SPELL ) {
		if ( stat == 0 & sdataref(SKILL_DATAREF_TG, efid) / EXT_SDATAREF * EXT_SDATAREF == TARGET_TYPE_ENEMY | noeffect == 1 ) {
			if ( synccheck(cc, -1) ) {
				redraw 0
				txt lang(name(cc) + "は" + itemname(ci, 1) + "を振った。", name(cc) + " zap " + itemname(ci, 1) + ".")
				txt_nothinghappens
			}
			goto *zapStaffSkip
		}
	}
	efp = efp * (100 + sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 16 + sdata(SKILL_NORMAL_MAGIC_CAPACITY, cc) * 6 + sdata(SKILL_ATTR_LER, cc) / 2) / 220
	hoseim = limit(cdata(CDATA_ENHANCE_SPELL, cc) * 2 / 3, 0, 1000) / 10 + limit(sdata(SKILL_ATTR_MAG, cc) / 5, 0, 300)
	efp = efp * (100 + hoseim) / 100
	if ( cdata(CDATA_EQUIP_WEIGHT, cc) < 35000 & cdata(CDATA_EQUIP_WEIGHT, cc) >= 15000 & findbuff(cc, BUFF_MAGIC_EQUIP) != (-1) ) {
		efp = efp * 6 / 5
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_LIGHTNING_BALL | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_ECLIPSE | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_FIRE_WALL | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_ACID_GROUND | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_LIGHTNING_BOLT | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_FIRE_BOLT | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_ICE_BOLT | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_MAGIC_MISSILE | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_POISON_BALL | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_MAGIC_LASER | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_BUBBLE_BALL ) {
		if ( cc != CHARA_PLAYER & cdata(CDATA_SP, cc) > 0 & (sdata(SKILL_NORMAL_ALCHEMY, cc) > 0) ) {
			if ( sqrt(sdata(SKILL_NORMAL_ALCHEMY, cc)) + 80 >= rnd(100) ) {
				item_separate ci
				inv(INV_ITEM_CHARGE, ci)++
				efp = efp * 7 / 10 + 1
				txtef COLOR_GREEN
				txt lang(name(cc) + "は杖を一時複製した。", name(cc) + " duplicated replica of " + itemname(ci) + ".")
				if ( charaGivesExp(tc) ) {
					skillexp SKILL_NORMAL_ALCHEMY, cc, 80
				}
			}
		}
		if ( cc == CHARA_PLAYER & gdata(GDATA_FLAG_DUPLICANE) == 100 & cdata(CDATA_SP, CHARA_PLAYER) > 0 ) {
			item_separate ci
			dupli = 0
			inv(INV_ITEM_CHARGE, ci)++
			efp = efp * 7 / 10 + 1
			txtef COLOR_GREEN
			txt lang(name(cc) + "は杖を一時複製した。", name(cc) + " duplicated replica of " + itemname(ci) + ".")
			item_stack CHARA_PLAYER, ci, 1
			if ( charaGivesExp(tc) ) {
				skillexp SKILL_NORMAL_ALCHEMY, cc, 40
			}
			dmgsp CHARA_PLAYER, 3
		}
	}
	if ( synccheck(cc, -1) ) {
		txt lang(name(cc) + "は" + itemname(ci, 1) + "を振った。", name(cc) + " zap " + itemname(ci, 1) + ".")
		txtmore
	}
	if ( efid >= STARTING_SKILL_SPELL & efid < MAX_SPELL ) {
		f = 0
		seikou = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 20 + 100
		if ( inv(INV_ITEM_STATUS, ci) >= ITEM_STATUS_BLESSED ) {
			seikou = seikou * 125 / 100
		}
		if ( inv(INV_ITEM_STATUS, ci) <= ITEM_STATUS_CURSED ) {
			seikou = seikou * 50 / 100
		}
		else {
			if ( rnd(2) ) {
				f = 1
			}
		}
		if ( rnd(sdataref(SKILL_DATAREF_DIFF, efid) + 1) / 2 <= seikou ) {
			f = 1
		}
	}
	else {
		f = 1
	}
	if ( sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) < 100 ) {
		if ( rnd(sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) + 20) == 0 ) {
			f = 0
		}
	}
	if ( f == 1 | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_WISHING | cc != CHARA_PLAYER ) {
		gosub *effect
		if ( cc == CHARA_PLAYER ) {
			if ( obvious == 1 ) {
				item_identify ci, ITEM_KNOWN_NAME
			}
		}
		gosub *expMagicDevice
	}
	else {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は杖をうまく使えなかった。", name(cc) + " fail to use the power of the rod.")
		}
	}
*zapStaffSkip
	efsource = 0
	if ( inv(INV_ITEM_NUM, ci) == 0 ) {
		if ( ci >= RANGE_INV2 ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			return 1
		}
	}
	item_separate ci
	inv(INV_ITEM_CHARGE, ci)--
	if ( cc == CHARA_PLAYER ) {
		item_stack CHARA_PLAYER, ci, 1
	}
	if ( efid == SKILL_EFFECT_CHANGE_ITEM ) {
		return 1
	}
	if ( sdataref(SKILL_DATAREF_TYPE, efid) != 1 & sdataref(SKILL_DATAREF_TYPE, efid) != 2 & sdataref(SKILL_DATAREF_TYPE, efid) != 3 ) {
		return 1
	}
	if ( cc == CHARA_PLAYER ) {
		if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) != 0 ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( gdata(GDATA_ACTIVATE_PROC) == 0 ) {
					if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BOLT | sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_ARROW | (sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BALL & efid != SKILL_SPACT_RAIN_OF_SANITY & efid != SKILL_SPELL_HEALING_RAIN) ) {
						efid = SKILL_SPACT_DIFFUSION_WAVE
						gosub *effect
					}
				}
			}
		}
	}
	if ( cc != CHARA_PLAYER ) {
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_OFFENSIVE ) {
			powsel = 0
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( gdata(GDATA_ACTIVATE_PROC) == 0 ) {
					if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BOLT | sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_ARROW | (sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BALL & efid != SKILL_SPACT_RAIN_OF_SANITY & efid != SKILL_SPELL_HEALING_RAIN) ) {
						efid = SKILL_SPACT_DIFFUSION_WAVE
						gosub *effect
					}
				}
			}
		}
	}
	return 1

*action
	if ( efid == SKILL_SPACT_DEATH_WORD ) {
		if ( cbit(CHARA_BIT_DEATH_COUNT, tc) == 1 ) {
			if ( cdata(CDATA_RELATION, cc) == (-3) ) {
				repeat MAX_CHARA_SAVE
					if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
						if ( cdata(CDATA_RELATION, cnt) == 10 ) {
							cdata(CDATA_TARGET, cc) = cnt
							break
						}
					}
				loop
			}
			return 0
		}
	}
	gosub *effect_selectTg
	if ( stat == 0 ) {
		return 0
	}
	if ( sdataref(SKILL_DATAREF_TG, efid) / EXT_SDATAREF * EXT_SDATAREF != TARGET_TYPE_SELF & sdataref(SKILL_DATAREF_TG, efid) / EXT_SDATAREF * EXT_SDATAREF != TARGET_TYPE_SELF_ONLY ) {
		if ( cdata(CDATA_CONDITION_CONFUSE, cc) != 0 | cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
			if ( rnd(5) == 0 ) {
				if ( synccheck(cc, -1) ) {
					txt lang(name(cc) + "は頭を振った。", name(cc) + " shake" + _s(cc) + " " + his(cc) + " head.")
				}
				return 1
			}
		}
	}
	if ( efid >= STARTING_SKILL_SPACT ) {
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					return 1
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
			skillexp sdataref(SKILL_DATAREF_USE, efid), cc, 25
		}
	}
	efp = calcspellpower(efid, cc)
	if ( noeffect == 1 ) {
		if ( efid != SKILL_ACTIVE_PICKPOCKET ) {
			txt_nothinghappens
			return 1
		}
	}
	gosub *effect
	if ( stat == 0 ) {
		return 0
	}
	return 1

*effect_selectTg
	noeffect = 0
	if ( efid > MAX_SKILL ) {
		tc = cc
		return 1
	}
	tg = sdataref(SKILL_DATAREF_TG, efid) / EXT_SDATAREF * EXT_SDATAREF
	if ( efsource == 1 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( tg == TARGET_TYPE_SELF ) {
				tg = TARGET_TYPE_DIRECTION
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( tg == TARGET_TYPE_DIRECTION ) {
				tg = TARGET_TYPE_SELF
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( tg == TARGET_TYPE_ENEMY | tg == TARGET_TYPE_OTHER | tg == TARGET_TYPE_BOTH ) {
				if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
					if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
						return 0
					}
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, tc) != (-3) ) {
							return 0
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) ) {
							return 0
						}
					}
				}
			}
		}
	}
	if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_SUMMON ) {
		if ( cc == CHARA_PLAYER ) {
			tc = CHARA_PLAYER
			return 1
		}
	}
	ghand = 0
	if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_HAND ) {
		if ( cbit(CHARA_BIT_BLUE_SPIRIT, cc) ) {
			if ( efid != SKILL_SPACT_VORACITY_FANG & efid != SKILL_SPACT_DRAIN_BLOOD & efid != SKILL_SPACT_MEMORY_POISON ) {
				powsel = 0
				if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
					if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
						powsel = 100
					}
				}
				if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
					if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
						powsel = 100
					}
				}
				if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
					powsel = 100
				}
				if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
					powsel = 100
				}
				if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
					if ( exgauge != 100 ) {
						powsel = 0
					}
				}
				if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
					powsel = 0
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
					if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
						powsel = 0
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
					powsel = 0
				}
				if ( cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
						powsel = 0
					}
				}
				if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
					if ( powsel == 100 ) {
						tg = 2000
					}
				}
				ghand = 100
				powsel = 0
			}
		}
	}
	if ( tg == TARGET_TYPE_DIRECTION ) {
		if ( cc == CHARA_PLAYER ) {
			tc = CHARA_PLAYER
			txt lang("どの方向？", "Which direction?")
			gosub *screen_draw
			gosub *prompt_direction
			if ( stat == 0 ) {
				return 0
			}
			if ( map(tlocx, tlocy, 1) == 0 ) {
				noeffect = 1
				obvious = 0
				return 1
			}
			tc = map(tlocx, tlocy, 1) - 1
			if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
                promptTagTeam
				if ( rtval == 1 ) {
					tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
				}
			}
		}
		else {
			if ( dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
				return 0
			}
			tlocx = cdata(CDATA_X, tc)
			tlocy = cdata(CDATA_Y, tc)
		}
		return 1
	}
	if ( tg == TARGET_TYPE_LOCATION | (tg == TARGET_TYPE_BOTH & tgloc == 1 & cc == CHARA_PLAYER) ) {
		if ( cc == CHARA_PLAYER ) {
			if ( tg == TARGET_TYPE_BOTH ) {
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tglocx, tglocy) == 0 ) {
					if ( stat == 0 ) {
						txt_cantsee
						gosub *screen_draw
					}
					obvious = 0
					return 0
				}
				tlocx = tglocx
				tlocy = tglocy
			}
			else {
				gosub *findLocation
				if ( stat != 1 ) {
					if ( stat == 0 ) {
						txt_cantsee
						gosub *screen_draw
					}
					obvious = 0
					return 0
				}
			}
		}
		else {
			if ( fov_los(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) == 0 ) {
				return 0
			}
			tlocx = cdata(CDATA_X, tc)
			tlocy = cdata(CDATA_Y, tc)
		}
		return 1
	}
	if ( tg == TARGET_TYPE_SELF | tg == TARGET_TYPE_SELF_ONLY ) {
		if ( cc != CHARA_PLAYER ) {
			if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_BALL ) {
				if ( dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
					return 0
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) == 0 ) {
					return 0
				}
			}
		}
		tc = cc
		tlocx = cdata(CDATA_X, cc)
		tlocy = cdata(CDATA_Y, cc)
		return 1
	}
	if ( tg == TARGET_TYPE_ENEMY | tg == TARGET_TYPE_OTHER | tg == TARGET_TYPE_BOTH ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *findTarget
			if ( stat == 0 ) {
				obvious = 0
				return 0
			}
			tc = cdata(CDATA_TARGET, CHARA_PLAYER)
			if ( cdata(CDATA_RELATION, tc) >= 0 ) {
				gosub *com_confirmAttack
				if ( stat == 0 ) {
					obvious = 0
					return 0
				}
			}
		}
		if ( dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
			if ( ghand == 0 ) {
				if ( cc == CHARA_PLAYER ) {
					msgdup++
					txt lang("射程距離外だ。", "It's out of range.")
					gosub *screen_draw
				}
				return 0
			}
		}
		ghand = 0
		if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) == 0 ) {
			return 0
		}
		tlocx = cdata(CDATA_X, tc)
		tlocy = cdata(CDATA_Y, tc)
		return 1
	}
	if ( tg == TARGET_TYPE_DIR ) {
		if ( cc == CHARA_PLAYER ) {
			if ( efsource == 3 ) {
				txt lang("どの方向に唱える？ ", "Which direction do you want to cast the spell? ")
			}
			else {
				txt lang("どの方向に振る？ ", "Which direction do you want to zap the wand? ")
			}
			gosub *screen_draw
			val = 0
			gosub *prompt_direction
			if ( stat == 0 ) {
				txt_impossible
				obvious = 0
				return 0
			}
		}
	}
	return 1

*effect
	efcibk = ci
	efcancel = 0
	obvious = 1
	if ( efsource != 4 & efsource != 1 & efsource != 2 ) {
		efstatus = 0
	}
	efsource = 0
	efbad = 0
	if ( efid >= STARTING_SKILL_ACTIVE ) {
		if ( efid < MAX_SKILL ) {
			f = 0
			if ( sdataref(SKILL_DATAREF_TYPE, efid) / EXT_SDATAREF == 1 ) {
				f = 1
				p = sdataref(SKILL_DATAREF_TYPE, efid) \ EXT_SDATAREF
				if ( bdataref(0, p) == 2 ) {
					efbad = 1
				}
			}
			if ( sdataref(SKILL_DATAREF_TYPE, efid) == SKILL_TYPE_SUMMON ) {
				efbad = 1
			}
			if ( efbad == 0 ) {
				if ( efstatus >= 1 ) {
					efp = efp * 150 / 100
				}
				if ( efstatus <= (-1) ) {
					efp = 50
				}
			}
			else {
				if ( efstatus >= 1 ) {
					efp = 50
				}
				if ( efstatus <= (-1) ) {
					efp = efp * 150 / 100
				}
			}
			if ( f ) {
				if ( bdataref(0, p) == 1 | efid == SKILL_SPELL_FEATHER ) {
					animeload ANIMATION_HEAL_FAST, tc
				}
				else {
					if ( bdataref(0, p) == 2 ) {
						animeid = ANIMATION_CURSE
						gosub *anime
					}
				}
				if ( efid == SKILL_SPACT_LULWYS_TRICK | efid == SKILL_SPELL_SPEED ) {
					if ( tc == CHARA_PLAYER & cc == CHARA_PLAYER | cc == gdata(GDATA_RIDER) ) {
						if ( gdata(GDATA_RIDER) != 0 ) {
							tc = gdata(GDATA_RIDER)
						}
					}
				}
				calcbuff -1, p, efp
				addbuff tc, p, efp, dur
				if ( efid == SKILL_SPELL_SLOW ) {
					if ( efstatus >= 1 ) {
						cdata(CDATA_AGE, tc) += rnd(3) + 1
						if ( cdata(CDATA_AGE, tc) + 12 > gdata(GDATA_YEAR) ) {
							cdata(CDATA_AGE, tc) = gdata(GDATA_YEAR) - 12
						}
						if ( synccheck(tc, -1) ) {
							txtef COLOR_GREEN
							txt lang(name(tc) + "の老化は遅くなった。", name(tc) + your(tc) + " aging process slows down.")
						}
					}
					if ( efstatus <= (-1) ) {
						if ( tc < MAX_CHARA_FOLLOWER ) {
							inv_find ITEM_ID_BIO_BATTERY, tc
							if ( stat == (-1) ) {
								cdata(CDATA_WEIGHT, tc) = cdata(CDATA_WEIGHT, tc) * 102 / 100 + rnd(2) + 1
								if ( cdata(CDATA_WEIGHT, tc) <= 0 ) {
									cdata(CDATA_WEIGHT, tc) = 1
								}
								if ( synccheck(tc, -1) ) {
									txtef COLOR_PURPLE
									txt lang(name(tc) + "の身体は重くなった。", name(tc) + " gain" + _s(tc) + " weight.")
								}
							}
						}
					}
				}
				if ( efid == SKILL_SPELL_SPEED ) {
					if ( efstatus <= (-1) ) {
						cdata(CDATA_AGE, tc) -= rnd(3) + 1
						if ( synccheck(tc, -1) ) {
							txtef COLOR_PURPLE
							txt lang(name(tc) + "の老化は速くなった。", name(tc) + your(tc) + " aging process speeds up.")
						}
					}
				}
				if ( efid == SKILL_SPELL_INCOGNITO ) {
					if ( tc == CHARA_PLAYER ) {
						incognitobegin
					}
				}
				goto *effect_end
			}
			calcskill efid, cc, efp, efpori
			if ( cc == CHARA_PLAYER ) {
				if ( trait(TRAIT_GOD_ITZPALT) ) {
					if ( ele == SKILL_RES_FIRE | ele == SKILL_RES_COLD | ele == SKILL_RES_LIGHTNING ) {
						dice2 = dice2 * 125 / 100
					}
				}
			}
			if ( rapidmagic ) {
				efp = efp / 2 + 1
			}
			_switch_val = sdataref(SKILL_DATAREF_TYPE, efid)
			if ( _switch_val == SKILL_TYPE_ATTACK | _switch_sw ) {
				_switch_sw = 0
				if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
					tc = cdata(CDATA_TARGET, cc)
					gosub *act_melee
					goto *effect_SWEND1
				}
				if ( efid == SKILL_SPACT_DISTANT_ATTACK ) {
					gdata(GDATA_TEMPORARY_FLAGS) = 200
					animeid = ANIMATION_DISTANT_ATK
					gosub *anime
				}
				else {
					animeid = ANIMATION_SPORE
					gosub *anime
				}
				gdata(GDATA_TEMPORARY_FLAGS) = 0
				gosub *act_melee
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_BOLT | _switch_sw ) {
				_switch_sw = 0
				get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
				if ( stat == 0 ) {
					goto *effect_SWEND1
				}
				animeid = ANIMATION_BOLT
				gosub *anime
				dx = cdata(CDATA_X, cc)
				dy = cdata(CDATA_Y, cc)
				tcbbk = -1
				if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
					if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
						if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
							customtalk cc, DBMODE_FLAVOR_CHARGE_A
							gosub *convert_word
							if ( synccheck(cc, -1) ) {
								txtef COLOR_RED
								txt lang(name(cc) + "の完全詠唱魔法が炸裂した。", name(cc) + " blast magic by full power.")
								txtmore
							}
						}
					}
				}
				repeat 20
					route_info dx, dy, cnt
					if ( stat == 0 ) {
						break
					}
					else {
						if ( stat == (-1) ) {
							continue
						}
					}
					if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
						break
					}
					if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
						continue
					}
					if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
						continue
					}
					maga = 0
					inv_find ITEM_ID_MAGATAMA, cc
					if ( stat != (-1) ) {
						maga = 100
					}
					if ( ele == SKILL_RES_FIRE ) {
						if ( maga == 0 ) {
							mapitem_fire dx, dy
						}
					}
					maga = 0
					inv_find ITEM_ID_MAGAICE, cc
					if ( stat != (-1) ) {
						maga = 100
					}
					if ( ele == SKILL_RES_COLD ) {
						if ( maga == 0 ) {
							mapitem_cold dx, dy
						}
					}
					maga = 0
					if ( map(dx, dy, 8) != 0 ) {
						if ( efid == SKILL_SPELL_WATER_BOLT ) {
							delmef map(dx, dy, 8) - 1
						}
					}
					if ( map(dx, dy, 8) != 0 ) {
						if ( mef(0, map(dx, dy, 8) - 1) == 9 ) {
							delmef map(dx, dy, 8) - 1
						}
					}
					if ( map(dx, dy, 1) != 0 ) {
						tc = map(dx, dy, 1) - 1
						if ( cc != tc ) {
							if ( gdata(GDATA_RIDER) != 0 ) {
								if ( gdata(GDATA_RIDER) == cc ) {
									if ( tc == CHARA_PLAYER ) {
										continue
									}
								}
							}
							dmg = role(dice1, dice2, bonus)
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
								if ( tc != CHARA_PLAYER ) {
									if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
										tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									}
									txt_guard
								}
							}
							if ( tcbbk == (-1) ) {
								if ( cdata(CDATA_RELATION, cc) != 10 ) {
									if ( cdata(CDATA_RELATION, tc) != cdata(CDATA_RELATION, cc) & tc != cc ) {
										tcbbk = tc
									}
								}
								if ( cdata(CDATA_RELATION, cc) == 10 ) {
									if ( cdata(CDATA_RELATION, tc) != 10 & tc != CHARA_PLAYER ) {
										tcbbk = tc
									}
								}
								if ( cdata(CDATA_ALLIED, cc) == 100 ) {
									if ( cdata(CDATA_RELATION, cc) != 10 ) {
										if ( cdata(CDATA_RELATION, tc) == 10 ) {
											tcbbk = tc
										}
									}
								}
								if ( cc == CHARA_PLAYER ) {
									if ( cdata(CDATA_RELATION, tc) != 10 & tc != CHARA_PLAYER ) {
										tcbbk = tc
									}
								}
							}
							if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
								if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
									if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
										dmg = dmg * 11
										animeload ANIMATION_OFFER, tc
									}
								}
							}
							if ( synccheck(tc, -1) ) {
								txtmore
								if ( tc >= MAX_CHARA_FOLLOWER ) {
									gdata(GDATA_DMG_TYPE) = 2
									txt3rd = 1
									txt lang("ボルトは" + name(tc) + "に命中し", "The bolt hits " + name(tc) + " and")
								}
								else {
									txt lang("ボルトが" + name(tc) + "に命中した。", "The bolt hits " + name(tc) + ".")
								}
							}
							dmghp tc, dmg, cc, ele, elep
							if ( efid == SKILL_SPELL_WATER_BOLT ) {
								wet tc, 5
							}
							if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
								if ( fusifc > 0 ) {
									if ( ele == SKILL_RES_FIRE ) {
										snd SOUNDLIST_ATK_ICE
										dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_COLD, elep
									}
									if ( ele == SKILL_RES_COLD ) {
										snd SOUNDLIST_ATK_FIRE
										dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_FIRE, elep
									}
								}
								if ( fusims > 0 ) {
									if ( ele == SKILL_RES_MIND ) {
										snd SOUNDLIST_ATK_SOUND
										dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_SOUND, elep
									}
									if ( ele == SKILL_RES_SOUND ) {
										snd SOUNDLIST_ATK_MIND
										dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_MIND, elep
									}
								}
								if ( fusipn > 0 ) {
									if ( ele == SKILL_RES_POISON ) {
										snd SOUNDLIST_ATK_NERVE
										dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NERVE, elep
									}
									if ( ele == SKILL_RES_NERVE ) {
										snd SOUNDLIST_ATK_POISON
										dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_POISON, elep
									}
								}
								if ( fusidne > 0 ) {
									if ( ele == SKILL_RES_DARKNESS ) {
										snd SOUNDLIST_ATK_HELL
										dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NETHER, elep
									}
									if ( ele == SKILL_RES_NETHER ) {
										snd SOUNDLIST_ATK_DARK
										dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_DARKNESS, elep
									}
								}
							}
							if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
								if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
									if ( cc >= MAX_CHARA_FOLLOWER | tc >= MAX_CHARA_FOLLOWER ) {
										dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, ele, elep
										if ( synccheck(tc, -1) ) {
											txtef COLOR_PURPLE
											txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected magic.")
										}
									}
								}
							}
						}
					}
				loop
				if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
					if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
						if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
							p = cc
							repeat MAX_BLESSINGS + MAX_HEXES
								if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == 0 ) {
									break
								}
								if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_CHARGE ) {
									delbuff p, cnt
									continue cnt
								}
							loop
							r1 = cc
							gosub *charaRefresh
						}
					}
				}
				if ( tcbbk != (-1) ) {
					if ( cdata(CDATA_EXIST, tcbbk) == CHAR_STATE_ALIVE ) {
						tc = tcbbk
					}
				}
				fusifc = 0
				fusims = 0
				fusipn = 0
				fusidne = 0
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_BALL | _switch_sw ) {
				_switch_sw = 0
				tcbbk = -1
				magc = 0
				if ( efid != SKILL_SPACT_RAIN_OF_SANITY ) {
					if ( efid != SKILL_SPELL_HEALING_RAIN ) {
						if ( efid != SKILL_SPACT_SUICIDE_ATTACK ) {
							if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
								if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
									customtalk cc, DBMODE_FLAVOR_CHARGE_A
									gosub *convert_word
									if ( synccheck(cc, -1) ) {
										txtef COLOR_RED
										txt lang(name(cc) + "の完全詠唱魔法が炸裂した。", name(cc) + " blast magic by full power.")
										txtmore
									}
								}
							}
						}
					}
				}
				chainbomb = 0
				ccbk = cc
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					if ( cdata(CDATA_CONDITION_WET, cc) > 0 ) {
						goto *effect_SWEND1
					}
				}
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					stxt cc, lang(name(cc) + "は爆発した。", name(cc) + " explode" + _s(cc) + ".")
				}
*chainBomb_loop
				cbitmod CHARA_BIT_SUICIDE_SWITCH, cc, 0
				range = sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					range = 2
				}
				if ( efid != SKILL_SPELL_HEALING_RAIN & efid != SKILL_SPACT_RAIN_OF_SANITY ) {
					if ( bakuretu != 200 ) {
						aniref = range
						animeid = ANIMATION_BALL
						anix = tlocx
						aniy = tlocy
						gosub *anime
					}
				}
				if ( efid == SKILL_SPELL_HEALING_RAIN | efid == SKILL_SPACT_RAIN_OF_SANITY ) {
					animeid = ANIMATION_HEALING_RAIN
					animode = 1
					gosub *anime
				}
				if ( bakuretu == 200 ) {
					animeid = ANIMATION_THUNDERCLAP
					anix = tlocx
					aniy = tlocy
					gosub *anime
				}
				repeat range * 2 + 1
					dy = tlocy - range + cnt
					if ( dy < 0 | dy >= mdata(MDATA_HEIGHT) ) {
						continue
					}
					repeat range * 2 + 1
						dx = tlocx - range + cnt
						if ( dx < 0 | dx >= mdata(MDATA_WIDTH) ) {
							continue
						}
						if ( dist(tlocx, tlocy, dx, dy) > range ) {
							continue
						}
						if ( fov_los(tlocx, tlocy, dx, dy) == 0 ) {
							continue
						}
						if ( map(dx, dy, 8) != 0 ) {
							if ( efid == SKILL_SPELL_BUBBLE_STORM ) {
								delmef map(dx, dy, 8) - 1
							}
						}
						if ( map(dx, dy, 8) != 0 ) {
							if ( mef(0, map(dx, dy, 8) - 1) == 9 ) {
								delmef map(dx, dy, 8) - 1
							}
						}
						if ( map(dx, dy, 1) == 0 ) {
							continue
						}
						tc = map(dx, dy, 1) - 1
						if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
							if ( tc != CHARA_PLAYER ) {
								if ( efid != SKILL_SPELL_HEALING_RAIN ) {
									if ( efid != SKILL_SPACT_RAIN_OF_SANITY ) {
										if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
											tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
										}
										txt_guard
									}
								}
							}
						}
						if ( tcbbk == (-1) ) {
							if ( cdata(CDATA_RELATION, cc) != 10 ) {
								if ( cdata(CDATA_RELATION, tc) != cdata(CDATA_RELATION, cc) & tc != cc ) {
									tcbbk = tc
								}
							}
							if ( cdata(CDATA_RELATION, cc) == 10 ) {
								if ( cdata(CDATA_RELATION, tc) != 10 & tc != CHARA_PLAYER ) {
									tcbbk = tc
								}
							}
							if ( cdata(CDATA_ALLIED, cc) == 100 ) {
								if ( cdata(CDATA_RELATION, cc) != 10 ) {
									if ( cdata(CDATA_RELATION, tc) == 10 ) {
										tcbbk = tc
									}
								}
							}
							if ( cc == CHARA_PLAYER ) {
								if ( cdata(CDATA_RELATION, tc) != 10 & tc != CHARA_PLAYER ) {
									tcbbk = tc
								}
							}
						}
						if ( efid == SKILL_SPELL_HEALING_RAIN ) {
							f = 0
							if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) >= 0 ) {
								if ( cdata(CDATA_RELATION, tc) >= 0 ) {
									f = 1
								}
							}
							if ( cdata(CDATA_RELATION, cc) == (-1) ) {
								if ( cdata(CDATA_RELATION, tc) == (-1) ) {
									f = 1
								}
							}
							if ( cdata(CDATA_RELATION, cc) < (-1) ) {
								if ( cdata(CDATA_RELATION, tc) < (-1) ) {
									f = 1
								}
							}
							if ( f == 1 ) {
								txt lang(cdatan(CDATAN_NAME, tc) + "は回復した。", name(tc) + " " + is(tc) + " healed.")
								gosub *effect_heal
								if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									txt lang(cdatan(CDATAN_NAME, tc) + "は回復した。", name(tc) + " " + is(tc) + " healed.")
									gosub *effect_heal
								}
							}
							continue
						}
						if ( efid == SKILL_SPACT_RAIN_OF_SANITY ) {
							f = 0
							if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) >= 0 ) {
								if ( cdata(CDATA_RELATION, tc) >= 0 ) {
									f = 1
								}
							}
							if ( cdata(CDATA_RELATION, cc) == (-1) ) {
								if ( cdata(CDATA_RELATION, tc) == (-1) ) {
									f = 1
								}
							}
							if ( cdata(CDATA_RELATION, cc) < (-1) ) {
								if ( cdata(CDATA_RELATION, tc) < (-1) ) {
									f = 1
								}
							}
							if ( f == 1 ) {
								txt lang(name(tc) + "の狂気は消え去った。", name(tc) + " " + is(tc) + " completely sane again.")
								healsan tc, efp / 10
								healcon tc, CONDITION_INSANE, 9999
								if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									txt lang(name(tc) + "の狂気は消え去った。", name(tc) + " " + is(tc) + " completely sane again.")
									healsan tc, efp / 10
									healcon tc, CONDITION_INSANE, 9999
								}
							}
							continue
						}
						if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
							continue
						}
						if ( gdata(GDATA_RIDER) != 0 ) {
							if ( gdata(GDATA_RIDER) == cc ) {
								if ( tc == CHARA_PLAYER ) {
									continue
								}
							}
						}
						maga = 0
						inv_find ITEM_ID_MAGATAMA, cc
						if ( stat != (-1) ) {
							maga = 100
						}
						if ( ele == SKILL_RES_FIRE ) {
							if ( maga == 0 ) {
								mapitem_fire dx, dy
							}
						}
						maga = 0
						inv_find ITEM_ID_MAGAICE, cc
						if ( stat != (-1) ) {
							maga = 100
						}
						if ( ele == SKILL_RES_COLD ) {
							if ( maga == 0 ) {
								mapitem_cold dx, dy
							}
						}
                        maga = 0
						if ( cc != tc ) {
							dmg = role(dice1, dice2, bonus)
							txtmore
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
								if ( synccheck(tc, -1) ) {
									txtmore
									if ( tc >= MAX_CHARA_FOLLOWER ) {
										gdata(GDATA_DMG_TYPE) = 2
										txt3rd = 1
										txt lang("爆風は" + name(tc) + "に命中し", "The explosion hits " + name(tc) + " and")
									}
									else {
										txt lang("爆風が" + name(tc) + "に命中した。", "The explosion hits " + name(tc) + ".")
									}
								}
								if ( cbit(CHARA_BIT_SUICIDE, tc) ) {
									if ( cdata(CDATA_CONDITION_WET, tc) == 0 ) {
										chainbomblist(chainbomb) = tc
										chainbomb++
										continue
									}
								}
								dmghp tc, dmg, cc, ele, elep
								if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
									dmgcon tc, CONDITION_FEAR, sdata(SKILL_ATTR_CON, cc) + 100
									cdata(CDATA_CONDITION_WINCE, tc) += 5
									txt lang(name(tc) + "は怯んだ。", name(tc) + " " + is(tc) + " faltered.")
								}
							}
							else {
								if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
									if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
										dmg = dmg * 11
										animeload ANIMATION_OFFER, tc
									}
								}
								if ( bakuretu != 200 ) {
									if ( synccheck(tc, -1) ) {
										txtmore
										if ( tc >= MAX_CHARA_FOLLOWER ) {
											gdata(GDATA_DMG_TYPE) = 2
											txt3rd = 1
											txt lang("ボールは" + name(tc) + "に命中し", "The ball hits " + name(tc) + " and")
										}
										else {
											txt lang("ボールが" + name(tc) + "に命中した。", "The ball hits " + name(tc) + ".")
										}
									}
								}
								if ( efid == SKILL_SPACT_GRENADE ) {
									if ( bakuretu == 200 ) {
										ele = SKILL_RES_LIGHTNING
										if ( synccheck(tc, -1) ) {
											txtmore
											if ( tc >= MAX_CHARA_FOLLOWER ) {
												gdata(GDATA_DMG_TYPE) = 2
												txt3rd = 1
												txt lang("電撃は" + name(tc) + "に命中し", "The ball hits " + name(tc) + " and")
											}
											else {
												txt lang("電撃が" + name(tc) + "に命中した。", "The ball hits " + name(tc) + ".")
											}
										}
									}
								}
								dmghp tc, dmg, cc, ele, elep
								if ( efid == SKILL_SPELL_BUBBLE_STORM ) {
									wet tc, 5
								}
								if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
									if ( fusifc > 0 ) {
										if ( ele == SKILL_RES_FIRE ) {
											snd SOUNDLIST_ATK_ICE
											dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_COLD, elep
										}
										if ( ele == SKILL_RES_COLD ) {
											snd SOUNDLIST_ATK_FIRE
											dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_FIRE, elep
										}
									}
									if ( fusims > 0 ) {
										if ( ele == SKILL_RES_MIND ) {
											snd SOUNDLIST_ATK_SOUND
											dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_SOUND, elep
										}
										if ( ele == SKILL_RES_SOUND ) {
											snd SOUNDLIST_ATK_MIND
											dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_MIND, elep
										}
									}
									if ( fusipn > 0 ) {
										if ( ele == SKILL_RES_POISON ) {
											snd SOUNDLIST_ATK_NERVE
											dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NERVE, elep
										}
										if ( ele == SKILL_RES_NERVE ) {
											snd SOUNDLIST_ATK_POISON
											dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_POISON, elep
										}
									}
									if ( fusidne > 0 ) {
										if ( ele == SKILL_RES_DARKNESS ) {
											snd SOUNDLIST_ATK_HELL
											dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NETHER, elep
										}
										if ( ele == SKILL_RES_NETHER ) {
											snd SOUNDLIST_ATK_DARK
											dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_DARKNESS, elep
										}
									}
								}
								if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
									if ( efid != SKILL_SPACT_GRENADE ) {
										if ( cc >= MAX_CHARA_FOLLOWER | tc >= MAX_CHARA_FOLLOWER ) {
											dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, ele, elep
											if ( synccheck(tc, -1) ) {
												txtef COLOR_PURPLE
												txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected magic.")
											}
										}
									}
								}
							}
						}
						if ( magist != 0 ) {
							if ( rnd(5) == 0 ) {
								magc = tc
							}
						}
					loop
				loop
				if ( magist != 0 ) {
					if ( magc != 0 ) {
						tlocx = cdata(CDATA_X, magc)
						tlocy = cdata(CDATA_Y, magc)
					}
				}
				if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
					if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
						p = cc
						repeat MAX_BLESSINGS + MAX_HEXES
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == 0 ) {
								break
							}
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_CHARGE ) {
								delbuff p, cnt
								continue cnt
							}
						loop
						r1 = cc
						gosub *charaRefresh
					}
				}
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					cdata(CDATA_HP, cc) = 0
					dmghp cc, 99999, DAMAGE_FROM_SUICIDE
				}
				if ( chainbomb > 0 ) {
*chainBomb_loop_WHILE1
					chainbomb--
					if ( chainbomb < 0 ) {
						goto *chainBomb_loop_WEND1
					}
					cc = chainbomblist(chainbomb)
					tlocx = cdata(CDATA_X, cc)
					tlocy = cdata(CDATA_Y, cc)
					if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
						if ( cdata(CDATA_CONDITION_WET, cc) == 0 ) {
							calcskill efid, cc, efp
							stxt cc, lang(name(cc) + "は誘爆した。", name(cc) + " explode" + _s(cc) + ".")
							goto *chainBomb_loop
						}
					}
					goto *chainBomb_loop_WHILE1
				}
*chainBomb_loop_WEND1
				cc = ccbk
				if ( tcbbk != (-1) ) {
					if ( cdata(CDATA_EXIST, tcbbk) == CHAR_STATE_ALIVE ) {
						tc = tcbbk
					}
				}
				fusifc = 0
				fusims = 0
				fusipn = 0
				fusidne = 0
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_ARROW | _switch_sw ) {
				_switch_sw = 0
				animeid = ANIMATION_ARROW
				gosub *anime
				dmg = role(dice1, dice2, bonus)
				if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
					if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
						dmg = dmg * 11
						p = cc
						repeat MAX_BLESSINGS + MAX_HEXES
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == 0 ) {
								break
							}
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_CHARGE ) {
								delbuff p, cnt
								continue cnt
							}
						loop
						r1 = cc
						gosub *charaRefresh
						snd SOUNDLIST_BOLT1
						customtalk cc, DBMODE_FLAVOR_CHARGE_A
						gosub *convert_word
						if ( synccheck(cc, -1) ) {
							txtef COLOR_RED
							txt lang(name(cc) + "の完全詠唱魔法が炸裂した。", name(cc) + " blast magic by full power.")
							txtmore
						}
						animeload ANIMATION_OFFER, tc
					}
				}
				if ( synccheck(tc, -1) ) {
					txtmore
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt3rd = 1
						txt lang("矢は" + name(tc) + "に命中し", "The arrow hits " + name(tc) + " and")
					}
					else {
						txt lang("矢が" + name(tc) + "に命中した。", "The arrow hits " + name(tc) + ".")
					}
				}
				dmghp tc, dmg, cc, ele, elep
				if ( efid == SKILL_SPELL_HYDRO_FANG ) {
					wet tc, 5
				}
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					if ( fusifc > 0 ) {
						if ( ele == SKILL_RES_FIRE ) {
							snd SOUNDLIST_ATK_ICE
							dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_COLD, elep
						}
						if ( ele == SKILL_RES_COLD ) {
							snd SOUNDLIST_ATK_FIRE
							dmghp tc, limit(dmg * fusifc / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_FIRE, elep
						}
					}
					if ( fusims > 0 ) {
						if ( ele == SKILL_RES_MIND ) {
							snd SOUNDLIST_ATK_SOUND
							dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_SOUND, elep
						}
						if ( ele == SKILL_RES_SOUND ) {
							snd SOUNDLIST_ATK_MIND
							dmghp tc, limit(dmg * fusims / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_MIND, elep
						}
					}
					if ( fusipn > 0 ) {
						if ( ele == SKILL_RES_POISON ) {
							snd SOUNDLIST_ATK_NERVE
							dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NERVE, elep
						}
						if ( ele == SKILL_RES_NERVE ) {
							snd SOUNDLIST_ATK_POISON
							dmghp tc, limit(dmg * fusipn / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_POISON, elep
						}
					}
					if ( fusidne > 0 ) {
						if ( ele == SKILL_RES_DARKNESS ) {
							snd SOUNDLIST_ATK_HELL
							dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_NETHER, elep
						}
						if ( ele == SKILL_RES_NETHER ) {
							snd SOUNDLIST_ATK_DARK
							dmghp tc, limit(dmg * fusidne / 500 + rnd(dmg / 4 + 1), 1, dmg * 3 / 2), cc, SKILL_RES_DARKNESS, elep
						}
					}
				}
				if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
					dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, ele, elep
					if ( synccheck(tc, -1) ) {
						txtef COLOR_PURPLE
						txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected magic.")
					}
				}
				fusifc = 0
				fusims = 0
				fusipn = 0
				fusidne = 0
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_HEAL | _switch_sw ) {
				_switch_sw = 0
				if ( efid == SKILL_SPELL_HEAL_LIGHT ) {
					if ( synccheck(tc, -1) ) {
						txt lang(name(tc) + "の傷はふさがった。", name(tc) + " " + is(tc) + " slightly healed.")
					}
				}
				if ( efid == SKILL_SPELL_HEAL_CRITICAL | efid == SKILL_SPELL_HEALING_TOUCH ) {
					if ( synccheck(tc, -1) ) {
						txt lang(name(tc) + "は回復した。", name(tc) + " " + is(tc) + " healed.")
					}
				}
				if ( efid == SKILL_SPELL_CURE_OF_ERIS ) {
					if ( synccheck(tc, -1) ) {
						txt lang(name(tc) + "の身体に生命力がみなぎった。", name(tc) + " " + is(tc) + " greatly healed.")
					}
				}
				if ( efid == SKILL_SPELL_CURE_OF_JURE ) {
					if ( synccheck(tc, -1) ) {
						txt lang(name(tc) + "は完全に回復した。", name(tc) + " " + is(tc) + " completely healed.")
					}
				}
				gosub *effect_heal
				if ( efid == SKILL_SPACT_PRAYER_OF_JURE ) {
					if ( tc == CHARA_PLAYER ) {
						healhp tc, cdata(CDATA_MAX_HP, tc) / 5
					}
					addbuff tc, BUFF_HOLY_VEIL, cdata(CDATA_PIETY, tc) / 2, 50
					addbuff tc, BUFF_REGENERATION, 30, 50
					repeat MAX_BLESSINGS + MAX_HEXES
						i = MAX_BLESSINGS + MAX_HEXES - cnt - 1
						if ( bdataref(0, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != 2 ) {
							continue
						}
						if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
							continue
						}
						if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == 0 ) {
							continue
						}
						if ( rnd(cdata(CDATA_PIETY, tc) + 1) > rnd(cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF + 1, tc) + 1) ) {
							delbuff tc, i
							continue cnt
						}
					loop
				}
				if ( efstatus >= 1 ) {
					healcon tc, CONDITION_SICK, 5 + rnd(5)
				}
				sickifcursed efstatus, tc, 3
				animeid = ANIMATION_HEAL
				gosub *anime
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_HAND | _switch_sw ) {
				_switch_sw = 0
				if ( efid == SKILL_SPACT_VORACITY_FANG ) {
					if ( cdata(CDATA_HUNGER, cc) >= 10000 ) {
						gosub *act_melee
						goto *effect_SWEND1
					}
				}
				if ( cbit(CHARA_BIT_BLUE_SPIRIT, cc) ) {
					if ( efid != SKILL_SPACT_VORACITY_FANG & efid != SKILL_SPACT_DRAIN_BLOOD ) {
						powsel = 0
						if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
							if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
								powsel = 100
							}
						}
						if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
							if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
								powsel = 100
							}
						}
						if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
							powsel = 100
						}
						if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
							powsel = 100
						}
						if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
							if ( exgauge != 100 ) {
								powsel = 0
							}
						}
						if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
							powsel = 0
						}
						if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
							if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
								powsel = 0
							}
						}
						if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
							powsel = 0
						}
						if ( cc == CHARA_PLAYER ) {
							if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
								powsel = 0
							}
						}
						if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
							if ( powsel == 100 ) {
								if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
									if ( efid == SKILL_SPACT_MEMORY_POISON ) {
										efid = SKILL_SPACT_DATA_DELETE
										gosub *effect
										goto *effect_SWEND1
									}
									if ( efid != SKILL_SPACT_MEMORY_POISON ) {
										efid = SKILL_SPACT_HAND_OF_SPLENDOR
										gosub *effect
										goto *effect_SWEND1
									}
								}
							}
						}
					}
				}
				if ( efid == SKILL_SPACT_VORACITY_FANG ) {
					snd SOUNDLIST_EAT1
					if ( synccheck(cc, -1) ) {
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt lang(aln(cc) + name(tc) + "の身体を食いちぎり", name(cc) + " bite" + _s(cc) + " off " + name(tc) + your(tc) + " flesh and")
						}
						else {
							txt lang(name(cc) + "に身体を食いちぎられた。", name(cc) + " bite" + _s(cc) + " off " + name(tc) + your(tc) + " flesh.")
						}
					}
				}
				if ( efid == SKILL_SPACT_MEMORY_POISON ) {
					snd SOUNDLIST_EAT1
					if ( synccheck(cc, -1) ) {
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt lang(aln(cc) + name(tc) + "の記憶を食い荒らして", name(cc) + " bite" + _s(cc) + " off " + name(tc) + your(tc) + " memory and")
						}
						else {
							txt lang(name(cc) + "に記憶を食い荒らされた。", name(cc) + " bite" + _s(cc) + " off " + name(tc) + your(tc) + " memory.")
						}
					}
				}
				if ( efid != SKILL_SPACT_VORACITY_FANG & efid != SKILL_SPACT_MEMORY_POISON ) {
					if ( cdata(CDATA_CAST_STYLE, cc) != 0 ) {
						if ( synccheck(cc, -1) ) {
							if ( cc == CHARA_PLAYER ) {
								txt lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cdata(CDATA_CAST_STYLE, cc)), name(cc) + " cast " + skillname(efid) + ".")
								txtmore
							}
							else {
								txt lang(name(cc) + "は" + _cast(cdata(CDATA_CAST_STYLE, cc)), name(cc) + "" + _cast(cdata(CDATA_CAST_STYLE, cc)))
								txtmore
							}
						}
					}
					else {
						if ( efid == SKILL_SPACT_DRAIN_BLOOD ) {
							if ( synccheck(cc, -1) ) {
								if ( tc >= MAX_CHARA_FOLLOWER ) {
									gdata(GDATA_DMG_TYPE) = 2
									txt lang(aln(cc) + name(tc) + "の血を吸い", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood and")
								}
								else {
									txt lang(name(cc) + "に血を吸われた。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
								}
							}
						}
						else {
							if ( synccheck(cc, -1) ) {
								if ( tc >= MAX_CHARA_FOLLOWER ) {
									gdata(GDATA_DMG_TYPE) = 2
									txt lang(aln(cc) + name(tc) + "を" + elename(ele) + _melee(2, cdata(CDATA_MELEE_STYLE, cc)) + "で" + _melee(0, cdata(CDATA_MELEE_STYLE, cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cdata(CDATA_MELEE_STYLE, cc)) + " and")
								}
								else {
									txt lang(name(tc) + "は" + name(cc) + "に" + elename(ele) + _melee(2, cdata(CDATA_MELEE_STYLE, cc)) + "で" + _melee(1, cdata(CDATA_MELEE_STYLE, cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cdata(CDATA_MELEE_STYLE, cc)) + ".")
								}
							}
						}
					}
				}
				if ( efid == SKILL_SPACT_DRAIN_BLOOD ) {
					if ( cdata(CDATA_SP, tc) > 0 ) {
						healsp cc, 12
					}
					if ( tc == CHARA_PLAYER ) {
						dmgsp CHARA_PLAYER, rnd(6) + 5
					}
					if ( tc != CHARA_PLAYER ) {
						dmgspt tc, rnd(6) + 5
					}
					refreshspeed tc
					if ( cc == CHARA_PLAYER & tc < MAX_CHARA_FOLLOWER & (cdata(CDATA_IMPRESSION, tc) >= 150 | cdata(CDATA_MASTER_SERVANT, tc) >= 150) ) {
						customtalk tc, DBMODE_FLAVOR_DRAIN
						gosub *convert_word
						if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
							txt lang(name(tc) + "は大人しく血を吸われている。", name(tc) + " obediently allows you to suck " + his(tc, 1) + " blood."), lang("「どうぞ…」", cnvtalk("Here you go...")), lang("「美味しい？」", cnvtalk("Is it good?"))
						}
						dmgcon tc, CONDITION_BLEED, 50
					}
					else {
						dmghp tc, role(dice1, dice2, bonus), cc, ele, elep
						dmgcon tc, CONDITION_BLEED, 75
					}
				}
				if ( efid != SKILL_SPACT_DRAIN_BLOOD ) {
					dmghp tc, role(dice1, dice2, bonus), cc, ele, elep
				}
				if ( efid == SKILL_SPACT_VORACITY_FANG ) {
					dmgcon tc, CONDITION_BLEED, 75
					cdata(CDATA_HUNGER, cc) += 150
				}
				if ( efid == SKILL_SPACT_MEMORY_POISON ) {
					if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
						if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
							goto *effect_SWEND1
						}
						p = SKILL_ATTR_STR, SKILL_ATTR_CON, SKILL_ATTR_DEX, SKILL_ATTR_CHA, SKILL_ATTR_SPD, SKILL_ATTR_LER, SKILL_ATTR_PER, SKILL_ATTR_MAG, SKILL_ATTR_WIL, SKILL_ATTR_LUC, -1
						repeat
							if ( p(cnt) == (-1) ) {
								break
							}
							i = p(cnt) + STARTING_CDATA_ATTR - STARTING_SKILL_ATTR
							cdata(i, tc) -= 50
						loop
						r1 = tc
						gosub *charaRefresh
						if ( gdata(GDATA_FLAG_MAIN) >= 780 ) {
							txtef COLOR_GREEN
							txt lang("[記憶の灯]から放出された光が、記憶消去を緩和した！", "The light emitted from Light of memory relieved memory delete!")
						}
						if ( synccheck(tc, -1) ) {
							txtmore
							txtef COLOR_PURPLE
							txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
						}
					}
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_FEAR ) {
					dmgcon tc, CONDITION_FEAR, elep
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_SLEEP ) {
					dmgcon tc, CONDITION_SLEEP, elep
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_HUNGER ) {
					addbuff tc, BUFF_CURSE_OF_HUNGER, 9999999, 100
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_WEAKNESS ) {
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
						txt lang(name(tc) + "は弱くならない。", name(tc) + " won't weaken.")
					}
					else {
						p = rnd(MAX_SKILL_ATTR - STARTING_SKILL_ATTR)
						if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE & rnd(4) | encfind(tc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + STARTING_SKILL_ATTR + p) != (-1) ) {
							p = -1
						}
						if ( findbuff(tc, BUFF_DISINFECTION) != (-1) ) {
							p = -1
						}
						if ( p != (-1) ) {
							i = sorg(STARTING_SKILL_ATTR + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
							if ( i > 0 ) {
								i = i * efp / 2000 + 1
								cdata(STARTING_CDATA_ATTR + p, tc) -= i
							}
							if ( synccheck(tc, -1) ) {
								txtmore
								txtef COLOR_PURPLE
								txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
							}
							r1 = tc
							gosub *charaRefresh
						}
					}
				}
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					if ( efid != SKILL_SPACT_VORACITY_FANG & efid != SKILL_SPACT_DRAIN_BLOOD ) {
						if ( findbuff(cc, BUFF_RESOLUTION_HAND) != (-1) ) {
							snd SOUNDLIST_OFFER1
							txt lang(name(cc) + "の触れた部分が塵と化した。", "Touched portion is turned into dust.")
							dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 5 + 4) * ((sdata(SKILL_NORMAL_ALCHEMY, cc) + 1) / 5 + 3) * 2 + rnd(sdata(SKILL_NORMAL_ALCHEMY, cc) * 2 + 5) + 1, cc, SKILL_RESDMG_CRUSH, 1000
							if ( cdata(CDATA_HP, tc) >= 0 ) {
								if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
									efid = SKILL_SPACT_MATERIALIZE
									gosub *effect
								}
							}
							skillexp SKILL_NORMAL_ALCHEMY, cc, 40
							if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
								if ( efid == SKILL_SPACT_TOUCH_OF_SLEEP ) {
									dmgcon tc, CONDITION_SLEEP, elep
								}
							}
						}
					}
					if ( efid != SKILL_SPACT_VORACITY_FANG & efid != SKILL_SPACT_DRAIN_BLOOD ) {
						powsel = 0
						if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
							if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
								powsel = 100
							}
						}
						if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
							if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
								powsel = 100
							}
						}
						if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
							powsel = 100
						}
						if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
							powsel = 100
						}
						if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
							if ( exgauge != 100 ) {
								powsel = 0
							}
						}
						if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
							powsel = 0
						}
						if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
							if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
								powsel = 0
							}
						}
						if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
							powsel = 0
						}
						if ( cc == CHARA_PLAYER ) {
							if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
								powsel = 0
							}
						}
						if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
							if ( powsel == 100 ) {
								if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
									if ( efid != SKILL_SPACT_MEMORY_POISON ) {
										efid = SKILL_SPACT_HAND_OF_SPLENDOR
										gosub *effect
									}
									if ( efid == SKILL_SPACT_MEMORY_POISON ) {
										efid = SKILL_SPACT_DATA_DELETE
										gosub *effect
									}
								}
							}
						}
					}
				}
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_SUMMON | _switch_sw ) {
				_switch_sw = 0
				if ( efid == SKILL_SPACT_TEMPEST_ARROW ) {
					if ( cc != CHARA_PLAYER ) {
						if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
							efid = SKILL_SPACT_INTENSIVE_POWER
							gosub *effect
							goto *effect_SWEND1
						}
					}
					if ( cc != CHARA_PLAYER ) {
						if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
							efid = SKILL_SPACT_TIME_STOP
							gosub *effect
							goto *effect_SWEND1
						}
					}
				}
				if ( cc != CHARA_PLAYER ) {
					if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == TRUE | cdata(CDATA_ALLIED, cc) == 100 | cdata(CDATA_RELATION, cc) == RELATION_ALLY ) {
						efid = SKILL_SPACT_INTENSIVE_POWER
						gosub *effect
						goto *effect_SWEND1
					}
				}
				if ( cc == CHARA_PLAYER ) {
					if ( gdata(GDATA_CROWD) + 100 >= MAX_CHARA_TOTAL - MAX_CHARA_SAVE ) {
						txt_nothinghappens
						obvious = 0
						goto *effect_SWEND1
					}
				}
				p = 3
				efp = (efp / 25 + efp * efp / 10000 + cdata(CDATA_LEVEL, cc)) / 2
				if ( efp < 1 ) {
					efp = 1
				}
				if ( efid == SKILL_SPACT_SUMMON_PAWN ) {
					efp = 15 + rnd(8)
				}
				if ( efid == SKILL_SPACT_SUMMON_CATS ) {
					efp = 2 + rnd(18)
				}
				if ( efid == SKILL_SPACT_SUMMON_FIRE ) {
					efp = 15 + rnd(15)
				}
				if ( efid == SKILL_SPACT_SUMMON_YEEK ) {
					efp = 5 + rnd(12)
				}
				if ( efid == SKILL_SPACT_SUMMON_SISTER ) {
					p = 10
				}
				if ( efid == SKILL_SPACT_TEMPEST_ARROW ) {
					p = 5
				}
				if ( efid == SKILL_SPACT_SUMMON_CHAOS ) {
					p = 5
				}

                // Make Summon Sprit scale with spell level.
                //
                // The following code for limiting the summoned ally level
                // was supposed to be implemented in an earlier Plus version, but
                // it didn't take effect due to a programming error. To make the spell
                // more viable, it has been removed in CGX.

                /********** ORIGINAL - BEGINNING **********

				if ( efid == SKILL_SPELL_SUMMON_SPIRIT ) {
					efp = 2 + rnd(8)
				}

                ********** ORIGINAL - ENDING **********/

				if ( efid == SKILL_SPELL_SUMMON_MONSTERS ) {
					if ( efp > cdata(CDATA_LEVEL, cc) + 5 ) {
						efp = cdata(CDATA_LEVEL, cc) + rnd(5)
					}
				}
				if ( cdata(CDATA_ID, cc) == CREATURE_ID_LULWY | cdata(CDATA_ID, cc) == CREATURE_ID_DEVASTATE_LULWY ) {
					if ( efid == SKILL_SPACT_SUMMON_CHAOS ) {
						if ( cdata(CDATA_RELATION, cc) >= (-1) ) {
							sylph = -1
						}
						else {
							sylph = -3
						}
						p = 0
						repeat MAX_CHARA_TOTAL
							if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
								continue
							}
							if ( cdata(CDATA_ID, cnt) != CREATURE_ID_SYLPH ) {
								continue
							}
							if ( cbit(CHARA_BIT_SUMMONED, cnt) != 1 ) {
								continue
							}
							p++
						loop
						if ( p > 15 ) {
							goto *effect_SWEND1
						}
						if ( synccheck(cc, -1) ) {
							txt lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
						}
						repeat 7
							characreate -1, CREATURE_ID_SYLPH, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
							cbitmod CHARA_BIT_SUMMONED, rc, 1
							cdata(CDATA_RELATION, rc) = sylph
						loop
						goto *effect_SWEND1
					}
				}
				if ( cdata(CDATA_ID, cc) == CREATURE_ID_ZOMBIE_QUEEN | cdata(CDATA_ID, cc) == CREATURE_ID_ROATONIS_THE_INFECTIONS ) {
					if ( efid == SKILL_SPACT_SUMMON_CHAOS ) {
						if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 | cdata(CDATA_ALLIED, cc) == 100 ) {
							goto *effect_SWEND1
						}
						p = 0
						repeat MAX_CHARA_TOTAL
							if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
								continue
							}
							if ( cdata(CDATA_ID, cnt) != CREATURE_ID_ZOMBIE ) {
								continue
							}
							if ( cbit(CHARA_BIT_SUMMONED, cnt) != 1 ) {
								continue
							}
							p++
						loop
						if ( p > 15 ) {
							goto *effect_SWEND1
						}
						txtef COLOR_RED
						txt lang(" *死者覚醒*　", " *Necro Awake* ")
						snd SOUNDLIST_CURSE2
						repeat 10
							initlv = cdata(CDATA_LEVEL, cc) * 2 / 3 + 1
							novoidlv = 1
							characreate -1, CREATURE_ID_ZOMBIE, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
							cbitmod CHARA_BIT_SUMMONED, rc, 1
							cdata(CDATA_CHARACTER_TIER, rc) = CHARACTER_TIER_SUMMONED_NORMAL
						loop
						goto *effect_SWEND1
					}
				}
				repeat 1 + rnd(p)
					flt calcobjlv(efp), 2
					dbid = 0
					if ( efid == SKILL_SPELL_SUMMON_WILD ) {
						fltn "wild"
					}
					if ( efid == SKILL_SPACT_SUMMON_FIRE ) {
						fltn "fire"
					}
					if ( efid == SKILL_SPACT_SUMMON_PAWN ) {
						fltn "pawn"
					}
					if ( efid == SKILL_SPACT_SUMMON_CATS ) {
						fltn "cat"
					}
					if ( efid == SKILL_SPACT_SUMMON_YEEK ) {
						fltn "yeek"
					}
					if ( efid == SKILL_SPACT_SUMMON_SISTER ) {
						dbid = CREATURE_ID_YOUNGER_SISTER
					}
					if ( efid == SKILL_SPACT_TEMPEST_ARROW ) {
						dbid = CREATURE_ID_RUDRAS
					}
					if ( efid == SKILL_SPACT_SUMMON_CHAOS ) {
						dbid = CREATURE_ID_CHAOS_SPIRIT
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_PERFORMAID_PINCHIEF ) {
							dbid = CREATURE_ID_PERFORMAID_BLOODRESS + rnd(3)
						}
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_OBLIVION_RUDE_BEAST ) {
							dbid = ITEM_ID_PETHOUSE
						}
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_HOT_MUSHROOM_TEACHER ) {
							dbid = ITEM_ID_ALPHA_SHIFT_CORE
						}
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA ) {
							dbid = ITEM_ID_DEED_DISCARDED_RANCH
						}
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_RATS_BRINGER ) {
							dbid = ITEM_ID_ROD_UNCURSE
						}
						if ( cdata(CDATA_ID, cc) == CREATURE_ID_POWERFUL_GREAT_WYRM ) {
							dbid = ITEM_ID_SPELLBOOK_WATER_BEAM
						}
					}
					if ( efid == SKILL_SPELL_SUMMON_SPIRIT ) {
						initlv = limit(efp * 1 / 3 + 2, 1, gdata(GDATA_DEEPEST_LEVEL))
						novoidlv = 1
						fltn "spirit"
						characreate -1, dbid, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
						cbitmod CHARA_BIT_SUMMONED, rc, 1
						cdata(CDATA_CHARACTER_TIER, rc) = CHARACTER_TIER_SUMMONED_NORMAL

                        /********** RUIN0X11 CUSTOM - BEGINNING **********/ // Make summoned spirits neutral.

						if ( cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE ) {
							locvar_relation = RELATION_DISLIKE
						}
						else {
							locvar_relation = RELATION_ENEMY
						}

						cdata(CDATA_RELATION, rc) = locvar_relation

                        /********** RUIN0X11 CUSTOM - ENDING **********/
					}
					else {
						if ( efid == SKILL_SPACT_TEMPEST_ARROW ) {
							characreate -1, dbid, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
							cdata(CDATA_RELATION, rc) = -3
							cdata(CDATA_RELATION_ORG, rc) = -3
							cbitmod CHARA_BIT_SUMMONED, rc, 1
						}
						else {
							if ( cdata(CDATA_ID, cc) == CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA ) {
								initlv = limit(cdata(CDATA_LEVEL, cc) / 5, 1, 700)
								novoidlv = 1
								characreate -1, dbid, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
								cbitmod CHARA_BIT_SUMMONED, rc, TRUE
								cdata(CDATA_CHARACTER_TIER, rc) = CHARACTER_TIER_SUMMONED_NORMAL
								cdata(CDATA_RELATION, rc) = cdata(CDATA_RELATION, cc)
							}
							if ( cdata(CDATA_ID, cc) != CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA ) {
								characreate -1, dbid, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
								cbitmod CHARA_BIT_SUMMONED, rc, TRUE
							}
							if ( cdata(CDATA_ID, rc) == CREATURE_ID_CTHUGHA ) {
								characreate -1, CREATURE_ID_YOMAGNTHO, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
								cbitmod CHARA_BIT_SUMMONED, rc, 1
							}
						}
					}
					if ( efid != SKILL_SPACT_SUMMON_SISTER ) {
						if ( cdata(CDATA_ID, rc) == cdata(CDATA_ID, cc) ) {
							if ( cdata(CDATA_ID, cc) != CREATURE_ID_POWERFUL_GREAT_WYRM ) {
								chara_vanquish rc
								continue cnt
							}
						}
					}
					if ( cdata(CDATA_ID, rc) == CREATURE_ID_STRAY_CAT ) {
						chara_vanquish rc
						continue cnt
					}
				loop
				if ( synccheck(cc, -1) ) {
					if ( efid == SKILL_SPACT_TEMPEST_ARROW ) {
						txt lang("「アハハ！竜巻に呑まれて消えなさい」", cnvtalk("Huh! Go into the tornado!"))
						snd SOUNDLIST_ENC
						animeload ANIMATION_UNISON_IMPACT2, cc
						cdata(CDATA_POWER_GAUGE, cc) -= 100
						if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
							snd SOUNDLIST_POWER
							exgauge = 100
							if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
								gdata(GDATA_TIME_STOP_TIME) = 2
							}
						}
						animeload ANIMATION_FIREWORK, cc
						snd SOUNDLIST_BOLT1
					}
					else {
						if ( synccheck(cc, -1) ) {
							txt lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
						}
					}
				}
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_TELEPORT | _switch_sw ) {
				_switch_sw = 0
				if ( efid == SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					if ( cc == tc ) {
						txt lang("自分で自分は投げられない。", "You can not throw yourself.")
						goto *effect_SWEND1
					}
					if ( tc == CHARA_PLAYER ) {
						txt lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
						goto *effect_SWEND1
					}
				}
				if ( efid == SKILL_SPACT_SHADOW_STEP ) {
					if ( cdata(CDATA_RELATION, cc) != 10 | tc != CHARA_PLAYER ) {
						if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
							tc = cdata(CDATA_TARGET, cc)
							gosub *act_melee
							goto *effect_SWEND1
						}
					}
				}
				tcprev = tc
				if ( gdata(GDATA_RIDER) != 0 ) {
					if ( efid != SKILL_SPACT_SHADOW_STEP ) {
						if ( tc == gdata(GDATA_RIDER) ) {
							goto *effect_SWEND1
						}
					}
				}
				if ( gdata(GDATA_RIDER) != 0 ) {
					if ( efid != SKILL_SPACT_DRAW_SHADOW ) {
						if ( cc == gdata(GDATA_RIDER) ) {
							goto *effect_SWEND1
						}
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, cc) == 1 ) {
					if ( efid != SKILL_SPACT_DRAW_SHADOW ) {
						goto *effect_SWEND1
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, tc) == 1 ) {
					if ( efid != SKILL_SPACT_SHADOW_STEP ) {
						goto *effect_SWEND1
					}
				}
				if ( cdata(CDATA_CONDITION_BIND, cc) >= 20 ) {
					if ( efid == SKILL_SPACT_SHADOW_STEP ) {
						txt lang("固定されていて動かない！", "It does not move to be fixed!")
						goto *effect_SWEND1
					}
				}
				if ( cdata(CDATA_CONDITION_BIND, tc) >= 20 ) {
					if ( efid != SKILL_SPACT_SHADOW_STEP ) {
						txt lang("固定されていて動かない！", "It does not move to be fixed!")
						goto *effect_SWEND1
					}
				}
				if ( efid != SKILL_SPACT_SHADOW_STEP & efid != SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					space = 0
					repeat MAX_CHARA_TOTAL
						if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
							if ( gdata(GDATA_LEVEL) >= 10 ) {
								space = 1
								break
							}
						}
						if ( cnt == cc ) {
							continue
						}
						if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						if ( findbuff(cnt, BUFF_RETENTION) != (-1) ) {
							space = 1
							break
						}
					loop
					if ( space == 1 ) {
						txt_noteleport
						goto *effect_SWEND1
					}
					space = 0
				}
				if ( efid == SKILL_SPELL_TELEPORT ) {
					tc = cc
				}
				if ( efid == SKILL_SPACT_SHADOW_STEP ) {
					telex = cdata(CDATA_X, tc)
					teley = cdata(CDATA_Y, tc)
				}
				if ( efid == SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					if ( synccheck(cc, -1) ) {
						txtmore
						txt lang(name(cc) + "は" + cdatan(CDATAN_NAME, cdata(CDATA_TARGET, tc)) + "に向かって" + name(tc) + "を放り投げた。", name(cc) + " threw " + name(tc) + " to " + cdatan(CDATAN_NAME, cdata(CDATA_TARGET, tc)) + ".")
					}
					if ( cdata(CDATA_TARGET, tc) != (-1) ) {
						telex = cdata(CDATA_X, cdata(CDATA_TARGET, tc))
						teley = cdata(CDATA_Y, cdata(CDATA_TARGET, tc))
					}
					if ( cdata(CDATA_TARGET, tc) == (-1) ) {
						telex = cdata(CDATA_X, CHARA_PLAYER)
						teley = cdata(CDATA_Y, CHARA_PLAYER)
					}
				}
				if ( efid == SKILL_SPACT_DRAW_SHADOW ) {
					telex = cdata(CDATA_X, cc)
					teley = cdata(CDATA_Y, cc)
				}
				if ( efid == SKILL_SPELL_TELEPORT_OTHER | efid == SKILL_SPACT_SUSPICIOUS_HAND ) {
					if ( map(tlocx, tlocy, 1) == 0 ) {
						txt_nothinghappens
						obvious = 0
						goto *effect_SWEND1
					}
					tc = map(tlocx, tlocy, 1) - 1
				}
				if ( efid != SKILL_SPACT_SHADOW_STEP & efid != SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					if ( gdata(GDATA_AREA) == AREA_PET_ARENA | mdata(MDATA_TYPE) == MAP_TYPE_WORLD | gdata(GDATA_AREA) == AREA_PYRAMID | gdata(GDATA_AREA) == AREA_JAIL ) {
						if ( synccheck(tc, -1) ) {
							txt_noteleport
						}
						goto *effect_SWEND1
					}
				}
				if ( efid != SKILL_SPACT_SHADOW_STEP & efid != SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					if ( encfind(tc, ENCHANT_PREVENT_TELEPORT) != (-1) ) {
						if ( synccheck(tc, -1) ) {
							txt_noteleport
						}
						goto *effect_SWEND1
					}
					if ( gdata(GDATA_RAPID_FIRE) == 100 ) {
						goto *effect_SWEND1
					}
				}
				if ( efid == SKILL_SPACT_SUSPICIOUS_HAND ) {
					if ( tc == cc ) {
						if ( synccheck(tc, -1) ) {
							txt_noteleport
						}
						goto *effect_SWEND1
					}
					if ( cbit(CHARA_BIT_SUMMONED, cc) == TRUE ) {
						gosub *act_melee
						goto *effect_SWEND1
					}

                    /********** ORIGINAL - BEGINNING **********

					if ( cbit(CHARA_BIT_SANDBAG, tc) == TRUE ) {

                     ********** ORIGINAL - ENDING **********/

                    /********** RUIN0X11 CUSTOM - BEGINNING **********/

					if ( cbit(CHARA_BIT_SANDBAG, tc) == TRUE & TweakData(TWEAK_GAMEPLAY_SANDBAG_TRAINING, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {

                    /********** RUIN0X11 CUSTOM - ENDING **********/

						txt lang(name(cc) + "は悪戦苦闘している。縄がきつくて財布が抜き取れないようだ。", name(cc) + " is struggling. It seems that the rope is so tight that you can't pull out " + his(cc) + " wallet.")
						goto *effect_SWEND1
					}
					p = rnd(cdata(CDATA_GOLD, tc) / 10 + 1)
					if ( cdatan(CDATAN_CLASS, tc) == "tourist" ) {
						p = p * 2
					}
					if ( rnd(sdata(SKILL_ATTR_PER, tc)) > rnd(sdata(SKILL_ATTR_DEX, cc) * 4) | cbit(CHARA_BIT_RES_STEAL, tc) == 1 ) {
						txt lang(name(tc) + "は自分の財布を守った。", name(tc) + " guard" + _s(tc) + " " + his(tc) + " wallet from a thief.")
						p = 0
					}
					if ( p != 0 ) {
						snd SOUNDLIST_PAYGOLD1
						cdata(CDATA_GOLD, tc) -= p
						txt lang(name(cc) + "は" + name(tc) + "から" + p + "枚の金貨を奪った。", name(cc) + " steal" + _s(cc) + " " + p + " gold pieces from " + name(tc) + ".")
						cdata(CDATA_GOLD, cc) += p
					}
					tc = cc
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == tc ) {
							goto *effect_SWEND1
						}
					}
				}
				if ( efid != SKILL_SPACT_SHADOW_STEP & efid != SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_TELEPORT1
					}
				}
				if ( efid == SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
					snd SOUNDLIST_SWING
				}
				if ( bakuretu == 200 ) {
					if ( cdata(CDATA_POWER_GAUGE, cc) >= 25 ) {
						snd SOUNDLIST_BOLT1
					}
				}
				tx = cdata(CDATA_X, tc)
				ty = cdata(CDATA_Y, tc)
				efidprev = efid
				repeat 200
					if ( efidprev == SKILL_SPELL_SHORT_TELEPORT | efidprev == SKILL_SPACT_DIMENSIONAL_MOVE ) {
						p = -1, 1
						cdata(CDATA_X_NEW, tc) = cdata(CDATA_X, tc) + (3 - cnt / 70 + rnd(5)) * p(rnd(2))
						cdata(CDATA_Y_NEW, tc) = cdata(CDATA_Y, tc) + (3 - cnt / 70 + rnd(5)) * p(rnd(2))
						cell_check cdata(CDATA_X_NEW, tc), cdata(CDATA_Y_NEW, tc)
					}
					else {
						if ( efidprev == SKILL_SPACT_SHADOW_STEP ) {
							cdata(CDATA_X_NEW, cc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							cdata(CDATA_Y_NEW, cc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							cell_check cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc)
						}
						else {
							if ( efidprev == SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
								if ( cdata(CDATA_AI_DISTANCE, tc) < 1 ) {
									cdata(CDATA_AI_DISTANCE, tc) = 1
								}
								cdata(CDATA_CHAIN_ATTACK_COUNT, tc) = 0
								cdata(CDATA_X_NEW, tc) = telex + rnd(cnt / 8 + 1 + cdata(CDATA_AI_DISTANCE, tc)) - rnd(cnt / 8 + 1 + cdata(CDATA_AI_DISTANCE, tc))
								cdata(CDATA_Y_NEW, tc) = teley + rnd(cnt / 8 + 1 + cdata(CDATA_AI_DISTANCE, tc)) - rnd(cnt / 8 + 1 + cdata(CDATA_AI_DISTANCE, tc))
								if ( dist(cdata(CDATA_X_NEW, tc), cdata(CDATA_Y_NEW, tc), cdata(CDATA_X, cdata(CDATA_TARGET, tc)), cdata(CDATA_Y, cdata(CDATA_TARGET, tc))) < cdata(CDATA_AI_DISTANCE, tc) ) {
									continue
								}
								cell_check cdata(CDATA_X_NEW, tc), cdata(CDATA_Y_NEW, tc)
							}
							else {
								if ( efidprev == SKILL_SPACT_DRAW_SHADOW ) {
									cdata(CDATA_X_NEW, tc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
									cdata(CDATA_Y_NEW, tc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
									cell_check cdata(CDATA_X_NEW, tc), cdata(CDATA_Y_NEW, tc)
								}
								else {
									cdata(CDATA_X_NEW, tc) = rnd(mdata(MDATA_WIDTH) - 2) + 1
									cdata(CDATA_Y_NEW, tc) = rnd(mdata(MDATA_HEIGHT) - 2) + 1
									cell_check cdata(CDATA_X_NEW, tc), cdata(CDATA_Y_NEW, tc)
								}
							}
						}
					}
					if ( cellaccess == 1 ) {
						if ( efidprev == SKILL_SPACT_SHADOW_STEP ) {
							if ( synccheck(cc, -1) ) {
								txt lang(name(cc) + "は" + cdatan(CDATAN_NAME, tcprev) + "の元に移動した。", name(cc) + " teleport" + _s(cc) + " toward " + cdatan(CDATAN_NAME, tcprev) + ".")
							}
							rowactend cc
							if ( cdata(CDATA_IN_TAGTEAM, cc) != 0 ) {
								tcc = cdata(CDATA_TAGTEAM_PARTNER, cc)
								rowactend tcc
							}
							ccprev = cc
							gosub *procMove
							cc = ccprev
							if ( cc == CHARA_PLAYER ) {
								gosub *screen_draw
							}
							if ( cc == CHARA_PLAYER & client == tc ) {
								break
							}
							if ( cdata(CDATA_RELATION, cc) == 10 & tc == CHARA_PLAYER ) {
								break
							}
							if ( cbit(CHARA_BIT_LIVESTOCK, cc) == 1 & tc == CHARA_PLAYER ) {
								break
							}
							if ( zero2 != 200 ) {
								animeid = ANIMATION_ATTACK
								gosub *anime
								if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
									shadow = 100
								}
								gosub *act_melee
							}
							shadow = 0
							break
						}
						else {
							if ( efidprev == SKILL_SPACT_DRAW_SHADOW ) {
								if ( synccheck(cc, -1) ) {
									txtmore
									txt lang(name(tc) + "は引き寄せられた。", name(tc) + " " + is(tc) + " drawn.")
								}
								if ( notconfuse == 0 ) {
									if ( cdata(CDATA_CONDITION_INVERT, tc) < 1 ) {
										cdata(CDATA_CONDITION_INVERT, tc) = 1
									}
									txt lang(name(tc) + "は転倒した。", name(tc) + " " + was(tc) + " knocked down.")
								}
								notconfuse = 0
								if ( cdata(CDATA_ROW_ACT, tc) != ACTION_NONE ) {
									if ( synccheck(tc, -1) ) {
										txt lang(name(tc) + "は驚いて行動を中断した。", name(tc) + " got surprised and interrupted " + his(tc, 1) + " action.")
										rowactend tc
									}
								}
								if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
									ttc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									if ( cdata(CDATA_ROW_ACT, ttc) != ACTION_NONE ) {
										txt lang(cdatan(CDATAN_NAME, ttc) + "は驚いて行動を中断した。", cdatan(CDATAN_NAME, ttc) + " got surprised and interrupted " + his(ttc, 1) + " action.")
										rowactend ttc
									}
								}
							}
							else {
								if ( efidprev != SKILL_SPACT_DISPATCH_FLYING_BEAST ) {
									if ( synccheck(cc, -1) ) {
										if ( efidprev == SKILL_SPACT_SUSPICIOUS_HAND ) {
											txtmore
											txt lang("泥棒は笑って逃げた。", "A thief escapes laughing.")
										}
										else {
											txt lang(name(tc) + "は突然消えた。", "Suddenly, " + name(tc) + " disappear" + _s(tc) + ".")
										}
									}
								}
								if ( cdata(CDATA_ROW_ACT, tc) != ACTION_NONE ) {
									if ( synccheck(cc, -1) ) {
										txt lang(name(tc) + "は驚いて行動を中断した。", name(tc) + " got surprised and interrupted " + his(tc, 1) + " action.")
										rowactend tc
									}
								}
								if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
									ttc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									if ( cdata(CDATA_ROW_ACT, ttc) != ACTION_NONE ) {
										txt lang(cdatan(CDATAN_NAME, ttc) + "は驚いて行動を中断した。", cdatan(CDATAN_NAME, ttc) + " got surprised and interrupted " + his(ttc, 1) + " action.")
										rowactend ttc
									}
								}
							}
							rowactend cc
							ccprev = cc
							cc = tc
							gosub *procMove
							cc = ccprev
							if ( tc == CHARA_PLAYER ) {
								gosub *screen_draw
							}
							break
						}
					}
				loop
				tc = tcprev
				goto *effect_SWEND1
			}
			if ( _switch_val == SKILL_TYPE_BREATH | _switch_sw ) {
				_switch_sw = 0
				powsel = 0
				if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
					if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
						powsel = 100
					}
				}
				if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
					if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
						powsel = 100
					}
				}
				if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
					powsel = 100
				}
				if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
					powsel = 100
				}
				if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
					if ( exgauge != 100 ) {
						powsel = 0
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
					if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
						powsel = 0
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
					powsel = 0
				}
				if ( cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
						powsel = 0
					}
				}
				if ( gdata(GDATA_ACTIVATE_PROC) == 100 ) {
					powsel = 0
				}
				if ( powsel == 100 ) {
					if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
						kouiki = 0
						snd SOUNDLIST_ENC
						animeload ANIMATION_UNISON_IMPACT2, cc
						efid = SKILL_SPACT_CONVERGE_BREATH
						gosub *effect
						cdata(CDATA_POWER_GAUGE, cc) -= 100
						powsel = 0
						goto *effect_SWEND1
					}
				}
				powsel = 0
				get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
				if ( stat == 0 ) {
					kouiki = 0
					goto *effect_SWEND1
				}
				if ( ele ) {
					valn = skillname(efid)
				}
				else {
					valn = lang("", "breath")
				}
				if ( findbuff(cc, BUFF_CHARGE) != (-1) & (cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3)) ) {
					customtalk cc, DBMODE_FLAVOR_CHARGE_A
					gosub *convert_word
					if ( synccheck(cc, -1) ) {
						txtef COLOR_RED
						txt lang(name(cc) + "は最大出力の" + valn + "を繰り出した。", name(cc) + " blast" + _s(cc) + " " + valn + " with full power.")
					}
				}
				else {
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は" + valn + "を繰り出した。", name(cc) + " blast" + _s(cc) + " " + valn + ".")
					}
				}
				dx = cdata(CDATA_X, cc)
				dy = cdata(CDATA_Y, cc)
				breath_list
				animeid = ANIMATION_BREATH
				gosub *anime
				repeat maxbreath
					dx = breathlist(0, cnt)
					dy = breathlist(1, cnt)
					if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
						continue
					}
					if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
						continue
					}
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					maga = 0
					inv_find ITEM_ID_MAGATAMA, cc
					if ( stat != (-1) ) {
						maga = 100
					}
					if ( ele == SKILL_RES_FIRE ) {
						if ( maga == 0 ) {
							mapitem_fire dx, dy
						}
					}
					maga = 0
					inv_find ITEM_ID_MAGAICE, cc
					if ( stat != (-1) ) {
						maga = 100
					}
					if ( ele == SKILL_RES_COLD ) {
						if ( maga == 0 ) {
							mapitem_cold dx, dy
						}
					}
					maga = 0
					if ( map(dx, dy, 8) != 0 ) {
						if ( mef(0, map(dx, dy, 8) - 1) == 9 ) {
							delmef map(dx, dy, 8) - 1
						}
					}
					if ( map(dx, dy, 1) != 0 ) {
						tc = map(dx, dy, 1) - 1
						if ( cc != tc ) {
							if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
								if ( tc != CHARA_PLAYER ) {
									if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
										tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
									}
									txt_guard
								}
							}
							dmg = role(dice1, dice2, bonus) + (kouiki == 100) * sdata(SKILL_ATTR_CON, cc) / 10 * (sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) + 10) / 2
							if ( cdata(CDATA_ENHANCE_BREATH, cc) != 0 ) {
								dmg = dmg * (100 + limit(cdata(CDATA_ENHANCE_BREATH, cc), 0, 2000) / 10) / 100
							}
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
								if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
									dmg = dmg * 11
									animeload ANIMATION_OFFER, tc
								}
							}
							if ( synccheck(tc, -1) ) {
								txtmore
								if ( tc >= MAX_CHARA_FOLLOWER ) {
									gdata(GDATA_DMG_TYPE) = 2
									txt3rd = 1
									txt lang(name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
								}
								else {
									txt lang(name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
								}
							}
							dmghp tc, dmg, cc, ele, elep
						}
					}
				loop
				if ( findbuff(cc, BUFF_CHARGE) != (-1) ) {
					if ( cc != CHARA_PLAYER | cdata(CDATA_RELATION, tc) == (-3) ) {
						p = cc
						repeat MAX_BLESSINGS + MAX_HEXES
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == 0 ) {
								break
							}
							if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_CHARGE ) {
								delbuff p, cnt
								continue cnt
							}
						loop
						r1 = cc
						gosub *charaRefresh
					}
				}
				kouiki = 0
				goto *effect_SWEND1
			}
			goto *effect2
*effect_SWEND1
			goto *effect_end
		}
		else {
			if ( efstatus >= 1 ) {
				efp = efp * 150 / 100
			}
			if ( efstatus <= (-1) ) {
				efp = 50
			}
		}
	}
*effect2
	_switch_val = efid
	if ( _switch_val == SKILL_SPACT_EYE_OF_INSANITY | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		if ( jp ) {
			txt name(tc) + "は" + name(cc) + "の腹の亀裂から蛆虫が沸き出る幻覚を見た。", name(tc) + "は" + name(cc) + "が屍を貪る幻覚を目撃した。", name(tc) + "は" + name(cc) + "の恐ろしい瞳に震えた。", name(tc) + "は" + name(cc) + "の触手に絡まる臓物の幻覚に吐き気を感じた。"
		}
		if ( en ) {
			txt name(tc) + " see" + _s(tc) + " maggots breed in the rent stomach of " + name(cc) + ".", name(tc) + " see" + _s(tc) + " " + name(cc) + " chow" + _s(cc) + " dead bodies.", name(tc) + " shudder" + _s(tc) + " at " + name(cc) + your(cc) + " terrifying eyes.", name(tc) + " feel" + _s(tc) + " sick at entrails caught in " + name(cc) + your(cc) + " tentacles."
		}
		dmgsan tc, rnd(role(dice1, dice2, bonus) + 1)
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_CONTINENT_MAP | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_BOOK1
		gsel 4
		if ( gdata(GDATA_FLAG_MAIN) < 180 ) {
			pos 0, 0
			picload exedir + "graphic\\world.bmp", 1
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 180 ) {
			pos 0, 0
			picload exedir + "graphic\\world2.bmp", 1
		}
		gsel 0
		redraw 0
		ww = 680
		wh = 430
		wx = (windoww - ww) / 2 + inf_screenx
		wy = winposy(wh)
		gmode 2
		pos wx, wy
		gcopy 4, 0, 0, ww, wh
		redraw 1
		press
		snd SOUNDLIST_CARD1
		gosub *screen_draw
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_TREASURE_MAP | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			txt lang("それはワールドマップで読む必要がある。", "You need to read it while you are in the world map.")
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			if ( rnd(5) == 0 ) {
				txt lang("呪われた地図は触れると崩れ落ちた。", "The cursed map crumbles as you touch it.")
				inv(INV_ITEM_NUM, ci)--
				if ( ci >= RANGE_INV2 ) {
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				}
				goto *effect_end
			}
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 0 | inv(INV_ITEM_PARAM3, ci) == 0 ) {
			item_separate ci
			repeat 1000
				dx = 4 + rnd(mdata(MDATA_WIDTH) - 8)
				dy = 3 + rnd(mdata(MDATA_HEIGHT) - 6)
				if ( dx >= 50 & dy >= 39 & dx <= 73 & dy <= 54 ) {
					continue
				}
				x = 1, -1, 0, 0
				y = 0, 0, 1, -1
				repeat 4
					f = 1
					cnt2 = cnt
					repeat 3
						p = map(dx + x(cnt2) * cnt, dy + y(cnt2) * cnt, 0)
						if ( 264 <= p & p < 363 | (chipm(CHIPM_ATTRIB, p) & CHIPM_ATTRIB_CANT_PASS) ) {
							f = 0
							break
						}
					loop
					if ( f == 1 ) {
						break
					}
				loop
				if ( f == 1 ) {
					break
				}
			loop
			inv(INV_ITEM_PARAM1, ci) = dx
			inv(INV_ITEM_PARAM2, ci) = dy
			if ( gdata(GDATA_AREA) == AREA_NORTH_TYRIS ) {
				inv(INV_ITEM_PARAM3, ci) = 1
			}
			if ( gdata(GDATA_AREA) == AREA_SOUTH_TYRIS ) {
				inv(INV_ITEM_PARAM3, ci) = 2
			}
			if ( gdata(GDATA_AREA) == AREA_LOST_YLVA ) {
				inv(INV_ITEM_PARAM3, ci) = 3
			}
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 1 & gdata(GDATA_AREA) != AREA_NORTH_TYRIS ) {
			txt lang("これはノースティリスの地図だ。ノースティリスで読もう。", "You should move to North Tyris to read this map.")
			goto *effect_end
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 2 & gdata(GDATA_AREA) != AREA_SOUTH_TYRIS ) {
			txt lang("これはサウスティリスの地図だ。サウスティリスで読もう。", "You should move to South Tyris to read this map.")
			goto *effect_end
		}
		if ( inv(INV_ITEM_PARAM3, ci) == 3 & gdata(GDATA_AREA) != AREA_LOST_YLVA ) {
			txt lang("これはロストイルヴァの地図だ。ロストイルヴァで読もう。", "You should move to Lost Irva to read this map.")
			goto *effect_end
		}
		txt lang("何かの場所を記した地図のようだ…", "There's a mark on the map...")
		snd SOUNDLIST_BOOK1
		gsel 4
		pos 0, 0
		picload exedir + "graphic\\paper.bmp", 1
		gsel 0
		redraw 0
		ww = 400
		wh = 300
		wx = (windoww - ww) / 2 + inf_screenx
		wy = winposy(wh)
		gmode 2
		pos wx, wy
		gcopy 4, 0, 0, ww, wh
		gmode 1, inf_tiles, inf_tiles
		repeat 5
			y = cnt + inv(INV_ITEM_PARAM2, ci) - 2
			sy = cnt * inf_tiles + wy + 26
			repeat 7
				x = cnt + inv(INV_ITEM_PARAM1, ci) - 3
				sx = cnt * inf_tiles + wx + 46
				p = map(x, y, 0)
				pos sx + 1, sy + 1
				gcopy 2, p \ 33 * inf_tiles, p / 33 * inf_tiles
				if ( x == inv(INV_ITEM_PARAM1, ci) ) {
					if ( y == inv(INV_ITEM_PARAM2, ci) ) {
						pos sx, sy
						font lang(cfg_font1, cfg_font2), 40 - en * 2, 2
						color 255, 20, 20
						mes lang("○", "O")
					}
				}
			loop
		loop
		gmode 2
		pos wx, wy
		gcopy 4, 400, 0, ww, wh
		redraw 1
		press
		snd SOUNDLIST_CARD1
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_LOVE | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= (-1) ) {
			if ( tc == CHARA_PLAYER ) {
				eatstatus efstatus, tc
			}
			else {
				txt lang("媚薬は呪われていた。" + name(tc) + "は" + name(CHARA_PLAYER) + "を軽蔑のまなざしで見つめた。", "This love potion is cursed. " + name(tc) + " look" + _s(tc) + " at " + name(CHARA_PLAYER) + " with a contemptuous glance.")
				modimp tc, -15
				modimp2 tc, -15
			}
			obvious = 0
			goto *effect_end
		}
		cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
		if ( potionspill | potionthrow ) {
			txt lang(name(tc) + "は恋の予感がした。", name(tc) + " sense" + _s(tc) + " a sigh of love.")
			if ( potionthrow != 90 ) {
				dmgcon tc, CONDITION_DIM, 100
				if ( cdata(CDATA_IMPRESSION, tc) < 100 ) {
					modimp tc, limit(efp / 20, 0, 15)
				}
			}
			if ( potionthrow == 90 ) {
				dmgcon tc, CONDITION_DIM, 100
			}
			if ( potionthrow != 90 ) {
				lovemiracle tc
			}
			if ( potionthrow != 90 ) {
				modimp2 tc, 10
			}
			goto *effect_end
		}
		if ( tc == CHARA_PLAYER ) {
			txt lang(name(tc) + "は興奮した！", "You are excited!")
		}
		else {
			txt lang(name(tc) + "は" + name(CHARA_PLAYER) + "を熱いまなざしで見つめた。", name(tc) + " give" + _s(tc) + " " + name(CHARA_PLAYER) + " the eye.")
			if ( potionthrow != 90 ) {
				lovemiracle tc
			}
			if ( potionthrow != 90 ) {
				dmgcon tc, CONDITION_DIM, 100
				if ( cdata(CDATA_IMPRESSION, tc) < 100 ) {
					modimp tc, limit(efp / 5, 0, 25)
				}
			}
			if ( potionthrow == 90 ) {
				dmgcon tc, CONDITION_DIM, 100
			}
			modimp2 tc, 10
		}
		if ( potionthrow != 90 ) {
			dmgcon tc, CONDITION_DIM, 500
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PREGNANT | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_ROVID ) {
					snd SOUNDLIST_AMMO
					txt lang(cdatan(CDATAN_NAME, cnt) + "「絶対防衛！」", cdatan(CDATAN_NAME, cnt) + " says: \"Absolute protect!\"")
					goto *effect_end
				}
			loop
		}
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は" + name(tc) + "の口の中に何かを送り込んだ！", name(cc) + " put" + _s(cc) + " something into " + name(tc) + your(tc) + " body!")
		}
		if ( cc == CHARA_PLAYER ) {
			ninsin = cdata(CDATA_INFANT, cc)
		}
		if ( cc != CHARA_PLAYER ) {
			ninsin = cdata(CDATA_ID, cc)
		}
		gosub *alien_effect
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PSYCHOANALYSIS | _switch_sw ) {
		_switch_sw = 0
		txt_targetwho
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
                    promptTagTeam
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				txt lang("あなたは" + name(tc) + "の心を覗いた。", "You look into " + name(tc) + "'s heart.")
				animeload ANIMATION_BLOOD, tc
				gosub *com_knowOther
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		if ( cc == CHARA_PLAYER ) {
			return
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MIRROR | _switch_sw ) {
		_switch_sw = 0
		txt lang("あなたは" + name(tc) + "の状態を調べた。", "You examine " + name(tc) + ".")
		animeload ANIMATION_BLOOD, tc
		gosub *com_knowSelf
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_MILK | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_ATK_ELEC
			if ( efstatus <= (-1) ) {
				if ( tc == CHARA_PLAYER ) {
					txt lang("うわ、これは呪われている。なんだかやばい味だ…", "Geee it's cursed! The taste is very dangerous.")
				}
				else {
					txtef COLOR_SKY_BLUE
					txt lang("「ぺっぺっ、まずー」", cnvtalk("Argh, the milk is cursed!"))
				}
			}
			else {
				if ( tc == CHARA_PLAYER ) {
					txt lang("濃厚で病み付きになりそうな味だ。", "The taste is very thick, almost addictive.")
				}
				else {
					txtef COLOR_SKY_BLUE
					txt lang("「うまー」", cnvtalk("Yummy!"))
				}
				if ( cdata(CDATA_SPRITE_SIZE_MILK, tc) <= (-1) & cdata(CDATA_HUNGER, tc) < 8000 ) {
					txtef COLOR_SKY_BLUE
					txt lang(name(tc) + "はすくすくと成長した。", name(tc) + " grew quickly.")
					if ( efstatus >= 0 ) {
						cdata(CDATA_SPRITE_SIZE_MILK, tc)++
						if ( cbit(CHARA_BIT_LIVESTOCK, tc) == 1 ) {
							modimp tc, 10
							modimp2 tc, 10
							cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 30
						}
					}
					if ( efstatus >= 1 ) {
						if ( cdata(CDATA_SPRITE_SIZE_MILK, tc) <= (-1) ) {
							cdata(CDATA_SPRITE_SIZE_MILK, tc)++
							if ( cbit(CHARA_BIT_LIVESTOCK, tc) == 1 ) {
								modimp tc, 10
								modimp2 tc, 10
							}
						}
					}
					if ( cdata(CDATA_HUNGER, tc) >= 8000 ) {
						txt lang("「げふぅ」", name(tc) + " muttered " + cnvtalk("Ugh-Ughu"))
					}
				}
			}
		}
		if ( efstatus >= 1 ) {
			modheight tc, rnd(5) + 1
		}
		if ( efstatus <= (-1) ) {
			modheight tc, (rnd(5) + 1) * (-1)
			if ( cdata(CDATA_SPRITE_SIZE_MILK, tc) >= (-4) ) {
				cdata(CDATA_SPRITE_SIZE_MILK, tc)--
				if ( cbit(CHARA_BIT_LIVESTOCK, tc) == 1 ) {
					modimp tc, -20
					modimp2 tc, -20
				}
			}
		}
		cdata(CDATA_HUNGER, tc) += 1000 * (120 / 100)
		if ( tc == CHARA_PLAYER ) {
			gosub *eat_finish
		}
		eatstatus efstatus, tc
		animeload ANIMATION_THROW, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_ALE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( efstatus <= (-1) ) {
				txtef COLOR_SKY_BLUE
				txtmore
				txt lang("「うぃっ…」", "*Hic*"), lang("「まずいぜ」", cnvtalk("Ah, bad booze.")), lang("「げー♪」", cnvtalk("Ugh...")), lang("「腐ったミルクみたいな味だ」", cnvtalk("Bah, smells like rotten milk."))
			}
			else {
				txtef COLOR_SKY_BLUE
				txtmore
				txt lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
			}
		}
		dmgcon tc, CONDITION_DRUNK, rnd(300) + 200
		eatstatus efstatus, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_KNEADED_SWEETS | _switch_sw ) {
		_switch_sw = 0
		if ( tc == CHARA_PLAYER ) {
			txt lang("う、美味すぎる！", "The taste is very thick!!")
		}
		else {
			txtef COLOR_SKY_BLUE
			txt lang("「うまいっ！！」", cnvtalk("Very yummy!"))
		}
		gosub *effect_elixer
		r1 = tc
		gosub *charaRefresh
		if ( synccheck(tc, -1) ) {
			txtmore
			txtef COLOR_PURPLE
			txt lang(name(tc) + "は気絶した。", name(tc) + " " + is(tc) + " dimmed.")
		}
		cdata(CDATA_CONDITION_DIM, tc) = 70
		rowactend tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_SOMA | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang("突然" + name(tc) + "は元気になった！", "In addition, " + his(tc) + " body is enchanted.")
			animeload ANIMATION_BLOOD, tc
		}
		p = SKILL_ATTR_STR, SKILL_ATTR_CON, SKILL_ATTR_DEX, SKILL_ATTR_CHA, SKILL_ATTR_SPD, SKILL_ATTR_LER, SKILL_ATTR_PER, SKILL_ATTR_MAG, SKILL_ATTR_WIL, SKILL_ATTR_LUC, -1
		repeat
			if ( p(cnt) == (-1) ) {
				break
			}
			i = p(cnt) + STARTING_CDATA_ATTR - STARTING_SKILL_ATTR
			if ( cdata(i, tc) < 0 ) {
				cdata(i, tc) = 0
			}
			cdata(i, tc) = sorg(p(cnt), tc) / 7 + 5
		loop
		healcon tc, CONDITION_SICK, 0
		if ( tc == CHARA_PLAYER ) {
			gdata(GDATA_SLEEP) = 0
			healsp CHARA_PLAYER, 200
		}
		r1 = tc
		gosub *charaRefresh
		dmgsan tc, 100
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_DISASTER | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_CURSE3
			animeload ANIMATION_CRUSH, tc
			txt lang("災いが" + name(tc) + "に降りかかった！", "A disaster has befallen " + name(tc) + "!")
		}
		dmgcon tc, CONDITION_SLEEP, 100 + limit(gdata(GDATA_LEVEL) * 2, 50, 400)
		dmgcon tc, CONDITION_POISON, 100 + limit(gdata(GDATA_LEVEL) * 2, 50, 400)
		dmgcon tc, CONDITION_PARALYZE, 100 + limit(gdata(GDATA_LEVEL) * 2, 50, 400)
		dmgcon tc, CONDITION_CONFUSE, 100 + limit(gdata(GDATA_LEVEL) * 2, 50, 400)
		dmgcon tc, CONDITION_BLIND, 100 + limit(gdata(GDATA_LEVEL) * 2, 50, 400)
		if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
			goto *effect_end
		}
		p = SKILL_ATTR_STR, SKILL_ATTR_CON, SKILL_ATTR_DEX, SKILL_ATTR_CHA, SKILL_ATTR_SPD, SKILL_ATTR_LER, SKILL_ATTR_PER, SKILL_ATTR_MAG, SKILL_ATTR_WIL, SKILL_ATTR_LUC, -1
		repeat
			if ( p(cnt) == (-1) ) {
				break
			}
			if ( encfind(tc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + p(cnt)) == (-1) ) {
				i = p(cnt) + STARTING_CDATA_ATTR - STARTING_SKILL_ATTR
				cdata(i, tc) = sorg(p(cnt), tc) * (-1) / 10 - 5
			}
		loop
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_NEKTAR | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang("ものすごい勢いで" + name(tc) + "の傷が消えていく…。", "The potion greatly heals " + name(tc) + ".")
		}
		healhp tc, cdata(CDATA_MAX_HP, tc) * 4 / 5 + 200
		cure_anorexia tc
		cdata(CDATA_VOMIT, tc) = 0
		dmgcon tc, CONDITION_DRUNK, rnd(1000) + 1000
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GOLDEN_MEAD | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は奇妙な感覚に襲われた…。", name(tc) + " became the oil covered.")
		}
		dmgcon tc, CONDITION_DRUNK, rnd(300) + 100
		skillexp SKILL_ATTR_LER, tc, 500
		if ( tc == CHARA_PLAYER ) {
			snd SOUNDLIST_ATK_MIND
			meadmap = 1
			homemapmode = 1
			cxbk = cdata(CDATA_X, CHARA_PLAYER)
			cybk = cdata(CDATA_Y, CHARA_PLAYER)
			gosub *home_setWallTile
			n = 0
			txtnew
			txt lang("移動キーで幽体を移動、キャンセルキーで幽体離脱終了。", "Movement keys to move current position, hit the cancel key to exit.")
			tlocinitx = cdata(CDATA_X, CHARA_PLAYER)
			tlocinity = cdata(CDATA_Y, CHARA_PLAYER)
			tile = 0
			repeat
				await
				homemakewall = 1
				gosub *findLocation
				if ( stat == (-1) ) {
					break
				}
				tlocinitx = tlocx
				tlocinity = tlocy
			loop
			homemapmode = 0
			cdata(CDATA_X, CHARA_PLAYER) = cxbk
			cdata(CDATA_Y, CHARA_PLAYER) = cybk
			meadmap = 0
			goto *effect_end
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_ESSENTIAL_OIL | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は、精油まみれになった。", name(tc) + " got covered in essential oil.")
			if ( tc == CHARA_PLAYER ) {
				txt lang("すごい臭いだ！", "So smelly!")
			}
		}
		dmgcon tc, CONDITION_CONFUSE, efp / 3 + 1
		cdata(CDATA_CONDITION_OIL, tc) += 30
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_GASOLINE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は、揮発油まみれになった。", name(tc) + " got covered in volatile oil.")
			if ( tc == CHARA_PLAYER ) {
				txt lang("すごい臭いだ！", "So smelly!")
			}
		}
		dmgcon tc, CONDITION_CONFUSE, efp / 3 + 1
		cdata(CDATA_CONDITION_OIL, tc) += 100
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_WISDOM | _switch_sw ) {
		_switch_sw = 0
		efid = SKILL_SPELL_HERO
		gosub *effect
		if ( potionthrow != 90 ) {
			waitbk = cfg_animewait
		}
		if ( potionthrow != 90 ) {
			if ( cfg_animewait > 0 ) {
				cfg_animewait = 0
			}
		}
		efid = SKILL_SPELL_GEM_POWER
		gosub *effect
		efid = SKILL_SPELL_CONCENTRATION
		gosub *effect
		efid = SKILL_SPELL_DIVINE_WISDOM
		gosub *effect
		if ( potionthrow != 90 ) {
			cfg_animewait = waitbk
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_SULFURIC | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt lang("ぐわぁぁ！", "Arrrrg!")
			}
			txt lang("酸が" + name(tc) + "を溶かした。", "The sulfuric acid melts " + name(tc) + ".")
		}
		if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
			cbitmod CHARA_BIT_PREGNANT, tc, 0
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の体内の異物は溶けた。", name(tc) + your(tc) + " child melts in " + his(tc) + " stomach.")
			}
			cdata(CDATA_INFANT, tc) = 0
			if ( tc == CHARA_PLAYER ) {
				spact(SKILL_SPACT_PREGNANT - STARTING_SKILL_SPACT) = 0
			}
		}
		dmghp tc, (rnd(efp / 10 + 5) + efp / 10) * efstatusfix(50, 100, 200, 300) / 100 + 1, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_AQUA_SANCTIO | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt lang("ぐわぁぁぁぁぁっ！！！", "Arrrrg!")
			}
		}
		aniref = 0
		animeid = ANIMATION_BALL
		anix = cdata(CDATA_X, tc)
		aniy = cdata(CDATA_Y, tc)
		gosub *anime
		ele = SKILL_NONE
		dmghp tc, rnd(efp + 1) + limit(sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * sdata(SKILL_NORMAL_ALCHEMY, cc) / 5, 100, 400000), cc, SKILL_RES_SOUND, 1000
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_WATER | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt lang("*ごくっ* 綺麗な水だ。", "*quaff* The water is refreshing.")
			}
			else {
				txt lang(" *ごくっ* ", " *quaff* ")
			}
		}
		sickifcursed efstatus, tc, 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_DISINFECTANT | _switch_sw ) {
		_switch_sw = 0
		txt name(tc) + lang("は消毒された。", " " + was(tc) + " disinfected.")
		healcon cnt, CONDITION_POISON, efstatusfix(5, 10, 20, 40) * 2
		healcon cnt, CONDITION_SICK, efstatusfix(5, 10, 20, 40) * 2
		addbuff tc, BUFF_DISINFECTION, 50, 3000
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_COLA | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang("「げふぅ」", "*Ughu*")
		}
		healsp tc, 15
		sickifcursed efstatus, tc, 1
		if ( rnd(2) == 0 ) {
			inv_find ITEM_ID_BIO_BATTERY, tc
			if ( stat == (-1) ) {
				cdata(CDATA_WEIGHT, tc)++
				txt lang(name(tc) + "は太った。", name(tc) + " gain" + _s(tc) + " weight.")
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_BARLEY_TEA | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt lang("*ごくっ* 血行が良くなりそうだ。", "*quaff* It seems to help my circulation.")
			}
			else {
				txt lang(" *ごくっ* ", " *quaff* ")
			}
		}
		skillexp SKILL_NORMAL_HEALING, tc, 200
		sickifcursed efstatus, tc, 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_SODA | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang("*シュワワ* 刺激的！", "*quaff* Refreshing!")
			txt lang(name(tc) + "のスタミナが少し回復した。", name(tc) + " restore" + _s(tc) + " some stamina.")
		}
		healsp tc, 25
		sickifcursed efstatus, tc, 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_CAPSULE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang("*ごくり*", " *quaff* ")
			txt lang(name(tc) + "のスタミナはかなり回復した。", name(tc) + " greatly restore" + _s(tc) + " stamina.")
		}
		healsp tc, 100
		sickifcursed efstatus, tc, 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_SALT | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SNAIL_THE_ANDROID_RIDER ) {
			txtef COLOR_SKY_BLUE
			txtmore
			txt lang("「アンチソルトシステム作動」", cnvtalk("Anti-salt system activated."))
			flt
			itemcreate -1, ITEM_ID_RICE_BALL, cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0
		}
		if ( cdatan(CDATAN_RACE, tc) == "snail" ) {
			if ( synccheck(tc, -1) ) {
				txtef COLOR_RED
				txtmore
				txt lang("塩だ！" + name(tc) + "は溶けはじめた！", "It's salt! " + name(tc) + " start" + _s(tc) + " to melt.")
			}
			if ( cdata(CDATA_HP, tc) > 10 ) {
				dmghp tc, cdata(CDATA_HP, tc) - rnd(10), DAMAGE_FROM_ACID
			}
			else {
				dmghp tc, rnd(20000), DAMAGE_FROM_ACID
			}
		}
		else {
			if ( synccheck(tc, -1) ) {
				txtef COLOR_SKY_BLUE
				txtmore
				txt lang("「しょっぱ〜」", cnvtalk("Salty!"))
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_DIRTY_WATER | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt lang("*ごくっ* まずい！", "*quaff* Yucky!")
			}
			else {
				txt lang(" *ごくっ* ", " *quaff* ")
			}
		}
		sickifcursed efstatus, tc, 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_ACTIVE_PICKPOCKET | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_QUEST) == QUEST_TYPE_CONQUER | gdata(GDATA_QUEST) == QUEST_TYPE_HUNTEX ) {
			txt lang("そんなことをしている余裕はない！", "You have no time for it!")
			return 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					ens = 0
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
		}
		invsubroutine = 1
		invctrl = 27, 0
		snd SOUNDLIST_INV
		gosub *com_inventory
		goto *effect_end
	}
	if ( _switch_val == SKILL_ACTIVE_RIDING | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					ens = 0
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
		}
		if ( gdata(GDATA_RIDER) != 0 ) {
			if ( tc == cc ) {
				cell_findspace cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
				if ( stat == 0 ) {
					txt lang("降りるスペースがない。", "There's no place to get off.")
					goto *effect_end
				}
				cell_setchara gdata(GDATA_RIDER), rtval, rtval(1)
				if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 0 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "から降りた。", "You dismount from " + name(gdata(GDATA_RIDER)) + ".")
				}
				if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 1 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "はあなたから降りた。", name(gdata(GDATA_RIDER)) + " dismounts from you.")
				}
				if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 0 ) {
					customtalk gdata(GDATA_RIDER), DBMODE_FLAVOR_RIDE_OFF
					gosub *convert_word
					if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							txt name(gdata(GDATA_RIDER)) + "「ふぅ」", name(gdata(GDATA_RIDER)) + "「乗り心地はよかった？」", name(gdata(GDATA_RIDER)) + "「疲れた…」", name(gdata(GDATA_RIDER)) + "「またいつでも乗ってね♪」"
						}
						if ( en ) {
							txt name(gdata(GDATA_RIDER)) + " " + cnvtalk("Phew."), name(gdata(GDATA_RIDER)) + " " + cnvtalk("How was my ride?"), name(gdata(GDATA_RIDER)) + " " + cnvtalk("Tired...tired..."), name(gdata(GDATA_RIDER)) + " " + cnvtalk("It was nice.")
						}
					}
				}
				if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 1 ) {
					customtalk gdata(GDATA_RIDER), DBMODE_FLAVOR_RIDE_OFF_PC
					gosub *convert_word
					if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							txt name(gdata(GDATA_RIDER)) + "「よいしょ」", name(gdata(GDATA_RIDER)) + "「乗り心地よかった！」", name(gdata(GDATA_RIDER)) + "「疲れた？」", name(gdata(GDATA_RIDER)) + "「また乗りたいな♪」"
						}
						if ( en ) {
							txt name(gdata(GDATA_RIDER)) + " " + cnvtalk("Phew."), name(gdata(GDATA_RIDER)) + " " + cnvtalk("How was my ride?"), name(gdata(GDATA_RIDER)) + " " + cnvtalk("Tired...tired..."), name(gdata(GDATA_RIDER)) + " " + cnvtalk("It was nice.")
						}
					}
				}
				cdata(CDATA_RIDING, gdata(GDATA_RIDER)) = 0
				ride_end
				goto *effect_end
			}
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			snd SOUNDLIST_FAIL1
			txtef COLOR_RED
			txt lang("タッグを解散する必要がある。", "You need to dissolve the tag-team.")
			goto *effect_end
		}
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt lang("仲間にしか騎乗できない。", "You can only ride an ally.")
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_BODYGUARD, tc) == 1 | cbit(CHARA_BIT_GUARD_TEMP, tc) == 1 ) {
			txt lang("護衛対象には騎乗できない。", "You can't ride a client.")
			goto *effect_end
		}
		if ( tc == cc ) {
			if ( gdata(GDATA_RIDER) == 0 ) {
				txt lang(name(cc) + "は自分に乗ろうとした。", "You try to ride yourself.")
			}
			goto *effect_end
		}
		if ( cdata(CDATA_AREA, tc) != AREA_NONE ) {
			txt lang("その仲間はこの場所に滞在中だ。", "The ally currently stays in this area.")
			goto *effect_end
		}
		if ( gdata(GDATA_RIDER) != 0 ) {
			if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 0 ) {
				txt lang("現在" + name(cc) + "は" + name(gdata(GDATA_RIDER)) + "に騎乗している。", name(cc) + " " + is(cc) + " currently riding " + name(gdata(GDATA_RIDER)) + ".")
			}
			if ( cdata(CDATA_RIDING, gdata(GDATA_RIDER)) == 1 ) {
				txt lang("現在" + name(cc) + "は" + name(gdata(GDATA_RIDER)) + "を乗せている。", name(gdata(GDATA_RIDER)) + " " + is(gdata(GDATA_RIDER)) + " currently riding " + name(cc) + ".")
			}
		}
		else {
			txtsetride 3
			repeat 3
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 1
			gosub *prompt_key
			if ( stat == 0 | rtval == 0 ) {
				goto *effect_end
			}
			if ( rtval == 1 ) {
				cdata(CDATA_RIDING, tc) = 0
			}
			if ( rtval == 2 ) {
				cdata(CDATA_RIDING, tc) = 1
			}
			if ( cdata(CDATA_RIDING, tc) == 0 ) {
				customtalk tc, DBMODE_FLAVOR_RIDE_ON
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt name(tc) + "「うぐぅ」", name(tc) + "「ダイエットしてよ…」", name(tc) + "「いくよ！」", name(tc) + "「やさしくしてね♪」"
					}
					if ( en ) {
						txt name(tc) + " " + cnvtalk("Awww."), name(tc) + " " + cnvtalk("You should go on a diet."), name(tc) + " " + cnvtalk("Let's roll!"), name(tc) + " " + cnvtalk("Be gentle.")
					}
				}
			}
			if ( cdata(CDATA_RIDING, tc) == 1 ) {
				customtalk tc, DBMODE_FLAVOR_RIDE_ON_PC
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt name(tc) + "「" + cdatan(CDATAN_AKA, CHARA_PLAYER) + "、" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "にライド！」", name(tc) + "「重くない？」", name(tc) + "「あんまり揺らさないでね」", name(tc) + "「レッツゴー♪」"
					}
					if ( en ) {
						txt name(tc) + " " + cnvtalk("Awww."), name(tc) + " " + cnvtalk("You should go on a diet."), name(tc) + " " + cnvtalk("Let's roll!"), name(tc) + " " + cnvtalk("Be gentle.")
					}
				}
			}
			ride_begin tc
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_NORMAL_PERFORMER | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			f = 0
			inv_getheader cc
			repeat invrange, invhead
				if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
					continue
				}
				if ( inv(INV_ITEM_SKILL_REF, cnt) == SKILL_NORMAL_PERFORMER ) {
					ci = cnt
					f = 1
					break
				}
				if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_MELODYUS ) {
					ci = cnt
					f = 1
					break
				}
			loop
			if ( f == 0 ) {
				return 0
			}
		}
		if ( sdata(SKILL_NORMAL_PERFORMER, cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は演奏のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to play an instrument.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					ens = 0
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
		}
		gosub *perform
		goto *effect_end
	}
	if ( _switch_val == SKILL_NORMAL_COOKING | _switch_sw ) {
		_switch_sw = 0
		cooktool = ci
		invsubroutine = 1
		invctrl = 16
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 0 ) {
			return 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					ens = 0
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
		}
		gosub *item_cook
		goto *effect_end
	}
	if ( _switch_val == SKILL_NORMAL_FISHING | _switch_sw ) {
		_switch_sw = 0
		if ( sdata(SKILL_NORMAL_FISHING, CHARA_PLAYER) == 0 ) {
			txt lang("釣りの仕方を知らない。", "You don't know how to fish.")
			return 0
		}
		if ( inv_getspace() == 0 ) {
			txt_invfull
			return 0
		}
		if ( inv(INV_ITEM_CHARGE, ci) == 0 ) {
			txt lang("釣竿には餌が付いていない。", "You need a bait to fish.")
			return 0
		}
		f = 0
		repeat 3
			y = cdata(CDATA_Y, cc) + cnt - 1
			x = cdata(CDATA_X, cc)
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			if ( chipm(CHIPM_ROLE, map(x, y, 0)) == MAP_CHIP_ROLE_WATER ) {
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			repeat 3
				y = cdata(CDATA_Y, cc)
				x = cdata(CDATA_X, cc) + cnt - 1
				if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
					continue
				}
				if ( chipm(CHIPM_ROLE, map(x, y, 0)) == MAP_CHIP_ROLE_WATER ) {
					f = 1
					break
				}
			loop
		}
		if ( f == 0 ) {
			msgdup++
			txt lang("釣りをする場所が見当たらない。", "This isn't a good place to fish.")
			gosub *screen_draw
			return 0
		}
		if ( chipm(CHIPM_ROLE, map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0)) == MAP_CHIP_ROLE_WATER ) {
			txt lang("水の中からは釣れない。", "You can't fish while swimming.")
			gosub *screen_draw
			return 0
		}
		if ( cdata(CDATA_X, CHARA_PLAYER) - x > 0 ) {
			cdata(CDATA_DIR, CHARA_PLAYER) = 1
		}
		if ( cdata(CDATA_X, CHARA_PLAYER) - x < 0 ) {
			cdata(CDATA_DIR, CHARA_PLAYER) = 2
		}
		if ( cdata(CDATA_Y, CHARA_PLAYER) - y > 0 ) {
			cdata(CDATA_DIR, CHARA_PLAYER) = 3
		}
		if ( cdata(CDATA_Y, CHARA_PLAYER) - y < 0 ) {
			cdata(CDATA_DIR, CHARA_PLAYER) = 0
		}
		gdata(GDATA_RUN_DIR) = cdata(CDATA_DIR, CHARA_PLAYER)
		fishx = x
		fishy = y
		addefmap fishx, fishy, 1, 3
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
				if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
					txt_exhausted
					dmgsp CHARA_PLAYER, sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
					ens = 0
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(sdataref(SKILL_DATAREF_COST, efid) / 2 + 1) + sdataref(SKILL_DATAREF_COST, efid) / 2 + 1
		}
		turi = ci
		item_separate ci
		item_find ITEM_ID_SUPER_LURE, ITEM_FIND_MODE_DBID
		if ( stat == (-1) ) {
			txt lang("何時間釣ろうか？", "How many hours do you fish?")
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, 6
			inputlog = "" + 1
			gosub *prompt_word
			in = int(inputlog)
			tulihun = gdata(GDATA_MIN)
			tulimit = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + in
		}
		rowactre = 0
		gosub *fishing
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_HOLY_LIGHT | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
			}
			goto *spUncurse_cursed
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			p = 0
			repeat MAX_BLESSINGS + MAX_HEXES
				i = MAX_BLESSINGS + MAX_HEXES - cnt - 1
				if ( efid == SKILL_SPELL_HOLY_LIGHT ) {
					if ( p >= 1 ) {
						break
					}
				}
				if ( bdataref(0, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != 2 ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == 0 ) {
					continue
				}
				if ( rnd(efp * 2 + 1) > rnd(cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF + 1, tc) + 1) ) {
					delbuff tc, i
					p++
					continue cnt
				}
			loop
			animeload ANIMATION_HEAL_FAST, tc
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_VANQUISH_HEX | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			tc = cc
		}
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
			}
			goto *spUncurse_cursed
		}
		p = 0
		repeat MAX_BLESSINGS + MAX_HEXES
			i = MAX_BLESSINGS + MAX_HEXES - cnt - 1
			if ( efid == SKILL_SPELL_HOLY_LIGHT ) {
				if ( p >= 1 ) {
					break
				}
			}
			if ( bdataref(0, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != 2 ) {
				continue
			}
			if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
				continue
			}
			if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == 0 ) {
				continue
			}
			if ( rnd(efp * 2 + 1) > rnd(cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF + 1, tc) + 1) ) {
				delbuff tc, i
				p++
				continue cnt
			}
		loop
		animeload ANIMATION_HEAL_FAST, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_ELIXER | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang(name(tc) + "は黄金の輝きに包まれた！", "A golden aura envelops " + name(tc) + "!")
		gosub *effect_elixer
		animeid = ANIMATION_HEAL
		gosub *anime
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_CREATE_MATERIAL | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( efstatus >= 0 ) {
			s = lang("素材", "materials")
		}
		else {
			s = lang("クズ", "junks")
		}
		snd SOUNDLIST_DING2
		txt lang("たくさんの" + s + "が降ってきた！", "Some " + s + " fall from above!")
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		repeat rnd(3) + 3 + (efstatus >= 1) * 6
			txtmore
			atxspot = ATX_GENERAL1
			if ( rnd(10) == 0 ) {
				atxspot = ATX_REMAIN1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_MINE1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_BUSH1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_DUNGEON1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_BUILDING1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_WATER1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_FIELD1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_FOREST1
			}
			if ( efstatus >= 0 ) {
				p = random_material(efp / 10, efp / 50)
			}
			else {
				p = 0
			}
			matgetmain p, 1
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_MUTATION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, cc) == CREATURE_ID_SPIRAL_KING ) {
			goto *effect_end
		}
		if ( cdata(CDATA_ID, cc) == CREATURE_ID_BADGER | (cdata(CDATA_ID, cc) == CREATURE_ID_METAMORPHOSE & cdata(CDATA_ALLIED, cc) == 100) ) {
			if ( cdata(CDATA_ALLIED, cc) == 0 ) {
				efid = SKILL_SPELL_TELEPORT
				gosub *effect
			}
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cnt == CHARA_PLAYER ) {
					continue
				}
				if ( cbit(CHARA_BIT_PCC, cnt) == 1 ) {
					continue
				}
				if ( rnd(2) == 0 ) {
					continue
				}
				if ( cnt != (-1) ) {
					cdata(CDATA_PIC, cc) = cdata(CDATA_PIC, cnt)
				}
			loop
			goto *effect_end
		}
		if ( tc != CHARA_PLAYER ) {
			goto *jump_changeCreature
		}
		txt lang("あなたは自分自身が変わっていくのを感じた。", "You feel yourself changing.")
		val = 0
		goto *com_aka
	}
	if ( _switch_val == SKILL_EFFECT_MUTATE | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_MUTATION | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_POTION_EVOLUTION | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			goto *jump_changeCreature
		}
		if ( efid == SKILL_SPACT_EYE_OF_MUTATION ) {
			txtmore
			txt_check 0
			txt lang(name(cc) + "は" + name(tc) + "を気の狂いそうな眼差しで見た。", name(cc) + " cast" + _s(cc) + " an insane glance on " + name(tc) + ".")
			if ( rnd(3) ) {
				goto *effect_end
			}
			txtmore
		}
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( encfind(tc, ENCHANT_RES_MUTATION) != (-1) ) {
			if ( rnd(5) ) {
				txt lang("あなたは変異を受け付けなかった。", "You resist the threat of mutation.")
				goto *effect_end
			}
		}
*delMutation_cursed
		f = 0
		p = 1
		if ( efid == SKILL_EFFECT_POTION_EVOLUTION ) {
			p = 2 + rnd(3)
		}
		repeat p
			repeat 100
				tid = rnd(MAX_NORMAL_TRAIT)
				traitmode = 0
				gosub *trait_ref
				if ( stat == 0 | traitref != 1 ) {
					continue
				}
				if ( rnd(2) ) {
					p = 1
				}
				else {
					p = -1
				}
				if ( trait(tid) >= traitref(2) ) {
					p = -1
				}
				if ( trait(tid) <= traitref(1) ) {
					p = 1
				}
				if ( efstatus <= (-1) ) {
					if ( p == 1 ) {
						continue
					}
				}
				else {
					if ( p == (-1) ) {
						if ( efstatus >= 1 ) {
							if ( rnd(3) == 0 ) {
								continue
							}
						}
						if ( efid == SKILL_EFFECT_POTION_EVOLUTION ) {
							continue
						}
					}
				}
				trait(tid) += p
				txt lang("あなたは変容した！ ", "You mutate.")
				if ( p > 0 ) {
					txtef COLOR_GREEN
					txt traitrefn(0)
				}
				else {
					txtef COLOR_RED
					txt traitrefn(1)
				}
				animeload ANIMATION_FIZZLE, CHARA_PLAYER
				f = 1
				break
			loop
		loop
		if ( f == 0 ) {
			txt_nothinghappens
			obvious = 0
		}
		r1 = CHARA_PLAYER
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_LOSE_MUTATION | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt lang("これは呪われている！", "It's cursed!")
			}
			goto *delMutation_cursed
		}
		f = 0
		repeat 1 + (efstatus >= 1) + (efstatus >= 0) + rnd(2)
			repeat 100
				tid = rnd(MAX_TRAIT)
				traitmode = 0
				gosub *trait_ref
				if ( stat == 0 | traitref != 1 ) {
					continue
				}
				if ( trait(tid) == 0 ) {
					continue
				}
				if ( trait(tid) > 0 ) {
					p = -1
				}
				if ( trait(tid) < 0 ) {
					p = 1
				}
				trait(tid) = 0
				txt lang("あなたは元の自分に近づいた気がした。", "You are now one step closer to your normal self.")
				if ( p > 0 ) {
					txtef COLOR_GREEN
					txt traitrefn(0)
				}
				else {
					txtef COLOR_RED
					txt traitrefn(1)
				}
				f = 1
				break
			loop
		loop
		if ( f == 0 ) {
			txt_nothinghappens
			obvious = 0
		}
		r1 = CHARA_PLAYER
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_IDENTIFY | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 13
		snd SOUNDLIST_INV
		gosub *com_inventory
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_RESURRECTION | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		f = get_freeallyne()
		if ( f == 0 ) {
			txt lang("仲間の最大数に達しているため、呼び戻せない。", "Your party is full. You can't invite anyone else.")
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			txt lang("冥界から死霊が呼び出された！", "Hordes of undead arise from hell!")
			repeat 4 + rnd(4)
				flt calcobjlv(cdata(CDATA_LEVEL, CHARA_PLAYER)), calcfixlv(FIX_QUALITY_GREAT)
				fltn "undead"
				characreate -1, CREATURE_ID_BUG, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			loop
			obvious = 0
			goto *effect_end
		}
		allyctrl = 2
		gosub *com_listNpc
		if ( stat == (-1) ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( cdata(CDATA_CAN_REVIVE, stat) <= 0 ) {
			txt lang("マップを切替えるまで復活できない。", "It can not be revived until you switch area.")
			goto *effect_end
		}
		if ( bonus < rnd(100) ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "の力は冥界に及ばなかった。", name(cc) + your(cc) + " prayer doesn't reach the underworld.")
			}
			goto *effect_end
		}
		rc = stat
		gosub *resurrect
		cxinit = cdata(CDATA_X, cc)
		cyinit = cdata(CDATA_Y, cc)
		gosub *place_chara
		cdata(CDATA_AREA, rc) = AREA_NONE
		txtef COLOR_YELLOW
		txt cnven(cdatan(CDATAN_NAME, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
		txt lang("「ありがとう！」", cnvtalk("Thanks!"))
		cdata(CDATA_CAN_REVIVE, rc)--
		animeid = ANIMATION_HOLY
		animode = 100 + rc
		gosub *anime
		snd SOUNDLIST_PRAY2
		cdata(CDATA_EMO_ICON, rc) = 17 + 100 * 3
		if ( cc == CHARA_PLAYER ) {
			modimp rc, 15
			if ( rc >= MAX_CHARA_FOLLOWER ) {
				modkarma CHARA_PLAYER, 2
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_UNCURSE | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus == 0 ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の装備品は白い光に包まれた。", his2(tc) + your2(tc) + " equipment is surrounded by a white aura.")
			}
		}
		if ( efstatus >= 1 ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は聖なる光に包み込まれた。", name(tc) + " " + is(tc) + " surrounded by a holy aura.")
			}
		}
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
			}
			goto *spUncurse_cursed
		}
		inv_getheader tc
		p(1) = 0, 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_STATUS, cnt) >= ITEM_STATUS_NORMAL ) {
				continue
			}
			ci = cnt
			p = 0
			if ( inv(INV_ITEM_STATUS, ci) == ITEM_STATUS_CURSED ) {
				p = rnd(200) + 1
			}
			if ( inv(INV_ITEM_STATUS, ci) == ITEM_STATUS_DOOMED ) {
				p = rnd(1000) + 1
			}
			if ( efstatus >= 1 ) {
				p = p / 2 + 1
			}
			else {
				if ( inv(INV_ITEM_EQUIP, ci) == 0 ) {
					continue
				}
			}
			if ( p != 0 ) {
				if ( efp >= p ) {
					p(1)++
					inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
					item_stack tc, ci, 1
				}
				else {
					p(2)++
				}
			}
		loop
		if ( efstatus >= 1 ) {
			if ( p(1) != 0 ) {
				if ( synccheck(tc, -1) ) {
					txt lang("幾つかのアイテムが浄化された。", "The aura uncurses some " + his(tc) + " stuff.")
				}
			}
		}
		else {
			if ( p(1) != 0 ) {
				if ( synccheck(tc, -1) ) {
					txt lang("身に付けている装備の幾つかが浄化された。", "The aura uncurses some of " + his(tc) + " equipment.")
				}
			}
		}
		if ( p(2) != 0 ) {
			if ( synccheck(tc, -1) ) {
				txt lang("幾つかのアイテムは抵抗した。", "Several items resist the aura and remain cursed.")
			}
		}
		if ( p(1) == 0 & p(2) == 0 ) {
			txt_nothinghappens
			obvious = 0
		}
		else {
			animeload ANIMATION_BLOOD, tc
		}
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_ORACLE | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			artifactlocation = ""
			txt lang("何かがあなたの耳元でささやいたが、あなたは聞き取ることができなかった。", "You hear a sepulchral whisper but the voice is too small to distinguish a word.")
			goto *effect_end
		}
		if ( artifactlocation == "" ) {
			txt lang("まだ特殊なアイテムは生成されていない。", "No artifacts have been generated yet.")
		}
		else {
			notesel artifactlocation
			repeat noteinfo(0)
				noteget s, 0
				txt cnven(s)
				notedel 0
			loop
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_SPELL | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		f = 0
		repeat 1 + (efstatus >= 1)
			cnt2 = cnt
			repeat 2000
				await
				p = rnd(MAX_SPELL - STARTING_SKILL_SPELL) + STARTING_SKILL_SPELL
				if ( p == SKILL_SPELL_WISH ) {
					if ( rnd(10) ) {
						continue
					}
				}
				if ( efstatus >= 0 ) {
					if ( sdataref(SKILL_DATAREF_USE, p) != 0 ) {
						if ( cnt2 == 0 ) {
							s = lang("突然、", "Suddenly, ")
						}
						else {
							s = lang("さらに、", "Futhermore, ")
						}
						skillgain CHARA_PLAYER, p, 1, 100 * 2
						txtef COLOR_GREEN
						txt lang(s + name(CHARA_PLAYER) + "は" + skillname(p) + "の魔法の知識を得た。", s + "you gain knowledge of a spell, " + skillname(p) + ".")
						snd SOUNDLIST_DING2
						f = 1
						break
					}
				}
				else {
					p = p - STARTING_SKILL_SPELL
					if ( spell(p) > 0 ) {
						spell(p) = 0
						txt lang("これは呪われている！", "It's cursed!")
						txtef COLOR_RED
						txt lang("突然、" + name(CHARA_PLAYER) + "は" + skillname(p + STARTING_SKILL_SPELL) + "の魔法の知識を失った。", "Suddenly, you lose knowledge of a spell, " + skillname(p + STARTING_SKILL_SPELL) + ".")
						snd SOUNDLIST_CURSE3
						animeload ANIMATION_CRUSH, CHARA_PLAYER
						f = 1
						break
					}
				}
			loop
		loop
		if ( f == 0 ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_DESCENT | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= 0 ) {
			if ( cdata(CDATA_LEVEL, tc) <= 1 ) {
				txt_nothinghappens
				obvious = 0
				goto *effect_end
			}
			cdata(CDATA_LEVEL, tc)--
			cdata(CDATA_EXP, tc) = 0
			r1 = tc
			gosub *calcExpToNextLevel
			txtef COLOR_PURPLE
			txt lang(name(tc) + "のレベルが下がった…", name(tc) + " lose" + _s(tc) + " a level...")
		}
		else {
			cdata(CDATA_EXP, tc) = cdata(CDATA_EXP_TO_NEXT_LVL, tc)
			r1 = tc
			r2 = 0
			gosub *calcLevelUp
			if ( cbit(CHARA_BIT_LIVESTOCK, r1) != 1 ) {
				if ( synccheck(tc, -1) ) {
					snd SOUNDLIST_DING1
				}
			}
			else {
				txt lang(name(tc) + "のレベルは上がらない…", name(tc) + " cannot gain a level...")
			}
		}
		if ( efstatus <= (-1) ) {
			txt lang("これは呪われている！", "It's cursed!")
			repeat STARTING_SKILL_RESIST - STARTING_SKILL_ATTR, STARTING_SKILL_ATTR
				if ( rnd(3) == 0 ) {
					if ( cnt <= 17 ) {
						if ( sdata(cnt, tc) != 0 ) {
							skillexp cnt, tc, -1000
						}
					}
				}
			loop
			animeload ANIMATION_FIZZLE, tc
		}
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_SKILL | _switch_sw ) {
		_switch_sw = 0
		repeat
			await
			p = rnd(STARTING_SKILL_SPELL - STARTING_SKILL_WEAPON) + STARTING_SKILL_WEAPON
			if ( sdataref(SKILL_DATAREF_USE, p) != 0 ) {
				if ( efstatus >= 0 ) {
					if ( cnt < efstatusfix(0, 0, 100, 2000) ) {
						if ( sdata(p, tc) != 0 ) {
							continue
						}
					}
					skillgain tc, p, 1
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_DING2
						txtef COLOR_GREEN
						txt lang("" + name(tc) + "は" + skillname(p) + "の技術を獲得した！", name(tc) + " gain" + _s(tc) + " a skill of " + skillname(p) + "!")
					}
					break
				}
				else {
					if ( sdata(p, tc) == 0 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_CURSE1
						txt lang("これは呪われている！", "It's cursed!")
					}
					skillexp p, tc, -1000
					break
				}
			}
		loop
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_FAITH | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_EYTH ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			txt lang("あなたの神はあなたの信仰に疑問を抱いた。", "Your god doubts your faith.")
			snd SOUNDLIST_CURSE3
			animeload ANIMATION_CRUSH, CHARA_PLAYER
			skillexp SKILL_NORMAL_FAITH, CHARA_PLAYER, -1000
			goto *effect_end
		}
		if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_EYTH ) {
			txt_nothinghappens
			obvious = 0
		}
		else {
			txtef COLOR_GREEN
			txt lang("あなたは" + godname(cdata(CDATA_GOD, CHARA_PLAYER)) + "の暖かい眼差しを感じた。", "You feel as if " + godname(cdata(CDATA_GOD, CHARA_PLAYER)) + " is watching you.")
			if ( efstatus >= 1 ) {
				txt lang("空から三つ葉のクローバーがふってきた。", "A three-leaved clover falls from the sky.")
			}
			animeid = ANIMATION_HOLY
			animode = 100 + tc
			gosub *anime
			snd SOUNDLIST_PRAY2
			cdata(CDATA_PRAY, CHARA_PLAYER) += 500
			modpiety 75
			skillexp SKILL_NORMAL_FAITH, CHARA_PLAYER, 1000 + (efstatus >= 1) * 750, 6, 1000
		}
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_SCROLL_OF_WITCHCRAFT | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) < 100 | gdata(GDATA_FLAG_GAME_MODE) == 2 | gdata(GDATA_FLAG_GAME_MODE) == 5 ) {
			txt lang("あなたはスペルボーナスを獲得した。", "You gain 5 spell bonus points.")
		}

    	/********** ORIGINAL - BEGINNING ********** // Remove skill bonus limit.

		if ( gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) >= 100 ) {
			if ( gdata(GDATA_FLAG_GAME_MODE) != 2 & gdata(GDATA_FLAG_GAME_MODE) != 5 ) {
				gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) -= 5
				gdata(GDATA_FLAG_SPELL_BONUS_OBTAINED) -= 5
			}
		}

    	 ********** ORIGINAL - ENDING **********/

		gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) += 5
		gdata(GDATA_FLAG_SPELL_BONUS_OBTAINED) += 5

    	/********** ORIGINAL - BEGINNING ********** // Remove skill bonus limit.

		if ( gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) >= 100 ) {
			if ( gdata(GDATA_FLAG_GAME_MODE) != 2 & gdata(GDATA_FLAG_GAME_MODE) != 5 ) {
				snd SOUNDLIST_CHIME
				txtef COLOR_RED
				txt lang("注意！スペルボーナスは100以上あると新たに獲得できない。", "Caution! While the spell bonus is 100 or more, you cannot get new.")
			}
		}

    	 ********** ORIGINAL - ENDING **********/

		snd SOUNDLIST_PRAY2
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_GROWTH | _switch_sw ) {
		_switch_sw = 0
		repeat STARTING_SKILL_SPELL - STARTING_SKILL_WEAPON, STARTING_SKILL_WEAPON
			await
			if ( sdataref(SKILL_DATAREF_USE, cnt) != SKILL_NONE ) {
				if ( sorg(cnt, tc) == 0 ) {
					continue
				}
				modgrowth tc, cnt, efp * efstatusfix(-3, -2, 4, 5) / 150
			}
		loop
		if ( efstatus >= 0 ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_DING2
				txtef COLOR_GREEN
				txt lang(name(tc) + "のスキルの潜在能力が上昇した。", "The potentials of " + name(tc) + your(tc) + " skills increase" + _s(tc) + ".")
			}
		}
		else {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_CURSE3
				txtef COLOR_RED
				txt lang(name(tc) + "のスキルの潜在能力が減少した。", "The potentials of " + name(tc) + "'s skills decreases.")
			}
		}
		r1 = tc
		gosub *charaRefresh
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_DECREASE_STAT | _switch_sw ) {
		_switch_sw = 0
		i = rnd(20 - 10) + 10
		skillexp i, tc, efstatusfix(-2000, -2000, -1000, -250)
		animeid = ANIMATION_CURSE
		gosub *anime
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_SPEED | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(tc) + "の血は沸きあがるように熱くなった。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
		if ( tc == CHARA_PLAYER ) {
			skillmod SKILL_ATTR_SPD, CHARA_PLAYER, efstatusfix(-4000, -1000, 1000 * 6, 1000 * 8)
		}
		else {
			skillmod SKILL_ATTR_SPD, tc, efstatusfix(-4000, -1000, 1000 * 15, 1000 * 20)
		}
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_SPEED_2 | _switch_sw ) {
		_switch_sw = 0
		skillmod SKILL_ATTR_SPD, tc, 1000
		txt lang("さらに" + name(tc) + "の速度の潜在能力が最大まで回復した。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
		modgrowth tc, SKILL_ATTR_SPD, 400
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_POTENTIAL | _switch_sw ) {
		_switch_sw = 0
		procid = (procid + 1) \ 4
		proclist(procid) = "efPotential:Begin" + " ct:" + ct
		if ( efstatus >= 1 ) {
			repeat (STARTING_SKILL_ATTR + MAX_SKILL_ATTR_BASIC) - STARTING_SKILL_ATTR, STARTING_SKILL_ATTR
				modgrowth tc, cnt, 100
			loop
			txt lang(name(tc) + "の全ての能力の潜在能力が上昇した。", name(tc) + your(tc) + " potential of every attribute expands.")
			animeid = ANIMATION_HOLY
			animode = 100 + tc
			gosub *anime
			snd SOUNDLIST_DING3
		}
		else {
			i = rnd((STARTING_SKILL_ATTR + MAX_SKILL_ATTR_BASIC) - STARTING_SKILL_ATTR) + STARTING_SKILL_ATTR
			valn = skillname(i)
			if ( efstatus == 0 ) {
				txt lang(name(tc) + "の" + valn + "の潜在能力が上昇した。", name(tc) + your(tc) + " potential of " + valn + " expands.")
				modgrowth tc, i, 100
				snd SOUNDLIST_DING2
			}
			else {
				txt lang(name(tc) + "の" + valn + "の潜在能力が減少した。", name(tc) + your(tc) + " potential of " + valn + " decreases.")
				modgrowth tc, i, (rnd(sgrowth(i, tc) / 10 + 10) + 1) * (-1)
				snd SOUNDLIST_CURSE3
			}
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}
		procid = (procid + 1) \ 4
		proclist(procid) = "efPotential:End" + " ct:" + ct
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_VANISH | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_PET_ARENA | gdata(GDATA_AREA) == AREA_SHOW_HOUSE | gdata(GDATA_AREA) == AREA_ARENA ) {
			goto *effect_end
		}
		if ( tc < 57 ) {
			goto *effect_end
		}
		if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) == tc ) {
			goto *effect_end
		}
		if ( gdata(GDATA_FLAG_DUEL_TARGET) == tc ) {
			goto *effect_end
		}
		if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_LIVESTOCK, tc) == 1 ) {
			goto *effect_end
		}
		txt lang(name(tc) + "は消え去った。", name(tc) + " vanish" + _s(tc, 1) + ".")
		chara_vanquish tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_SENSE_OBJECT | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_MAGIC_MAP | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		p = 1
		if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
			p = 2
		}
		repeat p
			repeat mdata(MDATA_HEIGHT)
				y = cnt
				repeat mdata(MDATA_WIDTH)
					x = cnt
					p = dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), x, y)
					if ( efstatus <= (-1) ) {
						if ( efid == SKILL_SPELL_MAGIC_MAP ) {
							map(x, y, 2) = tile_default
						}
						if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
							map(x, y, 5) = 0
						}
						continue
					}
					if ( p <= 7 | rnd(efp + 1) > rnd(p * 8 + 1) | efstatus >= 1 ) {
						if ( efid == SKILL_SPELL_MAGIC_MAP ) {
							map(x, y, 2) = map(x, y, 0)
						}
						if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
							if ( map(x, y, 6) != 0 | map(x, y, 5) != 0 | map(x, y, 1) != 0 | map(x, y, 4) != 0 ) {
								map(x, y, 2) = map(x, y, 0)
							}
						}
					}
				loop
			loop
		loop
		if ( efstatus <= (-1) ) {
			txt lang("あれ…？あなたは軽い記憶障害を受けた。", "Hmm? You suffer minor memory defect.")
		}
		else {
			if ( efid == SKILL_SPELL_MAGIC_MAP ) {
				txt lang(name(tc) + "は周囲の地形を察知した。", name(tc) + " sense" + _s(tc) + " nearby locations.")
			}
			if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
				txt lang(name(tc) + "は周囲の物質を感知した。", name(tc) + " sense" + _s(tc) + " nearby objects.")
			}
		}
		if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
			gdata(GDATA_SENSE_OBJECT) = 10
		}
		animeload ANIMATION_BLOOD, tc
		redraw 0
		gosub *screen_raderRefresh
		if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
			if ( efstatus > (-1) ) {
				repeat 13
					y = cdata(CDATA_Y, tc) + cnt - 5
					if ( y < 0 | y >= mdata(MDATA_HEIGHT) ) {
						continue
					}
					repeat 13
						x = cdata(CDATA_X, tc) + cnt - 5
						if ( x < 0 | x >= mdata(MDATA_WIDTH) ) {
							continue
						}
						if ( map(x, y, 6) != 0 ) {
							cell_featread x, y
							refx = x
							refy = y
							if ( abs(cdata(CDATA_Y, tc) - y) <= 7 & abs(cdata(CDATA_X, tc) - x) <= 7 ) {
								if ( feat(1) == CELL_FEATURE_TRAP ) {
									if ( feat(0) == 0 ) {
										gosub *revealTrap
										txt lang("罠を感知した。", "You discover a trap.")
									}
								}
								if ( feat(1) == CELL_FEATURE_HIDDEN_PATH ) {
									gosub *revealHiddenPath
									txt lang("隠れた通路を感知した。", "You discover a hidden path.")
								}
							}
							if ( feat(1) == CELL_FEATURE_SMALL_MEDAL ) {
								if ( gdata(GDATA_AREA) != AREA_SHOW_HOUSE ) {
									snd SOUNDLIST_DING2
									txt lang("小さなメダルを感知した！", "You find a small coin!")
									map(x, y, 6) = 0
									flt
									itemcreate -1, ITEM_ID_SMALL_MEDAL, x, y, 0
								}
							}
						}
					loop
				loop
			}
		}
		if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
			msg_halt
			gdata(GDATA_SENSE_OBJECT) = 0
			screenupdate = -1
			gosub *screen_refresh
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_TIME_STOP | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			goto *effect_end
		}
		if ( gdata(GDATA_TIME_STOP_TIME) > 0 | gdata(GDATA_FLAG_STOP_TIME_OTHER) > 0 ) {
			txtef COLOR_SKY_BLUE
			txt lang("時は既に止まっている。", "Time is already stopped.")
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		snd SOUNDLIST_CHEST1
		animeload ANIMATION_UNISON_IMPACT4, cc
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		txtef COLOR_SKY_BLUE
		txt lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
		gdata(GDATA_TIME_STOP_TIME) = 8
		snd SOUNDLIST_CHEST1
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			gdata(GDATA_TIME_STOP_TIME) += 2
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DIFFUSION_WAVE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
			goto *effect_end
		}
		if ( tc == cc ) {
			goto *effect_end
		}
		if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
			if ( tc < MAX_CHARA_FOLLOWER | tc == CHARA_PLAYER ) {
				goto *effect_end
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		txtef COLOR_GREEN
		txt lang(name(cc) + "は魔力を周囲のマナと同調させて放った！", name(cc) + " attune" + _s(cc) + " " + yourself(cc) + " with the mana in the air and let" + _s(cc) + " out a blast!")
		snd SOUNDLIST_ENC
		animeload 43, cc
		snd SOUNDLIST_ENC
		animeload 43, cc
		snd SOUNDLIST_ENC
		animeload 43, cc
		snd SOUNDLIST_PUNISH1
		weap = sdata(SKILL_NORMAL_CASTING, cc)
		if ( sdata(SKILL_NORMAL_CASTING, cc) < sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) ) {
			weap = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc)
		}
		if ( charaGivesExp(tc) ) {
			if ( sdata(SKILL_NORMAL_CASTING, cc) < sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) ) {
				skillexp SKILL_NORMAL_MAGIC_DEVICE, cc, 400
			}
			else {
				skillexp SKILL_NORMAL_CASTING, cc, 400 // As far as I can understand this is what this is supposed to be, rather than trying to give experience to magic device in either case, since it uses the skill with highest level
			}
		}
		if ( synccheck(tc, -1) ) {
			txtmore
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				gdata(GDATA_DMG_TYPE) = 2
				txt3rd = 1
				txt lang(name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
			}
			else {
				txt lang(name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
			}
		}
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit((weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap * 2 + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		healhp cc, (limit((weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap * 2 + 1)) / 5
		healmp cc, (limit((weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap * 2 + 1)) / 5
		eqlv = 0
		eqbui = 0
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DECAPITATION | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_STAB
		txt lang(name(cc) + "は" + name(tc) + "の首を狙って攻撃した。", name(cc) + " aim" + _s(cc) + " at " + name(tc) + your(tc) + " head and attack" + _s(cc) + ".")
		if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			dmghp tc, limit(sdata(SKILL_ATTR_DEX, cc) * 3 + rnd(sdata(SKILL_ATTR_DEX, cc)) - cdata(CDATA_PV, tc), 1, 99999), cc
		}
		if ( cdatan(CDATAN_CLASS, cc) == "farmer" ) {
			ha = 1
		}
		else {
			ha = 0
		}
		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / (8 - ha) ) {
			if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
				gosub *act_melee
			}
			else {
				if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) < 10 ) {
					cdata(CDATA_CONDITION_SUFFOCATION, tc) += 3
				}
			}
			goto *effect_end
		}
		if ( attackskill == SKILL_WEAPON_FIREARM ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATKSWORD
				txtef COLOR_RED
				txt lang(" *ズバシュッ* ", " *Bang* ")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "の頭を吹き飛ばし", name(cc) + " blew " + name(tc) + your(tc) + " head off and")
				}
				else {
					txt lang(name(cc) + "は" + name(tc) + "の頭を吹き飛ばした。", name(cc) + " blew " + name(tc) + your(tc) + " head off.")
				}
			}
		}
		else {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATKSWORD
				txtef COLOR_RED
				txt lang(" *ブシュッ* ", " *Gash* ")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " neck and")
				}
				else {
					txt lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " neck.")
				}
			}
		}
		dmghp tc, cdata(CDATA_MAX_HP, tc), cc, SKILL_SPACT_DECAPITATION
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DECAPITATION2 | _switch_sw ) {
		_switch_sw = 0
		if ( cdatan(CDATAN_CLASS, cc) == "farmer" ) {
			ha = 1
		}
		else {
			ha = 0
		}
		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / (8 - ha) ) {
			goto *effect_end
		}
		if ( attackskill == SKILL_WEAPON_FIREARM ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATKSWORD
				txtef COLOR_RED
				txt lang(" *ズバシュッ* ", " *Bang* ")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "の頭を吹き飛ばし", name(cc) + " blew " + name(tc) + "'s head off and")
				}
				else {
					txt lang(name(cc) + "は" + name(tc) + "の頭を吹き飛ばした。", name(cc) + " blew " + name(tc) + "'s head off.")
				}
			}
		}
		else {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATKSWORD
				txtef COLOR_RED
				txt lang(" *ブシュッ* ", " *Gash* ")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " neck and")
				}
				else {
					txt lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " neck.")
				}
			}
		}
		dmghp tc, cdata(CDATA_MAX_HP, tc), cc, SKILL_SPACT_DECAPITATION
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MATERIALIZE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / 8 ) {
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_SANDBAG, tc) == 1 ) {
			goto *effect_end
		}
		if ( synccheck(tc, -1) ) {
			txtef COLOR_RED
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				gdata(GDATA_DMG_TYPE) = 2
				txt3rd = 1
				txt lang(name(cc) + "は" + name(tc) + "の身体をマテリアルに変換し", name(cc) + " convert" + _s(cc) + " " + name(tc) + your(tc) + " body to material and")
			}
			else {
				txt lang(name(cc) + "は" + name(tc) + "の身体をマテリアルに変換した。", name(cc) + " convert" + _s(cc) + " " + name(tc) + your(tc) + " body to material.")
			}
		}
		dmghp tc, cdata(CDATA_MAX_HP, tc), cc, SKILL_SPACT_DECAPITATION
		efp = sdata(SKILL_NORMAL_ALCHEMY, cc) + 50
		snd SOUNDLIST_DING2
		repeat rnd(2) + 1
			txtmore
			atxspot = ATX_GENERAL1
			if ( rnd(10) == 0 ) {
				atxspot = ATX_REMAIN1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_MINE1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_BUSH1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_DUNGEON1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_BUILDING1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_WATER1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_FIELD1
			}
			if ( rnd(10) == 0 ) {
				atxspot = ATX_FOREST1
			}
			p = random_material(efp / 10, efp / 50)
			matgetmain p, 1
		loop
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_KIJIN_SHIBARI | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txt lang("消費する巻物は？", "Which scrolls?")
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 23
			snd SOUNDLIST_INV
			gosub *com_inventory
			if ( stat != 1 ) {
				goto *effect_end
			}
			inv(INV_ITEM_NUM, ci) -= 10
			gosub *calcBurdenPc
		}
		repeat 10
			snd SOUNDLIST_BOOK1
			await 100
		loop
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( cdata(CDATA_CONDITION_BIND, tc) <= 0 ) {
				cdata(CDATA_CONDITION_BIND, tc) = rnd(3)
			}
			snd SOUNDLIST_CARD1
			txt lang(name(tc) + "に巻物が絡みついた！", name(tc) + " " + is(tc) + " entangled in a scroll!")
			p = 12 - 10
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, 6 * 10000 + 10 + p) != (-1) ) {
				p = -1
			}
			if ( findbuff(tc, BUFF_DISINFECTION) != (-1) ) {
				p = -1
			}
			if ( sdata(SKILL_ATTR_DEX, tc) < sorg(SKILL_ATTR_DEX, tc) / 2 ) {
				p = -1
			}
			if ( p != (-1) ) {
				i = sorg(10 + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
				if ( i > 0 ) {
					efp = (sdata(SKILL_NORMAL_LITERACY, cc) + 1) / 4 + 10
					i = i * efp / 2000 + 5
					cdata(STARTING_CDATA_ATTR + p, tc) -= i
				}
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
				r1 = tc
				gosub *charaRefresh
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BURN_SCROLLS | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txt lang("消費する巻物は？", "Which scrolls?")
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 24
			snd SOUNDLIST_INV
			gosub *com_inventory
			if ( stat != 1 ) {
				goto *effect_end
			}
			inv(INV_ITEM_NUM, ci) -= 20
			gosub *calcBurdenPc
		}
		snd SOUNDLIST_BOOK1
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 50
		}
		animeid = ANIMATION_BURN_SCROLLS
		gosub *anime
		cfg_animewait = waitbk
		efp = sdata(SKILL_NORMAL_LITERACY, cc) * 20 + 100
		dmg = limit(sqrt(sdata(SKILL_ATTR_MAG, cc) + 1) + rnd(sqrt(sdata(SKILL_ATTR_MAG, cc) + 1) + 1), 1, 60) * efp
		dmghp tc, dmg, cc, SKILL_RES_FIRE, 1000
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			p = 0
			repeat 8 + 8
				i = 8 + 8 - cnt - 1
				if ( bdataref(BDATAREF_BUFF_TYPE, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != BUFF_TYPE_BUFF ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_NONE ) {
					continue
				}
				delbuff tc, i
				p++
				continue cnt
			loop
			if ( p > 0 ) {
				snd SOUNDLIST_ATK_FIRE
				animeload 20, tc
				p = 0
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ROCKET_FIRE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 25 ) {
			if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
				tc = cdata(CDATA_TARGET, cc)
				gosub *act_melee
				goto *effect_end
			}
			gosub *FindRangeWeapon
			if ( stat == 1 ) {
				if ( ammo == (-1) ) {
					goto *effect_end
				}
				attackitem = cw
				attackrange = 1
				extraattack = 0
				gosub *act_attack
				goto *effect_end
			}
		}
		txt lang(name(cc) + "は特殊砲弾を放った。", name(cc) + " shot the special cannon.")
		cdata(CDATA_POWER_GAUGE, cc) -= 25
		animeid = ANIMATION_NUCLEAR
		gosub *anime
		aniref = 0
		animeid = ANIMATION_BALL
		anix = cdata(CDATA_X, tc)
		aniy = cdata(CDATA_Y, tc)
		gosub *anime
		cdata(CDATA_PROT_PENALTY, tc) = 2
		dmg = rnd(5) + sdata(SKILL_ATTR_PER, CHARA_PLAYER) * 2 + sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) * sqrt(sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) + 1)
		dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_NUCLEAR_FIRE | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は核砲弾を放った。", name(cc) + " shot the nuclear artillery.")
		if ( cdata(CDATA_POWER_GAUGE, cc) < 25 ) {
			if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
				tc = cdata(CDATA_TARGET, cc)
				gosub *act_melee
				goto *effect_end
			}
			gosub *FindRangeWeapon
			if ( stat == 1 ) {
				if ( ammo == (-1) ) {
					goto *effect_end
				}
				attackrange = 1
				extraattack = 0
				gosub *act_attack
				goto *effect_end
			}
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 25
		tlocx = cdata(CDATA_X, tc)
		tlocy = cdata(CDATA_Y, tc)
		animeid = ANIMATION_NUCLEAR
		gosub *anime
		repeat 40
			if ( cnt == 14 ) {
				snd SOUNDLIST_ATK_FIRE
			}
			await cfg_animewait + 20
		loop
		range = 6
		ele = SKILL_RES_CHAOS
		aniref = range
		animeid = ANIMATION_BALL_NUKE
		anix = tlocx
		aniy = tlocy
		gosub *anime
		gosub *screen_draw
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if ( dy < 0 | dy >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if ( dx < 0 | dx >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( dist(tlocx, tlocy, dx, dy) > range ) {
					continue
				}
				f = 0
				if ( map(dx, dy, 0) != 701 & map(dx, dy, 0) != 671 ) {
					map(dx, dy, 0) = 37
				}
				if ( map(dx, dy, 1) != 0 ) {
					tc = map(dx, dy, 1) - 1
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = 1000 + (sdata(SKILL_NORMAL_CARPENTRY, CHARA_PLAYER) + 50) / 5 * limit(sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + 50, 50, 1000) + sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) / 5 * sqrt(sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) + 1)
					dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
				}
				mapitem_fire dx, dy
			loop
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PIERCING_ZERO_SHOOT | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		zero2 = 200
		motox = cdata(CDATA_X, cc)
		motoy = cdata(CDATA_Y, cc)
		efid = SKILL_SPACT_SHADOW_STEP
		gosub *effect
		gosub *FindRangeWeapon
		if ( stat == 1 ) {
			if ( ammo == (-1) ) {
				goto *effect_end
			}
			cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
			gdata(GDATA_TEMPORARY_FLAGS3) = 1500
			attackrange = 1
			extraattack = 0
			gosub *act_attack
			if ( charaGivesExp(tc) ) {
				skillexp SKILL_NORMAL_MARKSMAN, cc, 400
				if ( attackskill == SKILL_WEAPON_BOW ) {
					skillexp SKILL_WEAPON_BOW, cc, 400
				}
				if ( attackskill == SKILL_WEAPON_FIREARM ) {
					skillexp SKILL_WEAPON_FIREARM, cc, 400
				}
				if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
					skillexp SKILL_WEAPON_CROSSBOW, cc, 400
				}
			}
			if ( cc == CHARA_PLAYER | cc != gdata(GDATA_RIDER) ) {
				if ( cdata(CDATA_IN_TAGTEAM, cc) != 1 ) {
					if ( rnd(2) == 0 ) {
						cdata(CDATA_X_NEW, cc) = cdata(CDATA_X, tc) + cdata(CDATA_AI_DISTANCE, cc)
					}
					else {
						cdata(CDATA_X_NEW, cc) = cdata(CDATA_X, tc) - cdata(CDATA_AI_DISTANCE, cc)
					}
					if ( rnd(2) == 0 ) {
						cdata(CDATA_Y_NEW, cc) = cdata(CDATA_Y, tc) + cdata(CDATA_AI_DISTANCE, cc)
					}
					else {
						cdata(CDATA_Y_NEW, cc) = cdata(CDATA_Y, tc) - cdata(CDATA_AI_DISTANCE, cc)
					}
					cell_check cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc)
					if ( cellaccess != 1 | cc == CHARA_PLAYER | cdata(CDATA_IN_TAGTEAM, cc) == (-1) ) {
						cdata(CDATA_X_NEW, cc) = motox
						cdata(CDATA_Y_NEW, cc) = motoy
					}
					ccprev = cc
					gosub *procMove
					cc = ccprev
				}
			}
			if ( cc == CHARA_PLAYER ) {
				gosub *screen_draw
			}
		}
		zero2 = 0
		gdata(GDATA_TEMPORARY_FLAGS3) = 0
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SPINNING_THROW | _switch_sw ) {
		_switch_sw = 0
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt lang("*" + skillname(efid) + "*　", "*" + skillname(efid) + "* ")
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_THROWING, cc)
		}
		snd SOUNDLIST_ENC
		animeload 40, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		snd SOUNDLIST_BOLT1
		animeload 29, cc
		txtef COLOR_GREEN
		txt lang(name(cc) + "は武器に強烈な回転をかけて投げつけた！", name(cc) + "threw the weapon with a strong spin!")
		if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) != TRUE ) {
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(cc) + " bluntly prevented the attack!")
				snd SOUNDLIST_AMMO
				weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
			}
		}
		animeload 39, tc
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( cdata(CDATA_DRAIN_HP, tc) < 100 ) {
				cdata(CDATA_DRAIN_HP, tc) += 30
				if ( cdata(CDATA_DRAIN_HP, tc) >= 100 ) {
					cdata(CDATA_DRAIN_HP, tc) = 120
					waitbk = cfg_animewait
					if ( cfg_animewait < 50 ) {
						cfg_animewait = 50
					}
					animeload 87, tc
					snd SOUNDLIST_CRASH14
					cfg_animewait = waitbk
				}
			}
		}
		if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SUMMONED, tc) != TRUE & cbit(CHARA_BIT_LIVESTOCK, tc) != TRUE & cbit(CHARA_BIT_NECRO, tc) != TRUE & cbit(CHARA_BIT_SANDBAG, tc) != TRUE ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_THROWING, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GAUGE_RELEASE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) < 98 ) {
			txt_nothinghappens
			return 0
		}
		if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 1
			txtef COLOR_GREEN
			txt lang(name(cc) + "は次の攻撃に意識を集中させた！", name(cc) + " put" + _s(cc) + " all of " + your(cc) + " strength into the next blow!")
		}
		else {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
			txt lang(name(cc) + "は次の攻撃に意識を集中させていたが、やっぱりやめた。", name(cc) + " decide" + _s(cc) + " not to put all of " + your(cc) + " strength into the next blow.")
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_CHAOS_CHILD, cc
		return 0
	}
	if ( _switch_val == SKILL_SPACT_MANA_SLASH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_SCYTHE, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は鎌で大きく薙ぎ払った！", name(cc) + " mow" + _s(cc) + " " + name(tc) + " down!")
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_SICKLE & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
				txtef COLOR_YELLOW
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				goto *effect_end
			}
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
			snd SOUNDLIST_AMMO
			weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
		}
		snd SOUNDLIST_BOLT1
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmgmp tc, limit(limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) / 5, 1, cdata(CDATA_MAX_MP, tc) / 2)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_SCYTHE, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_FLASH_OF_SWIFTNESS | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_LONGSWORD, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は目にもとまらぬ速さで" + name(tc) + "を斬りつけた！", name(cc) + " slashed " + name(tc) + " in the blink of an eye!")
		snd SOUNDLIST_THROW1
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_LONGSWORD | cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_SHORTSWORD | cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_SWORDCANE ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
				if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
					txtef COLOR_YELLOW
					txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
					snd SOUNDLIST_AMMO
					goto *effect_end
				}
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
			}
		}
		snd SOUNDLIST_PUNISH1
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_LONGSWORD ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_LONGSWORD, cc, 400
			}
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_SHORTSWORD ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_SHORTSWORD, cc, 400
			}
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_SWORDCANE ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_STAVE, cc, 400
			}
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		if ( cdata(CDATA_POWER_GAUGE, tc) > 0 ) {
			cdata(CDATA_POWER_GAUGE, tc) = cdata(CDATA_POWER_GAUGE, tc) / 2
		}
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_UNDERHAND_DROP | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_SHORTSWORD, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は武器を逆手で振り上げると" + name(tc) + "に勢いよく突き刺した！", name(cc) + " hold" + _s(cc) + " " + his(cc) + " weapon overhead in a reverse grip and vigorously stab" + _s(cc) + " " + name(tc) + "!")
		snd SOUNDLIST_THROW1
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_SHORTSWORD2 & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
				txtef COLOR_YELLOW
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				goto *effect_end
			}
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
			snd SOUNDLIST_AMMO
			weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
		}
		snd SOUNDLIST_STAB
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_SHORTSWORD, cc, 400
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_CONDITION_FEAR, tc) == 0 ) {
			cdata(CDATA_CONDITION_FEAR, tc) = 5
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BISECTION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_AXE, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は重さを乗せた斬撃を" + name(tc) + "に叩き込んだ！", name(cc) + " drive" + _s(cc) + " a heavy slash into " + name(tc) + "!")
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_LONGSWORD2 | cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_AXE ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
				if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
					txtef COLOR_YELLOW
					txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
					snd SOUNDLIST_AMMO
					goto *effect_end
				}
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
			}
		}
		snd SOUNDLIST_BOLT1
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_LONGSWORD2 ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_LONGSWORD, cc, 400
			}
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_AXE ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_AXE, cc, 400
			}
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_CONDITION_BLEED, tc) < 15 ) {
			cdata(CDATA_CONDITION_BLEED, tc) = 15
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ARROW_RAIN | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_BOW, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は矢を束ねて上空へ放った！", name(cc) + " shoot" + _s(cc) + " a bundle of arrows into the sky!")
		repeat 8
			snd SOUNDLIST_BOW1
			await 50
		loop
		txtef COLOR_GREEN
		txt lang("矢が" + name(tc) + "の周囲へ滝の如く降り注いだ。", "Arrows rain down on " + name(tc) + " like a waterfall!")
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		tcbk = tc
		animeid = ANIMATION_ARROW_RAIN
		anic = tc
		gosub *anime
		animeid = ANIMATION_ARROW_RAIN
		anic = tc
		gosub *anime
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cnt != tcbk ) {
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, cnt) >= (-1)) ) {
						continue
					}
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_SWARM) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) == 0 ) {
				continue
			}
			weap = sdata(SKILL_WEAPON_BOW, cc)
			if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack!")
				snd SOUNDLIST_AMMO
				weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
			}
			dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
			if ( cdata(CDATA_CONDITION_WINCE, tc) < 2 ) {
				cdata(CDATA_CONDITION_WINCE, tc) = 2
				if ( synccheck(tc, -1) ) {
					txtmore
					txtef COLOR_PURPLE
					txt lang(name(tc) + "は怯んだ。", name(tc) + " " + was(tc) + " frightened.")
				}
			}
		loop
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
			skillexp SKILL_WEAPON_BOW, cc, 400
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		tc = tcbk
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HELM_SMASHER | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_CROSSBOW, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は矢を束ねて" + name(tc) + "の頭部へ放った！", name(cc) + " fire" + _s(cc) + " a bundle of bolts at " + name(tc) + your(tc) + " head!")
		snd SOUNDLIST_BOLT1
		animeload 62, tc
		snd SOUNDLIST_STAB
		if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack!")
			snd SOUNDLIST_AMMO
			weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
		}
		animeload ANIMATION_OFFER, tc
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
			skillexp SKILL_WEAPON_CROSSBOW, cc, 400
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_CONDITION_PARALYZE, tc) < 2 ) {
			cdata(CDATA_CONDITION_PARALYZE, tc) = 2
			if ( synccheck(tc, -1) ) {
				txtmore
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は麻痺した。", name(tc) + " " + is(tc) + " paralyzed.")
			}
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		if ( cdata(CDATA_HP, tc) >= 0 ) {
			if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
				attackskill = SKILL_WEAPON_FIREARM
				efid = SKILL_SPACT_DECAPITATION2
				gosub *effect
			}
		}
		attackskill = SKILL_WEAPON_CROSSBOW
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_IMPACT_GUNFIRE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_FIREARM, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は反動に備えながら" + name(tc) + "へ発砲した！", name(cc) + " brace" + _s(cc) + " for recoil and fire" + _s(cc) + " at " + name(tc) + "!")
		snd SOUNDLIST_GUNSHOT3
		if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack!")
			snd SOUNDLIST_AMMO
			weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
		}
		animeload ANIMATION_UNISON_IMPACT1, tc
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
			skillexp SKILL_WEAPON_FIREARM, cc, 400
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_CONDITION_INVERT, tc) < 2 ) {
			cdata(CDATA_CONDITION_INVERT, tc) = 2
		}
		if ( synccheck(tc, -1) ) {
			txtmore
			txtef COLOR_PURPLE
			txt lang(name(tc) + "は転倒した。", name(tc) + " " + was(tc) + " knocked down.")
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ONE_POINT_SHOOT | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_FIREARM, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は正確無比に" + name(tc) + "へ弾丸を放った！", name(cc) + " fire" + _s(cc) + " a bullet at " + name(tc) + " with perfect accuracy!")
		snd SOUNDLIST_GUNSHOT1
		await 300
		snd SOUNDLIST_GUNSHOT1
		await 300
		snd SOUNDLIST_GUNSHOT1
		if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack!")
			snd SOUNDLIST_AMMO
			weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
		}
		animeload ANIMATION_MP_BREATH, tc
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
			skillexp SKILL_WEAPON_FIREARM, cc, 400
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_PROT_PENALTY, tc) < 3 ) {
			cdata(CDATA_PROT_PENALTY, tc) = 3
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CRITICAL_PARTICLE_CANNON | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		ele = SKILL_RES_FIRE
		repeat MAX_SKILL_RESIST - STARTING_SKILL_RESIST, STARTING_SKILL_RESIST
			if ( sdata(cnt, cc) >= sdata(ele, cc) ) {
				ele = cnt
			}
		loop
		txtef COLOR_GREEN
		txt lang(name(cc) + "は粒子の奔流を放った！", name(cc) + " fire" + _s(cc) + " a particle beam!")
		animeid = ANIMATION_PARTICLE_CANNON
		gosub *anime
		ele = SKILL_NONE
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					weap = sdata(SKILL_WEAPON_FIREARM, cc)
					if ( weap < 0 ) {
						weap = 1
					}
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, tc) != (-3) ) {
							continue
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION_ORG, tc) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, tc) >= (-1)) ) {
							continue
						}
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
						txtef COLOR_RED
						txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack!")
						snd SOUNDLIST_AMMO
						weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
					}
					dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
					if ( cdata(CDATA_CONDITION_BLIND, tc) < 2 ) {
						cdata(CDATA_CONDITION_BLIND, tc) = 2
					}
				}
			}
		loop
		weap = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
			skillexp SKILL_WEAPON_FIREARM, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ACID_HURRICANE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_GREEN
		txt lang(name(cc) + "は風に乗せて酸を放った！", name(cc) + " send" + _s(cc) + " out a blast of acidic wind!")
		animeid = ANIMATION_ACID_HURRICANE
		animode = 0
		gosub *anime
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG, efid) \ 1000 + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
				tc = map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					dmg = role(dice1, dice2, bonus)
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt lang(name(tc) + "は" + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + "をかばった！", name(tc) + " guarded " + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + ".")
						}
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang("酸は" + name(tc) + "に命中し", "The acid hits " + name(tc) + " and")
						}
						else {
							txt lang("酸が" + name(tc) + "に命中した。", "The acid hits " + name(tc) + ".")
						}
					}
					dmghp tc, dmg, cc, ele, elep
					if ( cbit(CHARA_BIT_ARMOUR, tc) ) {
						cdata(CDATA_CONDITION_POISON, tc) += 5
					}
					if ( cbit(CHARA_BIT_METAL, tc) ) {
						cdata(CDATA_CONDITION_POISON, tc) += 35
					}
				}
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHINING_THROW | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_MECHA20
		animeload 32, cc
		cdata(CDATA_POWER_GAUGE, cc) += 5
		if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
			if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
				cdata(CDATA_POWER_GAUGE, cc) = 100
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
			cdata(CDATA_POWER_GAUGE, cc) = 200
		}
		animeid = ANIMATION_SHINING_THROW
		gosub *anime
		tcbbk = -1
		magc = 0
		ccbk = cc
		range = 2
		aniref = range
		animeid = ANIMATION_BALL
		anix = tlocx
		aniy = tlocy
		gosub *anime
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if ( dy < 0 | dy >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if ( dx < 0 | dx >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( dist(tlocx, tlocy, dx, dy) > range ) {
					continue
				}
				if ( fov_los(tlocx, tlocy, dx, dy) == 0 ) {
					continue
				}
				if ( map(dx, dy, MAP_MEF_INDEX_PLUS_ONE) != 0 ) {
					if ( efid == SKILL_SPELL_BUBBLE_STORM ) {
						delmef map(dx, dy, MAP_MEF_INDEX_PLUS_ONE) - 1
					}
				}
				if ( map(dx, dy, MAP_MEF_INDEX_PLUS_ONE) != 0 ) {
					if ( mef(MEF_TYPE, map(dx, dy, MAP_MEF_INDEX_PLUS_ONE) - 1) == MEF_TYPE_KEMURIDAMA ) {
						delmef map(dx, dy, MAP_MEF_INDEX_PLUS_ONE) - 1
					}
				}
				if ( map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) == 0 ) {
					continue
				}
				tc = map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					if ( tc != CHARA_PLAYER ) {
						if ( efid != SKILL_SPELL_HEALING_RAIN ) {
							if ( efid != SKILL_SPACT_RAIN_OF_SANITY ) {
								if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
								}
								txt lang(name(tc) + "は" + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + "をかばった！", name(tc) + " guarded " + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + ".")
							}
						}
					}
				}
				if ( tcbbk == (-1) ) {
					if ( cdata(CDATA_RELATION, cc) != RELATION_ALLY ) {
						if ( cdata(CDATA_RELATION, tc) != cdata(CDATA_RELATION, cc) & tc != cc ) {
							tcbbk = tc
						}
					}
					if ( cdata(CDATA_RELATION, cc) == RELATION_ALLY ) {
						if ( cdata(CDATA_RELATION, tc) != RELATION_ALLY & tc != CHARA_PLAYER ) {
							tcbbk = tc
						}
					}
					if ( cdata(CDATA_ALLIED, cc) == 100 ) {
						if ( cdata(CDATA_RELATION, cc) != RELATION_ALLY ) {
							if ( cdata(CDATA_RELATION, tc) == RELATION_ALLY ) {
								tcbbk = tc
							}
						}
					}
					if ( cc == CHARA_PLAYER ) {
						if ( cdata(CDATA_RELATION, tc) != RELATION_ALLY & tc != CHARA_PLAYER ) {
							tcbbk = tc
						}
					}
				}
				if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
					continue
				}
				if ( cc != tc ) {
					dmg = (sdata(SKILL_ATTR_WIL, cc) / 5 + 4) * ((sdata(SKILL_WEAPON_THROWING, cc) + 1) / 5 + 3) * 2 + rnd(sdata(SKILL_WEAPON_THROWING, cc) * 2 + 5) + 1
					txtmore
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang("爆風は" + name(tc) + "に命中し", "The explosion hits " + name(tc) + " and")
						}
						else {
							txt lang("爆風が" + name(tc) + "に命中した。", "The explosion hits " + name(tc) + ".")
						}
					}
					dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
				}
			loop
		loop
		cc = ccbk
		if ( tcbbk != (-1) ) {
			if ( cdata(CDATA_EXIST, tcbbk) == CHAR_STATE_ALIVE ) {
				tc = tcbbk
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_E_MAG_TORNADO | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_GREEN
		txt lang(name(cc) + "は電磁竜巻を放った！", name(cc) + " gave off tornado of E-Mag energy!")
		animeid = ANIMATION_ACID_HURRICANE
		animode = 1
		gosub *anime
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG, efid) \ 1000 + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
				tc = map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					dmg = role(dice1, dice2, bonus)
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt lang(name(tc) + "は" + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + "をかばった！", name(tc) + " guarded " + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + ".")
						}
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang("竜巻は" + name(tc) + "に命中し", "The E-Mag hits " + name(tc) + " and")
						}
						else {
							txt lang("竜巻が" + name(tc) + "に命中した。", "The E-Mag hits " + name(tc) + ".")
						}
					}
					if ( cbit(CHARA_BIT_MAGNETISM_S_POLE, tc) | cbit(CHARA_BIT_MAGNETISM_N_POLE, tc) ) {
						if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
							cdata(CDATA_CONDITION_BIND, tc) = 5
						}
						dmghp tc, dmg * 2, cc, ele, elep
					}
					else {
						if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
							cdata(CDATA_CONDITION_BIND, tc) = 3
						}
						dmghp tc, dmg, cc, ele, elep
					}
					if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cbit(CHARA_BIT_MAGNETISM_N_POLE, tc) == FALSE ) {
						txt lang(name(tc) + "の前面がＮ極になった！", name(cc) + " became the N pole on the front!")
						cbitmod CHARA_BIT_MAGNETISM_S_POLE, tc, FALSE
						cbitmod CHARA_BIT_MAGNETISM_N_POLE, tc, TRUE
					}
				}
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PULVERIZATION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_BLUNT, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は力任せの豪快な一撃を" + name(tc) + "に叩き込んだ！", name(cc) + " drive" + _s(cc) + " a heroic blow into " + name(tc) + " with all " + his(cc) + " might!")
		snd SOUNDLIST_THROW1
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_BLUDGEON & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
				txtef COLOR_YELLOW
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				goto *effect_end
			}
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
			snd SOUNDLIST_AMMO
			weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
		}
		snd SOUNDLIST_CRUSH1
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_BLUNT, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_PROT_PENALTY, tc) = 4
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PENETRATION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_POLEARM, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は一点に狙いを定め" + name(tc) + "を突き刺した！", name(cc) + " aim" + _s(cc) + " at one point and pierce" + _s(cc) + " " + name(tc) + "!")
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_POLEARM | cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_STAVE ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
				if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
					txtef COLOR_YELLOW
					txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
					snd SOUNDLIST_AMMO
					goto *effect_end
				}
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
			}
		}
		snd SOUNDLIST_PUNISH1
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_POLEARM ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_POLEARM, cc, 400
			}
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, cc) == WEAPON_STYLE_STAVE ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_WEAPON_STAVE, cc, 400
			}
		}
		eqlv = 0
		eqbui = 0
		if ( cdata(CDATA_CONDITION_DIM, tc) < 10 ) {
			cdata(CDATA_CONDITION_DIM, tc) = 10
		}
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DANCE_OF_BLOW | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_MARTIAL_ARTS, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は" + name(tc) + "に怒涛の連続攻撃を仕掛けた！", name(cc) + " hit" + _s(cc) + " " + name(tc) + " with a furious succession of attacks!")
		if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == WEAPON_STYLE_STAVE2 & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
				txtef COLOR_YELLOW
				txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を弾いた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attacks with " + his(tc) + " weapon!")
				snd SOUNDLIST_AMMO
				goto *effect_end
			}
			txtef COLOR_RED
			txt lang(name(tc) + "は咄嗟に武器で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attacks with " + his(tc) + " weapon!")
			snd SOUNDLIST_AMMO
			weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
		}
		gdata(GDATA_TEMPORARY_FLAGS2) = 1000
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		repeat 17
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				continue
			}
			animeid = ANIMATION_ATTACK
			gosub *anime
			snd SOUNDLIST_ATK2
			dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 16, 2500) / 16 * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap / 10 + 1), cc, SKILL_SPACT_DANCE_OF_BLOW
		loop
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_STAVE, cc, 400
		}
		snd SOUNDLIST_BOLT1
		cdata(CDATA_EVASION_PENALTY, tc) = 5
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHIELD_STRIKE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( cdata(CDATA_ATTACK_STYLE, cc) & STYLE_SHIELD ) {
			cdata(CDATA_POWER_GAUGE, cc) -= 100
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				snd SOUNDLIST_POWER
				exgauge = 100
				if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
					gdata(GDATA_TIME_STOP_TIME) = 2
				}
			}
			txtef COLOR_YELLOW
			txt_skillname
			if ( weap == 0 ) {
				weap = sdata(SKILL_NORMAL_SHIELD, cc)
			}
			snd SOUNDLIST_ENC
			animeload ANIMATION_UNISON_IMPACT2, cc
			customtalk cc, DBMODE_FLAVOR_SPECIAL
			gosub *convert_word
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は盾で" + name(tc) + "を殴りつけた。", name(cc) + " bash" + _s(cc) + " " + name(tc) + " with " + his(cc) + " shield.")
			}
			if ( cdata(CDATA_ATTACK_STYLE, tc) & STYLE_SHIELD & cdata(CDATA_SHIELD_STYLE_TYPE, tc) == SHIELD_STYLE_NORMAL & cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
				txtef COLOR_RED
				txt lang(name(tc) + "は咄嗟に装備した盾で" + name(cc) + "の攻撃を防いだ！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " shield!")
				snd SOUNDLIST_AMMO
				weap = limit(sdata(SKILL_NORMAL_SHIELD, cc) - sdata(SKILL_NORMAL_SHIELD, tc) - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
			}
			snd SOUNDLIST_BASH1
			inv_getheader cc
			eqlv = 1
			eqbui = 0
			repeat invrange, invhead
				if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
					continue
				}
				eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
				eqbui++
			loop
			if ( eqlv <= 0 ) {
				eqlv = 1
			}
			if ( eqbui <= 0 ) {
				eqbui = 1
			}
			eqlv = limit(eqlv / eqbui * 3, 3, 30)
			dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) / 2 * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
			dmgcon tc, CONDITION_DIM, 50 + int(sqrt(sdata(SKILL_NORMAL_SHIELD, cc))) * 15 + cbit(CHARA_BIT_BREAK_WALLS, cc) * 30
			if ( cdata(CDATA_CONDITION_PARALYZE, tc) == 0 ) {
				cdata(CDATA_CONDITION_PARALYZE, tc) += rnd(2) + cbit(CHARA_BIT_BREAK_WALLS, cc)
			}
			if ( charaGivesExp(tc) ) {
				skillexp SKILL_NORMAL_TACTICS, cc, 400
				skillexp SKILL_NORMAL_SHIELD, cc, 400
			}
			weap = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EXPLOSION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( weap == 0 ) {
			weap = sdata(SKILL_WEAPON_MARTIAL_ARTS, cc)
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "は闘志を極限にまで高め" + name(tc) + "に打ち込んだ！", name(cc) + " unleash" + _s(cc, 1) + " the utmost limit of " + his(cc) + " fighting spirit and pummel" + _s(cc) + " " + name(tc) + "!")
		if ( exgauge != 100 ) {
			if ( cdata(CDATA_WEAPON_STYLE_TYPE, tc) == 0 ) {
				if ( cdata(CDATA_SHIELD_STYLE_TYPE, tc) == 0 ) {
					if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
						if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(2000) ) {
							txtef COLOR_YELLOW
							txt lang(name(tc) + "は咄嗟に闘気をぶつけ" + name(cc) + "の攻撃を受け止めた！", name(tc) + " stop" + _s(tc) + " " + name(cc) + your(cc) + " attack with " + his(tc) + " own unleashed fighting spirit!")
							snd SOUNDLIST_PUNISH1
							goto *effect_end
						}
						txtef COLOR_RED
						txt lang(name(tc) + "は咄嗟に闘気をぶつけ" + name(cc) + "の攻撃を逸らした！", name(tc) + " fend" + _s(tc) + " off " + name(cc) + your(cc) + " attack with " + his(tc) + " own unleashed fighting spirit!")
						snd SOUNDLIST_PUNISH1
						weap = limit(weap - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 1, 2000)
					}
				}
			}
		}
		snd SOUNDLIST_PUNISH1
		animeload ANIMATION_UNISON_IMPACT1, tc
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		cdata(444, cc) = limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1)
		if ( TweakData(50, 4) > 0 & cdata(444, cc) >= cdata(CDATA_HP, tc) ) {
			txtef COLOR_YELLOW
			switch TweakData(50, 4)
				case 1
					txt "「お前はもう死んでいる。」"
					swbreak
				case 2
					txt cnvtalk("You are already dead.")
					swbreak
				default
					txt cnvtalk("Omae wa mou shindeiru.")
					swbreak
			swend
			msg_halt
		}
		dmghp tc, cdata(444, cc), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_WEAPON_MARTIAL_ARTS, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_POWER_GAUGE, cc) += 16
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_RESTORE_SPIRIT | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_RESTORE_BODY | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= (-1) ) {
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		if ( efid == SKILL_SPELL_RESTORE_BODY ) {
			healsp tc, 3
			if ( synccheck(tc, -1) ) {
				if ( efstatus <= (-1) ) {
					snd SOUNDLIST_CURSE3
					txt lang(name(tc) + "の肉体は蝕まれた。", name(tc) + your(tc) + " body is damaged.")
				}
				else {
					txt lang(name(tc) + "の肉体は復活した。", name(tc) + your(tc) + " body is restored.")
					animeload ANIMATION_BLOOD, tc
				}
				if ( efstatus >= 1 ) {
					txt lang("さらに、" + name(tc) + "の肉体は強化された。", "In addition, " + his(tc) + " body is enhanced.")
					animeload ANIMATION_BLOOD, tc
				}
			}
			p = 10, 11, 12, 17, 18, -1
		}
		if ( efid == SKILL_SPELL_RESTORE_SPIRIT ) {
			if ( cdata(CDATA_POWER_GAUGE, tc) < 50 ) {
				cdata(CDATA_POWER_GAUGE, tc) += 4
			}
			if ( synccheck(tc, -1) ) {
				if ( efstatus <= (-1) ) {
					snd SOUNDLIST_CURSE3
					txt lang(name(tc) + "の精神は蝕まれた。", name(tc) + your(tc) + " spirit is damaged.")
				}
				else {
					txt lang(name(tc) + "の精神は復活した。", name(tc) + your(tc) + " spirit is restored.")
					animeload ANIMATION_BLOOD, tc
				}
				if ( efstatus >= 1 ) {
					txt lang("さらに、" + name(tc) + "の精神は強化された。", "In addition, " + his(tc) + " spirit is enhanced.")
					animeload ANIMATION_BLOOD, tc
				}
			}
			p = SKILL_ATTR_LER, SKILL_ATTR_PER, SKILL_ATTR_MAG, SKILL_ATTR_WIL, SKILL_ATTR_LUC, -1
		}
		repeat
			if ( p(cnt) == (-1) ) {
				break
			}
			i = p(cnt) + STARTING_CDATA_ATTR - STARTING_SKILL_ATTR
			if ( efstatus <= (-1) ) {
				if ( cdata(CDATA_QUALITY, tc) <= FIX_QUALITY_GREAT ) {
					cdata(i, tc) -= rnd(sorg(p(cnt), tc)) / 5 + rnd(5)
					continue
				}
			}
			if ( cdata(i, tc) < 0 ) {
				cdata(i, tc) = 0
			}
			if ( efstatus >= 1 ) {
				cdata(i, tc) = sorg(p(cnt), tc) / 10 + 5
			}
		loop
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_WISH | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			if ( cc != CHARA_PLAYER ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179 ) {
			txtef COLOR_PURPLE
			txt lang("願いの女神の力も、ここに届かないようだ…。", "The power of the Wish Goddess does not seem to reach here...")
			goto *effect_end
		}
		gdata(GDATA_FLAG_WISHES_MADE)++
		gosub *com_wish
		screenupdate = -1
		gosub *screen_refresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_ESCAPE | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_AREA) == AREA_REMIDO & gdata(GDATA_LEVEL) == 129 | (gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179) ) {
			snd SOUNDLIST_FAIL1
			txt lang("この階層では脱出が出来ないようだ。", "It seems that you cannot escape from this floor.")
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_RETURN) != 0 ) {
			txt lang("脱出を中止した。", "The air around you gradually loses power.")
			gdata(GDATA_RETURN) = 0
		}
		else {
			gosub *check_return
			if ( stat == 1 ) {
				txt lang("依頼請負中の脱出は法律で禁止されている。それでも脱出する？", "Returning while taking a quest is forbidden. Are you sure you want to return?")
				promptYesNo
				if ( rtval != 0 ) {
					goto *effect_end
				}
			}
			txt lang("周囲の大気がざわめきだした。", "The air around you becomes charged.")
			if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANDOM_DUNGEON ) {
				if ( gdata(GDATA_LEVEL) == adata(ADATA_MAX_LEVEL, gdata(GDATA_AREA)) ) {
					if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) != (-1) ) {
						txt lang("このままダンジョンを出ると、この階のクエストは達成できない…", "The lord of the dungeon might disappear if you escape now.")
					}
				}
			}
			gdata(GDATA_TELEPORT_AREA) = gdata(GDATA_WORLD), 1
			if ( efstatus <= (-1) ) {
				if ( gdata(GDATA_WORLD) != AREA_LOST_YLVA ) {
					if ( rnd(3) == 0 ) {
						gdata(GDATA_TELEPORT_AREA) = AREA_JAIL, 1
					}
				}
			}
			gdata(GDATA_RETURN) = 5 + rnd(10)
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_RETURN | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_AREA) == AREA_REMIDO & gdata(GDATA_LEVEL) == 129 | (gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179) ) {
			snd SOUNDLIST_FAIL1
			txt lang("この階層では帰還が出来ないようだ。", "It seems that you cannot return from this floor.")
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_RETURN) != 0 ) {
			txt lang("帰還を中止した。", "The air around you gradually loses power.")
			gdata(GDATA_RETURN) = 0
		}
		else {
			gosub *com_return
			if ( efstatus <= (-1) ) {
				if ( gdata(GDATA_WORLD) != AREA_LOST_YLVA ) {
					if ( rnd(3) == 0 ) {
						gdata(GDATA_TELEPORT_AREA) = AREA_JAIL, 1
					}
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HARVEST_MANA | _switch_sw ) {
		_switch_sw = 0
		if ( tc == CHARA_PLAYER ) {
			healmp tc, efp / 2 + rnd(efp / 2 + 1)
		}
		else {
			healmp tc, cdata(CDATA_MAX_MP, tc) / 10 + rnd(sdata(SKILL_ATTR_MAG, tc)) + 5
		}
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
			animeid = ANIMATION_HEAL
			gosub *anime
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ABSORB_MAGIC | _switch_sw ) {
		_switch_sw = 0
		healmp tc, role(dice1, dice2, bonus)
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は周囲からマナを吸い取った。", name(tc) + " absorb" + _s(tc) + " mana from the air.")
			animeid = ANIMATION_HEAL
			gosub *anime
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_GREEN_TEA | _switch_sw ) {
		_switch_sw = 0
		animeid = ANIMATION_HEAL
		gosub *anime
		healcon tc, CONDITION_FEAR, inv(INV_ITEM_LEVEL, ci) * 2 + 15
		healcon tc, CONDITION_POISON, inv(INV_ITEM_LEVEL, ci) * 2 + 15
		healcon tc, CONDITION_CONFUSE, inv(INV_ITEM_LEVEL, ci) * 2 + 15
		healcon tc, CONDITION_DIM, inv(INV_ITEM_LEVEL, ci) * 2 + 15
		healcon tc, CONDITION_PARALYZE, inv(INV_ITEM_LEVEL, ci) * 2 + 15
		healcon tc, CONDITION_SICK, inv(INV_ITEM_LEVEL, ci) + 5
		if ( cdata(CDATA_VOMIT, tc) > 0 ) {
			cdata(CDATA_VOMIT, tc)--
		}
		inv_find ITEM_ID_BIO_BATTERY, tc
		if ( stat == (-1) ) {
			omosa = limit(cdata(CDATA_WEIGHT, tc), 1, 100000000)
			cdata(CDATA_WEIGHT, tc) -= omosa * (inv(INV_ITEM_LEVEL, ci) + 1) / 100 + 1
			if ( cdata(CDATA_WEIGHT, tc) < 0 ) {
				cdata(CDATA_WEIGHT, tc) = 0
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_BLACK_TEA | _switch_sw ) {
		_switch_sw = 0
		animeid = ANIMATION_HEAL
		gosub *anime
		healsp tc, 5
		healmp tc, 5 + (inv(INV_ITEM_LEVEL, ci) + 5) * cdata(CDATA_MAX_MP, tc) / 100
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POISON | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は毒を浴びた！", name(tc) + " " + is(tc) + " hit by poison!")
		}
		if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
			cbitmod CHARA_BIT_PREGNANT, tc, 0
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の体内の異物は溶けた。", name(tc) + your(tc) + " child melts in " + his(tc) + " stomach.")
			}
			cdata(CDATA_INFANT, tc) = 0
			if ( tc == CHARA_PLAYER ) {
				spact(SKILL_SPACT_PREGNANT - STARTING_SKILL_SPACT) = 0
			}
		}
		dmgcon tc, CONDITION_POISON, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_BLIND | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は墨を浴びた！", "Ink squirts into " + name(tc) + your(tc) + " face!")
		}
		dmgcon tc, CONDITION_BLIND, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_CONFUSE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "はひどい頭痛におそわれた！", "A foul stench floods " + name(tc) + your(tc) + " nostrils!")
		}
		dmgcon tc, CONDITION_CONFUSE, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_PARALYZE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は痺れた！", name(tc) + " get" + _s(tc) + " numbness!")
		}
		dmgcon tc, CONDITION_PARALYZE, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_SLEEP | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は甘い液体を浴びた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
		}
		dmgcon tc, CONDITION_SLEEP, efp
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CURSE | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_CURSE | _switch_sw ) {
		_switch_sw = 0
*spUncurse_cursed
		if ( efid == SKILL_SPACT_CURSE ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(cc) + "は" + name(tc) + "を指差して呪いの言葉を呟いた。", name(cc) + " point" + _s(cc) + " " + name(tc) + " and mutter" + _s(cc) + " a curse.")
			}
		}
		p = 75 + sdata(SKILL_ATTR_LUC, tc)
		if ( encfind(tc, ENCHANT_RES_CURSE) != (-1) ) {
			p += encfind(tc, ENCHANT_RES_CURSE) / 2
		}
		if ( rnd(p) > efp / 2 + (efstatus <= (-1)) * 100 ) {
			goto *effect_end
		}
		if ( tc < MAX_CHARA_FOLLOWER ) {
			if ( rnd(3) ) {
				if ( trait(TRAIT_NORMAL_OTHER_RES_CURSE) ) {
					txt lang("あなたは祈祷を捧げ呪いのつぶやきを無効にした。", "Your prayer nullifies the curse.")
					goto *effect_end
				}
			}
		}
		i = 0
		repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
			if ( cdata(cnt, tc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			p(i) = cdata(cnt, tc) \ EXT_EQUIP_SLOTS - 1
			if ( inv(INV_ITEM_STATUS, p(i)) == ITEM_STATUS_BLESSED ) {
				if ( rnd(10) ) {
					continue
				}
			}
			i++
		loop
		if ( i == 0 ) {
			inv_getheader tc
			repeat 200
				p = invhead + rnd(invrange)
				if ( inv(INV_ITEM_NUM, p) == 0 ) {
					continue
				}
				if ( inv(INV_ITEM_STATUS, p) == ITEM_STATUS_BLESSED ) {
					if ( rnd(10) ) {
						continue
					}
				}
				i = 1
				break
			loop
		}
		if ( i > 0 ) {
			i = p(rnd(i))
			valn = itemname(i, 1, 1)
			if ( inv(INV_ITEM_STATUS, i) == ITEM_STATUS_CURSED ) {
				inv(INV_ITEM_STATUS, i) = ITEM_STATUS_DOOMED
			}
			else {
				inv(INV_ITEM_STATUS, i) = ITEM_STATUS_CURSED
			}
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の" + valn + "は黒く輝いた。", name(tc) + your(tc) + " " + valn + " glows black.")
			}
			r1 = tc
			gosub *charaRefresh
			snd SOUNDLIST_CURSE3
			animeload ANIMATION_CRUSH, tc
			item_stack tc, i, 1
		}
		else {
			txt_nothinghappens
			obvious = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_DECREASE_RESIST | _switch_sw ) {
		_switch_sw = 0
		efid = SKILL_SPELL_ELEMENT_SCAR
		gosub *effect
		efid = SKILL_SPELL_NIGHTMARE
		gosub *effect
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_MYSTERIOUS_DIARY | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( gdata(GDATA_CROWD) + 100 >= MAX_CHARA_TOTAL - MAX_CHARA_SAVE ) {
				txt_nothinghappens
				obvious = 0
				goto *effect_end
			}
		}
		efp = gdata(GDATA_DEEPEST_LEVEL) / 2 + 1
		if ( efp < 1 ) {
			efp = 1
		}
		flt calcobjlv(efp), 2
		dbid = 0
		gdata(STARTING_GDATA_FLAG + 356)++
		if ( gdata(STARTING_GDATA_FLAG + 356) >= 12 ) {
			if ( gdata(STARTING_GDATA_FLAG + 356) \ 12 == 0 ) {
				dbid = CREATURE_ID_FOX_BROTHER
			}
		}
		if ( cdata(CDATA_X, CHARA_PLAYER) > 1 ) {
			sux = cdata(CDATA_X, CHARA_PLAYER) - 1
		}
		novoidlv = 1
		characreate -1, dbid, sux, cdata(CDATA_Y, CHARA_PLAYER)
		if ( stat != 0 ) {
			cdata(CDATA_RELATION, rc) = -1
			cdata(CDATA_RELATION_ORG, rc) = -1
		}
		txt lang("日記の主が現れた。", "The owner of the diary appears.")
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_CAT_SISTER | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_SISTER | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_ALLY | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_GIRL | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_BUTLERS_DIARY | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_OLDER_SISTER | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_DOG_SISTER | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_GAIN_WRANGWRANG | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_EFFECT_GAIN_ALLY ) {
			if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
				inv(INV_ITEM_NUM, ci)++
				txt lang("このエリアでは使えない。", "You can't use it in this area.")
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER & cc < MAX_CHARA_FOLLOWER ) {
			txt_nothinghappens
			goto *effect_end
		}
		flt cdata(CDATA_LEVEL, CHARA_PLAYER) / 2 + 5, 3
		p = 0
		if ( rnd(3) == 0 ) {
			fltn "man"
		}
		if ( efid == SKILL_EFFECT_GAIN_CAT_SISTER ) {
			txt lang("なんと、あなたには生き別れた血の繋がっていないぬこの妹がいた！", "How...! You suddenly get a younger cat sister!")
			p = CREATURE_ID_YOUNGER_CAT_SISTER
		}
		if ( efid == SKILL_EFFECT_GAIN_SISTER ) {
			txt lang("なんと、あなたには生き別れた血の繋がっていない妹がいた！", "How...! You suddenly get a younger sister!")
			p = CREATURE_ID_YOUNGER_SISTER
		}
		if ( efid == SKILL_EFFECT_GAIN_GIRL ) {
			txt lang("お嬢さんが空から降ってきた！", "A young lady falls from the sky.")
			p = CREATURE_ID_YOUNG_LADY
		}
		if ( efid == SKILL_EFFECT_BUTLERS_DIARY ) {
			txt lang("執事が空から降ってきた！", "A butler falls from the sky.")
			p = CREATURE_ID_BUTLER
		}
		if ( efid == SKILL_EFFECT_GAIN_OLDER_SISTER ) {
			txt lang("なんと、あなたには生き別れた血の繋がっていない姉がいた！", "How...! You suddenly get an older sister!")
			p = CREATURE_ID_OLDER_SISTER
		}
		if ( efid == SKILL_EFFECT_GAIN_DOG_SISTER ) {
			txt lang("なんと、あなたには生き別れた血の繋がっていないわんこの姉がいた！", "How...! You suddenly get an older dog sister!")
			p = CREATURE_ID_OLDER_DOG_SISTER
		}
		if ( efid == SKILL_EFFECT_GAIN_WRANGWRANG ) {
			txt lang("フォーマを生きるよるべとしなさい。それはあなたを、勇敢で、親切で、健康で、幸福な人間にする。", "Live by the foma that make you brave and kind and healthy and happy.")
			p = CREATURE_ID_WRANG_WRANG
		}
		novoidlv = 1
		fixlv = FIX_QUALITY_GOOD
		characreate MAX_CHARA_NC, p, -3, 0
		rc = MAX_CHARA_NC
		gosub *add_ally

		/********** ORIGINAL - BEGINNING **********

		if ( efid == SKILL_EFFECT_GAIN_ALLY ) {
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Re-enable save-scumming.

		if ( efid == SKILL_EFFECT_GAIN_ALLY & ( TweakData(TWEAK_GAMEPLAY_ENABLE_SAVE_SCUMMING, TWEAK_CATEGORY_GAMEPLAY) == 1 | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_PURGE ) ) {
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}

		/********** BLOODYSHADE CUSTOM - ENDING **********/

		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_DOMINATE | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cbit(CHARA_BIT_NECRO, tc) == TRUE ) {
                txt_nothinghappens
				obvious = 0
				goto *effect_end
			}
			if ( gdata(GDATA_AREA) == AREA_ARENA | gdata(GDATA_AREA) == AREA_PET_ARENA | gdata(GDATA_AREA) == AREA_CHAOS_CRADLE | gdata(GDATA_AREA) == AREA_VOID | adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) != 0 | (gdata(GDATA_AREA) == AREA_SHELTER & gdata(GDATA_LEVEL) == 1) ) {
				obvious = 0
				txt lang("この場所では効果がない。", "The effect doesn't work in this area.")
				goto *effect_end
			}
        }
		sihaip = 0
		inv_find ITEM_ID_MONSTER_HEART, cc
		if ( stat != (-1) ) {
			efp = efp * 3 / 2
		}
		if ( rnd(efp / 15 + 5) >= cdata(CDATA_LEVEL, tc) ) {
			sihaip = 1
		}
		if ( tc == CHARA_PLAYER | cdata(CDATA_RELATION, tc) == RELATION_ALLY | tc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_NECRO, tc) == TRUE | cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE | cbit(CHARA_BIT_PRECIOUS, tc) == TRUE | cdata(CDATA_CHARACTER_TIER, tc) == CHARACTER_TIER_SUMMONED_NORMAL | cbit(CHARA_BIT_BODYGUARD, tc) == TRUE | gdata(GDATA_FLAG_DUEL_TARGET) == tc ) {
			if ( tc != CHARA_PLAYER ) {
				txtef COLOR_RED
				txt lang(name(tc) + "は仲間にならない。", name(tc) + " never obeys.")
			}
			if ( cdata(CDATA_CONDITION_PARALYZE, tc) != 0 ) {
				sihaip = 0
			}
			if ( sihaip == 0 ) {
				sihaip = 2
			}
			if ( sihaip == 1 ) {
				sihaip = 3
			}
		}
		else {
			if ( cc != CHARA_PLAYER ) {
				if ( cdata(CDATA_CONDITION_PARALYZE, tc) != 0 ) {
					sihaip = 0
				}
				if ( sihaip == 0 ) {
					sihaip = 2
				}
				if ( sihaip == 1 ) {
					sihaip = 3
				}
			}
		}
		if ( sihaip == 0 ) {
			txt lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
		}
		if ( sihaip == 1 ) {
			rc = tc
			gosub *add_ally
			check_quest
		}
		if ( sihaip == 2 ) {
			txt lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
		}
		if ( sihaip == 3 ) {
			txtef COLOR_PURPLE
			txt lang(name(tc) + "の身体は支配された。", name(tc) + "'s movement was dominated.")
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
				cdata(CDATA_CONDITION_PARALYZE, tc) = 10
			}
			else {
				cdata(CDATA_CONDITION_PARALYZE, tc) = 30
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_WEB | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_MIST_OF_DARKNESS | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_ACID_GROUND | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_ETHER_GROUND | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_FIRE_WALL | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_MIST_OF_DAZZLING | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_CURTAIN_OF_SMOKE | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_SPACT_CURTAIN_OF_SMOKE ) {
			txt lang("辺りを黒煙が覆った。", "The air is wrapped in a dense smoke.")
			efp = 1000
			p = 3, 120
		}
		if ( efid == SKILL_SPELL_WEB ) {
			p = 3, 2 + rnd(efp / 50 + 1)
			txt lang("蜘蛛の巣が辺りを覆った。", "The ground is covered with thick webbing.")
		}
		if ( efid == SKILL_SPELL_MIST_OF_DARKNESS ) {
			txt lang("辺りを濃い闇の霧が覆った。", "The air is wrapped in a dense fog.")
			p = 3, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPELL_MIST_OF_DAZZLING ) {
			txt lang("辺りを眩い光の霧が覆った。", "The air is wrapped in dazzling light.")
			p = 3, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPELL_ACID_GROUND ) {
			txt lang("酸の水溜りが発生した。", "Acid puddles are generated.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPELL_FIRE_WALL ) {
			txt lang("火柱が発生した。", "Walls of fire come out from the ground.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPACT_ETHER_GROUND ) {
			txt lang("エーテルの霧が発生した。", "Ether mist spreads.")
			p = 2, 1 + rnd(efp / 100 + 2)
		}
		if ( efid == SKILL_SPACT_CURTAIN_OF_SMOKE ) {
			snd SOUNDLIST_ATK_DARK
		}
		else {
			snd SOUNDLIST_WEB
		}
		repeat p(1)
			x = rnd(p) + tlocx - rnd(p)
			y = rnd(p) + tlocy - rnd(p)
			f = 1
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
				f = 0
			}
			else {
				if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					f = 0
				}
			}
			if ( dist(tlocx, tlocy, x, y) >= p ) {
				f = 0
			}
			if ( f == 0 ) {
				if ( rnd(2) == 0 ) {
					continue
				}
				else {
					continue cnt
				}
			}
			if ( efid == SKILL_SPELL_ACID_GROUND | efid == SKILL_SPELL_FIRE_WALL ) {
				tcbk = tc
				if ( map(x, y, 1) != 0 ) {
					tc = map(x, y, 1) - 1
					if ( cc != tc ) {
						if ( gdata(GDATA_RIDER) != 0 ) {
							if ( gdata(GDATA_RIDER) == cc ) {
								if ( tc == CHARA_PLAYER ) {
									continue
								}
							}
						}
						if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
							if ( tc != CHARA_PLAYER ) {
								if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
								}
							}
						}
						if ( efid == SKILL_SPELL_ACID_GROUND ) {
							cdata(CDATA_ENVIRONMENT_EFFECT, tc) = ENVIRONMENT_EFFECT_ACID
						}
						if ( efid == SKILL_SPELL_FIRE_WALL ) {
							cdata(CDATA_ENVIRONMENT_EFFECT, tc) = ENVIRONMENT_EFFECT_FIRE
						}
					}
				}
				tc = tcbk
			}
			if ( efid == SKILL_SPACT_ETHER_GROUND ) {
				addmef x, y, 4, 20, rnd(4) + 2, efp, cc
			}
			if ( efid == SKILL_SPELL_ACID_GROUND ) {
				addmef x, y, 3, 19, rnd(10) + 5, efp, cc
			}
			if ( efid == SKILL_SPELL_FIRE_WALL ) {
				addmef x, y, 5, 24, rnd(10) + 5, efp, cc
				mapitem_fire x, y
			}
			if ( efid == SKILL_SPELL_WEB ) {
				addmef x, y, 1, 11, -1, efp * 2
			}
			if ( efid == SKILL_SPELL_MIST_OF_DARKNESS ) {
				addmef x, y, 2, 30, 8 + rnd(15 + efp / 25), efp
			}
			if ( efid == SKILL_SPELL_MIST_OF_DAZZLING ) {
				addmef x, y, 8, 4, 8 + rnd(15 + efp / 25), efp
			}
			if ( efid == SKILL_SPACT_CURTAIN_OF_SMOKE ) {
				addmef x, y, 9, 963, 15, efp
			}
		loop
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_NONE ) {
				continue
			}
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_ACID ) {
				txt lang(name(cnt) + "は大量の酸を浴びた。", name(cnt) + " was showered by a large amount of acid.")
				cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
				hostileaction cc, cnt
				dmghp cnt, rnd(efp / 10 + 5) + efp / 10 + 1, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, efp
			}
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_FIRE ) {
				txt lang(name(cnt) + "は炎に包まれた。", name(cnt) + " was surrounded by flames.")
				cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
				hostileaction cc, cnt
				dmghp cnt, rnd(efp / 3 + 5) + efp / 3 + 1, DAMAGE_FROM_FIRE, SKILL_RES_FIRE, efp
			}
			cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_RENAME_ITEM | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 23, 16
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( inv(INV_ITEM_QUALITY, ci) < FIX_QUALITY_MIRACLE | inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_UNIQUE ) {
			txt_impossible
			obvious = 0
			goto *effect_end
		}
		if ( inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_MIRACLE | inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_GODLY ) {
			txt lang("アーティファクトの新しい銘は？", "What do you want to name this artifact?")
			val = 3
			gosub *com_aka
			if ( stat == 0 ) {
				obvious = 0
				randomize
				goto *effect_end
			}
			p = stat
			inv(INV_ITEM_SUB_NAME, ci) = list(1, p) + 40000
			randomize
			txt lang("それは" + listn(0, p) + "という銘になった。", "It's now called " + listn(0, p) + ".")
		}
		goto *effect_end
	}
	if ( _switch_val == EFFECT_GAROK_HAMMER | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 23, 7
		snd SOUNDLIST_INV
		gosub *com_inventory
		f = stat
		if ( key == key_cancel ) {
			goto *effect_end
		}
		if ( inv(INV_ITEM_QUALITY, ci) >= FIX_QUALITY_MIRACLE | ibit(ITEM_BIT_ALIVE, ci) == 1 ) {
			txt lang("そのアイテムに改良の余地はない。", "This item has no room for improvement.")
			fixmaterial = ITEM_MATERIAL_SAND
			objfix = 0
			goto *effect_end
		}
		randomize inv(INV_ITEM_PARAM1, efcibk)
		equip = inv(INV_ITEM_EQUIP, ci)
		animeload ANIMATION_FIZZLE, cc
		inv(INV_ITEM_QUALITY, ci) = FIX_QUALITY_MIRACLE
		randomize inv(INV_ITEM_PARAM1, efcibk)
		inv(INV_ITEM_SUB_NAME, ci) = 40000 + rnd(30000)
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_HELM ) {
			encadd ci, ENCHANT_IMMUNE_DAMAGE, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ACCESSORY_AMULET ) {
			encadd ci, ENCHANT_ENHANCE_BREATH, 400, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_CLOAK ) {
			encadd ci, ENCHANT_ENHANCE_SPELL, 300, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ARMOR ) {
			encadd ci, ENCHANT_REFLECT_MAGIC, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ACCESSORY_RING ) {
			encadd ci, ENCHANT_FAST_TRAVEL, 400, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_GLOVES ) {
			encadd ci, ENCHANT_RES_PHYSICAL, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_GIRDLE ) {
			encadd ci, ENCHANT_PIERCING_CHANCE, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_BOOTS ) {
			encadd ci, ENCHANT_SHOOTING_MECHANISM, 300, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_WEAPON ) {
			encadd ci, ENCHANT_EXTRA_MELEE, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_RANGE ) {
			encadd ci, ENCHANT_EXTRA_RANGED, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_SHIELD ) {
			encadd ci, ENCHANT_PROXIMITY_ASSIST, 250, 0, 1, 0, 1
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_AMMO ) {
			encadd ci, ENCHANT_CRIT_CHANCE, 600, 0, 1, 0, 1
		}
		txt lang("それは" + itemname(ci, 1) + "になった。", "It becomes " + itemname(ci, 1) + ".")
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			inv(INV_ITEM_EQUIP, ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		ci = efcibk
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		goto *effect_end
	}
	if ( _switch_val == EFFECT_MATERIAL_KIT | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_CHANGE_MATERIAL | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		cibk = ci
		invsubroutine = 1
		invctrl = 23, 0
		snd SOUNDLIST_INV
		gosub *com_inventory
		f = stat
		if ( inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_GODLY | ibit(ITEM_BIT_ALIVE, ci) == 1 ) {
			if ( efid == SKILL_EFFECT_CHANGE_MATERIAL ) {
				f = 0
			}
		}
		equip = inv(INV_ITEM_EQUIP, ci)
		if ( f == 1 ) {
			if ( inv(INV_ITEM_QUALITY, ci) == FIX_QUALITY_UNIQUE ) {
				if ( efp < 350 ) {
					txt lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
					goto *effect_end
				}
				animeload ANIMATION_FIZZLE, cc
				txt lang(name(cc) + "の" + itemname(ci, 1) + "は再生成された。", name(cc) + your(cc) + " " + itemname(ci, 1, 1) + " is reconstructed.")
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				flt
				itemcreate 0, inv(INV_ITEM_ID, ci), -1, -1, 0
			}
			else {
				animeload ANIMATION_FIZZLE, cc
				s = itemname(ci, 1, 1)
				if ( inv(INV_ITEM_ID, cibk) == ITEM_ID_SCROLL_INFERIOR_MATERIAL ) {
					fixmaterial = ITEM_MATERIAL_SAND
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_PAPER ) {
						fixmaterial = ITEM_MATERIAL_CLOTH
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_CLOTH ) {
						fixmaterial = ITEM_MATERIAL_SILK
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_SILK ) {
						fixmaterial = ITEM_MATERIAL_MICA
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_MICA ) {
						fixmaterial = ITEM_MATERIAL_BAMBOO
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_BAMBOO ) {
						fixmaterial = ITEM_MATERIAL_RAW
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_RAW ) {
						fixmaterial = ITEM_MATERIAL_LEATHER
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_LEATHER ) {
						fixmaterial = ITEM_MATERIAL_GLASS
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_GLASS ) {
						fixmaterial = ITEM_MATERIAL_SCALE
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_SCALE ) {
						fixmaterial = ITEM_MATERIAL_CORAL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_CORAL ) {
						fixmaterial = ITEM_MATERIAL_BRONZE
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_BRONZE ) {
						fixmaterial = ITEM_MATERIAL_IRON
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_IRON ) {
						fixmaterial = ITEM_MATERIAL_BONE
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_BONE ) {
						fixmaterial = ITEM_MATERIAL_PAPER
					}
					if ( fixmaterial == ITEM_MATERIAL_SAND ) {
						fixmaterial = ITEM_MATERIAL_PAPER
					}
				}
				if ( inv(INV_ITEM_ID, cibk) == ITEM_ID_SCROLL_CHANGE_MATERIAL ) {
					fixmaterial = ITEM_MATERIAL_SAND
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_ZYLON ) {
						fixmaterial = ITEM_MATERIAL_WOOD
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_WOOD ) {
						fixmaterial = ITEM_MATERIAL_OBSIDIAN
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_OBSIDIAN ) {
						fixmaterial = ITEM_MATERIAL_CHROME
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_CHROME ) {
						fixmaterial = ITEM_MATERIAL_METAL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_METAL ) {
						fixmaterial = ITEM_MATERIAL_STEEL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_STEEL ) {
						fixmaterial = ITEM_MATERIAL_CHAIN
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_CHAIN ) {
						fixmaterial = ITEM_MATERIAL_SILVER
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_SILVER ) {
						fixmaterial = ITEM_MATERIAL_PLATINUM
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_PLATINUM ) {
						fixmaterial = ITEM_MATERIAL_GOLD
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_GOLD ) {
						fixmaterial = ITEM_MATERIAL_PEARL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_PEARL ) {
						fixmaterial = ITEM_MATERIAL_GRIFFON
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_GRIFFON ) {
						if ( inv(INV_ITEM_STATUS, cibk) < ITEM_STATUS_BLESSED ) {
							fixmaterial = ITEM_MATERIAL_ZYLON
						}
						else {
							fixmaterial = ITEM_MATERIAL_DRAGON
						}
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_DRAGON ) {
						if ( inv(INV_ITEM_STATUS, cibk) < ITEM_STATUS_BLESSED ) {
							fixmaterial = ITEM_MATERIAL_ZYLON
						}
						else {
							fixmaterial = ITEM_MATERIAL_ADAMANTIUM
						}
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_ADAMANTIUM ) {
						fixmaterial = ITEM_MATERIAL_ZYLON
					}
					if ( fixmaterial == ITEM_MATERIAL_SAND ) {
						fixmaterial = ITEM_MATERIAL_ZYLON
					}
				}
				if ( inv(INV_ITEM_ID, cibk) == ITEM_ID_SCROLL_SUPERIOR_MATERIAL ) {
					fixmaterial = ITEM_MATERIAL_SAND
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_DUSK ) {
						fixmaterial = ITEM_MATERIAL_SPIRIT
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_SPIRIT ) {
						fixmaterial = ITEM_MATERIAL_DRAGON
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_DRAGON ) {
						fixmaterial = ITEM_MATERIAL_CRYSTAL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_CRYSTAL ) {
						fixmaterial = ITEM_MATERIAL_TITANIUM
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_TITANIUM ) {
						fixmaterial = ITEM_MATERIAL_NANOMACHINE
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_NANOMACHINE ) {
						fixmaterial = ITEM_MATERIAL_MITHRIL
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_MITHRIL ) {
						fixmaterial = ITEM_MATERIAL_ADAMANTIUM
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_ADAMANTIUM ) {
						fixmaterial = ITEM_MATERIAL_EMERALD
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_EMERALD ) {
						fixmaterial = ITEM_MATERIAL_DIAMOND
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_DIAMOND ) {
						if ( inv(INV_ITEM_STATUS, cibk) < ITEM_STATUS_BLESSED ) {
							fixmaterial = ITEM_MATERIAL_DUSK
						}
						else {
							fixmaterial = ITEM_MATERIAL_RUBYNUS
						}
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_RUBYNUS ) {
						if ( inv(INV_ITEM_STATUS, cibk) < ITEM_STATUS_BLESSED ) {
							fixmaterial = ITEM_MATERIAL_DUSK
						}
						else {
							fixmaterial = ITEM_MATERIAL_ETHER
						}
					}
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_ETHER ) {
						fixmaterial = ITEM_MATERIAL_DUSK
					}
					if ( fixmaterial == ITEM_MATERIAL_SAND ) {
						fixmaterial = ITEM_MATERIAL_DUSK
					}
				}
				gosub *remake_material
				txt lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
			}
		}
		else {
			txt_nothinghappens
			obvious = 0
		}
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			inv(INV_ITEM_EQUIP, ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_HEIR_DEED | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		snd SOUNDLIST_DING2
		p = 3
		gdata(GDATA_HEIR_DEED) += p
		txtef COLOR_YELLOW
		txt lang("あなたは遺産相続人として認められた(+" + p + ")", "You claim the right of succession. (+" + p + ")")
		txt lang("今やあなたは" + gdata(GDATA_HEIR_DEED) + "個の遺産を相続できる。", "You can now inherit " + gdata(GDATA_HEIR_DEED) + " items.")
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_DEED_SUMMON_VEHICLE | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt lang("それはワールドマップ以外で読む必要がある。", "You need to read it while you are in the local map.")
			goto *effect_end
		}
		if ( cc != CHARA_PLAYER ) {
            txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_CARRIAGE ) {
			gdata(GDATA_CARGO_LIMIT) -= 10 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_TRUCK ) {
			gdata(GDATA_CARGO_LIMIT) -= 20 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_MAGIC_LOCOMOTIVE ) {
			gdata(GDATA_CARGO_LIMIT) -= 30 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_LAND_BATTLESHIP ) {
			gdata(GDATA_CARGO_LIMIT) -= 100 * 1000
		}
		snd SOUNDLIST_DING1
		gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) = inv(INV_ITEM_PARAM1, ci)
		gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_PIC) = gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) + inv(INV_ITEM_COL, ci) * COLOR_TINT_MULT
		txtef COLOR_YELLOW
		txt lang("あなたは乗り物をさっそく郊外に呼んだ。", "You called the world-vehicle out to the suburbs.")
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_CARRIAGE ) {
			gdata(GDATA_CARGO_LIMIT) += 10 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_TRUCK ) {
			gdata(GDATA_CARGO_LIMIT) += 20 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_MAGIC_LOCOMOTIVE ) {
			gdata(GDATA_CARGO_LIMIT) += 30 * 1000
		}
		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == VEHICLE_LAND_BATTLESHIP ) {
			gdata(GDATA_CARGO_LIMIT) += 100 * 1000
		}
		inv(INV_ITEM_NUM, ci)--
		if ( ci >= RANGE_INV2 ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		gosub *calcBurdenPc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_ENCHANT_WEAPON | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_ENCHANT_ARMOR | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *effect_end
		}
		invsubroutine = 1
		if ( efid == SKILL_EFFECT_ENCHANT_WEAPON ) {
			invctrl = 23, 1
		}
		else {
			invctrl = 23, 2
		}
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			if ( inv(INV_ITEM_LEVEL, ci) - 3 < efp / 100 ) {
				snd SOUNDLIST_DING2
				txt lang(itemname(ci) + "は黄金の光に包まれた。", itemname(ci) + " " + is2(inv(INV_ITEM_NUM, ci)) + " surrounded by a golden aura.")
				inv(INV_ITEM_LEVEL, ci)++
			}
			else {
				txt lang(itemname(ci) + "は抵抗した。", itemname(ci) + " resist" + _s2(inv(INV_ITEM_NUM, ci)) + ".")
			}
			r1 = cc
			gosub *charaRefresh
		}
		else {
			obvious = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_FILL_CHARGE | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_RECHARGE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		if ( efid == SKILL_SPACT_FILL_CHARGE ) {
			if ( gdata(GDATA_ABSORB_CHARGE) < 10 ) {
				txt lang("充填するには最低でも魔力の貯蓄が10必要だ。", "You need at least 10 recharge powers to recharge items.")
				goto *effect_end
			}
			gdata(GDATA_ABSORB_CHARGE) -= 10
			txt lang("魔力の貯蓄を10消費した(残り" + gdata(GDATA_ABSORB_CHARGE) + ")", "You spend 10 recharge powers. (Remaining:" + gdata(GDATA_ABSORB_CHARGE) + ")")
		}
		invsubroutine = 1
		invctrl = 23, 3
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			dbid = inv(INV_ITEM_ID, ci)
			dbmode = DBMODE_REF
			gosub *db_item
			if ( ichargelevel < 1 | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_WISHING | inv(INV_ITEM_ID, ci) == ITEM_ID_ROD_DOMINATION | inv(INV_ITEM_ID, ci) == ITEM_ID_SPELLBOOK_WISHING | inv(INV_ITEM_ID, ci) == ITEM_ID_SPELLBOOK_HARVEST | (inv(INV_ITEM_ID, ci) == ITEM_ID_ANCIENT_BOOK & inv(INV_ITEM_PARAM2, ci) != 0) ) {
				txt lang("それは充填ができないようだ。", "You can't recharge this item.")
				goto *effect_end
			}
			f = 1
			if ( inv(INV_ITEM_CHARGE, ci) > ichargelevel ) {
				f = -1
			}
			if ( f == (-1) ) {
				txt lang(itemname(ci) + "はこれ以上充填できないようだ。", itemname(ci) + " cannot be recharged anymore.")
				goto *effect_end
			}
			if ( rnd(efp / 25 + 1) == 0 ) {
				f = 0
			}
			if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_SPELLBOOK ) {
				if ( rnd(4) == 0 ) {
					f = 0
				}
			}
			if ( rnd(ichargelevel * ichargelevel + 1) == 0 ) {
				f = 0
			}
			if ( f == 1 ) {
				p = 2
				if ( rnd(sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 2) >= rnd(100) + 1 ) {
					p++
				}
				if ( p + inv(INV_ITEM_CHARGE, ci) > ichargelevel ) {
					p = ichargelevel - inv(INV_ITEM_CHARGE, ci) + 1
				}
				if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_SPELLBOOK ) {
					if ( rnd(sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 2) >= rnd(100) + 1 ) {
						p++
					}
					p = 1
				}
				txt lang(itemname(ci) + "は充填された(+" + p + ")", itemname(ci) + " " + is2(inv(INV_ITEM_NUM, ci)) + " recharged by +" + p + ".")
				inv(INV_ITEM_CHARGE, ci) += p
				animeload ANIMATION_FIZZLE, cc
				if ( cc == CHARA_PLAYER ) {
					item_stack CHARA_PLAYER, ci, 1
				}
				skillexp SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER, 50
			}
			else {
				if ( rnd(limit(sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER), 0, 198) + 2) == 0 ) {
					txt lang(itemname(ci) + "は破裂した。", itemname(ci) + " explode" + _s2(inv(INV_ITEM_NUM, ci)) + ".")
					inv(INV_ITEM_NUM, ci)--
					gosub *calcBurdenPc
					goto *effect_end
				}
				txt lang(itemname(ci) + "への充填は失敗した。", "You fail to recharge " + itemname(ci) + ".")
			}
		}
		else {
			obvious = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DRAW_CHARGE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 23, 5
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt_nodrop
				item_stack CHARA_PLAYER, ci
				goto *effect_end
			}
			dbid = inv(INV_ITEM_ID, ci)
			dbmode = DBMODE_REF
			gosub *db_item
			repeat 1
				if ( ichargelevel == 1 ) {
					p = 100 + limit((sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 1) / 10, 0, 50)
					break
				}
				if ( ichargelevel == 2 ) {
					p = 25 + limit((sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 1) / 10, 0, 10)
					break
				}
				if ( ichargelevel <= 4 ) {
					p = 5 + limit((sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 1) / 10, 0, 3)
					break
				}
				if ( ichargelevel <= 6 ) {
					p = 3 + limit((sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 1) / 10, 0, 2)
					break
				}
				p = 1
			loop
			animeload ANIMATION_FIZZLE, cc
			if ( ichargelevel >= 14 ) {
				p = (inv(INV_ITEM_CHARGE, ci) + 1) / 2 + inv(INV_ITEM_CHARGE, ci) * limit((sdata(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + 1) / 10, 0, 2)
				gdata(GDATA_ABSORB_CHARGE) += p
			}
			else {
				p = p * inv(INV_ITEM_CHARGE, ci)
				gdata(GDATA_ABSORB_CHARGE) += p
			}
			txt lang(itemname(ci) + "を破壊して" + p + "の魔力を抽出した(計" + gdata(GDATA_ABSORB_CHARGE) + ")", "You destroy " + itemname(ci) + " and extract " + p + " recharge powers. (Total:" + gdata(GDATA_ABSORB_CHARGE) + ")")
			inv(INV_ITEM_NUM, ci) = 0
			gosub *calcBurdenPc
			skillexp SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER, 100
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CHANGE | _switch_sw ) {
		_switch_sw = 0
*jump_changeCreature
		if ( tc == CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		f = 1
		if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE | cbit(CHARA_BIT_BODYGUARD, tc) == 1 | cbit(CHARA_BIT_PRECIOUS, tc) == 1 | cbit(CHARA_BIT_LIVESTOCK, tc) == 1 | cbit(CHARA_BIT_NECRO, tc) == 1 | gdata(GDATA_FLAG_DUEL_TARGET) == tc ) {
			f = -1
		}
		if ( tc < 57 ) {
			f = 0
		}
		if ( f == 1 ) {
			animeload ANIMATION_FIZZLE, tc
			txt lang(name(tc) + "は変化した。", name(tc) + " change" + _s(tc) + ".")
			flt calcobjlv(cdata(CDATA_LEVEL, tc) + 3), 2
			characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
			relocate_chara 56, tc, 1
			cdata(CDATA_TARGET, tc) = cc
			cbitmod CHARA_BIT_QUEST_TARGET, tc, 0
			check_quest
		}
		else {
			if ( f == 0 ) {
				txt lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			else {
				txt lang(name(tc) + "は変化できない。", name(tc) + " cannot be changed.")
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_DECREASE_WEIGHT | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 23, 6
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
			animeload ANIMATION_FIZZLE, cc
			if ( efstatus >= 0 ) {
				if ( inv(INV_ITEM_WEIGHT, ci) > 0 ) {
					inv(INV_ITEM_WEIGHT, ci) = limit(inv(INV_ITEM_WEIGHT, ci) * (100 - efp / 10) / 100, 1, inv(INV_ITEM_WEIGHT, ci))
				}
				txt lang("" + itemname(ci, 1) + "は羽が生えたように軽くなった。", itemname(ci, 1) + " becomes as light as a feather.")
			}
			else {
				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, ci) * 150 / 100 + 1000
				txt lang("" + itemname(ci, 1) + "はずしりと重くなった。", itemname(ci, 1) + " becomes heavy.")
			}
			gosub *calcBurdenPc
		}
		else {
			txt_nothinghappens
			obvious = 0
		}
		r1 = cc
		gosub *charaRefresh
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_CHANGE_ITEM | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = 23, 4
		snd SOUNDLIST_INV
		gosub *com_inventory
		f = stat
		if ( f ) {
			if ( inv(INV_ITEM_QUALITY, ci) > FIX_QUALITY_MIRACLE | ibit(ITEM_BIT_PRECIOUS, ci) == 1 ) {
				f = 0
			}
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_CONTAINER ) {
			f = 0
		}
		if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
			snd SOUNDLIST_FAIL1
			txt_nodrop
			f = 0
		}
		if ( f == 1 ) {
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
			animeload ANIMATION_FIZZLE, cc
			fltbk = refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE)
			valuebk = calcitemvalue(ci, 0)
			inv(INV_ITEM_NUM, ci) = 0
			repeat
				await
				flt calcobjlv(efp / 10) + 5, calcfixlv(FIX_QUALITY_GREAT)
				if ( cnt < 10 ) {
					flttypemajor = fltbk
				}
				itemcreate 0, ITEM_ID_DUMMY, -1, -1, 0
				if ( stat == 0 ) {
					continue
				}
				if ( inv(INV_ITEM_VALUE, ci) > valuebk * 3 / 2 + 1000 ) {
					inv(INV_ITEM_NUM, ci) = 0
					continue
				}
				else {
					break
				}
			loop
			txt lang("それは" + itemname(ci, 1) + "に変容した。", "It metamorphosed into " + itemname(ci, 1) + ".")
			gosub *calcBurdenPc
		}
		else {
			txt_nothinghappens
			obvious = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_DOOR_CREATION | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPELL_WALL_CREATION | _switch_sw ) {
		_switch_sw = 0
		x = tlocx
		y = tlocy
		f = 1
		if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
			f = 0
		}
		else {
			if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
				if ( homemapmode == 0 ) {
					if ( efid != SKILL_SPELL_DOOR_CREATION ) {
						f = 0
					}
					else {
						if ( chipm(CHIPM_ROLE, map(x, y, 0)) == MAP_CHIP_ROLE_WATER ) {
							f = 0
						}
					}
				}
			}
			if ( map(x, y, 1) != 0 | map(x, y, 6) != 0 ) {
				f = 0
			}
		}
		if ( f == 1 ) {
			if ( efid == SKILL_SPELL_WALL_CREATION ) {
				if ( homemapmode == 0 ) {
					txt lang("床が盛り上がってきた。", "A wall appears.")
					p = tile_wall
				}
				else {
					p = tile
				}
				if ( map(x, y, 0) != p ) {
					snd SOUNDLIST_OFFER1
				}
				map(x, y, 0) = p
				map(x, y, 2) = p
			}
			if ( efid == SKILL_SPELL_DOOR_CREATION ) {
				snd SOUNDLIST_OFFER1
				if ( chipm(CHIPM_ROLE, map(x, y, 0)) == MAP_CHIP_ROLE_HARD_WALL ) {
					txt lang("この壁は魔法を受け付けないようだ。", "These walls seem to resist your magic.")
					goto *effect_end
				}
				txt lang("扉が出現した。", "A door appears.")
				cell_featset x, y, tile_doorclosed, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
				if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					map(x, y, 0) = tile_tunnel
				}
			}
		}
		else {
			if ( homemapmode == 0 ) {
				txt_nothinghappens
			}
			obvious = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HOUZANHA | _switch_sw ) {
		_switch_sw = 0
		animeload ANIMATION_HEAL_FAST, cc
		txtef COLOR_BLUE
		txt lang("地面から無数の気が迸る！", "Haaaaaaaaaa!")
		if ( gdata(GDATA_AREA) == AREA_PET_ARENA | mdata(MDATA_TYPE) == MAP_TYPE_WORLD | gdata(GDATA_AREA) == AREA_PYRAMID | gdata(GDATA_AREA) == AREA_JAIL ) {
			if ( synccheck(tc, -1) ) {
				txt lang("むぅ 最大の奥義がかき消されるとは！", "These walls seem to resist your magic.")
				goto *effect_end
			}
		}
		repeat 400
			repeat 2
				x = rnd(mdata(MDATA_WIDTH))
				y = rnd(mdata(MDATA_HEIGHT))
				if ( map(x, y, 0) != 701 & map(x, y, 0) != 671 ) {
					map(x, y, 0) = 38
				}
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
				x = rnd(mdata(MDATA_WIDTH))
				y = rnd(mdata(MDATA_HEIGHT))
			}
			if ( cnt \ 7 == 0 ) {
				gosub *screen_draw
				if ( rnd(3) == 0 ) {
					snd SOUNDLIST_CRUSH1
				}
				await 25
			}
		loop
		skillexp SKILL_NORMAL_MINING, cc, 500
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GOLDEN_STORM | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_GOLD, cc) < 2000 ) {
			goto *effect_end
		}
		repeat 10
			gosub *com_findTarget
			if ( listmax == 0 ) {
				break
			}
			tc = list(0, rnd(listmax))
			if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) >= 0 ) {
				if ( cdata(CDATA_RELATION, tc) >= 0 ) {
					if ( cnt == 0 ) {
						continue
					}
				}
				if ( cdata(CDATA_RELATION, tc) >= 0 ) {
					if ( cnt != 0 ) {
						continue cnt + (rnd(10) == 0)
					}
				}
			}
			else {
				if ( cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) ) {
					continue cnt + (rnd(10) == 0)
				}
			}
			if ( cnt == 1 ) {
				if ( synccheck(cc, -1) ) {
					if ( cdata(CDATA_ID, cc) == CREATURE_ID_YACATECT | cdata(CDATA_ID, cc) == CREATURE_ID_HYPER_YACATECT ) {
						txt lang("「こぉぉんのっ！アホーーーーッ！！！」", "*Ooban-Burumai*")
					}
				}
			}
			animeid = ANIMATION_GOLDENSTORM
			gosub *anime
			dmghp tc, sdata(SKILL_WEAPON_THROWING, cc) / 5 * sqrt(sdata(SKILL_NORMAL_INVESTING, cc) + 1) * 3 + rnd(10) + 5, cc, SKILL_RESDMG_CRUSH, 1000
			dmgcon tc, CONDITION_BLIND, 100 + gdata(GDATA_LEVEL) * 2
			if ( cdata(CDATA_CONDITION_BLIND, tc) == 0 ) {
				if ( rnd(20) == 0 ) {
					cdata(CDATA_CONDITION_BLIND, tc) = 1
					txt lang(name(tc) + "は目が眩んだ！", name(tc) + " dazzle" + _s(tc) + ".")
				}
			}
			cdata(CDATA_GOLD, cc) -= 200
		loop
		goto *effect_end
	}
	if ( _switch_val == 738 | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		txtef COLOR_BLUE
		txt lang("ストラックアウト！", "Struck Out!")
		tcbk = tc
		gosub *FindRangeWeapon
		if ( stat == 1 ) {
			if ( ammo != (-1) ) {
				goto *effect_end
			}
			repeat MAX_CHARA_TOTAL
				gdata(GDATA_TEMPORARY_FLAGS) = 0
				if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cnt != tcbk ) {
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
							continue
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE & cdata(CDATA_RELATION, cnt) >= RELATION_DISLIKE) ) {
							continue
						}
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_SWARM) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) == 0 ) {
					continue
				}
				ele = SKILL_NONE
				gdata(GDATA_TEMPORARY_FLAGS) = 300
				attackrange = 1
				extraattack = 0
				gosub *act_fire
			loop
		}
		gdata(GDATA_TEMPORARY_FLAGS) = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_SMASH_GROUND | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は地面を砕いた！", name(cc) + " smash" + _s(cc, 1) + " the ground!")
		}
		snd SOUNDLIST_CRUSH1
		snd SOUNDLIST_BALL1
		animeload ANIMATION_BALL_NUKE, cc
		map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0) = 12
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_SWARM) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			calcmagiccontrol cc, tc
			if ( stat == 1 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "に破片が命中した。", name(tc) + " " + was(tc) + " struck by debris.")
			}
			dmg = rnd(sdata(SKILL_ATTR_STR, cc) * sqrt(sdata(SKILL_ATTR_STR, cc)) + sdata(SKILL_ATTR_STR, cc) * 2)
			dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
			if ( cdata(CDATA_CONDITION_WINCE, tc) <= 0 ) {
				cdata(CDATA_CONDITION_WINCE, tc) = 1 + rnd(5)
				txt lang(name(tc) + "は怯んだ。", name(tc) + " " + was(tc) + " frightened.")
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SWARM | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		txtef COLOR_BLUE
		txt lang("スウォーム！", "Swarm!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_ID, cc) != CREATURE_ID_BERSERK_DRAGON ) {
				if ( findbuff(cc, BUFF_RUN_WILDLY) == (-1) ) {
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
							continue
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, cnt) >= (-1)) ) {
							continue
						}
					}
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_SWARM) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			animeid = ANIMATION_ATTACK
			gosub *anime
			gosub *act_melee
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHINING_THROW | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		tcbk = tc
		gosub *FindRangeWeapon
		if ( stat == 1 ) {
			if ( ammo != (-1) ) {
				goto *effect_end
			}
			longthrow = 100
			attackitem = cw
			attackrange = 1
			extraattack = 0
			gosub *act_attack
		}
		longthrow = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_STRUCK_OUT | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		txtef COLOR_BLUE
		txt lang("ストラックアウト！", "Struck Out!")
		tcbk = tc
		gosub *FindRangeWeapon
		if ( stat == 1 ) {
			if ( ammo != (-1) ) {
				goto *effect_end
			}
			repeat MAX_CHARA_TOTAL
				gdata(GDATA_TEMPORARY_FLAGS) = 0
				if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cnt != tcbk ) {
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
							continue
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, cnt) >= (-1)) ) {
							continue
						}
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_SWARM) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, tcbk), cdata(CDATA_Y, tcbk), dx, dy) == 0 ) {
					continue
				}
				ele = SKILL_NONE
				gdata(GDATA_TEMPORARY_FLAGS) = 300
				attackrange = 1
				extraattack = 0
				gosub *act_fire
			loop
		}
		gdata(GDATA_TEMPORARY_FLAGS) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DROP_MINE | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *effect_end
		}
		if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 6) != 0 ) {
			goto *effect_end
		}
		cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_QUEST_MINE, cc
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は何かを投下した。", name(cc) + " drop" + _s(cc) + " something on the ground.")
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_GRAVITY | _switch_sw ) {
		_switch_sw = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cbit(CHARA_BIT_IMMUNE_MINE, cnt) ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > 2 * 2 ) {
				continue
			}
			if ( findbuff(tc, BUFF_FEATHER) != (-1) ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は重力を感じた。", name(tc) + " feel" + _s(tc) + " gravity.")
			}
			cdata(CDATA_CONDITION_GRAVITY, tc) += 50 + rnd(50)
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MEWMEWMEW | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		txtef COLOR_BLUE
		txt lang("うみみゃぁ！", "Mewmewmew!")
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		animeid = ANIMATION_HOLY
		animode = 0
		gosub *anime
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
				dmghp tc, 49999, cc
			}
			else {
				dmghp tc, 99999, cc
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MANIS_DISASSEMBLY | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		txt lang("「余分な機能は削除してしまえ」", cnvtalk("Delete."))
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		snd SOUNDLIST_CRUSH1
		animeload ANIMATION_BALL_NUKE, tc
		if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
			cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc) / 3 + 1
		}
		else {
			cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc) / 12 + 1
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SUPER_VIBRATING_FIST | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		txt lang("「くらえィ！フハハハーッ！」", cnvtalk("Muwahahahaha!"))
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_OFFER, tc
		snd SOUNDLIST_BALL1
		if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
			dmghp tc, 333333, cc
		}
		else {
			dmghp tc, 999999, cc
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EXCESSIVE_HEAL | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		txt lang("過剰なまでの癒しの力が" + name(tc) + "の体組織を崩壊させる…！", "Excessive heal power break tissue of target!")
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		animeid = ANIMATION_HEAL
		gosub *anime
		if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
			dmgcon tc, CONDITION_BLEED, 9999
		}
		else {
			dmgcon tc, CONDITION_BLEED, 999999
		}
		healhp cc, 999999
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHINE_SNAIL | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 10 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				cdata(CDATA_POWER_GAUGE, cc) -= 100
				efid = SKILL_SPACT_PIERCING_ZERO_SHOOT
				gosub *effect
				goto *effect_end
			}
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txt lang("「うおおおおお！シャィィィインスネェェェェイル！！」", cnvtalk("OK? Shine-Snail!!"))
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		animeid = ANIMATION_HOLY
		animode = 100 + tc
		gosub *anime
		dmghp tc, 30000, cc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ELEMENTIA | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		if ( synccheck(tc, -1) ) {
			txt lang("「我は導く 元素の調和 完成せよ 究極元素魔法（エレメンティア）」", cnvtalk("Complete Elementia!"))
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		animeload ANIMATION_SAND, tc
		snd SOUNDLIST_BOLT1
		if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
			dmgmp tc, 333333
		}
		else {
			dmgmp tc, 999999
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GOLD_RUSH | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 98 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		if ( synccheck(tc, -1) ) {
			txt lang("「ウチの繰り出す黄金の猛撃、見たってや！」", cnvtalk("This is my rush!"))
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		addbuff tc, BUFF_SPEED, 9999, 30
		addbuff tc, BUFF_HERO, 50000, 30
		addbuff tc, BUFF_CONTINGENCY, 9999, 30
		addbuff tc, BUFF_HOLY_SHIELD, 9999, 30
		addbuff tc, BUFF_REGENERATION, 9999, 30
		addbuff tc, BUFF_ATTRIBUTE_SHIELD, 9999, 30
		addbuff tc, BUFF_HOLY_VEIL, 9999, 30
		snd SOUNDLIST_ATK_ELEC
		animeload ANIMATION_THROW, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_METEOR | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_PET_ARENA | mdata(MDATA_TYPE) == MAP_TYPE_WORLD | gdata(GDATA_AREA) == AREA_PYRAMID | gdata(GDATA_AREA) == AREA_JAIL ) {
			if ( synccheck(tc, -1) ) {
				txt lang("隕石は大気圏で燃え尽きてしまったようだ…。", "These walls seem to resist your magic.")
				goto *effect_end
			}
		}
		txtef COLOR_BLUE
		txt lang("隕石が" + efp + "落ちてきた！", "" + efp + " meteorites fall all over the area!")
		animeid = ANIMATION_METEOR
		gosub *anime
		repeat mdata(MDATA_HEIGHT)
			dy = cnt
			repeat mdata(MDATA_WIDTH)
				dx = cnt
				if ( rnd(3) == 0 ) {
					map(dx, dy, 0) = 12 + rnd(2)
				}
				if ( rnd(40) == 0 ) {
					addmef dx, dy, 5, 24, rnd(4) + 3, 50
				}
				if ( map(dx, dy, 1) != 0 ) {
					tc = map(dx, dy, 1) - 1
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = limit(sqrt(sdata(SKILL_ATTR_MAG, cc) + 1) + rnd(sqrt(sdata(SKILL_ATTR_MAG, cc) + 1) + 1), 1, 60) * efp
					dmghp tc, dmg, cc, SKILL_RES_FIRE, 1000
					if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
						if ( cc >= MAX_CHARA_FOLLOWER | tc >= MAX_CHARA_FOLLOWER ) {
							dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, SKILL_RES_FIRE, 1000
							if ( synccheck(tc, -1) ) {
								txtef COLOR_PURPLE
								txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected magic.")
							}
						}
					}
				}
			loop
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MANA_BURST | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "はマナを解き放った。", name(cc) + " released own mana.")
		}
		snd SOUNDLIST_BREATH1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cc) == 10 | cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, cnt) == 10 | cnt == CHARA_PLAYER ) {
					continue
				}
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			calcmagiccontrol cc, tc
			if ( stat == 1 ) {
				continue
			}
			if ( cdata(CDATA_MP, cc) > sdata(SKILL_ATTR_MAG, cc) ) {
				dmghp tc, cdata(CDATA_MP, cc), cc
			}
			else {
				dmghp tc, sdata(SKILL_ATTR_MAG, cc), cc
			}
		loop
		if ( cdata(CDATA_MP, cc) > sdata(SKILL_ATTR_MAG, cc) ) {
			cdata(CDATA_MP, cc) = 0
		}
		else {
			dmgmp cc, sdata(SKILL_ATTR_MAG, cc)
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SAND_CANNON | _switch_sw ) {
		_switch_sw = 0
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は" + skillname(efid) + "を繰り出した。", name(cc) + " blast" + _s(cc) + " " + skillname(efid) + ".")
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		breath_list
		snd SOUNDLIST_SONIC
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat 8
			animeid = ANIMATION_SAND_CANNON
			gosub *anime
		loop
		cfg_animewait = waitbk
		repeat maxbreath
			dx = breathlist(0, cnt)
			dy = breathlist(1, cnt)
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( gdata(GDATA_RIDER) != 0 ) {
				if ( gdata(GDATA_RIDER) == cc ) {
					if ( tc == CHARA_PLAYER ) {
						continue
					}
				}
			}
			if ( map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
				tc = map(dx, dy, MAP_CHARA_INDEX_PLUS_ONE) - 1
				if ( cc != tc ) {
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt lang(name(tc) + "は" + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + "をかばった！", name(tc) + " guarded " + name(cdata(CDATA_TAGTEAM_PARTNER, tc)) + ".")
						}
					}
					dmg = role(dice1, dice2, bonus)
					if ( cdata(CDATA_ENHANCE_BREATH, cc) != 0 ) {
						dmg = dmg * (11 + limit(cdata(CDATA_ENHANCE_BREATH, cc) / 10, 0, 200) / 10) / 10
					}
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang(name(tc) + "に命中し", "The sand hits " + name(tc) + " and")
						}
						else {
							txt lang(name(tc) + "に命中した。", "The sand hits " + name(tc) + ".")
						}
					}
					dmghp tc, dmg, cc, ele, elep
					if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) == 0 ) {
						cdata(CDATA_CONDITION_SUFFOCATION, tc)++
					}
					dmgcon tc, CONDITION_BLIND, 100 + sdata(SKILL_ATTR_CON, cc)
				}
			}
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_MP_BREATH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_MP, cc) < cdata(CDATA_MAX_MP, cc) / 4 ) {
			txt_nothinghappens
			goto *effect_end
		}
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_MP_BREATH, cc
		ele = SKILL_RES_FIRE
		repeat MAX_SKILL_RESIST - STARTING_SKILL_RESIST, STARTING_SKILL_RESIST
			if ( sdata(cnt, cc) >= sdata(ele, cc) ) {
				ele = cnt
			}
		loop
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は" + skillname(efid) + "を繰り出した。", name(cc) + " blast" + _s(cc) + " " + skillname(efid) + ".")
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		breath_list
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat 8
			snd SOUNDLIST_CRUSH1
			animeid = ANIMATION_MP_BREATH
			gosub *anime
			snd SOUNDLIST_ATK_FIRE
		loop
		cfg_animewait = waitbk
		ele = SKILL_RES_MAGIC
		repeat maxbreath
			dx = breathlist(0, cnt)
			dy = breathlist(1, cnt)
			if ( map(dx, dy, 0) != 701 & map(dx, dy, 0) != 671 ) {
				map(dx, dy, 0) = 38
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( gdata(GDATA_RIDER) != 0 ) {
				if ( gdata(GDATA_RIDER) == cc ) {
					if ( tc == CHARA_PLAYER ) {
						continue
					}
				}
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = role(dice1, dice2, bonus)
					if ( cdata(CDATA_ENHANCE_BREATH, cc) != 0 ) {
						dmg = dmg * (11 + limit(cdata(CDATA_ENHANCE_BREATH, cc) / 10, 0, 200) / 10) / 10
					}
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang(name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
						}
						else {
							txt lang(name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
						}
					}
					dmghp tc, dmg, cc, ele, elep
				}
			}
		loop
		dmgmp cc, cdata(CDATA_MAX_MP, cc) / 4
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_READING_PARTY | _switch_sw ) {
		_switch_sw = 0
		ens2 = 0
		if ( cc != CHARA_PLAYER ) {
			goto *effect_end
		}
		txt lang("読む対象は？", "Which book?")
		invsubroutine = 1
		invctrl = 23, 12
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			studybuddy = ""
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
					if ( cnt >= MAX_CHARA_FOLLOWER ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				if ( studybuddy == "" ) {
					studybuddy = name(tc)
				}
				else {
					studybuddy = "your friends"
				}
				ens2 += limit((sdata(SKILL_NORMAL_LITERACY, tc) + sdata(SKILL_NORMAL_MEMORIZATION, tc) + 1) / 2, 3, 3 + sdata(SKILL_NORMAL_LITERACY, cc) / 5)
			loop
			if ( ens2 > 100 ) {
				ens2 = 100
			}
			if ( ens2 == 0 ) {
				txt lang("あなたはひとりぼっちだ…。", "You're all alone.")
				goto *effect_end
			}
			txt lang("あなたと仲間たちは読書会を始めた。", "You started a reading party with " + studybuddy + ".")
			gosub *readSpellbook
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_LOCK_BREAK | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			goto *effect_end
		}
		txt lang("開ける対象は？", "Which target?")
		invsubroutine = 1
		invctrl = 23, 14
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			item_separate ci
			if ( inv(INV_ITEM_PARAM1, ci) != 0 ) {
				if ( inv(INV_ITEM_PARAM2, ci) != 0 ) {
					if ( inv(INV_ITEM_ID, ci) != ITEM_ID_CARD_PACK ) {
						breakstr = 0
						repeat MAX_CHARA_FOLLOWER - 1, 1
							if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
								continue
							}
							if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
								continue
							}
							if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) == 0 ) {
								continue
							}
							breakstr += sdata(SKILL_ATTR_STR, cnt)
							if ( sdata(SKILL_NORMAL_LOCK_PICKING, cnt) > 0 ) {
								breakstr += sdata(SKILL_NORMAL_LOCK_PICKING, cnt)
							}
						loop
						breakstr += sdata(SKILL_ATTR_STR, CHARA_PLAYER)
						if ( sdata(SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER) > 0 ) {
							breakstr += sdata(SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER)
						}
						snd SOUNDLIST_LOCKED1
						await 70
						snd SOUNDLIST_LOCKED1
						await 70
						snd SOUNDLIST_LOCKED1
						await 70
						snd SOUNDLIST_BASH1
						await 100
						snd SOUNDLIST_BASH1
						await 100
						snd SOUNDLIST_BALL1
						redraw 0
						gosub *screen_draw
						gosub *screen_fade
						gsel 4
						buffer 4, FACE_SIZE_WIDTH, FACE_SIZE_HEIGHT
						pos 0, 0
						picload exedir + "graphic\\face1" + devfile + ".bmp", 1
						gsel 0
						if ( breakstr / 2 < inv(INV_ITEM_PARAM2, ci) ) {
							txtef COLOR_BLUE
							txt lang("…力任せでも無理だということがわかった。", "...You realize that it's impossible to force open.")
							goto *effect_end
						}
						if ( rnd(rnd(breakstr + 1) + 1) < inv(INV_ITEM_PARAM2, ci) ) {
							txtef COLOR_BLUE
							txt lang("…なかなか頑丈だ。", "...It's quite sturdy.")
							goto *effect_end
						}
						snd SOUNDLIST_CRUSH1
						txtef COLOR_GREEN
						txt lang("錠の破壊に成功した！", "You succeeded in destroying the lock!")
						ri = ci
						cc = CHARA_PLAYER
						gosub *open_chest
						skillexp SKILL_ATTR_STR, CHARA_PLAYER, 50
						skillexp SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER, 40 + inv(INV_ITEM_PARAM2, ci) / 3
						repeat MAX_CHARA_FOLLOWER - 1, 1
							if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
								continue
							}
							if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
								continue
							}
							if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) == 0 ) {
								continue
							}
							skillexp SKILL_ATTR_STR, cnt, 50
							if ( sdata(SKILL_NORMAL_LOCK_PICKING, cnt) > 0 ) {
								skillexp SKILL_NORMAL_LOCK_PICKING, cnt, 40
							}
						loop
					}
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DUPLICANE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			goto *effect_end
		}
		if ( gdata(GDATA_FLAG_DUPLICANE) == 100 ) {
			gdata(GDATA_FLAG_DUPLICANE) = 0
			txt lang("あなたは普通に杖で攻撃することにした。", name(cc) + " will attack by normal cane.")
			return
		}
		if ( gdata(GDATA_FLAG_DUPLICANE) == 0 ) {
			gdata(GDATA_FLAG_DUPLICANE) = 100
			snd SOUNDLIST_ENC2
			txt lang("あなたは複製した杖で攻撃することにした。", name(cc) + " will attack by duplicated cane.")
			return
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_VINDALIAN_JIUJITSU | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc) == TRUE ) {
			cbitmod CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc, FALSE
			txt lang(name(cc) + "は呼吸を整え、構えを変えた。", name(cc) + " steadied " + his(cc) + " breathing and changed " + his(cc) + " posture.")
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc) == FALSE ) {
			snd SOUNDLIST_SWING
			cbitmod CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc, TRUE
			txt lang(name(cc) + "は呼吸を整え、柔術の構えをとった。", name(cc) + " steadied " + his(cc) + " breathing and changed " + his(cc) + " posture.")
			goto *effect_end
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_LIQUID_MANIPULATION | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txt lang("使用するポーションは？", "Which potion?")
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 11
			snd SOUNDLIST_INV
			gosub *com_inventory
		}
		else {
			ti = inv_getfreeid(cc)
			if ( ti != (-1) ) {
				flt
				itemcreate cc, ITEM_ID_POTION_PARALYSIS, -1, -1, 0
				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
			}
			else {
				goto *effect_end
			}
		}
		if ( stat == 1 ) {
			snd SOUNDLIST_MIZU
			animeload 49, cc
			txtef COLOR_BLUE
			txt lang(name(cc) + "は液体を操り、拡散射出した。", name(cc) + " established a breathing and changed the posture.")
			ccthrowpotion = cc
			cibk = ci
			if ( cc == CHARA_PLAYER ) {
				if ( inv(INV_ITEM_PIC, ci) == xy2pic(24, 10) ) {
					gdata(GDATA_FLAG_TOTAL_POTION_PLUGS)++
				}
			}
			inv(INV_ITEM_NUM, ci)--
			if ( cc == CHARA_PLAYER ) {
				gosub *calcBurdenPc
			}
			waitbk = cfg_animewait
			if ( cfg_animewait > 0 ) {
				cfg_animewait = 0
			}
			repeat MAX_CHARA_TOTAL
				potionthrow = 90
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 5 + 4) * ((sdata(SKILL_NORMAL_ALCHEMY, cc) + 1) / 5 + 3) / 2 + rnd(sdata(SKILL_NORMAL_ALCHEMY, cc) + 5) + 1, cc, SKILL_RESDMG_CRUSH, 1000
				if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( inv(INV_ITEM_ID, ci) != ITEM_ID_ESSENTIAL_OIL & inv(INV_ITEM_ID, ci) != ITEM_ID_GASOLINE ) {
					wet tc, 25
				}
				cc = tc
				ci = cibk
				dbmode = DBMODE_ON_DRINK
				dbid = inv(INV_ITEM_ID, ci)
				gosub *db_item
			loop
			cfg_animewait = waitbk
			cc = ccthrowpotion
			potionthrow = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_LINEAR_LAUNCHER | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txt lang("消費＆射出するアイテムは？", "Which item will you consume?")
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 25
			snd SOUNDLIST_INV
			gosub *com_inventory
		}
		else {
			ti = inv_getfreeid(cc)
			if ( ti != (-1) ) {
				flt
				itemcreate cc, ITEM_ID_ORE_PIECE, -1, -1, 0
				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
			}
			else {
				goto *effect_end
			}
		}
		if ( stat == 1 ) {
			snd SOUNDLIST_ATK_ELEC
			txtef COLOR_BLUE
			txt lang(itemname(ci) + "が高速で射出された。", itemname(ci) + " was launched at high speed.")
			inv(INV_ITEM_NUM, ci)--
			if ( cc == CHARA_PLAYER ) {
				gosub *calcBurdenPc
			}
			waitbk = cfg_animewait
			if ( cfg_animewait > 0 ) {
				cfg_animewait = 1
			}
			animeid = ANIMATION_LINEAR_LAUNCHER
			aniref = ci
			gosub *anime
			cfg_animewait = waitbk
			dmg = sdata(SKILL_ATTR_PER, cc) / 2 * limit(inv(INV_ITEM_WEIGHT, ci) / 1000, 1, 50) + sdata(SKILL_ATTR_PER, cc) * 2 + rnd(inv(INV_ITEM_WEIGHT, ci) / 500 + 1)
			if ( cbit(CHARA_BIT_MAGNETISM_S_POLE, cc) | cbit(CHARA_BIT_MAGNETISM_N_POLE, cc) ) {
				dmghp tc, dmg * 2, cc, SKILL_RESDMG_CRUSH, 1000
			}
			else {
				dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
			}
			if ( inv(INV_ITEM_WEIGHT, ci) >= 10000 & cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				if ( cdata(CDATA_CONDITION_INVERT, tc) < 1 ) {
					cdata(CDATA_CONDITION_INVERT, tc) = 1
					if ( synccheck(tc, -1) ) {
						txtmore
						txtef COLOR_PURPLE
						txt lang(name(tc) + "は転倒した。", name(tc) + " " + is(tc) + " knocked down.")
					}
				}
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_ALCHEMICAL_RAIN	| _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txt lang("使用するポーションは？", "Which potion?")
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 11
			snd SOUNDLIST_INV
			gosub *com_inventory
		}
		else {
			ti = inv_getfreeid(cc)
			if ( ti != (-1) ) {
				flt
				itemcreate cc, ITEM_ID_POTION_RESTORE_SPIRIT, -1, -1, 0
				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
			}
			else {
				goto *effect_end
			}
		}
		if ( stat == 1 ) {
			snd SOUNDLIST_RAIN
			txtef COLOR_BLUE
			txt lang(itemname(ci) + "の雨が辺りに降り注いだ。", itemname(ci) + " rain poured down in around.")
			ccthrowpotion = cc
			cibk = ci
			if ( cc == CHARA_PLAYER ) {
				if ( inv(INV_ITEM_PIC, ci) == xy2pic(24, 10) ) {
					gdata(GDATA_FLAG_TOTAL_POTION_PLUGS)++
				}
			}
			inv(INV_ITEM_NUM, ci)--
			if ( cc == CHARA_PLAYER ) {
				gosub *calcBurdenPc
			}
			waitbk = cfg_animewait
			if ( cfg_animewait > 0 ) {
				cfg_animewait = 0
			}
			repeat MAX_CHARA_TOTAL
				potionthrow = 90
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
					if ( cnt >= 16 ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				if ( inv(INV_ITEM_ID, ci) != ITEM_ID_ESSENTIAL_OIL & inv(INV_ITEM_ID, ci) != ITEM_ID_GASOLINE ) {
					wet tc, 25
				}
				cc = tc
				ci = cibk
				dbmode = DBMODE_ON_DRINK
				dbid = inv(INV_ITEM_ID, ci)
				gosub *db_item
			loop
			cfg_animewait = waitbk
			cc = ccthrowpotion
			potionthrow = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_HAZARD_RECIPE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *effect_end
			snd SOUNDLIST_RAIN
			txtef COLOR_BLUE
			txt lang("雨が辺りに降り注いだ。", "Rain pours down all around.")
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				wet tc, 30
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					hostileaction cc, tc
				}
			loop
			goto *effect_end
		}
		txt lang("対象にする食品は？", "Which food?")
		invsubroutine = 1
		invctrl = 23, 19
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			snd SOUNDLIST_ATK_POISON
			item_separate ci
			txtef COLOR_RED
			txt lang(itemname(ci) + "にアレンジを加えた！", "You arranged " + itemname(ci) + ".")
			ibitmod ITEM_BIT_HAZARD, ci, 1
			inv(INV_ITEM_COL, ci) = COLOR_DARK_GRAY3
			inv(INV_ITEM_VALUE, ci) = 1
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ZERO_SHOOT | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		gosub *FindRangeWeapon
		if ( stat == 1 ) {
			if ( ammo == (-1) ) {
				goto *effect_end
			}
			gdata(GDATA_TEMPORARY_FLAGS3) = 150
			attackrange = 1
			extraattack = 0
			gosub *act_attack
		}
		gdata(GDATA_TEMPORARY_FLAGS3) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHADOW_RUSH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 75 ) {
			if ( cc == CHARA_PLAYER ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 75
		if ( cdata(CDATA_ID, cc) == CREATURE_ID_GETUEI_THE_NINJA_MASTER ) {
			txt lang("「超忍法・影の舞！」", "*Shadow Dance*")
			snd SOUNDLIST_CARD1
			redraw 0
			gosub *screen_draw
			gosub *screen_fade
			gsel 4
			buffer 4, FACE_SIZE_WIDTH, FACE_SIZE_HEIGHT
			pos 0, 0
			picload exedir + "graphic\\face1" + devfile + ".bmp", 1
			gsel 0
		}
		else {
			snd SOUNDLIST_ENC
			animeload ANIMATION_GIGA, cc
		}
		tcbk = tc
		gdata(GDATA_TEMPORARY_FLAGS2) = 100
		repeat MAX_CHARA_TOTAL
			if ( gdata(GDATA_AREA) == AREA_PET_ARENA ) {
				if ( cnt == CHARA_PLAYER ) {
					continue
				}
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_DEFENSIVE ) {
				continue
			}
			cc = cnt
			dx = cdata(CDATA_X, cc)
			dy = cdata(CDATA_Y, cc)
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, cc) != 0 | cdata(CDATA_CONDITION_DIM, cc) >= 60 | cdata(CDATA_CONDITION_BLIND, cc) != 0 | cdata(CDATA_CONDITION_PARALYZE, cc) != 0 | cdata(CDATA_CONDITION_SUFFOCATION, cc) != 0 | cdata(CDATA_CONDITION_BRAINWASH, cc) != 0 ) {
				continue
			}
			tc = tcbk
			efid = SKILL_SPACT_SHADOW_STEP
			gosub *effect
			if ( cc < MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
		loop
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_FIRE_A_VOLLEY | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 50 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 50
		snd SOUNDLIST_ENC
		animeload ANIMATION_GIGA, cc
		tcbk = tc
		gdata(GDATA_TEMPORARY_FLAGS2) = 100
		repeat 3
			repeat MAX_CHARA_TOTAL
				if ( gdata(GDATA_AREA) == AREA_PET_ARENA ) {
					if ( cnt == 0 ) {
						continue
					}
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
					if ( cnt >= MAX_CHARA_FOLLOWER ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
						continue
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_DEFENSIVE ) {
					continue
				}
				cc = cnt
				dx = cdata(CDATA_X, cc)
				dy = cdata(CDATA_Y, cc)
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				if ( cdata(CDATA_CONDITION_SLEEP, cc) != 0 | cdata(CDATA_CONDITION_DIM, cc) >= 60 | cdata(CDATA_CONDITION_BLIND, cc) != 0 | cdata(CDATA_CONDITION_PARALYZE, cc) != 0 | cdata(CDATA_CONDITION_SUFFOCATION, cc) != 0 | cdata(CDATA_CONDITION_BRAINWASH, cc) != 0 ) {
					continue
				}
				tc = tcbk
				if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
					extraattack = 0
					gosub *act_melee
					if ( cc != CHARA_PLAYER ) {
						snd SOUNDLIST_ATK_FIRE
					}
					attackvar = 0
					ammoproc = -1
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						hostileaction CHARA_PLAYER, tc
					}
				}
				if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) != 1 ) {
					gosub *FindRangeWeapon
					if ( stat == 1 ) {
						attackrange = 1
						extraattack = 0
						gosub *act_attack
						if ( cc != CHARA_PLAYER ) {
							snd SOUNDLIST_ATK_FIRE
						}
						attackvar = 0
						ammoproc = -1
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							hostileaction CHARA_PLAYER, tc
						}
					}
				}
			loop
		loop
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_OVERRAY | _switch_sw ) {
		_switch_sw = 0
		if ( findbuff(cc, BUFF_MIST_OF_SILENCE) != (-1) ) {
			txt lang("沈黙の霧が魔力の発生を阻止した。", "The mist of silence interrupts a spell.")
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) < 50 ) {
			txt_nothinghappens
			goto *effect_end
		}
		tcbk = tc
		malm = 0
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat MAX_CHARA_TOTAL
			if ( gdata(GDATA_AREA) == AREA_PET_ARENA ) {
				if ( cnt == CHARA_PLAYER ) {
					continue
				}
			}
			if ( cnt == cc ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			if ( findbuff(cnt, BUFF_MIST_OF_SILENCE) != (-1) ) {
				continue
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cnt) == DIRECTIVE_MODE_DEFENSIVE ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, tc) != 0 | cdata(CDATA_CONDITION_DIM, cc) >= 60 | cdata(CDATA_CONDITION_PARALYZE, tc) != 0 | cdata(CDATA_CONDITION_SUFFOCATION, tc) != 0 | cdata(CDATA_CONDITION_BRAINWASH, tc) != 0 ) {
				continue
			}
			customtalk tc, DBMODE_FLAVOR_MULTIPLE
			gosub *convert_word
			if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
				if ( jp ) {
					txt cdatan(CDATAN_NAME, tc) + "は" + cdatan(CDATAN_NAME, cc) + "に重ねて詠唱した。"
				}
			}
			if ( cbit(CHARA_BIT_UPLIFTED_WHILE_CASTING, tc) ) {
				cdata(CDATA_POWER_GAUGE, tc) += 5
				if ( cdata(CDATA_POWER_GAUGE, tc) > 100 ) {
					if ( cdata(CDATA_SHIFT_FORM, tc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, tc) <= 0 | tc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, tc) < FIX_QUALITY_MIRACLE | tc < MAX_CHARA_FOLLOWER) ) {
						cdata(CDATA_POWER_GAUGE, tc) = 100
					}
				}
				if ( cdata(CDATA_POWER_GAUGE, tc) > 200 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 200
				}
			}
			animeload 46, tc
			snd SOUNDLIST_ATK_MIND
			if ( cdata(CDATA_ID, tc) != CREATURE_ID_ANOTHER_WORLD_CHEATAH ) {
				cdata(CDATA_MP, tc) -= cdata(CDATA_MAX_MP, tc) / 10 + 1
			}
			malm += sdata(SKILL_ATTR_MAG, tc) + 10
		loop
		cfg_animewait = waitbk
		if ( malm == 0 ) {
			txt lang(cdatan(CDATAN_NAME, cc) + "はひとりぼっちだ…。", cdatan(CDATAN_NAME, cc) + " is lonely.")
			goto *effect_end
		}
		if ( malm > sdata(SKILL_ATTR_MAG, cc) * 9 ) {
			malm = sdata(SKILL_ATTR_MAG, cc) * 9
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 50
		tc = tcbk
		gdata(GDATA_TEMPORARY_FLAGS) = 666
		motomag = sdata(SKILL_ATTR_MAG, cc)
		sdata(SKILL_ATTR_MAG, cc) += malm
		efid = SKILL_SPELL_CRYSTAL_SPEAR
		gosub *cast_proc
		sdata(SKILL_ATTR_MAG, cc) = motomag
		gdata(GDATA_TEMPORARY_FLAGS) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CONTINUOUS_ATTACKS | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		waitbk = cfg_animewait
		attackbk = cfg_attackanime
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		if ( cfg_attackanime > 0 ) {
			cfg_attackanime = 0
		}
		gdata(GDATA_TEMPORARY_FLAGS2) = 1200
		repeat 17
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				continue
			}
			extraattack = 0
			animeid = ANIMATION_NORMAL_ATTACK
			gosub *anime
			snd SOUNDLIST_ATK2
			gosub *act_melee
		loop
		if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
			snd SOUNDLIST_BOLT1
		}
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			animeid = ANIMATION_NORMAL_ATTACK
			gosub *anime
			snd SOUNDLIST_BOLT1
			gosub *act_melee
		}
		cfg_animewait = waitbk
		cfg_attackanime = attackbk
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_RAMPAGE | _switch_sw ) {
		_switch_sw = 0
		animeload ANIMATION_GENE, cc
		snd SOUNDLIST_ATK_FIRE
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_ANGRY, tc) > 0 ) {
				if ( synccheck(tc, -1) ) {
					txt lang(name(tc) + "はすでに狂暴化している。", name(cc) + " has already gone berserk.")
				}
			}
			else {
				if ( synccheck(tc, -1) ) {
					txt lang(name(tc) + "は狂暴化した。", name(cc) + " went berserk.")
				}
				snd SOUNDLIST_ATK_FIRE
				cdata(CDATA_CONDITION_ANGRY, tc) += rnd(20) + 10
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SYNCHRO_HEARTS | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 4 ) {
			txt lang("窮地でなければ発動しない。", "Did not meet the conditions of use.")
			goto *effect_end
		}
		txtef COLOR_BLUE
		txt lang("集いし絆が、更なる力を紡ぎだす！", "With our hearts united, we spin off even more power!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_IMPRESSION, tc) < 100 ) {
				continue
			}
			snd SOUNDLIST_OFFER2
			customtalk tc, DBMODE_FLAVOR_KIZUNA
			gosub *convert_word
			if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
				txt lang("「まだ戦える！」", cnvtalk("I can still fight!")), lang("「勝負はこれから！」", cnvtalk("The game is just starting!")), lang("「心を一つに…！」", cnvtalk("Together as one...!")), lang("「絆パワー！」", cnvtalk("Alliance Power!"))
			}
			addbuff tc, BUFF_BOOST, cdata(CDATA_IMPRESSION, tc) * 2, 50
			addbuff tc, BUFF_REGENERATION, cdata(CDATA_IMPRESSION, tc) * 2, 50
			healhp tc, cdata(CDATA_MAX_HP, tc) / 2
			if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
				cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
			}
			healhp cc, cdata(CDATA_MAX_HP, cc) / 10
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SUPER_REGEN | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt_skillname
		healhp tc, cdata(CDATA_MAX_HP, tc) / 10 + 1
		addbuff tc, BUFF_SUPER_REGEN, 4000, 20
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BROWBEAT | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_CONDITION_ATROPHY, tc) > 0 ) {
			txt_nothinghappens
		}
		else {
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は畏縮した。", name(tc) + " was daunted by the browbeat.")
			}
			cdata(CDATA_CONDITION_ATROPHY, tc) += 5
			animeload ANIMATION_FIZZLE, tc
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SHINING_WAVE | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は衝撃波動を放った。", name(cc) + " sends out a shockwave.")
		if ( gdata(GDATA_ACTIVATE_PROC) == 100 ) {
			if ( ammo != (-1) ) {
				efp = sdata(SKILL_NORMAL_MARKSMAN, cc)
			}
			else {
				efp = sdata(SKILL_NORMAL_TACTICS, cc)
			}
		}
		else {
			efp = sdata(SKILL_NORMAL_TACTICS, cc)
		}
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		zannku = 10
		animeid = ANIMATION_BOLT
		gosub *anime
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmghp tc, sqrt(efp + 50) * efp + rnd(sdata(SKILL_ATTR_STR, cc) * 2), cc, SKILL_RESDMG_CRUSH, 1000
				}
			}
		loop
		zannku = 0
		efp = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BLOOD_STREAM | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は自分の血液を圧縮して放った。", name(cc) + " compressed and released a stream of blood.")
		if ( cdata(CDATA_CONDITION_BLEED, cc) < 100 ) {
			cdata(CDATA_CONDITION_BLEED, cc) += 8
		}
		efp = sdata(SKILL_ATTR_WIL, cc)
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		zannku = 10
		animeid = ANIMATION_BOLT
		gosub *anime
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = sqrt(sdata(SKILL_ATTR_CON, cc) + 1) * efp + rnd(sdata(SKILL_ATTR_CON, cc) * 2)
					if ( cdata(CDATA_CONDITION_BLEED, cc) >= 10 & cdata(CDATA_CONDITION_BLEED, cc) < 20 ) {
						dmg = dmg * 5 / 4
					}
					if ( cdata(CDATA_CONDITION_BLEED, cc) >= 20 & cdata(CDATA_CONDITION_BLEED, cc) < 30 ) {
						dmg = dmg * 3 / 2
					}
					if ( cdata(CDATA_CONDITION_BLEED, cc) >= 30 & cdata(CDATA_CONDITION_BLEED, cc) < 40 ) {
						dmg = dmg * 7 / 4
					}
					if ( cdata(CDATA_CONDITION_BLEED, cc) >= 40 ) {
						dmg = dmg * 2
					}
					dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
				}
			}
		loop
		zannku = 0
		efp = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MEGID_FLAME | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は祝福を焼き尽くす波動を放った。", name(cc) + " released a wave of dispelling flames.")
		animeid = ANIMATION_RAGNA
		gosub *anime
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			addbuff tc, BUFF_ELEMENT_SCAR, 150, 20
			p = 0
			repeat MAX_BLESSINGS + MAX_HEXES
				i = MAX_BLESSINGS + MAX_HEXES - cnt - 1
				if ( bdataref(0, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != 1 ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == 0 ) {
					continue
				}
				delbuff tc, i
				p++
				continue cnt
			loop
			if ( p > 0 ) {
				snd SOUNDLIST_ATK_FIRE
				animeload ANIMATION_GENE, tc
				p = 0
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BIND | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_CONDITION_BIND, tc) > 0 ) {
			goto *effect_end
		}
		else {
			snd SOUNDLIST_EAT1
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は束縛された。", name(tc) + " was bound.")
			}
			cdata(CDATA_CONDITION_BIND, tc) += 10
			animeload ANIMATION_ARROW_RAIN, tc
			snd SOUNDLIST_EAT1
			snd SOUNDLIST_EAT1
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SMOKE_MIRROR | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 | cdata(CDATA_ALLIED, cc) == 100 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 50
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 50 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		addbuff cc, BUFF_BLACK_MIRROR, 300, 300
		snd SOUNDLIST_ATK_DARK
		repeat mdata(MDATA_HEIGHT)
			dy = cnt
			repeat mdata(MDATA_WIDTH)
				dx = cnt
				if ( chipm(CHIPM_ATTRIB, map(dx, dy, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					continue
				}
				addmef dx, dy, 9, 963, 300, 300
			loop
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_INSANE_WAVE | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_TIME_STOP
				gosub *effect
				goto *effect_end
			}
		}
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txt lang("「ふふふ…あはははははっ！絶対に逃がさない…」", cnvtalk("You'll not escape..."))
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_LIVESTOCK, cc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
		}
		snd SOUNDLIST_CURSE3
		animeload ANIMATION_GARDEN, tc
		snd SOUNDLIST_OFFER2
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( tc >= MAX_CHARA_FOLLOWER & cdatan(CDATAN_RACE, tc) == "god" ) {
				dmgcon tc, CONDITION_INSANE, 1000
			}
			else {
				dmgcon tc, CONDITION_INSANE, 2000
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GROUP_HYPNOSIS | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は広範囲に催眠術を放った！", name(cc) + " spread hypnotism extensively!")
		snd SOUNDLIST_CHEST1
		animeload 48, tc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cbit(CHARA_BIT_NECRO, cnt) ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, tc) == 0 ) {
				dmgcon tc, CONDITION_SLEEP, limit(sdata(SKILL_RES_MIND, cc), 10, 2000)
				if ( cdata(CDATA_CONDITION_SLEEP, tc) > 10 ) {
					cdata(CDATA_CONDITION_SLEEP, tc) = 10
				}
			}
			addbuff tc, BUFF_NIGHTMARE, 150, 10
			if ( cdata(CDATA_CONDITION_SLEEP, tc) != 0 | cc == CHARA_PLAYER | cdata(CDATA_ALLIED, cc) != 0 ) {
				continue
			}
			if ( tc == CHARA_PLAYER ) {
				dmgcon CHARA_PLAYER, CONDITION_CONFUSE, 100
				if ( rnd(sdata(SKILL_ATTR_CHA, cc)) >= rnd(sdata(SKILL_ATTR_WIL, CHARA_PLAYER)) * 2 & findbuff(CHARA_PLAYER, BUFF_TAG_FORCE) == (-1) ) {
					animeload ANIMATION_FIZZLE, tc
					body = rnd(MAX_EQUIP_SLOT) + 1
					repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
						if ( cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS == body ) {
							p = cdata(cnt, CHARA_PLAYER) \ EXT_EQUIP_SLOTS
							if ( p == 0 ) {
								continue
							}
							p--
							inv(INV_ITEM_EQUIP, p) = 0
							cdata(cnt, CHARA_PLAYER) = cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS
							txtef COLOR_PURPLE
							txt lang(name(CHARA_PLAYER) + "は" + name(cc) + "に言われるがまま、装備を外してしまった。", name(tc) + " " + was(tc) + " brainwashed into removing " + his(tc) + " equipment.")
						}
					loop
					cdata(CDATA_CONDITION_BRAINWASH, CHARA_PLAYER) = limit(sdata(SKILL_ATTR_CHA, cc) / 5 - sdata(SKILL_ATTR_WIL, CHARA_PLAYER) / 5, 5, 25)
					r1 = CHARA_PLAYER
					gosub *charaRefresh
				}
				else {
					txtef COLOR_GREEN
					txt lang("あなたは" + name(cc) + "の洗脳を跳ね除けた。", "You resist " + name(cc) + "'s brainwashing.")
				}
				continue
			}
			sennnou = limit(cdata(CDATA_IMPRESSION, tc), 1, 300)
			if ( rnd(sennnou + sdata(SKILL_ATTR_CHA, CHARA_PLAYER)) > 50 + rnd(sdata(SKILL_ATTR_CHA, cc)) | findbuff(tc, BUFF_TAG_FORCE) != (-1) ) {
				txtef COLOR_GREEN
				txt lang(name(tc) + "は" + name(cc) + "の洗脳を跳ね除けた。", name(tc) + " resists " + name(cc) + "'s brainwashing.")
				continue
			}
			animeload ANIMATION_FIZZLE, tc
			cdata(CDATA_CONDITION_BRAINWASH, tc) = limit((300 - cdata(CDATA_IMPRESSION, tc)) * 1 / 10, 2, 15)
			cdata(CDATA_AI_AGGRO, tc) = 5
			cdata(CDATA_TARGET, tc) = 0
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_LOVE_CRAFTING | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は秘めたる狂気を垣間見せた…あまりに冒涜的だ！", name(tc) + " showed off glimpses of a horrifying madness...how blasphemous!")
		snd SOUNDLIST_CURSE2
		animeload 30, tc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= RELATION_DISLIKE & cdata(CDATA_RELATION, cnt) >= RELATION_DISLIKE) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( rnd(2) == 0 ) {
				dmgsan tc, rnd(role(dice1, dice2, bonus) + 1)
			}
			if ( cdata(CDATA_POWER_GAUGE, tc) >= 5 ) {
				if ( cdata(CDATA_POWER_GAUGE, tc) <= 80 ) {
					cdata(CDATA_POWER_GAUGE, tc) -= 5
				}
			}
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_PSYCHIC_WAVE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は強烈な精神波を放った！", name(cc) + " was overwhelmed.")
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_GARDEN, tc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			dmghp tc, cdata(CDATA_LEVEL, cc) * 3 / 2 + rnd(cdata(CDATA_LEVEL, cc) * 1 / 2 + 1), cc, SKILL_RESDMG_BRAIN, 1000
			cdata(CDATA_CONDITION_BIND, tc)++
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DEATH_SONG | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は破滅を高らかに歌い上げた。", name(cc) + " sang doom loudly.")
		snd SOUNDLIST_CURSE3
		animeload ANIMATION_GARDEN, tc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cbit(CHARA_BIT_DEATH_COUNT, cnt) == 1 ) {
				continue
			}
			if ( cc == cnt ) {
				addbuff cc, BUFF_DEATH_WORD, 70000000, 20
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( sdata(SKILL_RES_SOUND, tc) > 0 ) {
				if ( rnd(sdata(SKILL_ATTR_MAG, cc) + 1) > rnd(sdata(SKILL_RES_SOUND, tc) + 1) ) {
					addbuff tc, BUFF_DEATH_WORD, 70000000, 44
				}
				else {
					txt lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
				}
			}
			if ( sdata(SKILL_RES_SOUND, tc) <= 0 ) {
				addbuff tc, BUFF_DEATH_WORD, 70000000, 20
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BLADE_TURBULENCE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は風の刃を放った。", name(cc) + " emanated blades of wind.")
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_SONIC
		}
		animeid = ANIMATION_HEALING_RAIN
		animode = 0
		gosub *anime
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, cnt) >= (-1)) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(cc, -1) ) {
				snd SOUNDLIST_SONIC
			}
			dmghp tc, sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) * 2 + 5, cc, SKILL_RESDMG_CUT, 100
			dmgcon tc, CONDITION_BLEED, cdata(CDATA_INIT_SPEED, tc)
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HOMING_LASER | _switch_sw ) {
		_switch_sw = 0
		homing = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			homing++
		loop
		if ( homing <= 0 ) {
			goto *effect_end
		}
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は周囲の敵に狙いを定めた。", name(cc) + " emanated blades of wind.")
		snd SOUNDLIST_SHOTS
		animeload 49, cc
		snd SOUNDLIST_SHOTS
		animeload 49, cc
		animeid = ANIMATION_HEALING_RAIN
		animode = 2
		gosub *anime
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION_ORG, cnt) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			dmghp tc, (sdata(SKILL_ATTR_PER, cc) / 30 * limit(sdata(SKILL_ATTR_PER, cc), 1, 1000) + rnd(sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) + (sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 30 * sdata(SKILL_NORMAL_MARKSMAN, cc)) / homing + 1, cc, SKILL_RESDMG_CRUSH, 100
		loop
		homing = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CHARGE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_AROMAGEDDON, tc
		cc = tc
		gosub *skill_charge
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ADVANCED_CASTING | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ADVANCED_CASTING_ENABLED, CHARA_PLAYER) == FALSE ) {
			snd SOUNDLIST_ENC
			cdata(CDATA_ADVANCED_CASTING_ENABLED, CHARA_PLAYER) = TRUE
		}
		else {
			snd SOUNDLIST_LOCKED1
			cdata(CDATA_ADVANCED_CASTING_ENABLED, CHARA_PLAYER) = FALSE
		}
		txt lang(name(0) + "は詠唱モードを切り替えた。", name(tc) + " switched the casting mode.")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_DATA_SCAN | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ALLIED, tc) == 0 & tc != CHARA_PLAYER ) {
			snd SOUNDLIST_POWER07
			txt lang(name(tc) + "は自分が分析されていることを逆に分析し、動きを変えた。", name(tc) + " noticed " + he(tc) + " was being analyzed and changed " + his(tc) + " behavior.")
			cdata(CDATA_ANALYSIS_GAUGE, tc) = 0
		}
		else {
			if ( findbuff(tc, BUFF_DATA_SCAN) != (-1) ) {
				repeat 8 + 8
					if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_NONE ) {
						break
					}
					if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_DATA_SCAN ) {
						delbuff tc, cnt
						continue cnt
					}
				loop
			}
			else {
				if ( gdata(GDATA_FLAG_DATA_SCAN_CHARA_INDEX) != 0 ) {
					sctc = gdata(GDATA_FLAG_DATA_SCAN_CHARA_INDEX) - 1
					if ( sctc < 0 ) {
						goto *effect_end
					}
					repeat 8 + 8
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, sctc) == BUFF_NONE ) {
							break
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, sctc) == BUFF_DATA_SCAN ) {
							delbuff sctc, cnt
							continue cnt
						}
					loop
					txt lang(name(tc) + "は" + name(sctc) + "からデータスキャンを引き継いだ。", name(tc) + " took over the data scan from " + name(sctc) + ".")
				}
				snd SOUNDLIST_POWER07
				gdata(GDATA_FLAG_DATA_SCAN_CHARA_INDEX) = tc + 1
				addbuff tc, BUFF_DATA_SCAN, 20, 20
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_OVERLIMIT_THROW | _switch_sw ) {
		_switch_sw = 0
		if ( findbuff(tc, BUFF_OVERLIMIT_THROW) != (-1) ) {
			repeat 8 + 8
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_NONE ) {
					break
				}
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_OVERLIMIT_THROW ) {
					delbuff tc, cnt
					continue cnt
				}
			loop
		}
		else {
			snd SOUNDLIST_BOLT1
			animeload 20, tc
			addbuff tc, BUFF_OVERLIMIT_THROW, 25, 25
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_OVERLIMIT_THROW | _switch_sw ) {
		_switch_sw = 0
		if ( findbuff(tc, BUFF_OVERLIMIT_THROW) != (-1) ) {
			repeat 8 + 8
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_NONE ) {
					break
				}
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_OVERLIMIT_THROW ) {
					delbuff tc, cnt
					continue cnt
				}
			loop
		}
		else {
			snd SOUNDLIST_BOLT1
			animeload 20, tc
			addbuff tc, BUFF_OVERLIMIT_THROW, 25, 25
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_EMERGENCY_EVASION | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_MAGIC_EQUIP | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_SUPER_ARMOR | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_SHIELD_PARRY | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_AROMAGEDDON, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( efid == SKILL_SPACT_EMERGENCY_EVASION ) {
				if ( cdata(CDATA_EQUIP_WEIGHT, tc) < 15000 ) {
					addbuff tc, BUFF_EMERGENCY_EVASION, 15, 15
				}
			}
			if ( efid == SKILL_SPACT_MAGIC_EQUIP ) {
				if ( cdata(CDATA_EQUIP_WEIGHT, tc) < 35000 & cdata(CDATA_EQUIP_WEIGHT, tc) >= 15000 ) {
					addbuff tc, BUFF_MAGIC_EQUIP, 15, 15
				}
			}
			if ( efid == SKILL_SPACT_SUPER_ARMOR ) {
				if ( cdata(CDATA_EQUIP_WEIGHT, tc) >= 35000 ) {
					addbuff tc, BUFF_SUPER_ARMOR, 20, 20
				}
			}
			if ( efid == SKILL_SPACT_SHIELD_PARRY ) {
				if ( cdata(CDATA_SHIELD_STYLE_TYPE, tc) == SHIELD_STYLE_NORMAL ) {
					if ( cdata(CDATA_ATTACK_STYLE, tc) & STYLE_SHIELD ) {
						addbuff tc, BUFF_SHIELD_PARRY, 40, 40
					}
				}
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GRAVITY_ACCEL | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_GARDEN, tc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			p = limit(cdata(CDATA_CONDITION_GRAVITY, tc) + 20, 20, sorg(SKILL_ATTR_SPD, tc) / 2)
			if ( p > 300 ) {
				p = 300
			}
			addbuff tc, BUFF_GRAVITY_ACCEL, p, 40
			cdata(CDATA_CONDITION_GRAVITY, tc) += 20
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HARMONIC_ASSAULT | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload 73, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= 16 ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_HARMONIC_ASSAULT, 50, 50
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_RESOLUTION_HAND | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_AROMAGEDDON, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_RESOLUTION_HAND, 50, 50
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CALL_FAMILIAR | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_ARENA ) {
			txt_nothinghappens
			goto *effect_end
		}
		allyctrl = 0
		gosub *com_ally
		if ( stat != (-1) ) {
			rc = stat
			if ( cbit(CHARA_BIT_GUARD_TEMP, rc) == 1 ) {
				txt_nothinghappens
				goto *effect_end
			}
			if ( cdata(CDATA_EXIST, rc) == CHAR_STATE_ALIVE ) {
				txt lang("あなたは、" + cdatan(CDATAN_NAME, rc) + "を待機させた。", "You order " + cdatan(CDATAN_NAME, rc) + " to wait in town.")
				if ( cdata(CDATA_ROW_ACT, rc) != ACTION_NONE ) {
					rowactend rc
				}
				map(cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 1) = 0
				cdata(CDATA_EXIST, rc) = CHAR_STATE_ALLY_WAIT
				cdata(CDATA_AREA, rc) = AREA_NONE
				if ( cdata(CDATA_IN_TAGTEAM, rc) == (-1) ) {
					ttc = cdata(CDATA_TAGTEAM_PARTNER, rc)
					cell_setchara ttc, cdata(CDATA_X, rc), cdata(CDATA_Y, rc)
					tag_end rc
				}
				if ( cdata(CDATA_IN_TAGTEAM, rc) == 1 ) {
					ttc = cdata(CDATA_TAGTEAM_PARTNER, rc)
					tag_end rc
					cell_movechara ttc, cdata(CDATA_X, ttc), cdata(CDATA_Y, ttc)
				}
				gosub *screen_draw
				return 0
			}
			if ( cdata(CDATA_EXIST, rc) != CHAR_STATE_ALLY_WAIT ) {
				txt_nothinghappens
				goto *effect_end
			}
			f = get_freeallyne()
			if ( f == 0 ) {
				txt lang("仲間の最大数に達しているため、呼び出せない。", "Your party is already full. You can't invite someone anymore.")
				goto *effect_end
			}
			if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
				txt lang("このモードでは使えない… ", "You can not use it in Abnormal mode...")
				goto *effect_end
			}
			listmax = 0
			snd SOUNDLIST_TELEPORT1
			txtef COLOR_YELLOW
			txt cnven(cdatan(CDATAN_NAME, rc)) + lang("を呼び出した。", " " + have(rc) + " appeared out of nowhere.")
			cdata(CDATA_EXIST, rc) = CHAR_STATE_ALIVE
			cdata(CDATA_RELATION, rc) = cdata(CDATA_RELATION_ORG, rc)
			cxinit = cdata(CDATA_X, CHARA_PLAYER)
			cyinit = cdata(CDATA_Y, CHARA_PLAYER)
			gosub *place_chara
			cdata(CDATA_AREA, rc) = AREA_NONE
		}
		gosub *screen_draw
		return 0
	}
	if ( _switch_val == SKILL_SPACT_FASCINATION_DANCE | _switch_sw ) {
		_switch_sw = 0
		gosub *perform_dance
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PREACHING | _switch_sw ) {
		_switch_sw = 0
		gosub *perform_preach
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SERIOUS_BEGGING | _switch_sw ) {
		_switch_sw = 0
		gosub *perform_begging
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_ENSEMBLE | _switch_sw ) {
		_switch_sw = 0
		ens = 0
		txtef COLOR_BLUE
		txt lang("アンサンブル！", "Ensemble!")
		performerpal = ""
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( performerpal == "" ) {
				performerpal = name(tc)
			}
			else {
				performerpal = "your friends"
			}
			ens += limit(sdata(SKILL_NORMAL_PERFORMER, tc), 3, 3 + sdata(SKILL_NORMAL_PERFORMER, cc) / 5)
		loop
		if ( ens > 200 ) {
			ens = 200
		}
		if ( ens == 0 ) {
			txt lang("あなたはひとりぼっちだ…。", "You're all alone.")
			goto *effect_end
		}
		txt lang("あなたと仲間たちはアンサンブルを始めた。", "You started the ensemble with " + performerpal + ".")

		/********** ANNA CUSTOM - BEGINNING **********/

		EnsembleStart = 1

		/********** ANNA CUSTOM - ENDING **********/

		efid = SKILL_NORMAL_PERFORMER
		gosub *effect
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EXPLOSIVE_FIST | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		bakuretu = 100
		gosub *act_melee
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CLASH_RUSH | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 25 ) {
			snd SOUNDLIST_ATK_FIRE
			animeload ANIMATION_GENE, cc
			txtef COLOR_RED
			txt lang(name(cc) + "は覚悟を決めた！", name(cc) + " was ready!")
			cdata(CDATA_POWER_GAUGE, cc) -= 25
			sutemi = 100
		}
		efid = SKILL_SPACT_SHADOW_STEP
		gosub *effect
		sutemi = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_THUNDERCLAP_KICK | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		bakuretu = 200
		efid = SKILL_SPACT_SHADOW_STEP
		gosub *effect
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BODY_BLOW | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		bakuretu = 300
		gosub *act_melee
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_KNOCKOUT | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
			tc = cdata(CDATA_TARGET, cc)
			gosub *act_melee
			goto *effect_end
		}
		if ( tc == cc ) {
			txt_impossible
			return
		}
		if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 20 | cdata(CDATA_HP, tc) == 0 ) {
			txt lang("これ以上やると死んでしまう…。", "If you attack any more, the opponent will die...")
			return
		}
		gdata(GDATA_TEMPORARY_FLAGS2) = 888
		gosub *act_melee
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DIMENSION_FISHING | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_X, cc) > 0 ) {
			x = cdata(CDATA_X, cc) - 1
			cdata(CDATA_DIR, cc) = 1
		}
		if ( cdata(CDATA_X, cc) == 0 ) {
			x = cdata(CDATA_X, cc) + 1
			cdata(CDATA_DIR, cc) = 2
		}
		y = cdata(CDATA_Y, cc)
		if ( cc == CHARA_PLAYER ) {
			gdata(GDATA_RUN_DIR) = cdata(CDATA_DIR, CHARA_PLAYER)
		}
		fishx = x
		fishy = y
		addefmap fishx, fishy, 1, 3
		aniref = 0
		animeid = ANIMATION_BALL
		anix = fishx
		aniy = fishy
		gosub *anime
		snd SOUNDLIST_DOOR2
		chipbk = map(fishx, fishy, 0)
		map(fishx, fishy, 0) = 233
		tc = CHARA_PLAYER
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
				continue
			}
			tc = cnt
		loop
		if ( tc == CHARA_PLAYER ) {
			txt lang("釣れる獲物がいないようだ…。", "A waste of time...")
			map(fishx, fishy, 0) = chipbk
			goto *effect_end
		}
		txt lang("亜空釣りを始めた。", "You start fishing.")
		snd SOUNDLIST_FISH_CAST
		fishstat = 1
		if ( fishstat == 1 ) {
			repeat 4 + rnd(4)
				redraw 0
				fishanime = 1, 3 + rnd(3)
				addefmap fishx, fishy, 4, 2
				scrturn++
				gosub *screen_draw
				redraw 1
				await cfg_wait1 * 2
			loop
			fishstat = 2
			fishanime = 0
		}
		if ( fishstat == 2 ) {
			fishanime = 2
			snd SOUNDLIST_WATER2
			cdata(CDATA_EMO_ICON, CHARA_PLAYER) = 20 + 100 * 2
			repeat 8 + rnd(10)
				redraw 0
				scrturn++
				gosub *screen_draw
				redraw 1
				await cfg_wait1 * 2
			loop
			fishstat = 3
			fishanime = 0
		}
		if ( fishstat == 3 ) {
			fishanime = 3
			repeat 28 + rnd(15)
				if ( cnt \ 7 == 0 ) {
					snd SOUNDLIST_FISH_FIGHT
				}
				redraw 0
				fishanime(1) = cnt
				scrturn++
				gosub *screen_draw
				addefmap fishx, fishy, 5, 2
				redraw 1
				await cfg_wait1 * 2
			loop
			fishstat = 4
			fishanime = 0
		}
		if ( fishstat == 4 ) {
			fishanime = 4
			snd SOUNDLIST_FISH_GET
			repeat 21
				redraw 0
				fishanime(1) = cnt
				if ( cnt == 1 ) {
					addefmap fishx, fishy, 1, 3
				}
				scrturn++
				gosub *screen_draw
				redraw 1
				await cfg_wait1 * 2
			loop
			snd SOUNDLIST_GET1 + rnd(2)
			fishanime = 0
			gosub *expFishing
			snd SOUNDLIST_MIZU
			map(fishx, fishy, 0) = chipbk
			notconfuse = 1
			efid = SKILL_SPACT_DRAW_SHADOW
			gosub *effect
			cdata(CDATA_EMO_ICON, CHARA_PLAYER) = 6 + 100 * 3
		}
		map(fishx, fishy, 0) = chipbk
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GIGA_GRAVITATION | _switch_sw ) {
		_switch_sw = 0
		dmgmp cc, cdata(CDATA_MAX_MP, cc) / 10
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GIGA
			gosub *anime
		}
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は超重力の塊を振り下ろした。", name(cc) + " swung down the mass of super gravity.")
		snd SOUNDLIST_POP3
		snd SOUNDLIST_POP3
		f = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			dmg = limit((sdata(SKILL_ATTR_DEX, cc) / 5 + 2) * ((sdata(SKILL_NORMAL_MAGIC_CAPACITY, cc) + 1) / 5 + 2) + rnd(sdata(SKILL_ATTR_CON, cc) + 5), 5, 80000)
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 50 & cdata(CDATA_CONDITION_GRAVITY, tc) < 100 ) {
				dmg = dmg * 3 / 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 100 & cdata(CDATA_CONDITION_GRAVITY, tc) < 150 ) {
				dmg = dmg * 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 150 & cdata(CDATA_CONDITION_GRAVITY, tc) < 200 ) {
				dmg = dmg * 5 / 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 200 ) {
				dmg = dmg * 3
			}
			cdata(CDATA_CONDITION_GRAVITY, tc) += 30
			if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
				cdata(CDATA_CONDITION_BIND, tc)++
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			dmghp tc, dmg, cc, SKILL_RES_MAGIC, 1000
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_NORMAL_MAGIC_CAPACITY, cc, 50
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SILENT_OCEAN | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GIGA
			gosub *anime
		}
		txtef COLOR_LIGHT_BLUE
		txt lang("霧とともに周囲に海が広がった。", "An expanse of ocean and fog spreads out.")
		snd SOUNDLIST_MIZU
		p = 6
		repeat 1000
			x = rnd(p) + tlocx - rnd(p)
			y = rnd(p) + tlocy - rnd(p)
			f = 1
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
				f = 0
			}
			else {
				if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					f = 0
				}
			}
			if ( dist(tlocx, tlocy, x, y) >= p ) {
				f = 0
			}
			if ( f == 0 ) {
				continue cnt
			}
			tcbk = tc
			if ( map(x, y, 1) != 0 ) {
				tc = map(x, y, 1) - 1
				if ( gdata(GDATA_RIDER) != 0 ) {
					if ( tc == CHARA_PLAYER ) {
						cdata(CDATA_ENVIRONMENT_EFFECT, gdata(GDATA_RIDER)) = ENVIRONMENT_EFFECT_WATER
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					cdata(CDATA_ENVIRONMENT_EFFECT, cdata(CDATA_TAGTEAM_PARTNER, tc)) = ENVIRONMENT_EFFECT_WATER
				}
				cdata(CDATA_ENVIRONMENT_EFFECT, tc) = ENVIRONMENT_EFFECT_WATER
			}
			tc = tcbk
			if ( map(x, y, 0) < 363 ) {
				map(x, y, 0) = 168
			}
			if ( map(x, y, 8) != 0 ) {
				delmef map(x, y, 8) - 1
			}
		loop
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_NONE ) {
				continue
			}
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_WATER ) {
				cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
				addbuff cnt, BUFF_MIST_OF_SILENCE, 150, 20
				if ( cbit(CHARA_BIT_FLOAT, cnt) == 0 | cdata(CDATA_CONDITION_GRAVITY, cnt) > 0 | findbuff(cnt, BUFF_GRAVITY_ACCEL) != (-1) ) {
					wet cnt, 25
				}
			}
			cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PLATINUM_SONG | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_GOLD, CHARA_PLAYER) > 100 ) {
			cdata(CDATA_GOLD, CHARA_PLAYER) -= 100
			snd SOUNDLIST_PAYGOLD1
		}
		if ( synccheck(cc, -1) ) {
			txt lang("「ヴァモス・カンタール！」", cnvtalk("This is my song!"))
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_ID, cc) == CREATURE_ID_KARAVIKA ) {
				if ( cnt != cc ) {
					continue
				}
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_HOLY_SHIELD, sdata(SKILL_ATTR_CHA, cc) * 3 + 100, 60
			addbuff tc, BUFF_DIVINE_WISDOM, sdata(SKILL_ATTR_CHA, cc) * 3 + 100, 60
			addbuff tc, BUFF_FEATHER, sdata(SKILL_ATTR_CHA, cc) * 3 + 100, 60
			if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
				cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
			}
		loop
		snd SOUNDLIST_CHEER
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DIVINE_STREAM | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_INTENSIVE_POWER
				gosub *effect
				goto *effect_end
			}
		}
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_DISTANT_ATK, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cc) != 0 ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cdata(CDATA_RELATION, cc) == 0 ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			sinp = 0
			if ( sdata(SKILL_ATTR_SPD, tc) > sdata(SKILL_ATTR_SPD, cc) ) {
				sinp += sdata(SKILL_ATTR_SPD, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_STR, tc) > sdata(SKILL_ATTR_STR, cc) ) {
				sinp += sdata(SKILL_ATTR_STR, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_CON, tc) > sdata(SKILL_ATTR_CON, cc) ) {
				sinp += sdata(SKILL_ATTR_CON, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_DEX, tc) > sdata(SKILL_ATTR_DEX, cc) ) {
				sinp += sdata(SKILL_ATTR_DEX, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_PER, tc) > sdata(SKILL_ATTR_PER, cc) ) {
				sinp += sdata(SKILL_ATTR_PER, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_LER, tc) > sdata(SKILL_ATTR_LER, cc) ) {
				sinp += sdata(SKILL_ATTR_LER, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_WIL, tc) > sdata(SKILL_ATTR_WIL, cc) ) {
				sinp += sdata(SKILL_ATTR_WIL, tc)
			}
			else {
				sinp += 100
			}
			if ( sdata(SKILL_ATTR_MAG, tc) > sdata(SKILL_ATTR_MAG, cc) ) {
				sinp += sdata(SKILL_ATTR_MAG, tc)
			}
			else {
				sinp += 100
			}
			dmghp tc, sinp, cc
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PROVOKE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は挑発を行った。", name(cc) + " provokes the enemy.")
		}
		txtmore
		txtef COLOR_SKY_BLUE
		customtalk cc, DBMODE_FLAVOR_INSULT
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			if ( jp ) {
				if ( cdata(CDATA_SEX, cc) == 0 ) {
					txt "「命をかけてかかってこい」", "「お前の全てを否定してやる」", "「捕まえてみな」", "「遊ぼうか」", "「覚悟はいいか？」", "「無理をするな。結果はどうせ一緒だ」", "「そう粋がるなよ」"
				}
				else {
					txt "「私と遊びたいの？」", "「かかってきなさい」", "「こっちですよぉ？」", "「ほら、いらっしゃい」", "「手短に死んでもらえる？」", "「相手をしてあげようか？」", "「拍子抜けしちゃうなぁ〜」", "「本気を出しているの？」"
				}
			}
			else {
				if ( rnd(2) ) {
					txt cnvtalk("You suck!"), cnvtalk("You will die alone."), cnvtalk("Bow down before me."), cnvtalk("Go jump off a bridge."), cnvtalk("Bang your head against the wall!"), cnvtalk("Why do you sniff under your dog's tail?")
				}
				else {
					txt cnvtalk("The world is against you because you are a unsavory decomposing virus."), cnvtalk("You are no better than a immoral guzzling bureaucrat."), cnvtalk("You are so lowly."), cnvtalk("Get off me.")
				}
			}
		}
		tyouhatu = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cc) > (-3) | cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, cnt) > (-3) ) {
					continue
				}
			}
			if ( cdata(CDATA_RELATION, cc) == (-3) ) {
				if ( cdata(CDATA_RELATION, cnt) == (-3) & cnt != 0 ) {
					continue
				}
			}
			if ( cbit(CHARA_BIT_SANDBAG, cnt) ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cc) == (-3) ) {
				if ( gdata(GDATA_AREA) == AREA_PET_ARENA ) {
					if ( cdata(CDATA_RELATION, cnt) != 10 ) {
						continue
					}
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_RED
				txt lang(name(tc) + "は挑発にのった！", name(tc) + " fell for the provocation.")
			}
			cdata(CDATA_AI_AGGRO, tc) = 30
			cdata(CDATA_TARGET, tc) = cc
			if ( tc != CHARA_PLAYER ) {
				cdata(CDATA_KARMA, tc) = 3
			}
			if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
				cdata(CDATA_CONDITION_ANGRY, tc) += rnd(10) + 10
			}
			tyouhatu++
			if ( tyouhatu <= 21 ) {
				cdata(CDATA_POWER_GAUGE, cc)++
			}
		loop
		if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
			if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
				cdata(CDATA_POWER_GAUGE, cc) = 100
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
			cdata(CDATA_POWER_GAUGE, cc) = 200
		}
		tyouhatu = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_NECRO_FORCE | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			txtsetnecro 6
			repeat 6
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 250, 1
			gosub *prompt_key
			if ( stat == 0 | rtval == 0 ) {
				return 0
			}
			if ( rtval == 4 ) {
				if ( cdata(CDATA_TARGET, CHARA_PLAYER) == 0 ) {
					gosub *findTarget
				}
				gosub *com_findTarget
				if ( listmax == 0 ) {
					txt lang("視界内にターゲットは存在しない。", "You look around and find nothing.")
					return 0
				}
			}
			if ( rtval == 2 ) {
				txtef COLOR_YELLOW
				txt lang(" *魔力増強*　", " *MP Charge* ")
			}
			if ( rtval == 3 ) {
				txtef COLOR_YELLOW
				txt lang(" *生命の転換*　", " *HP Convert* ")
			}
			if ( rtval == 4 ) {
				txtef COLOR_YELLOW
				txt lang(" *外道式炸裂弾*　", " *Brutal Burst* ")
			}
			if ( rtval == 5 ) {
				txtef COLOR_YELLOW
				txt lang(" *コールアンデッド*　", " *Convocation* ")
			}
			if ( rtval == 5 ) {
				snd SOUNDLIST_CURSE3
				repeat MAX_CHARA_TOTAL
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cnt == CHARA_PLAYER ) {
						continue
					}
					if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
						cc = cnt
						tc = CHARA_PLAYER
						efid = SKILL_SPACT_SHADOW_STEP
						gosub *effect
					}
				loop
				goto *effect_end
			}
			nelv = 0
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				if ( cbit(CHARA_BIT_LIVESTOCK, tc) != 1 ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						if ( cbit(CHARA_BIT_NECRO, tc) == 1 ) {
							if ( rtval == 1 ) {
								necrop = 0
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT_ZOMBIE ) {
									necrop = 2
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE ) {
									necrop = 3
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUMMY ) {
									necrop = 4
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR ) {
									necrop = 5
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH ) {
									necrop = 6
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_NECRO_DOLL ) {
									necrop = 7
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_DRAGON_ZOMBIE ) {
									necrop = 8
								}
								if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON ) {
									necrop = 9
								}
								necrop3 = cdata(CDATA_CHARA_PIC, tc)
								if ( necrop != 0 ) {
									txt lang(name(tc) + "を棺に戻した。", "You push " + name(tc) + " back into the coffin.")
									flt
									itemcreate -1, ITEM_ID_COFFIN_OF_NECROMANCY, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
									inv(INV_ITEM_PARAM1, ci) = necrop
									inv(INV_ITEM_PARAM2, ci) = cdata(CDATA_FORM_SHIFT_PIC, tc)
									inv(INV_ITEM_WEIGHT, ci) += necrop * 1000
									inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_PARAM3, ci)
									inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
									inv(INV_ITEM_KNOWN, ci) = ITEM_KNOWN_NECRO
									inv(INV_ITEM_CHARA_PIC, ci) = necrop3
									chara_vanquish tc
									gosub *screen_draw
								}
							}
							if ( rtval == 2 ) {
								txtef COLOR_BLUE
								txt lang(name(tc) + "は魔力を注がれ狂暴化した！", name(tc) + " became enraged through magic!")
								addbuff tc, BUFF_BOOST, 20, 50
								addbuff tc, BUFF_ATTRIBUTE_SHIELD, sdata(SKILL_NORMAL_CONTROL_MAGIC, CHARA_PLAYER) + 100, 50
								nelv += cdata(CDATA_LEVEL, tc)
								skillexp SKILL_NORMAL_CONTROL_MAGIC, CHARA_PLAYER, 100
							}
							if ( rtval == 3 ) {
								txtef COLOR_BLUE
								txt lang(name(tc) + "の身体は闇に包まれて再生した！", name(tc) + "'s body was enveloped by darkness and regenerated!")
								healhp tc, cdata(CDATA_MAX_HP, tc) / 3
								addbuff tc, BUFF_REGENERATION, sdata(SKILL_NORMAL_CONTROL_MAGIC, CHARA_PLAYER) + 100, 50
								if ( cdata(CDATA_CONDITION_POISON, tc) != 0 ) {
									cdata(CDATA_CONDITION_POISON, tc) = cdata(CDATA_CONDITION_POISON, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_MPOISON, tc) != 0 ) {
									cdata(CDATA_CONDITION_MPOISON, tc) = cdata(CDATA_CONDITION_MPOISON, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_SLEEP, tc) != 0 ) {
									cdata(CDATA_CONDITION_SLEEP, tc) = cdata(CDATA_CONDITION_SLEEP, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_CONFUSE, tc) != 0 ) {
									cdata(CDATA_CONDITION_CONFUSE, tc) = cdata(CDATA_CONDITION_CONFUSE, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_BLIND, tc) != 0 ) {
									cdata(CDATA_CONDITION_BLIND, tc) = cdata(CDATA_CONDITION_BLIND, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_PARALYZE, tc) != 0 ) {
									cdata(CDATA_CONDITION_PARALYZE, tc) = cdata(CDATA_CONDITION_PARALYZE, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_DIM, tc) != 0 ) {
									cdata(CDATA_CONDITION_DIM, tc) = cdata(CDATA_CONDITION_DIM, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_DRUNK, tc) != 0 ) {
									cdata(CDATA_CONDITION_DRUNK, tc) = cdata(CDATA_CONDITION_DRUNK, tc) / 5 + 1
								}
								if ( cdata(CDATA_CONDITION_BLEED, tc) != 0 ) {
									cdata(CDATA_CONDITION_BLEED, tc) = cdata(CDATA_CONDITION_BLEED, tc) / 5 + 1
								}
								nelv += cdata(CDATA_LEVEL, tc)
								skillexp SKILL_NORMAL_CONTROL_MAGIC, CHARA_PLAYER, 100
							}
							if ( rtval == 4 ) {
								if ( cdata(CDATA_NECRO_FORCE, tc) == 10 ) {
									cdata(CDATA_NECRO_FORCE, tc) = 0
									txt lang(name(tc) + "の眼が元に戻った。", name(tc) + "'s eyes come back to normal.")
									continue
								}
								txtef COLOR_RED
								txt lang(name(tc) + "の眼が不気味に光り出した。", name(tc) + "'s eyes began to shine omniously.")
								cdata(CDATA_NECRO_FORCE, tc) = 10
								cdata(CDATA_TARGET, tc) = cdata(CDATA_TARGET, cc)
								cdata(CDATA_AI_AGGRO, tc) = 30
							}
						}
					}
				}
			loop
			snd SOUNDLIST_CURSE3
			if ( rtval == 2 ) {
				if ( nelv != 0 ) {
					dmgmp cc, 1
					cdata(CDATA_MP, cc) += -nelv
				}
			}
			if ( rtval == 3 ) {
				if ( nelv != 0 ) {
					dmghp cc, 1
					cdata(CDATA_HP, cc) += -nelv
				}
			}
			nelv = 0
		}
		else {
			tc = cc
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ALLIED, cc) != 100 ) {
					if ( cdata(CDATA_ID, cnt) != CREATURE_ID_ZOMBIE ) {
						continue
					}
					if ( cbit(CHARA_BIT_SUMMONED, cnt) != 1 ) {
						continue
					}
				}
				else {
					if ( cdata(CDATA_ALLIED, cnt) == 100 ) {
						continue
					}
					if ( cbit(CHARA_BIT_NECRO, cnt) != 1 ) {
						continue
					}
				}
				if ( cnt < MAX_CHARA_FOLLOWER ) {
					continue
				}
				if ( cdata(CDATA_HP, cnt) < cdata(CDATA_MAX_HP, cnt) * 1 / 4 ) {
					continue
				}
				if ( cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) * 3 / 4 ) {
					addbuff cnt, BUFF_SPEED, sdata(SKILL_ATTR_CHA, cc) * 5 + 50, 10
					addbuff cnt, BUFF_HERO, sdata(SKILL_ATTR_CHA, cc) * 5 + 100, 10
					addbuff cnt, BUFF_CONTINGENCY, 1500, 10
				}
				tc = cnt
			loop
			if ( tc == cc ) {
				goto *effect_end
			}
			snd SOUNDLIST_CURSE3
			if ( cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) * 3 / 4 ) {
				txtef COLOR_RED
				txt lang(" *死者狂乱*　", " *Necro Charge* ")
				txt lang(name(cc) + "は手駒を強化した。", name(cc) + " strengthens those under " + his(cc) + " control.")
			}
			else {
				txtef COLOR_RED
				txt lang(" *奴隷搾取*　", " *HP Drain* ")
				txt lang(name(cc) + "は" + name(tc) + "の体力を吸収した。", name(cc) + " has absorbed " + name(tc) + "'s vitality.")
				cdata(CDATA_HP, cc) += cdata(CDATA_HP, tc) * 3
				cdata(CDATA_HP, tc) = 0
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CLOSE_SUICIDE | _switch_sw ) {
		_switch_sw = 0
		aniref = 0
		animeid = ANIMATION_BALL
		anix = cdata(CDATA_X, tc)
		aniy = cdata(CDATA_Y, tc)
		gosub *anime
		stxt cc, lang(name(cc) + "は" + name(tc) + "を道連れに自爆した。", name(cc) + " explode with " + tc + ".")
		dmghp tc, (limit(sdata(SKILL_ATTR_MAG, cc) / 6, 1, 350) + rnd(limit(sdata(SKILL_ATTR_MAG, cc) / 20, 1, 100))) * limit(sdata(SKILL_ATTR_CON, cc) / 2, 1, 1000), cc, SKILL_RES_MAGIC, 1000
		if ( cc != CHARA_PLAYER ) {
			cdata(CDATA_HP, cc) = 0
		}
		dmghp cc, 1, DAMAGE_FROM_SUICIDE
		if ( cdata(CDATA_HP, cc) == 0 ) {
			dmghp cc, 1, DAMAGE_FROM_SUICIDE
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_TAG_FORCE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 50 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 50
		addbuff tc, BUFF_TAG_FORCE, 50, 51
		if ( cdata(CDATA_TAGTEAM_PARTNER, cc) > 0 ) {
			healhp 0, cdata(CDATA_MAX_HP, cc) * (cdata(CDATA_POWER_GAUGE, cc) + 40) / 200
		}
		txtef COLOR_YELLOW
		txt_skillname
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( cdata(CDATA_IN_TAGTEAM, tc) == 0 ) {
				continue
			}
			cdata(CDATA_POWER_GAUGE, tc) -= 50
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			healhp tc, cdata(CDATA_MAX_HP, tc) * (cdata(CDATA_POWER_GAUGE, tc) + 40) / 200
			addbuff tc, BUFF_TAG_FORCE, 50, 50
		loop
		snd SOUNDLIST_CHEER
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CHEER | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は仲間を鼓舞した。", name(cc) + " cheer" + _s(cc) + ".")
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_BLUE
				txt lang(name(tc) + "は興奮した！", name(tc) + " " + is(tc) + " excited!")
			}
			addbuff tc, BUFF_SPEED, sdata(SKILL_ATTR_CHA, cc) * 3 + 50, 75
			addbuff tc, BUFF_HERO, sdata(SKILL_ATTR_CHA, cc) * 3 + 100, 75
		loop
		snd SOUNDLIST_CHEER
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_UNISON_IMPACT | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_RELATION, tc) >= (-1) ) {
				txt lang("さすがに卑怯な気がする…。", "It feels sneaky...")
				goto *effect_end
			}
		}
		over = 0
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_POWER_GAUGE, cnt) < 0 ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) == 10 | cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, cnt) < 10 ) {
					continue
				}
			}
			if ( cdata(CDATA_RELATION, cnt) < 10 & cc != CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			ovtc = cnt
			dx = cdata(CDATA_X, ovtc)
			dy = cdata(CDATA_Y, ovtc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			animeload 68, ovtc
			snd SOUNDLIST_BREATH1
			overs = 0
			if ( sdata(SKILL_NORMAL_TACTICS, ovtc) >= sdata(SKILL_NORMAL_MARKSMAN, ovtc) & sdata(SKILL_NORMAL_TACTICS, ovtc) >= sdata(SKILL_NORMAL_CASTING, ovtc) & sdata(SKILL_NORMAL_TACTICS, ovtc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) ) {
				overs = sdata(SKILL_NORMAL_TACTICS, ovtc) * cdata(CDATA_POWER_GAUGE, ovtc) / 100
			}
			if ( sdata(SKILL_NORMAL_MARKSMAN, ovtc) >= sdata(SKILL_NORMAL_TACTICS, ovtc) & sdata(SKILL_NORMAL_MARKSMAN, ovtc) >= sdata(SKILL_NORMAL_CASTING, ovtc) & sdata(SKILL_NORMAL_MARKSMAN, ovtc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) ) {
				overs = sdata(SKILL_NORMAL_MARKSMAN, ovtc) * cdata(CDATA_POWER_GAUGE, ovtc) / 100
			}
			if ( sdata(SKILL_NORMAL_CASTING, ovtc) >= sdata(SKILL_NORMAL_MARKSMAN, ovtc) & sdata(SKILL_NORMAL_CASTING, ovtc) >= sdata(SKILL_NORMAL_TACTICS, ovtc) & sdata(SKILL_NORMAL_CASTING, ovtc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) ) {
				overs = sdata(SKILL_NORMAL_CASTING, ovtc) * cdata(CDATA_POWER_GAUGE, ovtc) / 100
			}
			if ( sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) >= sdata(SKILL_NORMAL_MARKSMAN, ovtc) & sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) >= sdata(SKILL_NORMAL_CASTING, ovtc) & sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) >= sdata(SKILL_NORMAL_TACTICS, ovtc) ) {
				overs = sdata(SKILL_NORMAL_MAGIC_DEVICE, ovtc) * cdata(CDATA_POWER_GAUGE, ovtc) / 100
			}
			if ( overs > 0 ) {
				over += overs * sqrt(overs) * 5 + rnd(overs + 1)
			}
			cdata(CDATA_POWER_GAUGE, ovtc) = 0
			customtalk ovtc, DBMODE_FLAVOR_SPECIAL
			gosub *convert_word
		loop
		cfg_animewait = waitbk
		if ( over == 0 ) {
			txt lang("力が足りない…。", "Force is not enough...")
			goto *effect_end
		}
		overs = 0
		if ( sdata(SKILL_NORMAL_TACTICS, cc) >= sdata(SKILL_NORMAL_MARKSMAN, cc) & sdata(SKILL_NORMAL_TACTICS, cc) >= sdata(SKILL_NORMAL_CASTING, cc) & sdata(SKILL_NORMAL_TACTICS, cc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) ) {
			overs = sdata(SKILL_NORMAL_TACTICS, cc) * cdata(CDATA_POWER_GAUGE, cc) / 100
		}
		if ( sdata(SKILL_NORMAL_MARKSMAN, cc) >= sdata(SKILL_NORMAL_TACTICS, cc) & sdata(SKILL_NORMAL_MARKSMAN, cc) >= sdata(SKILL_NORMAL_CASTING, cc) & sdata(SKILL_NORMAL_MARKSMAN, cc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) ) {
			overs = sdata(SKILL_NORMAL_MARKSMAN, cc) * cdata(CDATA_POWER_GAUGE, cc) / 100
		}
		if ( sdata(SKILL_NORMAL_CASTING, cc) >= sdata(SKILL_NORMAL_MARKSMAN, cc) & sdata(SKILL_NORMAL_CASTING, cc) >= sdata(SKILL_NORMAL_TACTICS, cc) & sdata(SKILL_NORMAL_CASTING, cc) >= sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) ) {
			overs = sdata(SKILL_NORMAL_CASTING, cc) * cdata(CDATA_POWER_GAUGE, cc) / 100
		}
		if ( sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) >= sdata(SKILL_NORMAL_MARKSMAN, cc) & sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) >= sdata(SKILL_NORMAL_CASTING, cc) & sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) >= sdata(SKILL_NORMAL_TACTICS, cc) ) {
			overs = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * cdata(CDATA_POWER_GAUGE, cc) / 100
		}
		cdata(CDATA_POWER_GAUGE, cc) = 0
		if ( overs > 0 ) {
			over += overs * sqrt(overs) * 5 + rnd(overs + 1)
		}
		animeload 68, cc
		snd SOUNDLIST_BREATH1
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		animeid = ANIMATION_UNISON_IMPACT1
		anic = tc
		gosub *anime
		snd SOUNDLIST_ENC
		snd SOUNDLIST_PUNISH1
		animeid = ANIMATION_UNISON_IMPACT4
		anic = tc
		gosub *anime
		dmg = over
		if ( cdata(CDATA_HP, tc) < dmg ) {
			snd SOUNDLIST_BOM03
			animeload 70, tc
			snd SOUNDLIST_BOM06
			animeid = ANIMATION_UNISON_IMPACT2
			anic = tc
			gosub *anime
			snd SOUNDLIST_BOM15
			animeid = ANIMATION_UNISON_IMPACT3
			anic = tc
			gosub *anime
		}
		dmghp tc, dmg, cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		if ( charaGivesExp(tc) ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_POWER_GAUGE, cnt) < 0 ) {
					continue
				}
				if ( cdata(CDATA_RELATION, cnt) == 10 | cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_RELATION, cnt) < 10 ) {
						continue
					}
				}
				if ( cdata(CDATA_RELATION, cnt) < 10 & cc != CHARA_PLAYER ) {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
						continue
					}
				}
				ovtc = cnt
				dx = cdata(CDATA_X, ovtc)
				dy = cdata(CDATA_Y, ovtc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				skillexp SKILL_NORMAL_TACTICS, ovtc, 200
				skillexp SKILL_NORMAL_MARKSMAN, ovtc, 200
				skillexp SKILL_NORMAL_CASTING, ovtc, 200
				skillexp SKILL_NORMAL_MAGIC_DEVICE, ovtc, 200
			loop
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PURGE | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) {
			goto *effect_end
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			cdata(CDATA_HP, tc) = 0
			cdata(CDATA_MP, tc) = 0
		loop
		snd SOUNDLIST_ENC
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BOUND_IN_BLOOD | _switch_sw ) {
		_switch_sw = 0
		ens3 = 0
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は周囲の同族に呼びかけた。", name(cc) + " encouraged the cognate.")
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RACE_ID, cnt) != cdata(CDATA_RACE_ID, cc) ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			ens3++
		loop
		if ( ens3 == 0 ) {
			txt lang(name(cc) + "はひとりぼっちだ…。", name(cc) + " was all alone.")
			goto *effect_end
		}
		dmgcon cc, CONDITION_BLEED, 1000
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RACE_ID, cnt) != cdata(CDATA_RACE_ID, cc) ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_BLUE
				txt lang(name(tc) + "は決意を固めた！", name(tc) + " " + is(tc) + " excited!")
			}
			if ( cdata(CDATA_POWER_GAUGE, tc) < 50 ) {
				cdata(CDATA_POWER_GAUGE, tc) += limit((ens3 + 1) * 2, 0, 30)
			}
			addbuff tc, BUFF_SPEED, sdata(SKILL_ATTR_WIL, tc) * 3 + 50, 50
			addbuff tc, BUFF_HERO, sdata(SKILL_ATTR_WIL, tc) * 3 + 100, 50
			addbuff tc, BUFF_ATTRIBUTE_SHIELD, sdata(SKILL_ATTR_WIL, tc) * 3 + 100, 50
			if ( tc == CHARA_PLAYER ) {
				addbuff tc, BUFF_CONTINGENCY, 150, 5
			}
			else {
				addbuff tc, BUFF_CONTINGENCY, 1500, 50
			}
		loop
		ens3 = 0
		snd SOUNDLIST_CHEER
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DISTURBANCE | _switch_sw ) {
		_switch_sw = 0
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, tc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, tc) >= 50 ) {
				powsel = 100
			}
		}
		if ( tc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, tc) == 100 | tc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( powsel == 0 ) {
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) <= 1 ) {
			txt_nothinghappens
			goto *effect_end
		}
		gaugedown = cdata(CDATA_POWER_GAUGE, cc) / 2
		if ( cdata(CDATA_POWER_GAUGE, cc) < gaugedown ) {
			txt_nothinghappens
			goto *effect_end
		}
		txt lang(name(cc) + "は" + name(tc) + "を撹乱した。", name(cc) + " disturbed " + name(tc) + ".")
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		animeid = ANIMATION_CURSE
		gosub *anime
		cfg_animewait = waitbk
		cdata(CDATA_POWER_GAUGE, cc) -= gaugedown
		cdata(CDATA_POWER_GAUGE, tc) -= gaugedown
		if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
			cdata(CDATA_POWER_GAUGE, tc) = 0
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CUT_TREE | _switch_sw ) {
		_switch_sw = 0
		citree = -1
		cell_itemlist cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		f = 0
		repeat listmax
			p = list(0, cnt)
			if ( inv(INV_ITEM_ID, p) == ITEM_ID_TREE_SAKURA | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_FIR | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_NAKED | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_ASH | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_PALM | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_ZELKOVA | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_DEAD_TREE | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_FRUIT | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_FRUITLESS | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_CEDAR | inv(INV_ITEM_ID, p) == ITEM_ID_TREE_BEECH ) {
				citree = p
				break
			}
		loop
		if ( citree == (-1) ) {
			txt lang("伐採できる樹木が無い。", "You can not find a tree.")
			goto *effect_end
		}
		ci = p
		axeitem = 0
		item_find ITEM_ID_BARDISH, 3, 1
		if ( stat != (-1) ) {
			if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
				axeitem = 100
			}
		}
		item_find ITEM_ID_CHAINSAW, 3, 1
		if ( stat != (-1) ) {
			if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
				axeitem = 30
			}
		}
		item_find ITEM_ID_NEGATIVE_EDGE, 3, 1
		if ( stat != (-1) ) {
			if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
				axeitem = 30
			}
		}
		if ( axeitem == 0 ) {
			txt lang("伐採するための道具を持っていない。", "You have no item that can cut trees.")
			goto *effect_end
		}
		gdata(GDATA_ROW_ACT) = ACTION_CUT_TREE
		gosub *generalAct
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PERSUASION | _switch_sw ) {
		_switch_sw = 1
	}
	if ( _switch_val == SKILL_SPACT_PECULIAR_JOKE | _switch_sw ) {
		_switch_sw = 1
	}
	if ( _switch_val == SKILL_SPACT_BLENDED_LIE | _switch_sw ) {
		_switch_sw = 1
	}
	if ( _switch_val == SKILL_SPACT_INTIMIDATION | _switch_sw ) {
		_switch_sw = 1
	}
	if ( _switch_val == SKILL_SPACT_MYSTERIOUS_SONG | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			talking = 0
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
						continue
					}
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				talking++
			loop
			if ( talking == 0 ) {
				txt lang("特に必要はなさそうだ。", "It doesn't seem to be especially necessary.")
				goto *effect_end
			}
			talking = 0
		}
		if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
			goto *effect_end
		}
		if ( efid == SKILL_SPACT_PERSUASION ) {
			snd SOUNDLIST_CHAT
			animeload 73, cc
			gosub *skill_persuasion
		}
		if ( efid == SKILL_SPACT_PECULIAR_JOKE ) {
			snd SOUNDLIST_CHAT
			animeload 73, cc
			gosub *skill_peculiar_joke
		}
		if ( efid == SKILL_SPACT_BLENDED_LIE ) {
			snd SOUNDLIST_CHAT
			animeload 73, cc
			gosub *skill_blended_lie
		}
		if ( efid == SKILL_SPACT_INTIMIDATION ) {
			snd SOUNDLIST_CHAT
			animeload 73, cc
			gosub *skill_intimidation
		}
		if ( efid == SKILL_SPACT_MYSTERIOUS_SONG ) {
			snd SOUNDLIST_OFFER2
			animeload ANIMATION_MP_BREATH, cc
			gosub *skill_mysterious_song
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_RUBBING | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_ROVID ) {
					snd SOUNDLIST_AMMO
					txt lang(cdatan(CDATAN_NAME, cnt) + "「なんですか、そのいやらしい手つきは！フケツです！」", cdatan(CDATAN_NAME, cnt) + " says: " + cnvtalk("Just where do you think you're putting those perverted hands of yours?! Stop this at once!"))
					goto *effect_end
				}
			loop
		}
		if ( cc == CHARA_PLAYER & (cbit(CHARA_BIT_LIVESTOCK, tc) == 1 | getworker(gdata(GDATA_AREA)) == tc) & adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH ) {
			item_find ITEM_ID_BIG_BRUSH, 3, 1
			if ( stat != (-1) ) {
				ci = stat
				if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
					txt lang(name(cc) + "は" + name(tc) + "をブラッシングした。", "You rub " + name(tc) + " with a brush.")
					snd SOUNDLIST_BUSH1
					if ( getworker(gdata(GDATA_AREA)) == tc ) {
						if ( cdata(CDATA_LIVESTOCK_QUALITY, tc) > 0 ) {
							txtef COLOR_YELLOW
							txt lang("ブリーダー効果：" + _impression3(cdata(CDATA_LIVESTOCK_QUALITY, tc)) + "。", "Your thoughts on this breeder's offspring: " + _impression3(cdata(CDATA_LIVESTOCK_QUALITY, tc)) + ".")
						}
						if ( cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) > 0 ) {
							txtef COLOR_YELLOW
							txt lang("ブリーダー効果：" + _impression4(cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc)) + "。", "Your thoughts on this breeder's offspring: " + _impression4(cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc)) + ".")
						}
					}
					if ( getworker(gdata(GDATA_AREA)) != tc ) {
						if ( cdata(CDATA_LIVESTOCK_QUALITY, tc) > 0 ) {
							txtef COLOR_YELLOW
							txt lang("この家畜からは" + _impression3(cdata(CDATA_LIVESTOCK_QUALITY, tc)) + "と感じた。", "Your thoughts on this creature: " + _impression3(cdata(CDATA_LIVESTOCK_QUALITY, tc)) + ".")
						}
						if ( cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) > 0 ) {
							if ( cdata(CDATA_LIVESTOCK_QUALITY, tc) > 0 ) {
								txtef COLOR_YELLOW
								txt lang("また、", "Further,")
							}
							txtef COLOR_YELLOW
							txt lang("この家畜は" + _impression4(cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc)) + "と感じた。", "Your thoughts on this creature: " + _impression4(cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc)) + ".")
						}
					}
					if ( cbit(CHARA_BIT_BRUSHED, tc) == 1 ) {
						txt lang("最近ブラッシングしたばかりなので効果はない。", name(tc) + " was already brushed recently.")
						goto *effect_end
					}
					cdata(CDATA_EMO_ICON, tc) = 6 + 100 * 3
					cdata(CDATA_BRUSH_LEVEL, tc)++
					if ( cdata(CDATA_BRUSH_LEVEL, tc) >= 5 ) {
						cdata(CDATA_BRUSH_LEVEL, tc) = 5
					}
					modimp tc, 10
					cbitmod CHARA_BIT_BRUSHED, tc, 1
					if ( cdata(CDATA_BRUSH_LEVEL, tc) == 1 ) {
						txtef COLOR_YELLOW
						txt name(tc) + lang("はちょっと得意げだ。「綺麗になった？」", " looks proud. \"Did it make me beautiful?\"")
					}
					if ( cdata(CDATA_BRUSH_LEVEL, tc) == 2 ) {
						txtef COLOR_YELLOW
						txt name(tc) + lang("は小奇麗な感じがする。「え、もう終わり？」", " looks clean. \"Aww, it's already over?\"")
					}
					if ( cdata(CDATA_BRUSH_LEVEL, tc) == 3 ) {
						txtef COLOR_YELLOW
						txt name(tc) + lang("はかなり立派に見える。「ありがと！」", " looks marvelous. \"Thank you!\"")
					}
					if ( cdata(CDATA_BRUSH_LEVEL, tc) == 4 ) {
						txtef COLOR_YELLOW
						txt name(tc) + lang("はとても健康そうだ！「いつもありがとう」", " looks quite healthy! \"Thank you for everything!\"")
					}
					if ( cdata(CDATA_BRUSH_LEVEL, tc) == 5 ) {
						txtef COLOR_YELLOW
						txt name(tc) + lang("がキラキラ輝いて見える！「大好き！」", " is positively shining! \"I love you!\"")
					}
					goto *effect_end
				}
			}
		}
		if ( cc == CHARA_PLAYER & tc == CHARA_PLAYER ) {
			txt lang(name(cc) + "は自分を撫でた。", "You brush yourself.")
			goto *effect_end
		}
		txt lang(name(cc) + "は" + name(tc) + "を撫でた。*なでなで* ", name(cc) + " rubbed " + name(tc) + ".")
		if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
			if ( rnd(5) == 0 ) {
				cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_IMPRESSION, tc) < 100 & rnd(sdata(SKILL_ATTR_DEX, cc) + 1) < rnd(200) ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPACE_HORNED_OWL ) {
					txtef COLOR_RED
					txt lang("「コワイコワイ…アッ、ア゛ア゛ア゛ーーー！」", cnvtalk("I'm scared, I'm scared... Ah, ah ah ah---!"))
				}
				else {
					txtef COLOR_RED
					txt name(tc) + lang("の神経を逆撫でしてしまったようだ。", " appears to be irritated."), name(tc) + lang("は嫌そうに", " looks disgusted and brushes ") + name(cc) + lang("を払いのけた。", " away."), lang("「セクハラ！」", cnvtalk("Sexual harassment!")), lang("「触らないで」", cnvtalk("Don't touch me."))
				}
				if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
					cangury(tc) = 5
				}
				goto *effect_end
			}
			if ( cdata(CDATA_IMPRESSION, tc) < 150 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPACE_HORNED_OWL ) {
					txtef COLOR_YELLOW
					txt lang("「アハヒャヒャ！モット！モットオネガ…アヒャヒャ！」", cnvtalk("Ahyahya! More! Do it more... Ahyahya!"))
				}
				else {
					txtef COLOR_YELLOW
					txt lang(name(tc) + "は困惑している…。", name(tc) + " looks puzzled."), lang(name(tc) + "は微妙にイヤそうだ！", name(tc) + " looks slightly upset!"), lang(name(tc) + "は無言で" + name(cc) + "から離れた。", name(tc) + " silently steps away from " + name(cc) + ".")
				}
				goto *effect_end
			}
			if ( cdata(CDATA_IMPRESSION, tc) < 200 ) {
				cdata(CDATA_EMO_ICON, tc) = 6 + 100 * 3
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPACE_HORNED_OWL ) {
					txtef COLOR_YELLOW
					txt lang("「モットナデナデシテー！」", cnvtalk("More! More brush brush!"))
				}
				else {
					txtef COLOR_YELLOW
					txt lang(name(tc) + "はちょっと嬉しそうだ。", name(tc) + " looks somewhat happy."), lang(name(tc) + "は恥ずかしがっている…。", name(tc) + " blushes shyly...")
				}
				addbuff tc, BUFF_BOOST, 20, 3
				goto *effect_end
			}
			if ( cdata(CDATA_IMPRESSION, tc) >= 200 ) {
				cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
				customtalk tc, DBMODE_FLAVOR_NADE
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPACE_HORNED_OWL ) {
						txtef COLOR_YELLOW
						txt lang("「ファー…ブルスコ…ファー…ブルスコ…」", cnvtalk("Haa... *purr*... haa... *purr*"))
					}
					else {
						txtef COLOR_YELLOW
						txt name(tc) + lang("はとっても嬉しそうだ！", " looks very happy!"), name(tc) + lang("は無言で", " silently snuggles up next to ") + name(cc) + lang("に寄り添ってきた。", ".")
					}
				}
				addbuff tc, BUFF_BOOST, cdata(CDATA_IMPRESSION, tc), 5
				goto *effect_end
			}
			goto *effect_end
		}
		else {
			txtef COLOR_RED
			txt name(tc) + lang("の神経を逆撫でしてしまったようだ。", " appears to be irritated."), name(tc) + lang("は嫌そうに", " looks disgusted and brushes ") + name(cc) + lang("を払いのけた。", " away.")
			if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
				cangury(tc) = 5
			}
			goto *effect_end
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BEWITCH | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_PRAY1
		animeload ANIMATION_GOLDENSTORM, cc
		if ( tc == cc ) {
			goto *effect_end
		}
		if ( jp ) {
			txt name(cc) + "は" + name(tc) + "に全力で甘えた！", name(cc) + "は" + name(tc) + "を上目遣いで見た！", name(cc) + "は" + name(tc) + "にすり寄った！", "*ふぁのーん*"
		}
		if ( en ) {
			txt lang(name(cc) + "は" + name(tc) + "に甘えてみた。", name(cc) + " tried fawn on " + name(tc) + ".")
		}
		if ( cdata(CDATA_CONDITION_PARALYZE, tc) == (-1) ) {
			txt lang(name(tc) + "は落ち着いている。", name(tc) + " come" + _s(tc) + " to " + yourself(tc) + " again.")
			goto *effect_end
		}
		if ( cdata(CDATA_INTEREST, tc) <= 0 ) {
			cdata(CDATA_INTEREST, tc) = 0
			txt lang(name(tc) + "は興味なさそうに" + name(cc) + "を見ている。", name(tc) + " does not seem to be interested.")
			goto *effect_end
		}
		if ( rnd(sdata(SKILL_ATTR_CHA, cc) + cdata(CDATA_IMPRESSION, tc)) >= rnd(sdata(SKILL_ATTR_WIL, tc)) ) {
			dmgcon tc, CONDITION_BLEED, 75
			customtalk tc, DBMODE_FLAVOR_FAWN_ON
			gosub *convert_word
			if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
				if ( jp ) {
					txtef COLOR_YELLOW
					txt name(tc) + "は静かに悶えている！", "「そ、そんな目で見ないで" + _kure(3) + "！」", "*キュン♪1*"
				}
				if ( en ) {
					txtef COLOR_YELLOW
					txt name(tc) + " " + is(tc) + " crazy about " + name(cc) + "!"
				}
			}
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, tc) >= 0 ) {
					txt lang(name(tc) + "は思わず財布を取りだした。「お小遣いあげちゃ" + _u(3) + "！」", name(tc) + " took out the wallet without thinking \"I'll give you pocket money!\"")
				}
				if ( cdata(CDATA_RELATION, tc) < 0 ) {
					txt lang(name(tc) + "は思わず財布を取りだした。「ひ、卑怯" + _da(3) + "！」", name(tc) + " took out the wallet without thinking \"I'll give you pocket money!\"")
				}
				sexvalue = sdata(SKILL_ATTR_CHA, cc) * (10 + rnd(10)) + 50
				if ( cdata(CDATA_GOLD, tc) <= sexvalue ) {
					sexvalue = cdata(CDATA_GOLD, tc)
				}
				cdata(CDATA_GOLD, tc) -= sexvalue
				if ( cdata(CDATA_GOLD, tc) <= 0 ) {
					cdata(CDATA_GOLD, tc) = 1
				}
				snd SOUNDLIST_PAYGOLD1
				flt
				itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), sexvalue
				if ( cc == CHARA_PLAYER ) {
					txt_questitem
				}
				cdata(CDATA_INTEREST, tc) -= rnd(10) + 20
				cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
			}
			if ( cdata(CDATA_CONDITION_PARALYZE, tc) == 0 ) {
				cdata(CDATA_CONDITION_PARALYZE, tc) = 1
			}
		}
		else {
			if ( jp ) {
				txtef COLOR_RED
				txt name(tc) + "は平然としている！", name(tc) + "は真顔で" + name(cc) + "を見ている…。"
			}
			if ( en ) {
				txtef COLOR_RED
				txt name(tc) + " is nonchalant!"
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MELT_CLINCH | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_POISON
		await 100
		snd SOUNDLIST_ATK_POISON
		await 100
		snd SOUNDLIST_ATK_POISON
		if ( cdata(CDATA_CONDITION_BIND, tc) < 1 ) {
			cdata(CDATA_CONDITION_BIND, tc) = 1
		}
		if ( cdata(CDATA_CONDITION_ATROPHY, tc) < 1 ) {
			cdata(CDATA_CONDITION_ATROPHY, tc) = 1
		}
		if ( cdata(CDATA_CONDITION_BIND, cc) < 2 ) {
			cdata(CDATA_CONDITION_BIND, cc) = 2
		}
		txt lang(name(cc) + "は" + name(tc) + "に組み付いて溶かし始めた。", name(cc) + " assembled with " + name(tc) + " and started to melt.")
        txt lang("「ひっ！」", cnvtalk("Ouch!")), lang("「と、溶かされる！」", cnvtalk("I'm m-melting!")), lang("「あぁぁあっ！？」", cnvtalk("Aaaaah!")), lang("「ぎゃあああ…！」", cnvtalk("Gyaaaaaahh...!"))
		dmghp tc, sdata(SKILL_ATTR_STR, cc) * 2 + sdata(SKILL_ATTR_CON, cc) * 2 + rnd(sdata(SKILL_ATTR_STR, cc) + 10), cc, SKILL_RESDMG_ACID, 1000
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_FORMLESS_FETTER | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は周囲に魔力を放った！", name(cc) + " devoted magical power to the surroundings!")
		snd SOUNDLIST_ATK_MIND
		animeload 48, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cc) > (-3) | cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, cnt) > (-3) ) {
					continue
				}
			}
			if ( cdata(CDATA_RELATION, cc) == (-3) ) {
				if ( cdata(CDATA_RELATION, cnt) == (-3) & cnt != 0 ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) != 0 ) {
				i = map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) - 1
				s = ""
				if ( mef(0, i) == 1 ) {
					s = lang("糸", "web")
				}
				if ( mef(0, i) == 2 ) {
					s = lang("闇", "darkness")
				}
				if ( mef(0, i) == 3 ) {
					s = lang("酸", "acid")
				}
				if ( mef(0, i) == 4 ) {
					s = lang("エーテル", "ether")
				}
				if ( mef(0, i) == 5 ) {
					s = lang("炎", "fire")
				}
				if ( mef(0, i) == 6 ) {
					s = lang("液体", "potion")
				}
				if ( mef(0, i) == 8 ) {
					s = lang("光", "light")
				}
				if ( mef(0, i) == 9 ) {
					s = lang("煙", "smoke")
				}
				if ( s == "" ) {
					continue
				}
				txt lang("まるで生きているかのように、" + s + "が" + name(tc) + "に絡みついた！", "As if it were alive, the " + s + " caught " + name(tc) + "!")
				snd SOUNDLIST_EAT1
				if ( cdata(CDATA_CONDITION_BIND, tc) < 1 ) {
					cdata(CDATA_CONDITION_BIND, tc) = 1
				}
				dmghp tc, sdata(SKILL_ATTR_MAG, cc) * (sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) + 100) / 30 + rnd(sdata(SKILL_ATTR_MAG, cc) + 100), cc, SKILL_RES_MAGIC, 1000
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					p = (MAX_SKILL_ATTR - MAX_SKILL_ATTR_BASIC) - STARTING_SKILL_ATTR
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + STARTING_SKILL_ATTR + p) != (-1) ) {
						p = -1
					}
					if ( sdata(SKILL_ATTR_DEX, tc) < sorg(SKILL_ATTR_DEX, tc) / 2 ) {
						p = -1
					}
					if ( findbuff(tc, BUFF_DISINFECTION) != (-1) ) {
						p = -1
					}
					if ( p != (-1) ) {
						i = sorg(STARTING_SKILL_ATTR + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
						if ( i > 0 ) {
							efp = (sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) + 1) / 4 + 20
							i = i * efp / 2000 + 5
							cdata(STARTING_CDATA_ATTR + p, tc) -= i
						}
						if ( synccheck(tc, -1) ) {
							txtmore
							txtef COLOR_PURPLE
							txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
						}
						r1 = tc
						gosub *charaRefresh
					}
				}
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_E_MAG_CAGE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 80 ) {
			txt_nothinghappens
			goto *effect_end
		}
		snd SOUNDLIST_ENC
		animeload 40, cc
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GARDEN
			animode = 1
			gosub *anime
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 80
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
			cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = 1
		}
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			weap = limit(sdata(SKILL_ATTR_PER, cc) / 4, 1, 1000)
		}
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmg = limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1)
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			dmghp tc, dmg, cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				continue
			}
			txt lang(name(tc) + "の前面がＳ極になった！", name(cc) + " became the S pole on the front!")
			cbitmod CHARA_BIT_MAGNETISM_S_POLE, tc, TRUE
			cbitmod CHARA_BIT_MAGNETISM_N_POLE, tc, FALSE
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_ATTR_PER, cc, 200
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_ROCRUSHER | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 80 ) {
			txt_nothinghappens
			goto *effect_end
		}
		snd SOUNDLIST_ENC
		animeload 40, cc
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GARDEN
			animode = 4
			gosub *anime
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 80
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
			cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = 4
		}
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			weap = limit(sdata(SKILL_ATTR_CON, cc) / 4, 1, 1000)
		}
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmg = limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1)
		repeat 245
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			dmghp tc, dmg, cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
			if ( cdata(CDATA_CONDITION_BIND, tc) < 5 ) {
				cdata(CDATA_CONDITION_BIND, tc) = 5
			}
			map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_TILE_ID) = xy2pic(32, 17)
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_ATTR_CON, cc, 200
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_MOGRANIC_AURA | _switch_sw ) {
		_switch_sw = 0
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_TILE_ID) = xy2pic(12, 0)
		repeat 4
			animeload 68, tc
			snd SOUNDLIST_BREATH1
		loop
		cfg_animewait = waitbk
		cdata(CDATA_CONDITION_MPOISON, tc) += 50
		p = limit(sdata(SKILL_ATTR_CON, tc) * 3, 0, 1200)
		addbuff tc, BUFF_MOGRANIC_AURA, p, 50
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_WIRE_WORLD | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 80 ) {
			txt_nothinghappens
			goto *effect_end
		}
		snd SOUNDLIST_ENC
		animeload 40, cc
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GARDEN
			animode = 2
			gosub *anime
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 80
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
			cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = 2
		}
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			weap = limit(sdata(SKILL_ATTR_DEX, cc) / 4, 1, 1000)
		}
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmg = limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1)
		repeat 245
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			dmghp tc, dmg, cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
			if ( map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_FEATS_ON_TILE) != 0 ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS, cc
			}
			else {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_BLADE_STRINGS, cc
			}
			if ( cc == CHARA_PLAYER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), tile_trap, -1, -1
			}
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_ATTR_DEX, cc, 200
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_MAGNECOAT | _switch_sw ) {
		_switch_sw = 0
		if ( cbit(CHARA_BIT_MAGNETISM_N_POLE, tc) == TRUE ) {
			snd SOUNDLIST_ATK_ELEC
			animeload 11, tc
			txt lang(name(tc) + "から磁気が消えた…。", "The magnetism disappeared...")
			cbitmod CHARA_BIT_MAGNETISM_S_POLE, tc, FALSE
			cbitmod CHARA_BIT_MAGNETISM_N_POLE, tc, FALSE
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_MAGNETISM_S_POLE, tc) == FALSE ) {
			snd SOUNDLIST_ATK_ELEC
			animeload 11, tc
			txt lang(name(tc) + "の前面がＳ極になった！", name(cc) + " became the S pole on the front!")
			cbitmod CHARA_BIT_MAGNETISM_S_POLE, tc, TRUE
			cbitmod CHARA_BIT_MAGNETISM_N_POLE, tc, FALSE
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_MAGNETISM_S_POLE, tc) == TRUE ) {
			snd SOUNDLIST_ATK_ELEC
			animeload 11, tc
			txt lang(name(tc) + "の前面がＮ極になった！", name(cc) + " became the N pole on the front!")
			cbitmod CHARA_BIT_MAGNETISM_S_POLE, tc, FALSE
			cbitmod CHARA_BIT_MAGNETISM_N_POLE, tc, TRUE
			goto *effect_end
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_TICKLING_HELL | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は" + name(tc) + "の動きを封じ、全力でくすぐった！", name(cc) + " held down " + name(tc) + " and started to tickle " + him(tc) + " at full power!")
		if ( cc < MAX_CHARA_FOLLOWER ) {
			hostileaction cc, tc
		}
		repeat 10
			snd SOUNDLIST_CARD1
			await 50
		loop
		if ( cdata(CDATA_CONDITION_BIND, tc) <= 0 ) {
			cdata(CDATA_CONDITION_BIND, tc) = 1
		}
		dmg = sqrt(sdata(SKILL_ATTR_DEX, cc) * 100 / sdata(SKILL_ATTR_CON, tc) + 16) + 5
		if ( tc == CHARA_PLAYER ) {
			dmgsp CHARA_PLAYER, dmg
		}
		if ( tc != CHARA_PLAYER ) {
			dmgspt tc, dmg
		}
		if ( jp ) {
			txt name(tc) + "は苦しそうに笑っている！", "「ひっ！ひィィ！やめっ…でっ！」", "「あはははははっはははははは！！！」", "「はははっはは…げほっ！げほっ！！ううう…ぐえっ！」", "「んぎいいい！？いっ…ひいいい！！！」", "「ぐっあああ…！はぁーっ！あはははっ…！」", "「こ、こしょばゆいいいいい！！！」"
		}
		if ( sdata(SKILL_ATTR_PER, tc) > sdata(SKILL_ATTR_CON, tc) ) {
			cdata(CDATA_POWER_GAUGE, tc) -= 10
		}
		if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 2 ) {
			dmgsan tc, rnd(rnd(1 + sdata(SKILL_ATTR_DEX, cc) / 20) * 10 + 2) + 1
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_SQUEEZE | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER & (cbit(CHARA_BIT_LIVESTOCK, tc) == 1 | getworker(gdata(GDATA_AREA)) == tc) & adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH ) {
			if ( cbit(CHARA_BIT_SQUEEZED, tc) == 1 ) {
				txt lang("まだ乳が溜まってない。", name(tc) + " has not accumulated milk yet.")
				goto *effect_end
			}
			if ( TweakData(54, 2) == 1 & cdata(CDATA_SPRITE_SIZE_MILK, tc) != 0 ) {
				txt lang("乳を搾れるほど成長していない。", name(tc) + " is not old enough to produce milk.")
				goto *effect_end
			}
			if ( sorg(SKILL_ATTR_LIFE, tc) <= 2 ) {
				txtef COLOR_RED
				txt lang("無理に搾り取ると死にそうだ。やめておこうか？", "If you squeeze more milk, " + name(tc) + " will die. Stop it?")
				promptYesNo
				if ( rtval != 1 ) {
					goto *effect_end
				}
				txt lang("あなたは" + name(tc) + "から搾り尽くした。", "You squeezed " + name(tc) + " to exhaustion.")
				snd SOUNDLIST_DRINK1
				await 100
				snd SOUNDLIST_DRINK1
				await 100
				snd SOUNDLIST_DRINK1
				milkp = 0
				if ( cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) >= 10 & cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) <= 12 ) {
					milkp = cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) - 9
				}
				flt
				itemcreate -1, ITEM_ID_BOTTLE_MILK, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
				if ( stat ) {
					inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
					if ( TweakData(54, 2) == 1 ) {
						inv(INV_ITEM_LEVEL, ci) = cdata(CDATA_BRUSH_LEVEL, tc) + milkp + 5 + cdata(CDATA_SPRITE_SIZE_MILK, tc) + rnd(limit(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) / 100, 0, 2) + 1)
					}
					else {
						inv(INV_ITEM_LEVEL, ci) = cdata(CDATA_BRUSH_LEVEL, tc) + 2 + milkp + rnd(limit(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) / 50, 0, 5) + 1)
					}
				}
				milkp = 0
				cbitmod CHARA_BIT_SQUEEZED, tc, 1
				evadd EVENT_SQUEEZE, tc
				goto *effect_end
			}
			snd SOUNDLIST_DRINK1
			await 100
			snd SOUNDLIST_DRINK1
			await 100
			snd SOUNDLIST_DRINK1
			milkp = 0
			if ( cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) >= 10 & cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) <= 12 ) {
				milkp = cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, tc) - 9
			}
			flt
			itemcreate -1, ITEM_ID_BOTTLE_MILK, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			if ( stat ) {
				inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
				if ( TweakData(54, 2) == 1 ) {
					inv(INV_ITEM_LEVEL, ci) = cdata(CDATA_BRUSH_LEVEL, tc) + milkp + 5 + cdata(CDATA_SPRITE_SIZE_MILK, tc) + rnd(limit(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) / 100, 0, 2) + 1)
				}
				else {
					inv(INV_ITEM_LEVEL, ci) = cdata(CDATA_BRUSH_LEVEL, tc) + 2 + milkp + rnd(limit(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) / 50, 0, 5) + 1)
				}
			}
			milkp = 0
			txtef COLOR_GREEN
			txt lang(name(tc) + "から濃厚な乳を搾り取った。", "You squeezed milk from " + name(tc) + ".")
			txtef COLOR_PINK
			txt lang(name(tc) + "から元気がなくなった。", name(tc) + " got weakened.")
			skillmod SKILL_ATTR_LIFE, tc, sorg(SKILL_ATTR_LIFE, tc) * (-1) / 2 * 1000
			cbitmod CHARA_BIT_SQUEEZED, tc, 1
			goto *effect_end
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_ROVID ) {
					snd SOUNDLIST_AMMO
					txt lang(cdatan(CDATAN_NAME, cnt) + "「抱き枕で我慢していなさい！」", cdatan(CDATAN_NAME, cnt) + " says: \"Please make do with the hug pillow!\"")
					goto *effect_end
				}
			loop
		}
		soine = 0
		if ( gdata(GDATA_SLEEP) >= 15 ) {
			if ( cc == CHARA_PLAYER ) {
				if ( map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4) != 0 ) {
					cell_itemlist cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
					f = 0
					repeat listmax
						p = list(0, cnt)
						if ( inv(INV_ITEM_ID, p) == ITEM_ID_HAPPY_BED | inv(INV_ITEM_ID, p) == ITEM_ID_DOUBLE_BED | inv(INV_ITEM_ID, p) == ITEM_ID_KINGS_BED ) {
							soine = 100
							break
						}
					loop
				}
				if ( soine == 100 ) {
					snd SOUNDLIST_DRINK1
					await 100
					snd SOUNDLIST_DRINK1
					await 100
					snd SOUNDLIST_DRINK1
					txt lang(name(cc) + "は" + name(tc) + "をベッドへと抱き寄せた。", name(cc) + " hugged " + name(tc) + " to bed.")
					teikou = limit(cdata(CDATA_HP, tc) * 20 / cdata(CDATA_MAX_HP, tc), 1, 20) * sdata(SKILL_ATTR_STR, tc) / 2
					if ( cdata(CDATA_IMPRESSION, tc) < 200 & rnd(sdata(SKILL_ATTR_STR, CHARA_PLAYER)) < teikou & cdata(CDATA_MASTER_SERVANT, tc) < 150 ) {
						hostileaction cc, tc
						txtef COLOR_RED
						txt lang(name(tc) + "は信じられない" + teikou + "ほどの力で抵抗し、あなたを振りほどいた。", name(cc) + " squeezed " + name(tc) + ".")
						goto *effect_end
					}
					if ( cdata(CDATA_IMPRESSION, tc) < 200 & cdata(CDATA_MASTER_SERVANT, tc) < 150 ) {
						txtef COLOR_BLUE
						txt lang(name(tc) + "は必死に抵抗したが、あなたの力は強かった。", name(tc) + " tried desperately to resist, but you were stronger.")
						modkarma CHARA_PLAYER, -20
						if ( jp ) {
							customtalk tc, DBMODE_FLAVOR_INSULT
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								txt name(tc) + "はあきらめが悪く、まだジタバタしている…。", "「こんなのってない" + _yo(3) + "！」", "「どうしてこうなった…」", "「こんなことするなんて、見損なった" + _yo(3) + "！」", "「この犯罪者！」"
							}
						}
						soine = 1000
					}
					if ( cdata(CDATA_IMPRESSION, tc) >= 200 & cdata(CDATA_MASTER_SERVANT2, tc) < 5 ) {
						soine = 2000
						txtef COLOR_GREEN
						txt lang(name(tc) + "は形だけの抵抗しか見せなかった。", name(cc) + " squeezed " + name(tc) + ".")
						cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
						if ( jp ) {
							customtalk tc, DBMODE_FLAVOR_HUG
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								txt name(tc) + "はふっと力を抜くと、身体をあなたに預けた。", "「あーれー」", "「まったく、甘えん坊さん" + _dana(3) + "」"
							}
						}
					}
					if ( cdata(CDATA_IMPRESSION, tc) >= 200 & cdata(CDATA_MASTER_SERVANT2, tc) >= 5 ) {
						soine = 2000
						txtef COLOR_GREEN
						txt lang(name(tc) + "は抱擁を振りほどくと、あなたをベッドへ押さえつけた。", name(tc) + " hugs you and pushes you onto the bed.")
						if ( jp ) {
							customtalk cc, DBMODE_FLAVOR_INSULT2
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								txt name(tc) + "はあなたを見下ろして冷笑を浮かべた。", "「おっと、こんなところに抱き枕が」", "「覚悟はできている" + _kana(3) + "？」"
							}
						}
					}
					if ( cdata(CDATA_IMPRESSION, tc) < 200 & cdata(CDATA_MASTER_SERVANT, tc) >= 150 ) {
						soine = 1000
						if ( jp ) {
							txtef COLOR_BLUE
							txt name(tc) + "は全てを察して抵抗しなかった。", name(tc) + "は諦めの表情を浮かべている…。", name(tc) + "は無言で流れに身を任せている。"
						}
					}
					cbitmod CHARA_BIT_MAKE_GENE, tc, 1
					cdata(CDATA_ITEM_USING, CHARA_PLAYER) = -1
					goto *sleep
				}
			}
		}
		if ( ( cc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, tc) < 100 ) | ( tc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, cc) < 100 ) ) {
			txt lang(name(cc) + "は" + name(tc) + "をきつく締め上げた。", name(cc) + " squeezed " + name(tc) + ".")
		}
		if ( ( cc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, tc) >= 100 ) | ( tc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, cc) >= 100 ) ) {
			txt lang(name(cc) + "は" + name(tc) + "をきつく抱きしめた。", name(cc) + " hugged " + name(tc) + " tightly.")
		}
		if ( cc == CHARA_PLAYER & tc == CHARA_PLAYER ) {
			txt lang("痛い！", "What?")
			goto *effect_end
		}
		if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
			cdata(CDATA_CONDITION_BIND, tc) = 1
		}
		if ( ( cc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, tc) < 100 ) | ( tc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, cc) < 100 ) ) {
			if ( cbit(CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc) == TRUE ) {
				txtef COLOR_RED
				txt lang("さらに、" + name(tc) + "に極め技を仕掛けた。", "Further, " + name(cc) + " attacked " + name(tc) + " by kiwame-waza.")
			}
			if ( jp ) {
				txt name(tc) + "の身体が軋む…。", "「くるし…い…」", "「ぐぇぇ」", "「死ぬぅ！」"
			}
			snd SOUNDLIST_DRINK1
			await 100
			snd SOUNDLIST_DRINK1
			await 100
			snd SOUNDLIST_DRINK1
			dmghp tc, limit(sdata(SKILL_ATTR_STR, cc) / 20 * (sdata(SKILL_ATTR_STR, cc) / 20 + rnd(sdata(SKILL_ATTR_STR, cc) / 20 + 2)) - sdata(SKILL_ATTR_STR, tc) * 2, sdata(SKILL_ATTR_STR, cc), 100000), cc
			if ( cbit(CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc) == TRUE ) {
				dmghp tc, limit(sdata(SKILL_ATTR_DEX, cc) / 10 * (sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) + 1) / 10 + rnd(sdata(SKILL_ATTR_DEX, cc) * 2) - sdata(SKILL_ATTR_CON, tc) * 2, sdata(SKILL_ATTR_DEX, cc), 100000), cc
				if ( cdata(CDATA_CONDITION_BIND, cc) < 2 ) {
					cdata(CDATA_CONDITION_BIND, cc) = 2
				}
			}
			hostileaction cc, tc
			goto *effect_end
		}
		if ( ( cc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, tc) >= 200 ) | ( tc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, cc) >= 200 ) ) {
			cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
			if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
				cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
			}
			if (tc != CHARA_PLAYER) {
				customtalk tc, DBMODE_FLAVOR_HUG
			}
			else {
				customtalk cc, DBMODE_FLAVOR_HUG
			}
			gosub *convert_word
			if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
				if ( jp ) {
					txt name(tc) + "は無言で抱きしめ返してきた。", "「あたたかい…」", "「幸せな気分" + _dana(3) + "」"
				}
			}
		}
		if ( cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 10 + 1 ) {
			if ( cdata(CDATA_HP, tc) != cdata(CDATA_MAX_HP, tc) ) {
				animeid = ANIMATION_HEAL_FAST
				gosub *anime
				dmghp cc, limit(cdata(CDATA_MAX_HP, cc) / 10, 1, cdata(CDATA_MAX_HP, tc) - cdata(CDATA_HP, tc)),
				healhp tc, cdata(CDATA_MAX_HP, cc) / 10
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MAGIC_KISS | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_ROVID ) {
					snd SOUNDLIST_AMMO
					txt lang(cdatan(CDATAN_NAME, cnt) + "「ジュア様の唇は私が絶対防衛します！」", cdatan(CDATAN_NAME, cnt) + " says: \"I will protect Lady Jure's lips at all costs!\"")
					goto *effect_end
				}
			loop
		}
		if ( cc == CHARA_PLAYER & tc == CHARA_PLAYER ) {
			txt lang("えっ。", "What?")
			goto *effect_end
		}
		txt lang(name(cc) + "は" + name(tc) + "に口づけした。", name(cc) + " kissed " + name(tc) + ".")
		if ( ( cc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, tc) >= 200 ) | ( tc == CHARA_PLAYER & cdata(CDATA_IMPRESSION, cc) >= 200 ) ) {
			cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
			if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
				cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
			}
			if ( cc == CHARA_PLAYER) {
				customtalk tc, DBMODE_FLAVOR_KISS
			}
			else {
				customtalk cc, DBMODE_FLAVOR_KISS
			}
			gosub *convert_word
			if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
				if ( jp ) {
					txt "「大好き♪1」", "「んっ…♪」", "「もっと…して」", "「キスだけじゃいや…」"
				}
			}
			dmgmp cc, sdata(SKILL_ATTR_CHA, cc) / 20 + 1
			healmp tc, sdata(SKILL_ATTR_CHA, cc) / 10 + 1
			goto *effect_end
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_IMPRESSION, tc) < 100 ) {
				if ( jp ) {
					txt "「ヘンタイ！」", "「殺してやる」", "「うげぇ…ぺっぺっ」", "「ひどい…」"
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					hostileaction cc, tc
				}
				if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
					if ( rnd(3) == 0 ) {
						cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
					}
				}
				modkarma CHARA_PLAYER, -4
				modimp tc, -10
				dmgmp tc, sdata(SKILL_ATTR_CHA, cc) / 10 + 1
				healmp cc, sdata(SKILL_ATTR_CHA, cc) / 20 + 1
				goto *effect_end
			}
			if ( jp ) {
				txt "「いきなり何を！？」", "「冗談はやめてよ」", "「そういう関係になりたいの？」", "「責任とってよ！」"
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
			if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
				if ( rnd(2) == 0 ) {
					cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
				}
			}
			dmgmp tc, sdata(SKILL_ATTR_CHA, cc) / 10 + 1
			healmp cc, sdata(SKILL_ATTR_CHA, cc) / 10 + 1
			modkarma CHARA_PLAYER, -2
			goto *effect_end
		}
		dmgmp tc, rnd(sdata(SKILL_ATTR_CHA, cc) / 10 + 30) + 10
		healmp cc, rnd(sdata(SKILL_ATTR_CHA, cc) / 10 + 30) + 10
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_HYPER_DASH | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( gdata(GDATA_RIDER) == 0 ) {
				txt_nothinghappens
				goto *effect_end
			}
			tc = CHARA_PLAYER
		}
		if ( cc == gdata(GDATA_RIDER) ) {
			tc = CHARA_PLAYER
		}
		addbuff tc, BUFF_HYPER_DASH, 30, 30
		snd SOUNDLIST_SONIC
		animeload ANIMATION_HEAL_FAST, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CLEAR_MIND | _switch_sw ) {
		_switch_sw = 0
		addbuff tc, BUFF_CLEAR_MIND, 100, 20 + sdata(SKILL_WEAPON_MARTIAL_ARTS, tc) / 5
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_MP_BREATH, cc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_KILLING_DANCE | _switch_sw ) {
		_switch_sw = 0
		if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
			addbuff tc, BUFF_KILLING_DANCE, 44, 44
		}
        else {
			addbuff tc, BUFF_KILLING_DANCE, 13, 13
		}
		snd SOUNDLIST_ATK_MIND
		animeload 43, cc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SPACE_RETENTION | _switch_sw ) {
		_switch_sw = 0
		addbuff tc, BUFF_RETENTION, 30, 30
		snd SOUNDLIST_PRAY1
		animeload ANIMATION_BLOOD, cc
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) < 0 ) {
			txtef COLOR_RED
			txt lang("現在のフィールド変化は解除できない…。", "The current field state cannot be reset...")
		}
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) > 0 ) {
			cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = 0
			txtef COLOR_GREEN
			txt lang("フィールド変化が解除された。", "The field state was reset.")
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_UNCONTROL | _switch_sw ) {
		_switch_sw = 0
		if ( findbuff(tc, BUFF_RUN_WILDLY) == (-1) ) {
			addbuff tc, BUFF_RUN_WILDLY, sorg(SKILL_ATTR_LER, tc) + sorg(SKILL_ATTR_DEX, tc) + sorg(SKILL_ATTR_WIL, tc), 30
			snd SOUNDLIST_ATK_FIRE
			animeload ANIMATION_GENE, tc
			if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
				cdata(CDATA_CONDITION_ANGRY, tc) = 30
				txt lang(name(tc) + "は狂暴化した。", name(cc) + " went berserk.")
			}
			if ( tc == CHARA_PLAYER ) {
				if ( cdata(CDATA_CONDITION_CONFUSE, tc) == 0 ) {
					cdata(CDATA_CONDITION_CONFUSE, tc) = 5
					txtef COLOR_PURPLE
					txt lang(name(tc) + "は混乱した。", name(tc) + " " + is(tc) + " confused.")
				}
			}
			if ( cdata(CDATA_PIC, tc) == xy2pic(13, 22) ) {
				cdata(CDATA_PIC, tc) = xy2pic(25, 24)
			}
			if ( cdata(CDATA_PIC, tc) == xy2pic(18, 17) ) {
				cdata(CDATA_PIC, tc) = xy2pic(20, 19)
			}
			if ( cdata(CDATA_PIC, tc) == xy2pic(6, 26) ) {
				cdata(CDATA_PIC, tc) = xy2pic(7, 26)
				if ( cdata(CDATA_PORTRAIT, tc) == 86 ) {
					cdata(CDATA_PORTRAIT, tc) = 87
				}
			}
			goto *effect_end
		}
		if ( cdata(CDATA_EXIST, cdata(CDATA_TARGET, tc)) == CHAR_STATE_ALIVE ) {
			if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
				tc = cdata(CDATA_TARGET, cc)
				gosub *act_melee
				goto *effect_end
			}
		}
		if ( cdata(CDATA_EXIST, cdata(CDATA_TARGET, tc)) == CHAR_STATE_ALIVE & dist(cdata(CDATA_X, cdata(CDATA_TARGET, tc)), cdata(CDATA_Y, cdata(CDATA_TARGET, tc)), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) > 1 ) {
			tc = cdata(CDATA_TARGET, tc)
			efid = SKILL_SPACT_SHADOW_STEP
			gosub *effect
		}
		else {
			efid = SKILL_SPACT_SWARM
			gosub *effect
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_INTENSIVE_POWER | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_ATK_MIND
		}
		txt lang(name(cc) + "は力を集めている！", name(cc) + " accumulates power.")
		if ( cdata(CDATA_POWER_GAUGE, cc) > 100 & cdata(CDATA_POWER_GAUGE, cc) < 185 ) {
			cdata(CDATA_POWER_GAUGE, cc) += 16
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) < 85 ) {
			cdata(CDATA_POWER_GAUGE, cc) += 16
		}
		healhp cc, cdata(CDATA_MAX_HP, cc) / 20 + 2
		healmp cc, cdata(CDATA_MAX_MP, cc) / 20 + 2
		healsp cc, cdata(CDATA_MAX_SP, cc) / 20 + 1
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_PRESSURE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_GARDEN, tc
		dmgmp cc, cdata(CDATA_MAX_MP, cc) / 2
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == (-3) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は怯えた。", name(tc) + " was overwhelmed.")
			}
			cdata(CDATA_POWER_GAUGE, tc) -= 50
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			if ( rnd(8) == 0 ) {
				if ( cdata(CDATA_CONDITION_FEAR, tc) == 0 ) {
					cdata(CDATA_CONDITION_FEAR, tc) = 1
				}
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_COWERING_SMILE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_MIND
		animeload ANIMATION_GARDEN, cc
		txtef COLOR_RED
		txt lang(name(cc) + "は笑顔を作ったが、目が全然笑っていない！", name(cc) + " smiles, but " + his(cc) + " eyes are not laughing at all!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は戦慄した。", name(tc) + " was overwhelmed.")
			}
			if ( cdata(CDATA_CONDITION_ATROPHY, tc) == 0 ) {
				cdata(CDATA_CONDITION_ATROPHY, tc) += 3
			}
			if ( cdata(CDATA_CONDITION_CHILLS, tc) == 0 ) {
				cdata(CDATA_CONDITION_CHILLS, tc) = 3
			}
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ABYSS_IN_THE_EYE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_AROMAGEDDON, cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, cnt) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_ABYSS_IN_THE_EYE, 50, 50
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_SMILE_FIELD | _switch_sw ) {
		_switch_sw = 0
		animeid = ANIMATION_STARS
		gosub *anime
		txtef COLOR_GREEN
		txt lang(name(cc) + "は笑顔を振りまいた。", name(cc) + " smiled.")
		addbuff cc, BUFF_RETENTION, 20, 20
		smile = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			smile++
		loop
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_CONCENTRATION, sdata(SKILL_ATTR_WIL, cc) / 2 * sqrt(smile + 1) + 10, 50
			if ( synccheck(tc, -1) ) {
				txtef COLOR_PINK
				txt lang(name(tc) + "の興味を惹いた。", name(cc) + " caught interest of " + name(tc) + ".")
			}
		loop
		smile = 0
		snd SOUNDLIST_CHEER
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_POLLEN_CANNON | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_GREEN
		txt lang(name(cc) + "は強烈花粉を噴出した！", name(cc) + " gushed out intense pollen!")
		animeid = ANIMATION_POLLEN_CANNON
		gosub *anime
		animeload 8, tc
		if ( tc == CHARA_PLAYER ) {
			txt lang("ぐわぁぁぁぁぁっ！！！", "Arrrrg!")
		}
		hostileaction cc, tc
		elep = cdata(CDATA_LEVEL, cc) * 2
		dmgcon tc, CONDITION_WINCE, rnd(elep + 1)
		dmgcon tc, CONDITION_CHILLS, rnd(elep + 1)
		dmgcon tc, CONDITION_BLIND, rnd(elep + 1)
		dmgcon tc, CONDITION_PARALYZE, rnd(elep + 1)
		dmgcon tc, CONDITION_CONFUSE, rnd(elep + 1)
		dmgcon tc, CONDITION_DIM, rnd(elep + 1)
		dmgcon tc, CONDITION_POISON, rnd(elep + 1)
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			p = 13 - 10
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, 6 * 10000 + 10 + p) != (-1) ) {
				p = -1
			}
			if ( sdata(SKILL_ATTR_PER, tc) < sorg(SKILL_ATTR_PER, tc) / 2 ) {
				p = -1
			}
			if ( p != (-1) ) {
				i = sorg(10 + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
				if ( i > 0 ) {
					efp = (elep + 1) / 4 + 20
					i = i * efp / 2000 + 5
					cdata(STARTING_CDATA_ATTR + p, tc) -= i
				}
				if ( synccheck(tc, -1) ) {
					txtmore
					txtef COLOR_PURPLE
					txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
				}
				r1 = tc
				gosub *charaRefresh
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_MISTELTEIN | _switch_sw ) {
		_switch_sw = 0
		if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
			f = 1
		}
		txtef COLOR_GREEN
		txt lang(name(cc) + "はヤドリギを投げつけた。", name(cc) + " threw the mistletoe.")
		animeid = ANIMATION_SPORE
		gosub *anime
		animeload ANIMATION_FIZZLE, tc
		hostileaction cc, tc
		dmgmp tc, sdata(SKILL_WEAPON_THROWING, cc) / 5 + rnd(5 + sdata(SKILL_WEAPON_THROWING, cc) / 5)
		s = refchara(cdata(CDATA_ID, tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/god/") != (-1) ) {
			dmg = (sdata(SKILL_WEAPON_THROWING, cc) / 3 + 1) * ((sdata(SKILL_NORMAL_GARDENING, cc) + 1) / 3 + 1) + rnd(sdata(SKILL_WEAPON_THROWING, cc) + 5)
			dmg = dmg * 50 / (sdata(SKILL_NORMAL_GARDENING, tc) + 50)
			dmghp tc, dmg, cc
		}
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_NORMAL_GARDENING, cc, 20
			skillexp SKILL_WEAPON_THROWING, cc, 20
		}
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			p = STARTING_SKILL_ATTR - STARTING_SKILL_ATTR
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + STARTING_SKILL_ATTR + p) != (-1) ) {
				p = -1
			}
			if ( sdata(SKILL_ATTR_STR, tc) < sorg(SKILL_ATTR_STR, tc) / 2 ) {
				p = -1
			}
			if ( p != (-1) ) {
				i = sorg(STARTING_SKILL_ATTR + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
				if ( i > 0 ) {
					efp = (sdata(SKILL_NORMAL_GARDENING, cc) + 1) / 4 + 20
					i = i * efp / 2000 + 5
					cdata(STARTING_CDATA_ATTR + p, tc) -= i
				}
				if ( synccheck(tc, -1) ) {
					txtmore
					txtef COLOR_PURPLE
					txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
				}
				r1 = tc
				gosub *charaRefresh
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_VIOLENT_GARDEN | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_GARDEN
			animode = 3
			gosub *anime
		}
		txtef COLOR_YELLOW
		txt lang("地面から毒を帯びた蔓が飛び出した！", "Poisonous vines popped out from the ground!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
				dmg = (sdata(SKILL_ATTR_LER, cc) / 5 + 2) * ((sdata(SKILL_NORMAL_GARDENING, cc) + 1) / 2 + 2) + rnd(sdata(SKILL_ATTR_LER, cc) + 5)
			}
			else {
				dmg = (sdata(SKILL_ATTR_LER, cc) / 5 + 2) * ((sdata(SKILL_NORMAL_GARDENING, cc) + 1) / 5 + 2) + rnd(sdata(SKILL_ATTR_LER, cc) + 5)
			}
			dmghp tc, dmg, cc, SKILL_RES_POISON, 1000
			if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
				if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
					cdata(CDATA_CONDITION_BIND, tc) += 3
				}
				else {
					cdata(CDATA_CONDITION_BIND, tc) += 1
				}
				if ( synccheck(tc, -1) ) {
					txt lang(name(tc) + "は蔓に束縛された。", name(tc) + " was bound.")
				}
			}
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_NORMAL_GARDENING, cc, 50
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ANAPHYLAXIS | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_AROMAGEDDON
			gosub *anime
		}
		txtef COLOR_PURPLE
		txt lang(name(cc) + "はアレルギー毒をまき散らした。", name(cc) + " spreads allergenic poison.")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
				f = 1
			}
			dmg = limit((sdata(SKILL_ATTR_CON, cc) / 8 + 2) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 1) / 8 + 2) + rnd(cdata(CDATA_CONDITION_POISON, tc) + 5), 2, 40000)
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 25 & cdata(CDATA_CONDITION_POISON, tc) < 50 ) {
				dmg = dmg * 2
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 50 & cdata(CDATA_CONDITION_POISON, tc) < 75 ) {
				dmg = dmg * 3
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 75 & cdata(CDATA_CONDITION_POISON, tc) < 100 ) {
				dmg = dmg * 4
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 100 & cdata(CDATA_CONDITION_POISON, tc) < 125 ) {
				dmg = dmg * 5
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 125 & cdata(CDATA_CONDITION_POISON, tc) < 150 ) {
				dmg = dmg * 6
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) >= 150 ) {
				dmg = dmg * 7
			}
			dmghp tc, dmg, cc, SKILL_RES_POISON, 10
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_POISON, tc) == 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) == 0 ) {
				cdata(CDATA_CONDITION_SUFFOCATION, tc) = 5
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は呼吸困難になった。", name(tc) + " suffers dyspnea.")
			}
			dmgcon tc, CONDITION_DIM, 200
			chara_vomit tc
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_NORMAL_GENE_ENGINEER, cc, 50
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_VENOTRATE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 25 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 25
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は凝固させた毒を放った！", name(cc) + " shot solidified venom.")
		animeid = 43
		gosub *anime
		ele = SKILL_NONE
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG, efid) \ 1000 + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( cc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, tc) != (-3) ) {
							continue
						}
					}
					if ( cc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION_ORG, tc) == cdata(CDATA_RELATION_ORG, cc) | cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) | (cdata(CDATA_RELATION, cc) >= (-1) & cdata(CDATA_RELATION, tc) >= (-1)) ) {
							continue
						}
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
						f = 1
					}
					dmg = (sdata(SKILL_NORMAL_TACTICS, cc) / 5 + 2) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 1) / 5 + 2) + rnd(sdata(SKILL_NORMAL_TACTICS, cc) + sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 5)
					dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
					if ( cdata(CDATA_QUALITY, tc) > FIX_QUALITY_GREAT | cdata(CDATA_ID, tc) == CREATURE_ID_AILE_THE_ATTENDANT ) {
						if ( cdata(CDATA_CONDITION_POISON, tc) < 2 ) {
							cdata(CDATA_CONDITION_POISON, tc) = 2
						}
					}
					else {
						cdata(CDATA_CONDITION_POISON, tc) += 10
					}
				}
			}
		loop
		if ( f == 1 ) {
			f = 0
			skillexp SKILL_NORMAL_GENE_ENGINEER, cc, 50
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_WIN | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) {
			goto *effect_end
		}
		cdata(CDATA_HP, tc) = 0
		dmghp tc, 100, cc
		snd SOUNDLIST_GONG
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BLAME_PAIN | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_CONDITION_BIND, tc) == 0 ) {
			snd SOUNDLIST_BASH1
			await 100
			snd SOUNDLIST_BASH1
			await 100
			snd SOUNDLIST_BASH1
			cdata(CDATA_CONDITION_BIND, tc) += 1
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "は束縛された。", name(tc) + " was bound.")
			}
			await 100
		}
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は" + name(tc) + "を拷問した！", name(cc) + " tortured " + name(tc) + "!")
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat 4
			if ( cnt == 0 ) {
				snd SOUNDLIST_PUNISH1
				if ( synccheck(cc, -1) ) {
					animeload ANIMATION_STARS, tc
				}
			}
			if ( cnt == 1 ) {
				snd SOUNDLIST_PUNISH1
				if ( synccheck(cc, -1) ) {
					animeload ANIMATION_STARS, tc
				}
			}
			if ( cnt == 2 ) {
				snd SOUNDLIST_ATK_ELEC
				if ( synccheck(cc, -1) ) {
					animeload ANIMATION_SPORE, tc
				}
			}
			if ( cnt == 3 ) {
				snd SOUNDLIST_ATTACK00
				if ( synccheck(cc, -1) ) {
					animeload ANIMATION_OFFER, tc
				}
			}
			await 100
			dmg = (sdata(SKILL_ATTR_CON, cc) / 10 + 1) * (sdata(SKILL_ATTR_WIL, cc) / 10 + 1) + rnd((sdata(SKILL_ATTR_CON, cc) + sdata(SKILL_ATTR_WIL, cc)) / 8 + 1)
			dmghp tc, dmg, cc, SKILL_RES_NETHER, 1000
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				break
			}
		loop
		cfg_animewait = waitbk
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( rnd(sdata(SKILL_ATTR_CON, cc) + sdata(SKILL_ATTR_WIL, cc)) >= rnd(sdata(SKILL_ATTR_CON, tc) + sdata(SKILL_ATTR_WIL, tc)) ) {
				txtef COLOR_PURPLE
				txt lang(name(tc) + "は拷問に屈した。", name(cc) + " succumbed to torture.")
				if ( tc != CHARA_PLAYER ) {
					txt lang("「すみません…でした…」", cnvtalk("I'm sorry... really...!")), lang("「許して…ください」", cnvtalk("Forgive me, please.")), lang("「うう…こんなの、耐えられるわけ…」", cnvtalk("I can not stand... such a thing.")), lang("「む…り…！」", cnvtalk("I-I... can't!")), lang("「ひと思いに殺して…」", cnvtalk("Kill me! Please kill me!")), lang("「ひっ、ひィィィ…」", cnvtalk("A...aaaugh..."))
				}
				cdata(CDATA_POWER_GAUGE, tc) -= 15
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DESTINY_DICE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang(name(cc) + "はダイスを放り投げた。", name(cc) + " threw two dice.")
		snd SOUNDLIST_DICE
		sai1 = rnd(10)
		sai2 = rnd(10)
		saikoro = 0
		if ( sai1 == 0 & sai2 >= 1 & sai2 <= 5 ) {
			saikoro = 2
		}
		if ( sai1 == 0 & sai2 == 0 | (sai1 == 9 & sai2 >= 6) ) {
			saikoro = 1
		}
		if ( saikoro == 1 ) {
			if ( cdata(CDATA_ID, cc) == CREATURE_ID_EHEKATL | cdata(CDATA_ID, cc) == CREATURE_ID_GOD_INSIDE_EHEKATL ) {
				saikoro = 0
			}
		}
		if ( saikoro == 0 ) {
			txtef COLOR_YELLOW
		}
		if ( saikoro == 1 ) {
			txtef COLOR_RED
		}
		if ( saikoro == 2 ) {
			txtef COLOR_GREEN
		}
		txt lang("出目は…" + sai1 + sai2 + "！", " The total is..." + sai1 + sai2 + "!")
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		dtc = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( saikoro != 1 ) {
				if ( cc == cnt ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
						continue
					}
				}
			}
			else {
				if ( cnt != cc ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(cc, -1) ) {
				animeid = ANIMATION_ATTACK
				gosub *anime
			}
			dtc = tc
			if ( dtc == (-1) ) {
                txt_nothinghappens
				saikoro = 0
				cfg_animewait = waitbk
				goto *effect_end
			}
			if ( synccheck(tc, -1) ) {
				txtmore
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(tc) + "にダイスがぶち当たり", "The dice hits " + name(tc) + " and")
				}
				else {
					txt lang(name(tc) + "にダイスがぶち当たった。", "The dice hits " + name(tc) + ".")
				}
			}
			dmg = (sdata(SKILL_ATTR_DEX, cc) / 8 + 3) * ((sdata(SKILL_WEAPON_THROWING, cc) + 1) / 8 + 3) + rnd(sdata(SKILL_WEAPON_THROWING, cc) * 2 + 5) + sdata(SKILL_WEAPON_THROWING, cc) * saikoro
			dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
			if ( saikoro == 2 ) {
				snd SOUNDLIST_HEAL1
				healhp cc, rnd(sdata(SKILL_WEAPON_THROWING, cc)) + 1
				healmp cc, rnd(sdata(SKILL_WEAPON_THROWING, cc)) + 1
				healsp cc, 1
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				dmgmp tc, sdata(SKILL_WEAPON_THROWING, cc)
				if ( tc == CHARA_PLAYER ) {
					dmgsp CHARA_PLAYER, 9
				}
				if ( tc != CHARA_PLAYER ) {
					dmgspt tc, 9
				}
			}
		loop
		saikoro = 0
		cfg_animewait = waitbk
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_KAMUI | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			animeload 68, cc
			snd SOUNDLIST_BREATH1
		}
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は取り込んだ神の力を引き出した！", name(cc) + " unleashed the accumulated power of gods!")
		kamui++
		if ( kamui \ 7 == 1 ) {
			txtef COLOR_YELLOW
			txt lang("*創神の息吹*", "<Respiration of Creative Gods>")
			animeid = ANIMATION_HEAL
			gosub *anime
			healhp cc, cdata(CDATA_MAX_HP, cc) / 10
			healmp cc, cdata(CDATA_MAX_MP, cc) / 10
			healsp cc, cdata(CDATA_MAX_SP, cc) / 10
		}
		if ( kamui \ 7 == 2 ) {
			txtef COLOR_YELLOW
			txt lang("*闘神の咆哮*", "<Roar of Fighting Gods>")
			animeload 39, cc
			snd SOUNDLIST_BREATH1
			cdata(CDATA_POWER_GAUGE, cc) = 200
		}
		if ( kamui \ 7 >= 3 & kamui \ 7 <= 6 ) {
			if ( kamui \ 7 == 3 ) {
				txtef COLOR_YELLOW
				txt lang("*獣神の烈爪*", "<Assault of Beast Gods>")
			}
			if ( kamui \ 7 == 4 ) {
				txtef COLOR_YELLOW
				txt lang("*司神の審判*", "<Referee of Judicial Gods>")
			}
			if ( kamui \ 7 == 5 ) {
				txtef COLOR_YELLOW
				txt lang("*忌神の怨嗟*", "<Grudge of Abominable Gods>")
			}
			if ( kamui \ 7 == 6 ) {
				txtef COLOR_YELLOW
				txt lang("*獄神の呪縛*", "<Commandment of Hell Gods>")
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) < 50 ) {
                txt_nothinghappens
				goto *effect_end
			}
			cdata(CDATA_POWER_GAUGE, cc) -= 50
			animeid = ANIMATION_HEALING_RAIN
			animode = kamui \ 7
			gosub *anime
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				if ( kamui \ 7 == 3 ) {
					cdata(CDATA_HP, cnt) = cdata(CDATA_HP, cnt) / 2
				}
				if ( kamui \ 7 == 4 ) {
					addbuff cnt, BUFF_PUNISHMENT, 300, 100
					if ( gdata(GDATA_FLAG_MAIN) != 900 ) {
						dmgcon cnt, CONDITION_PARALYZE, 300
					}
					if ( findbuff(cnt, BUFF_DEATH_WORD) == (-1) ) {
						addbuff cnt, BUFF_DEATH_WORD, 300, 10
					}
				}
				if ( kamui \ 7 == 5 ) {
					if ( gdata(GDATA_FLAG_MAIN) != 900 ) {
						dmgsan cnt, rnd(100) + 1
					}
				}
				if ( kamui \ 7 == 6 ) {
					if ( cdata(CDATA_POWER_GAUGE, cnt) > 0 ) {
						cdata(CDATA_POWER_GAUGE, cnt) = cdata(CDATA_POWER_GAUGE, cnt) / 2
					}
					if ( cdata(CDATA_SP, cnt) > 0 ) {
						cdata(CDATA_SP, cnt) = cdata(CDATA_SP, cnt) / 2
					}
				}
			loop
		}
		if ( kamui \ 7 == 0 ) {
			if ( gdata(GDATA_FLAG_MAIN) < 900 ) {
				txtef COLOR_YELLOW
				txt lang("*森羅万象殺*", "<Elements Killing>")
				tc = CHARA_PLAYER
				animeload 43, tc
				snd SOUNDLIST_WAVE
				motodmg = 500
				dmghp tc, motodmg, cc, SKILL_RES_FIRE, 1000
				dmghp tc, motodmg, cc, SKILL_RES_COLD, 1000
				dmghp tc, motodmg, cc, SKILL_RES_LIGHTNING, 1000
				dmghp tc, motodmg, cc, SKILL_RES_DARKNESS, 1000
				dmghp tc, motodmg, cc, SKILL_RES_MIND, 1000
				dmghp tc, motodmg, cc, SKILL_RES_POISON, 1000
				dmghp tc, motodmg, cc, SKILL_RES_NETHER, 1000
				dmghp tc, motodmg, cc, SKILL_RES_SOUND, 1000
				dmghp tc, motodmg, cc, SKILL_RES_NERVE, 1000
				dmghp tc, motodmg, cc, SKILL_RES_CHAOS, 1000
				dmghp tc, motodmg, cc, SKILL_RES_MAGIC, 1000
				dmghp tc, motodmg, cc, SKILL_RESDMG_CRUSH, 1000
			}
			else {
				txtef COLOR_YELLOW
				txt lang("*滅火の神槍*", "<HOROBINOYARI>")
				tc = CHARA_PLAYER
				animeid = ANIMATION_HOROBINOYARI_2
				animode = 100 + tc
				gosub *anime
				dmghp tc, cdata(CDATA_MAX_HP, tc) * 2, cc
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_FLAME_OF_RAGE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_CONDITION_ANGRY, cc) == 0 ) {
			goto *effect_end
		}
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_RAGNA
			gosub *anime
		}
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は怒りを爆発させた！", name(cc) + " exploded with anger!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != (-3) ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0) = 12 + rnd(2)
			dmg = sdata(SKILL_ATTR_WIL, cc) / 8 * sdata(SKILL_ATTR_MAG, cc) / 8 + rnd(sdata(SKILL_ATTR_WIL, cc) * 2)
			dmghp tc, dmg, cc, SKILL_RES_FIRE, 1000
		loop
		cdata(CDATA_CONDITION_ANGRY, cc) = 0
		txtef COLOR_YELLOW
		txt lang(name(cc) + "はすっきりした。", name(cc) + " calm" + _s(cc) + " down.")
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DOWNPOUR_SPORE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_CARD1
		txtef COLOR_YELLOW
		txt lang(name(cc) + "は胞子を噴出した！", name(cc) + " spewed spores!")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
					continue
				}
			}
			if ( cc >= MAX_CHARA_FOLLOWER ) {
				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			animeid = ANIMATION_CURSE
			gosub *anime
			addbuff tc, BUFF_SLOW, 100 + sdata(SKILL_ATTR_MAG, cc), 20
			dmgcon tc, CONDITION_SLEEP, 100 + sdata(SKILL_ATTR_MAG, cc)
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_GRAND_FINALE | _switch_sw ) {
		_switch_sw = 0

		if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_CURTAIN_CALL, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
			goto *effect_end
		}

		if ( gdata(GDATA_FLAG_CURTAIN_CALL) >= 0 ) {
			goto *effect_end
		}
		txtef COLOR_RED2
		txt lang("*" + skillname(efid) + "*　", "*" + skillname(efid) + "* ")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt >= 16 ) {
				continue
			}
			tc = cnt
			repeat 8 + 8
				i = 8 + 8 - cnt - 1
				if ( bdataref(BDATAREF_BUFF_TYPE, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != BUFF_TYPE_BUFF ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
					continue
				}
				if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_NONE ) {
					continue
				}
				delbuff tc, i
				continue cnt
			loop
			cdata(CDATA_HP, cnt) = 0
			cdata(CDATA_MP, cnt) = 0
			cdata(CDATA_SP, cnt) = 0
			cdata(CDATA_IMMUNE_DAMAGE, tc) = 0
			dmghp tc, cdata(CDATA_MAX_HP, tc), cc
		loop

		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_TUIN_DER_LUSTEN | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			animeid = ANIMATION_AROMAGEDDON
			gosub *anime
		}
		txtef COLOR_YELLOW
		txt lang("強烈なフェロモンをまき散らした。", "A strong pheromone was scattered around.")
		ccbk = cc
		repeat MAX_CHARA_TOTAL
			if ( cdata(0, cnt) != 1 ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(3, 656) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			cc = tc
			tc = ccbk
			gosub *skill_tuin_der_lusten
			cc = ccbk
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_AROMAGEDDON | _switch_sw ) {
		_switch_sw = 0
		inv_find ITEM_ID_ESSENTIAL_OIL, cc
		if ( stat != (-1) | cc != CHARA_PLAYER ) {
			if ( cc == CHARA_PLAYER ) {
				inv(INV_ITEM_NUM, stat)--
			}
			if ( cc == CHARA_PLAYER ) {
				gosub *calcBurdenPc
			}
			if ( synccheck(cc, -1) ) {
				animeid = ANIMATION_AROMAGEDDON
				gosub *anime
			}
			txtef COLOR_YELLOW
			txt lang("魔力を帯びた芳香が周囲にたちこめた。", "A magical aroma envelops your surroundings.")
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				tc = cnt
				dx = cdata(CDATA_X, tc)
				dy = cdata(CDATA_Y, tc)
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
					continue
				}
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_RELATION, tc) != (-3) ) {
						cdata(CDATA_POWER_GAUGE, tc) += 15
						if ( cdata(CDATA_POWER_GAUGE, tc) > 100 ) {
							if ( cdata(CDATA_SHIFT_FORM, tc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, tc) <= 0 | tc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, tc) < FIX_QUALITY_MIRACLE | tc < MAX_CHARA_FOLLOWER) ) {
								cdata(CDATA_POWER_GAUGE, tc) = 100
							}
						}
						if ( cdata(CDATA_POWER_GAUGE, tc) > 200 ) {
							cdata(CDATA_POWER_GAUGE, tc) = 200
						}
						healmp tc, cdata(CDATA_MAX_MP, tc) / 50 + rnd(5 + sdata(SKILL_NORMAL_GARDENING, cc)) + sdata(SKILL_NORMAL_GARDENING, cc) / 2 * sqrt(sdata(SKILL_NORMAL_GARDENING, cc) + 1)
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) ) {
						cdata(CDATA_POWER_GAUGE, tc) += 15
						if ( cdata(CDATA_POWER_GAUGE, tc) > 100 ) {
							if ( cdata(CDATA_SHIFT_FORM, tc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, tc) <= 0 | tc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, tc) < FIX_QUALITY_MIRACLE | tc < MAX_CHARA_FOLLOWER) ) {
								cdata(CDATA_POWER_GAUGE, tc) = 100
							}
						}
						if ( cdata(CDATA_POWER_GAUGE, tc) > 200 ) {
							cdata(CDATA_POWER_GAUGE, tc) = 200
						}
						healmp tc, cdata(CDATA_MAX_MP, tc) / 50 + rnd(5 + sdata(SKILL_NORMAL_GARDENING, cc)) + sdata(SKILL_NORMAL_GARDENING, cc) / 2 * sqrt(sdata(SKILL_NORMAL_GARDENING, cc) + 1)
					}
				}
				if ( cc < MAX_CHARA_FOLLOWER | cc == CHARA_PLAYER & cdata(CDATA_RELATION, tc) == (-3) | (cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_RELATION, tc) != cdata(CDATA_RELATION, cc)) ) {
					p = (STARTING_SKILL_ATTR + MAX_SKILL_ATTR_BASIC) - STARTING_SKILL_ATTR
					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + STARTING_SKILL_ATTR + p) != (-1) ) {
						p = -1
					}
					if ( findbuff(tc, BUFF_DISINFECTION) != (-1) ) {
						p = -1
					}
					if ( sdata(SKILL_ATTR_SPD, tc) < sorg(SKILL_ATTR_SPD, tc) / 2 ) {
						p = -1
					}
					if ( p != (-1) ) {
						i = sorg(STARTING_SKILL_ATTR + p, tc) - cdata(STARTING_CDATA_ATTR + p, tc)
						if ( i > 0 ) {
							efp = (sdata(SKILL_NORMAL_GARDENING, cc) + 1) / 4 + 10
							i = i * efp / 2000 + 5
							cdata(STARTING_CDATA_ATTR + p, tc) -= i
						}
						if ( synccheck(tc, -1) ) {
							txtmore
							txtef COLOR_PURPLE
							txt lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
						}
						r1 = tc
						gosub *charaRefresh
					}
				}
			loop
		}
		else {
			txt_nothinghappens
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_JYUSOU_GOUSHIN | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は自分自身に強烈な呪いをかけた！", name(cc) + " point" + _s(cc) + " " + name(tc) + " and mutter" + _s(cc) + " a curse.")
		snd SOUNDLIST_CURSE3
		animeload 14, cc
		inv_getheader tc
		noroi = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_STATUS, cnt) >= ITEM_STATUS_BLESSED ) {
				if ( rnd(10) ) {
					continue
				}
			}
			ci = cnt
			if ( inv(INV_ITEM_STATUS, ci) == ITEM_STATUS_CURSED ) {
				noroi++
			}
			if ( inv(INV_ITEM_STATUS, ci) == ITEM_STATUS_DOOMED ) {
				noroi += 2
			}
			p = 75 + sdata(SKILL_ATTR_LUC, cc)
			if ( encfind(cc, ENCHANT_RES_CURSE) != (-1) ) {
				p += encfind(cc, ENCHANT_RES_CURSE) / 2
			}
			if ( rnd(p) > sdata(SKILL_ATTR_WIL, cc) ) {
				continue
			}
			if ( inv(INV_ITEM_STATUS, ci) != ITEM_STATUS_DOOMED ) {
				txt lang(name(cc) + "の" + itemname(ci) + "は黒く輝いた。", name(tc) + your(tc) + " " + itemname(ci) + " glows black.")
				if ( inv(INV_ITEM_STATUS, ci) == ITEM_STATUS_CURSED ) {
					inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_DOOMED
				}
				else {
					inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
				}
				noroi++
				item_stack cc, ci, 1
			}
		loop
		if ( noroi > 0 ) {
			r1 = cc
			gosub *charaRefresh
			animeload 82, cc
			snd SOUNDLIST_BREATH1
			healhp cc, noroi * 666 + sdata(SKILL_ATTR_WIL, cc)
			addbuff cc, BUFF_JYUSOU_GOUSHIN, sdata(SKILL_ATTR_WIL, cc) * (24 + noroi) / 4, 67
			noroi = 0
		}
		else {
			txt_nothinghappens
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_ATTRIBUTE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		bvar = sdata(SKILL_RES_MAGIC, tc)
		cdata(CDATA_ATTRIBUTE_ELE, tc) = 10
		if ( sdata(SKILL_RES_FIRE, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 0
			bvar = sdata(SKILL_RES_FIRE, tc)
		}
		if ( sdata(SKILL_RES_COLD, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 1
			bvar = sdata(SKILL_RES_COLD, tc)
		}
		if ( sdata(SKILL_RES_LIGHTNING, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 2
			bvar = sdata(SKILL_RES_LIGHTNING, tc)
		}
		if ( sdata(SKILL_RES_DARKNESS, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 3
			bvar = sdata(SKILL_RES_DARKNESS, tc)
		}
		if ( sdata(SKILL_RES_MIND, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 4
			bvar = sdata(SKILL_RES_MIND, tc)
		}
		if ( sdata(SKILL_RES_POISON, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 5
			bvar = sdata(SKILL_RES_POISON, tc)
		}
		if ( sdata(SKILL_RES_NETHER, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 6
			bvar = sdata(SKILL_RES_NETHER, tc)
		}
		if ( sdata(SKILL_RES_SOUND, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 7
			bvar = sdata(SKILL_RES_SOUND, tc)
		}
		if ( sdata(SKILL_RES_NERVE, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 8
			bvar = sdata(SKILL_RES_NERVE, tc)
		}
		if ( sdata(SKILL_RES_CHAOS, tc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 9
			bvar = sdata(SKILL_RES_CHAOS, tc)
		}
		if ( sdata(SKILL_RES_MAGIC, tc) >= bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = 10
		}
		bvar = 0
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) != 0 ) {
			cdata(CDATA_ATTRIBUTE_ELE, tc) = cdata(CDATA_ELEMENTS_EYES_ELE, tc) - 1
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 10 ) {
			animeload ANIMATION_HEAL_FAST, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 0 ) {
			animeload ANIMATION_GENE, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 1 ) {
			animeload ANIMATION_HOLY, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 2 ) {
			animeload ANIMATION_SPORE, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 3 ) {
			animeload ANIMATION_RAGNA, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 4 ) {
			animeload ANIMATION_THUNDERCLAP, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 5 ) {
			animeload 27, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 6 ) {
			animeload ANIMATION_METEOR, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 7 ) {
			animeload ANIMATION_MP_BREATH, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 8 ) {
			animeload ANIMATION_GIGA, tc
		}
		if ( cdata(CDATA_ATTRIBUTE_ELE, tc) == 9 ) {
			animeload ANIMATION_NUCLEAR, tc
		}
		addbuff tc, BUFF_ATTRIBUTE, cdata(CDATA_ATTRIBUTE_ELE, tc), 101
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_ABSOLUTE_PROTECT | _switch_sw ) {
		_switch_sw = 0
		animeload ANIMATION_HEAL_FAST, tc
		snd SOUNDLIST_AMMO
		addbuff tc, BUFF_AUTO_GUARD, 50, 50
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_QUICK_USE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_OFFER2
		animeload 32, cc
		addbuff cc, BUFF_POWER_ITEM, 31, 31
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DO_NOTHING | _switch_sw ) {
		_switch_sw = 0

		if ( dbg_doNothing ) {
			if ( cc == CHARA_PLAYER ) {
				if ( gdata(GDATA_FLAG_SUB_AMURDAD) >= 10 & gdata(GDATA_FLAG_SUB_AMURDAD) \ 10 == 0 ) {
					snd SOUNDLIST_ENC
					gdata(GDATA_FLAG_SUB_AMURDAD)++
                    txt_questupdate
				}
				gdata(GDATA_FLAG_WORK_A_REMAINING) = 0
				gdata(GDATA_FLAG_WORK_B_REMAINING) = 0
				gdata(GDATA_FLAG_WORK_C_REMAINING) = 0
				seiton = 4
				flt
				itemcreate -1, ITEM_ID_CF_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
				gdata(GDATA_FLAG_SUB_SLIME) = 1000
				gdata(GDATA_FLAG_SUB_ROGUE) = 1000
				gdata(GDATA_FLAG_SUB_NIGHTMARE) = 1000
				gdata(GDATA_FLAG_SUB_MOTHER) = 1000
				gdata(GDATA_FLAG_SUB_WIFE) = 1000
				gdata(GDATA_FLAG_SUB_DOG) = 1000
				gdata(GDATA_FLAG_SUB_CAT) = 1000
				gdata(GDATA_FLAG_SUB_WAR) = 1000
				gdata(GDATA_FLAG_SUB_YEEK) = 1000
				gdata(GDATA_FLAG_SUB_KAMIKAZE) = 1000
				gdata(GDATA_FLAG_SUB_MIAS_DREAM) = 1000
				gdata(GDATA_FLAG_SUB_VEIN) = 1000
				gdata(GDATA_FLAG_SUB_PYRAMID) = 1000
				gdata(GDATA_FLAG_SUB_NUKE) = 1000
				gdata(GDATA_FLAG_SUB_BIOLOGIST) = 1000
				gdata(GDATA_FLAG_SUB_SEWER) = 1000
				gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1000
				gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1000
				gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1000
				gdata(GDATA_FLAG_SUB_MINOTAUR) = 1000
				gdata(GDATA_FLAG_SUB_DADDY) = 1000
				gdata(GDATA_FLAG_SUB_LOST_KITTY) = 1000
				gdata(GDATA_FLAG_SUB_DIVERSIONARY_TACTICS) = 1000
				gdata(GDATA_FLAG_SUB_JUERES_IMPERTINENCE) = 1000
				gdata(GDATA_FLAG_SUB_PIRATE_HUNTING) = 1000
				gdata(GDATA_FLAG_SUB_FALLEN_PRINCESS) = 1000
				gdata(GDATA_FLAG_SUB_UNPAID_COMPENSATION) = 1
				gdata(GDATA_FLAG_SUB_MANSION_FOR_SALE) = 1000
				gdata(GDATA_FLAG_SUB_THE_RESULT_OF_REVENGE) = 1000
				gdata(GDATA_FLAG_SUB_STRUGGLE_AGAINST_INSANITY) = 1000
				gdata(GDATA_FLAG_SUB_H_SISTER) = 1000
				gdata(GDATA_FLAG_SUB_LAW_OF_NINJAS) = 1000
				gdata(GDATA_FLAG_SUB_MONOCHROME_DELIVERY_SERVICE_LETTER) = 1
				gdata(GDATA_FLAG_SUB_DOGS_TAIL) = 1000
				gdata(GDATA_FLAG_DIALOG_NAZUNA) = 1000
				gdata(GDATA_FLAG_SUB_THE_TRUE_APPEARANCE) = 1000
				gdata(GDATA_FLAG_SUB_THE_ABYSS_OF_MAGIC) = 1000
				gdata(GDATA_FLAG_SUB_THE_DISTANT_SEA_OF_STARS) = 1000
				gdata(GDATA_FLAG_SUB_BEYOND_THE_GENERATIONS) = 9
				gdata(GDATA_FLAG_SUB_WHEN_THE_FLAME_BURNS_OUT) = 1000
				gdata(GDATA_FLAG_SUB_NINE_HEAD_DRAGON) = 3
				gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) = 1003
				gdata(GDATA_FLAG_SUB_REGULUS_EULDERNA) = 1000
				gdata(GDATA_FLAG_SUB_REGULUS_KIKKASU) = 1000
				gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) = 1000
				gdata(GDATA_FLAG_SUB_THE_LIFE_IN_THIS_WORLD) = 2
				gdata(GDATA_FLAG_SUB_BELPHAT_THE_COSMIC_SWORD) = 1000
				gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_34) = 100
				gdata(GDATA_FLAG_TRAINING_COURSE_COMBAT_4) = 1000
				gdata(GDATA_FLAG_SUB_KARURA) = 1
				txt lang("*" + skillname(SKILL_SPACT_DO_NOTHING) + "*　", "*" + skillname(efid) + "* ")
				repeat 1023
					card(0, cnt)++
				loop
				cdata(CDATA_PIETY, CHARA_PLAYER) = sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) * 100
				gdata(GDATA_RANK_HOME) = 100
				gdata(GDATA_WORLD_RENEW) = TRUE
				gdata(GDATA_YEAR) += 20
				gosub *advance_hour
				gdata(GDATA_GUEST) = 2
				gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) += 95
				cdata(CDATA_SKILLPOINT, CHARA_PLAYER) += 95
				gdata(GDATA_FLAG_DESTINY_LETTERS) = 7
				repeat MAX_CHARA_FOLLOWER
					cdata(CDATA_ROLE_SHOP_LEVEL, cnt) = rnd(30) + 1
					cdata(CDATA_ROLE_RESTOCK, cnt) = rnd(30) + 1
				loop
				repeat MAX_CHARA_TOTAL
					cdata(CDATA_POWER_GAUGE, cnt) += 52
					cdata(CDATA_DRAIN_HP, cnt) += 52
					cdata(CDATA_WEIGHT, cnt) = 15000
					if ( cnt != 0 ) {
						cdata(CDATA_CONDITION_BIND, cnt) += 100
					}
					if ( cdata(CDATA_POWER_GAUGE, cnt) > 100 ) {
						if ( cdata(CDATA_SHIFT_FORM, cnt) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cnt) <= 0 | cnt == 0) & (cdata(CDATA_QUALITY, cnt) < FIX_QUALITY_MIRACLE | cnt < 16) ) {
							cdata(CDATA_POWER_GAUGE, cnt) = 100
						}
					}
					if ( cdata(CDATA_POWER_GAUGE, cnt) > 200 ) {
						cdata(CDATA_POWER_GAUGE, cnt) = 200
					}
					cdata(CDATA_IMPRESSION, cnt) = 200
					cdata(CDATA_MASTER_SERVANT, cnt) = 200
					cdata(CDATA_SKILLPOINT, cnt) += 100
					cdata(CDATA_AP_CURRENT, cnt) += 1000
					cdata(CDATA_SALES_EXP, cnt) = 1000
					cdata(CDATA_LIVESTOCK_QUALITY, cnt) = rnd(12) + 1
					cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, cnt) = rnd(12) + 1
					cbitmod CHARA_BIT_AWAKE_MP_BARRIER, cnt, TRUE
					if ( cnt != 0 ) {
						cdata(CDATA_SP, cnt) = 0
					}
					txt lang("deru" + gdata(GDATA_FLAG_RARE_DROP) + "、" + gdata(GDATA_FLAG_REALTIME_MINUTES) + "だ。運勢は" + sdata(SKILL_ATTR_LUC, CHARA_PLAYER) + "。", "*" + skillname(efid) + "* ")
				loop
			}
		}

		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_CONVERGE_BREATH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 200 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		txtef COLOR_GREEN
		txt lang(name(cc) + "は収束させたエネルギーを" + name(tc) + "に向けて放った！", name(cc) + " release" + _s(cc) + " the converged energy towards " + name(tc) + "!")
		ele = SKILL_RES_FIRE
		repeat MAX_SKILL_RESIST - STARTING_SKILL_RESIST, STARTING_SKILL_RESIST
			if ( sdata(cnt, cc) >= sdata(ele, cc) ) {
				ele = cnt
			}
		loop
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		zannku = 100
		snd SOUNDLIST_BREATH1
		repeat 8
			animeid = ANIMATION_BOLT
			gosub *anime
			snd SOUNDLIST_BOLT1
		loop
		zannku = 0
		ele = SKILL_NONE
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG_RANGE, efid) \ EXT_SDATAREF + 1 ) {
				break
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( tc < MAX_CHARA_FOLLOWER | tc == CHARA_PLAYER ) {
						if ( cc < MAX_CHARA_FOLLOWER | cbit(CHARA_BIT_NECRO, cc) == 1 ) {
							continue
						}
					}
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_RELATION, cc) == cdata(CDATA_RELATION, tc) ) {
							continue
						}
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang(name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
						}
						else {
							txt lang(name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
						}
					}
					dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (sdata(SKILL_ATTR_MAG, cc) + 5) / 2, 2, 2500) * sqrt(sdata(SKILL_ATTR_CON, cc) / 2 + 1) + rnd(sdata(SKILL_ATTR_CON, cc) + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
				}
			}
		loop
		if ( cdata(CDATA_HP, cc) <= cdata(CDATA_MAX_HP, cc) ) {
			cdata(CDATA_HP, cc) += cdata(CDATA_MAX_HP, cc) / 3
			snd SOUNDLIST_HEAL1
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EXTERMINATION_BREATH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 25 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 25
		kouiki = 100
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_AROMAGEDDON, cc
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 1 ) {
			efid = SKILL_SPACT_FIRE_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 2 ) {
			efid = SKILL_SPACT_COLD_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 3 ) {
			efid = SKILL_SPACT_LIGHTNING_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 4 ) {
			efid = SKILL_SPACT_DARKNESS_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 5 ) {
			efid = SKILL_SPACT_MIND_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 6 ) {
			efid = SKILL_SPACT_POISON_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 7 ) {
			efid = SKILL_SPACT_NETHER_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 8 ) {
			efid = SKILL_SPACT_SOUND_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 9 ) {
			efid = SKILL_SPACT_NERVE_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 10 ) {
			efid = SKILL_SPACT_CHAOS_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 11 ) {
			efid = SKILL_SPACT_POWER_BREATH
			gosub *effect
			goto *effect_end
		}
		bvar = sdata(SKILL_RES_MAGIC, cc)
		cdata(CDATA_ATTRIBUTE_ELE, cc) = 10
		if ( sdata(SKILL_RES_FIRE, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 0
			bvar = sdata(SKILL_RES_FIRE, cc)
		}
		if ( sdata(SKILL_RES_COLD, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 1
			bvar = sdata(SKILL_RES_COLD, cc)
		}
		if ( sdata(SKILL_RES_LIGHTNING, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 2
			bvar = sdata(SKILL_RES_LIGHTNING, cc)
		}
		if ( sdata(SKILL_RES_DARKNESS, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 3
			bvar = sdata(SKILL_RES_DARKNESS, cc)
		}
		if ( sdata(SKILL_RES_MIND, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 9
			bvar = sdata(SKILL_RES_MIND, cc)
		}
		if ( sdata(SKILL_RES_POISON, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 8
			bvar = sdata(SKILL_RES_POISON, cc)
		}
		if ( sdata(SKILL_RES_NETHER, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 6
			bvar = sdata(SKILL_RES_NETHER, cc)
		}
		if ( sdata(SKILL_RES_SOUND, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 5
			bvar = sdata(SKILL_RES_SOUND, cc)
		}
		if ( sdata(SKILL_RES_NERVE, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 7
			bvar = sdata(SKILL_RES_NERVE, cc)
		}
		if ( sdata(SKILL_RES_CHAOS, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 4
			bvar = sdata(SKILL_RES_CHAOS, cc)
		}
		if ( sdata(SKILL_RES_MAGIC, cc) >= bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 10
		}
		bvar = 0
		efid = SKILL_SPACT_FIRE_BREATH + cdata(CDATA_ATTRIBUTE_ELE, cc)
		gosub *effect
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_VARIABLE_BREATH | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 1 ) {
			efid = SKILL_SPACT_FIRE_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 2 ) {
			efid = SKILL_SPACT_COLD_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 3 ) {
			efid = SKILL_SPACT_LIGHTNING_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 4 ) {
			efid = SKILL_SPACT_DARKNESS_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 5 ) {
			efid = SKILL_SPACT_MIND_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 6 ) {
			efid = SKILL_SPACT_POISON_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 7 ) {
			efid = SKILL_SPACT_NETHER_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 8 ) {
			efid = SKILL_SPACT_SOUND_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 9 ) {
			efid = SKILL_SPACT_NERVE_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 10 ) {
			efid = SKILL_SPACT_CHAOS_BREATH
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 11 ) {
			efid = SKILL_SPACT_POWER_BREATH
			gosub *effect
			goto *effect_end
		}
		bvar = sdata(SKILL_RES_MAGIC, tc)
		cdata(CDATA_ATTRIBUTE_ELE, cc) = 10
		if ( sdata(SKILL_RES_FIRE, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 0
			bvar = sdata(SKILL_RES_FIRE, cc)
		}
		if ( sdata(SKILL_RES_COLD, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 1
			bvar = sdata(SKILL_RES_COLD, cc)
		}
		if ( sdata(SKILL_RES_LIGHTNING, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 2
			bvar = sdata(SKILL_RES_LIGHTNING, cc)
		}
		if ( sdata(SKILL_RES_DARKNESS, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 3
			bvar = sdata(SKILL_RES_DARKNESS, cc)
		}
		if ( sdata(SKILL_RES_MIND, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 9
			bvar = sdata(SKILL_RES_MIND, cc)
		}
		if ( sdata(SKILL_RES_POISON, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 8
			bvar = sdata(SKILL_RES_POISON, cc)
		}
		if ( sdata(SKILL_RES_NETHER, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 6
			bvar = sdata(SKILL_RES_NETHER, cc)
		}
		if ( sdata(SKILL_RES_SOUND, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 5
			bvar = sdata(SKILL_RES_SOUND, cc)
		}
		if ( sdata(SKILL_RES_NERVE, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 7
			bvar = sdata(SKILL_RES_NERVE, cc)
		}
		if ( sdata(SKILL_RES_CHAOS, cc) > bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 4
			bvar = sdata(SKILL_RES_CHAOS, cc)
		}
		if ( sdata(SKILL_RES_MAGIC, cc) >= bvar ) {
			cdata(CDATA_ATTRIBUTE_ELE, cc) = 10
		}
		bvar = 0
		efid = SKILL_SPACT_FIRE_BREATH + cdata(CDATA_ATTRIBUTE_ELE, cc)
		gosub *effect
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MARKING | _switch_sw ) {
		_switch_sw = 0

		if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
			goto *effect_end
		}

		if ( cdata(CDATA_THIRST, cc) < 10000 ) {
			txt_nothinghappens
			goto *effect_end
		}
		if ( tc == cc | (cc != CHARA_PLAYER & dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) > 1) ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				goto *effect_end
			}
			snd SOUNDLIST_WATERM
			cdata(CDATA_THIRST, cc) = 5000
			txt lang(name(cc) + "はマーキングを始めた。*ジョロロロ*　", name(cc) + " began marking. *slop around* ")
			if ( cfg_dust_select == 0 ) {
				flt
				itemcreate -1, ITEM_ID_URINE, tlocx, tlocy, 0
				if ( stat != 0 ) {
					if ( cc != CHARA_PLAYER ) {
						inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, cc)
					}
				}
			}
			goto *effect_end
		}
		snd SOUNDLIST_WATERM
		cdata(CDATA_THIRST, cc) = 5000
		txt lang(name(cc) + "はマーキングを始めた。*ジョロロロ*　", name(cc) + " began marking. *slop around* ")
		if ( synccheck(tc, -1) ) {
			txtef COLOR_BLUE
			txt lang(name(tc) + "はあまりの屈辱に体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
		}
		cdata(CDATA_CONDITION_ANGRY, tc) += 3
		cdata(CDATA_CONDITION_WET, tc) += 3

		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_BLADE_STRINGS | _switch_sw ) {
		_switch_sw = 0
		if ( tc == cc | (cc != CHARA_PLAYER & dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) > 1) ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				goto *effect_end
			}
			if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 6) != 0 ) {
				goto *effect_end
			}
			txt lang(name(cc) + "は何かを仕掛けた。", name(cc) + " set something on the ground.")
			if ( cc < MAX_CHARA_FOLLOWER ) {
				cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS, cc
			}
			else {
				cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_BLADE_STRINGS, cc
			}
			if ( cc == CHARA_PLAYER ) {
				cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tile_trap, -1, -1
			}
			goto *effect_end
		}
		txt lang(name(cc) + "は" + name(tc) + "を糸で切りつけた。", name(tc) + " " + was(tc) + " slashed with threads.")
		snd SOUNDLIST_ENC
		animeload 53, tc
		snd SOUNDLIST_STAB
		dmghp tc, (sdata(SKILL_ATTR_DEX, cc) / 5 + 4) * ((sdata(SKILL_NORMAL_TACTICS, cc) + 1) / 5 + 3) * 2 + rnd(sdata(SKILL_NORMAL_TACTICS, cc) * 2 + 5) + 1, cc, SKILL_RESDMG_CRUSH, 1000
		if ( cdata(CDATA_CONDITION_BIND, tc) > 0 ) {
			dmgcon tc, CONDITION_BLEED, (sdata(SKILL_NORMAL_TACTICS, cc) + 1) / 2 + 1
		}
		if ( cdata(CDATA_HP, tc) >= 0 ) {
			if ( cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 9 ) {
				attackskill = SKILL_WEAPON_LONGSWORD
				efid = SKILL_SPACT_DECAPITATION2
				gosub *effect
			}
		}
		if ( charaGivesExp(tc) & tc != CHARA_PLAYER ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 40
		}
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) == 2 & map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_FEATS_ON_TILE) == 0 ) {
			if ( cc < MAX_CHARA_FOLLOWER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS, cc
			}
			else {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_BLADE_STRINGS, cc
			}
			if ( cc == CHARA_PLAYER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), tile_trap, -1, -1
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_THREAD_OF_INNERVATION | _switch_sw ) {
		_switch_sw = 0
		txt lang(name(cc) + "は" + name(tc) + "の身体に糸を打ち込んだ。", name(cc) + " put thread in " + name(tc) + ".")
		animeid = ANIMATION_INNERVATION
		gosub *anime
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) == 2 & map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_FEATS_ON_TILE) == 0 ) {
			if ( cc < MAX_CHARA_FOLLOWER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS, cc
			}
			else {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_BLADE_STRINGS, cc
			}
			if ( cc == CHARA_PLAYER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), tile_trap, -1, -1
			}
		}
		gdata(STARTING_GDATA_FLAG + 372) = 0
		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / 9 ) {
			dmghp tc, (sdata(SKILL_ATTR_PER, cc) / 5 + 4) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 1) / 5 + 3) * 2 + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, cc) * 2 + 5) + 1, cc, SKILL_RES_NERVE, sdata(SKILL_ATTR_PER, cc) + 200
			goto *effect_end
		}
		if ( tc < MAX_CHARA_FOLLOWER | cdata(CDATA_RELATION, tc) == 10 | cdata(CDATA_ALLIED, tc) != 0 ) {
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
			goto *effect_end
		}
		if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
			if ( cdata(CDATA_ID, tc) == CREATURE_ID_TOURIST ) {
				goto *effect_end
			}
			if ( cdata(CDATA_ID, tc) == CREATURE_ID_PALMIAN_ELITE_SOLDIER ) {
				goto *effect_end
			}
		}
		if ( cbit(CHARA_BIT_HIRED, tc) ) {
			goto *effect_end
		}
		if ( charaIsSummoned(tc) ) {
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_CRADLE_15TH, tc) ) {
			goto *effect_end
		}
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			goto *effect_end
		}
		skillexp SKILL_NORMAL_GENE_ENGINEER, cc, 50
		if ( rnd(175) == 0 | gdata(GDATA_FLAG_DUEL_TARGET) == (-2) | cdata(CDATA_QUALITY, tc) == FIX_QUALITY_UNIQUE | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_KING | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_QUEEN | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JACK | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JOKER | cdata(CDATA_ID, tc) == CREATURE_ID_AILE_THE_ATTENDANT | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_GODLY & rnd(3) == 0) | (cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(35) == 0) ) {
			gdata(STARTING_GDATA_FLAG + 372) = 100
		}
		if ( rollanatomy == 1 | cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, tc) == 1 & cdata(CDATA_CONDITION_SICK, tc) == 0) ) {
			gdata(STARTING_GDATA_FLAG + 372) = 100
		}
		if ( gdata(STARTING_GDATA_FLAG + 372) == 100 ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_STAB
				txtef COLOR_RED
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "を人形に変えて事実上", name(cc) + " change" + _s(cc) + " " + name(tc) + " into a doll and")
				}
				else {
					txt lang(name(cc) + "は" + name(tc) + "の自由を奪い、人形に変えた。", name(cc) + " change" + _s(cc) + " " + name(tc) + " into a doll.")
				}
			}
			situ = 0
			if ( cdata(CDATA_LIVESTOCK_QUALITY, tc) >= 1 & cdata(CDATA_LIVESTOCK_QUALITY, tc) <= 3 ) {
				situ = cdata(CDATA_LIVESTOCK_QUALITY, tc)
			}
			flt
			itemcreate -1, ITEM_ID_CORPSE, cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0
			inv(INV_ITEM_PIC, ci) = xy2pic(30, 33)
			inv(INV_ITEM_PARAM2, ci) = 10
			inv(INV_ITEM_PARAM3, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 240
			if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, tc) == 1 ) {
				inv(INV_ITEM_LEVEL, ci) += limit(rnd((sdata(SKILL_NORMAL_ANATOMY, cc) + 1) / 20 + 2) + situ, 1, 10) + cdata(CDATA_BRUSH_LEVEL, tc)
			}
			else {
				inv(INV_ITEM_LEVEL, ci) += cdata(CDATA_BRUSH_LEVEL, tc)
				if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_AMUR_CAGE ) {
					inv(INV_ITEM_AMUR_CAGE, ci) = 1
				}
			}
			remain_make ci, tc
			inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, tc) \ COLOR_TINT_MULT + cdata(CDATA_CHARA_PIC, tc) * COLOR_TINT_MULT
			inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		else {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_STAB
				txtef COLOR_RED
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt3rd = 1
					txt lang(name(cc) + "は" + name(tc) + "を内部から崩壊させて", name(cc) + " burst" + _s(cc) + " " + name(tc) + your(tc) + " head by thread and")
				}
				else {
					txt lang(name(tc) + "の身体が耐え切れずに崩壊した。", name(cc) + " burst" + _s(cc) + " " + name(tc) + your(tc) + " head by thread.")
				}
			}
		}
		dmghp tc, cdata(CDATA_MAX_HP, tc), cc, SKILL_SPACT_DECAPITATION
		gdata(STARTING_GDATA_FLAG + 372) = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DANCING_WIRE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_FIZZLE
		animeload 53, tc
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は" + name(tc) + "を絡めとった。", name(cc) + " entangles " + name(tc) + " by wire.")
		}
		if ( cdata(CDATA_CONDITION_BIND, tc) < 3 ) {
			cdata(CDATA_CONDITION_BIND, tc) = 3
		}
		notconfuse = 1
		efid = SKILL_SPACT_DRAW_SHADOW
		gosub *effect
		if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) == 2 & map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_FEATS_ON_TILE) == 0 ) {
			if ( cc < MAX_CHARA_FOLLOWER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS, cc
			}
			else {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_BLADE_STRINGS, cc
			}
			if ( cc == CHARA_PLAYER ) {
				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), tile_trap, -1, -1
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MULTIPLE_GATHER | _switch_sw ) {
		_switch_sw = 0
		dread = 0
		notconfuse = 1
		tc = CHARA_PLAYER
		efid = SKILL_SPACT_DRAW_SHADOW
		gosub *effect
		repeat MAX_CHARA_TOTAL
			if ( dread > 5 ) {
				dread = 0
				break
			}
			if ( cnt == cc ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt < MAX_CHARA_FOLLOWER ) {
				if ( cnt != 0 ) {
					continue
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) < sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			notconfuse = 1
			efid = SKILL_SPACT_DRAW_SHADOW
			gosub *effect
			dread++
		loop
		dread = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_FORCED_DRAFT | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			goto *effect_end
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
			efid = SKILL_SPACT_SQUEEZE
			gosub *effect
			goto *effect_end
		}
		if ( tc != CHARA_PLAYER ) {
			efid = SKILL_SPACT_SQUEEZE
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_HP, CHARA_PLAYER) > cdata(CDATA_MAX_HP, CHARA_PLAYER) / 5 ) {
			efid = SKILL_SPACT_SQUEEZE
			gosub *effect
			goto *effect_end
		}
		if ( cdata(CDATA_KARMA, CHARA_PLAYER) >= (-30) ) {
			efid = SKILL_SPACT_SQUEEZE
			gosub *effect
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_INCOGNITO, CHARA_PLAYER) != 0 ) {
			efid = SKILL_SPACT_SQUEEZE
			gosub *effect
			goto *effect_end
		}
		if ( jp ) {
			txt "「ブタ箱行きだ」", "「観念しろ！」", "「確保ー！」", "「これまでだな」"
		}
		txtef COLOR_RED
		txt lang("あなたは取り押さえられてしまった…。", "You have been overpowered.")
		msg_halt
		snd SOUNDLIST_AMMO
		gdata(GDATA_TELEPORT_AREA) = AREA_JAIL, 1
		levelexitby = 2
		goto *map_exit
	}
	if ( _switch_val == SKILL_SPACT_GRAVITY_SPHERE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_ELEC
		snd SOUNDLIST_BOLT1
		animeload ANIMATION_PARTICLE_CANNON, tc
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は重力の球に押しつぶされた。", name(tc) + " was pressed by super Gravity.")
		}
		if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
			dmg = sdata(SKILL_ATTR_CON, cc) * sdata(SKILL_ATTR_CON, cc) / 50 + limit(gdata(GDATA_LEVEL) * (gdata(GDATA_LEVEL) + 100) / 50, 1, 29999) + rnd(gdata(GDATA_LEVEL) + 5)
		}
        else {
			dmg = limit(sdata(SKILL_ATTR_CON, cc) * sdata(SKILL_ATTR_MAG, cc) / 40, 2, 200000) / 2 + limit(gdata(GDATA_LEVEL) * (gdata(GDATA_LEVEL) + 100) / 50, 1, 29999) + rnd(gdata(GDATA_LEVEL) + 5)
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 50 & cdata(CDATA_CONDITION_GRAVITY, tc) < 100 ) {
				dmg = dmg * 3 / 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 100 & cdata(CDATA_CONDITION_GRAVITY, tc) < 150 ) {
				dmg = dmg * 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 150 & cdata(CDATA_CONDITION_GRAVITY, tc) < 200 ) {
				dmg = dmg * 5 / 2
			}
			if ( cdata(CDATA_CONDITION_GRAVITY, tc) >= 200 ) {
				dmg = dmg * 3
			}
        }
		if ( findbuff(tc, BUFF_FEATHER) != (-1) ) {
			dmg = dmg / 10
		}
		addbuff tc, BUFF_SLOW, sdata(SKILL_ATTR_CON, cc) / 2 + 150, 5
		cdata(CDATA_CONDITION_GRAVITY, tc) += limit(gdata(GDATA_LEVEL) / 10, 1, 50) + 10 + rnd(10)
		dmghp tc, dmg, cc, SKILL_RES_MAGIC, 1000
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			powsel = 0
			if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
					powsel = 100
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
					powsel = 100
				}
			}
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
				powsel = 100
			}
			if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
				powsel = 100
			}
			if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
				if ( exgauge != 100 ) {
					powsel = 0
				}
			}
			if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
				powsel = 0
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
				if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
					powsel = 0
				}
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
				powsel = 0
			}
			if ( cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
					powsel = 0
				}
			}
			if ( gdata(GDATA_ACTIVATE_PROC) == 100 ) {
				powsel = 0
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( powsel == 100 ) {
					if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
						efid = SKILL_SPACT_GRAVITON_BUSTER
						gosub *effect
					}
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_GRAVITON_BUSTER | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			if ( TweakData(TWEAK_GAMEPLAY_CG_REVERT_SKILL_NERFS, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
				weap = limit((sdata(SKILL_ATTR_CON, cc) + gdata(GDATA_LEVEL)) / 2, 1, 2000)
			}
            else {
				weap = limit((sdata(SKILL_ATTR_CON, cc) + sqrt((gdata(GDATA_LEVEL) + 1)) * 2) / 2, 1, 2000)
			}
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		get_route cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		dx = cdata(CDATA_X, cc)
		dy = cdata(CDATA_Y, cc)
		breath_list
		ele = SKILL_NONE
		waitbk = cfg_animewait
		if ( cfg_animewait > 0 ) {
			cfg_animewait = 1
		}
		repeat 8
			snd SOUNDLIST_CRUSH1
			animeid = ANIMATION_MP_BREATH
			gosub *anime
			snd SOUNDLIST_ATK_ELEC
		loop
		cfg_animewait = waitbk
		repeat maxbreath
			dx = breathlist(0, cnt)
			dy = breathlist(1, cnt)
			if ( map(dx, dy, 0) != 701 & map(dx, dy, 0) != 671 ) {
				map(dx, dy, 0) = 38
			}
			if ( dx == cdata(CDATA_X, cc) & dy == cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( gdata(GDATA_RIDER) != 0 ) {
				if ( gdata(GDATA_RIDER) == cc ) {
					if ( tc == CHARA_PLAYER ) {
						continue
					}
				}
			}
			if ( map(dx, dy, 1) != 0 ) {
				tc = map(dx, dy, 1) - 1
				if ( cc != tc ) {
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1)
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang(name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
						}
						else {
							txt lang(name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
						}
					}
					cdata(CDATA_CONDITION_GRAVITY, tc) += 50
					addbuff tc, BUFF_SLOW, sdata(SKILL_ATTR_CON, cc) + 150, 5
					dmghp tc, dmg, cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
				}
			}
		loop
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_TACTICS, cc, 400
			skillexp SKILL_NORMAL_MAGIC_CAPACITY, cc, 400
		}
		eqlv = 0
		eqbui = 0
		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_METAL_GUARD | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			goto *effect_end
		}
		if ( synccheck(tc, -1) ) {
			txtef COLOR_BLUE
			txt lang(name(cc) + "はダメージに備えた。", name(cc) + " was watching out for the damage.")
		}
		cdata(CDATA_CONDITION_METAL, cc) = 6
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DIRECTIVE | _switch_sw ) {
		_switch_sw = 0
		goto *effect_directive
	}
	if ( _switch_val == SKILL_SPACT_INDIVIDUAL_LEADING | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_DRAIN_HP, cc) >= 100 ) {
			snd SOUNDLIST_FAIL1
			txt lang("他人の指導をしている余裕はない。", "You can't afford to lead others.")
			goto *effect_end
		}
		goto *individual_leading
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_EFFECT_POTION_CURE_CORRUPTION | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *effect_end
		}
		snd SOUNDLIST_PRAY1
		if ( efstatus >= 0 ) {
			txtef COLOR_GREEN
			txt lang("エーテルの抗体があなたの体内に行き渡った。", "Your Ether Disease is cured greatly.")
			if ( efstatus == 1 ) {
				modcorrupt 300 * (-10)
			}
			if ( efstatus == 0 ) {
				modcorrupt 200 * (-10)
			}
		}
		else {
			txtef COLOR_PURPLE
			txt lang("あなたはエーテルに侵食された。", "The Ether erodes your body.")
			modcorrupt 200
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_ANE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SIST_THE_OLDER_SISTER | cdata(CDATA_ID, tc) == CREATURE_ID_MIKRAANESIS | cdata(CDATA_ID, tc) == CREATURE_ID_URCAGUARY | cdata(CDATA_ID, tc) == CREATURE_ID_LAZY_OLDER_SISTER | cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_SISTER2 | cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_DOG_SISTER | cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_SISTER ) {
			txtef COLOR_PURPLE
			txt lang(name(cc) + "の眼差しは" + name(tc) + "の姉波動に防がれた！", name(tc) + " defended against " + name(cc) + your(cc) + " gaze with sisterly energy!")
			goto *effect_end
		}
		txtef COLOR_RED
		txt lang(name(cc) + "は勝手に" + name(tc) + "の姉ヅラをして、勝手に癒されている！", name(cc) + " became the older sister of " + name(tc) + " without permission, and " + was(cc) + " healed for some reason.")
		repeat 8 + 8
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, cc) == BUFF_NONE ) {
				break
			}
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, cc) == BUFF_MELANCHOLY ) {
				delbuff cc, cnt
				continue cnt
			}
		loop
		anepower = cdata(CDATA_LEVEL, cc) * 10
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_MATERIAL3_COUNTER, CHARA_PLAYER)++
			if ( cdata(CDATA_MATERIAL3_COUNTER, CHARA_PLAYER) > cdata(CDATA_LEVEL, CHARA_PLAYER) ) {
				cdata(CDATA_MATERIAL3_COUNTER, CHARA_PLAYER) = cdata(CDATA_LEVEL, CHARA_PLAYER)
			}
			anepower = (cdata(CDATA_MATERIAL3_COUNTER, CHARA_PLAYER) + 13) / 13 * 10
		}
		tcbk = tc
		tc = cc
		animeid = ANIMATION_HEAL
		gosub *anime
		tc = tcbk
		healhp cc, anepower
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + your(cc) + " pupils dilated.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_ETHER | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			goto *effect_end
		}
		txtef COLOR_PURPLE
		txt lang(name(cc) + "に睨まれ、あなたはエーテルに侵食された。", name(cc) + " gazes at you. The Ether erodes your body.")
		modcorrupt 100
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_BRAINWASHING | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 ) {
				efid = SKILL_SPACT_EYE_OF_MANA
				gosub *effect
				goto *effect_end
			}
		}
		txtef COLOR_PURPLE
		txt lang(name(cc) + "は" + name(tc) + "を洗脳した。", name(cc) + " brainwash" + _s(cc, 1) + " " + name(tc) + ".")
		if ( cbit(CHARA_BIT_NECRO, tc) == 1 ) {
			txtef COLOR_GREEN
			txt lang(name(tc) + "には効果がないようだ…。", name(tc) + " resisted the brainwashing.")
			goto *effect_end
		}
		if ( tc == CHARA_PLAYER ) {
			dmgcon CHARA_PLAYER, CONDITION_CONFUSE, 200
			if ( rnd(sdata(SKILL_ATTR_CHA, cc)) >= rnd(sdata(SKILL_ATTR_WIL, CHARA_PLAYER)) * 2 & findbuff(CHARA_PLAYER, BUFF_TAG_FORCE) == (-1) ) {
				animeload ANIMATION_FIZZLE, tc
				body = rnd(MAX_EQUIP_SLOT) + 1
				repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
					if ( cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS == body ) {
						p = cdata(cnt, CHARA_PLAYER) \ EXT_EQUIP_SLOTS
						if ( p == 0 ) {
							continue
						}
						p--
						inv(INV_ITEM_EQUIP, p) = 0
						cdata(cnt, CHARA_PLAYER) = cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS
						txtef COLOR_PURPLE
						txt lang(name(CHARA_PLAYER) + "は" + name(cc) + "に言われるがまま、装備を外してしまった。", name(tc) + " was brainwashed into removing " + his(tc) + " equipment.")
					}
				loop
				cdata(CDATA_CONDITION_BRAINWASH, CHARA_PLAYER) = limit(sdata(SKILL_ATTR_CHA, cc) / 5 - sdata(SKILL_ATTR_WIL, CHARA_PLAYER) / 5, 10, 50)
				r1 = CHARA_PLAYER
				gosub *charaRefresh
			}
			else {
				txtef COLOR_GREEN
				txt lang("あなたは" + name(cc) + "の洗脳を跳ね除けた。", "You resist " + name(cc) + "'s brainwashing.")
			}
			goto *effect_end
		}
		sennnou = limit(cdata(CDATA_IMPRESSION, tc), 1, 300)
		if ( rnd(sennnou + sdata(SKILL_ATTR_CHA, CHARA_PLAYER)) > 50 + rnd(sdata(SKILL_ATTR_CHA, cc)) | findbuff(tc, BUFF_TAG_FORCE) != (-1) ) {
			txtef COLOR_GREEN
			txt lang(name(tc) + "は" + name(cc) + "の洗脳を跳ね除けた。", name(tc) + " resists " + name(cc) + "'s brainwashing.")
			goto *effect_end
		}
		animeload ANIMATION_FIZZLE, tc
		cdata(CDATA_CONDITION_BRAINWASH, tc) = limit((300 - cdata(CDATA_IMPRESSION, tc)) * 1 / 10, 5, 30)
		cdata(CDATA_AI_AGGRO, tc) = 10
		cdata(CDATA_TARGET, tc) = 0
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_DIMNESS | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_INSULT | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_SPACT_INSULT ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(cc) + "は" + name(tc) + "を罵倒した。", name(cc) + " insult" + _s(cc) + " " + name(tc) + ".")
				txtmore
				txtef COLOR_SKY_BLUE
				customtalk cc, DBMODE_FLAVOR_INSULT
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					if ( jp ) {
						if ( cdata(CDATA_SEX, cc) == 0 ) {
							txt "「すっこんでろ雑魚め」", "「オマエ程度が戦うだと？」", "「すぐに殺してやるよ」", "「消えろザコめ」", "「このかたつむり野郎」", "「こんなヤツに本気を出してやる価値はあるのか…？」", "「マッハでミンチにしてやるよ」", "「まったく…度し難いな」", "「ブタはブタ小屋に帰れ」"
						}
						else {
							if ( rnd(2) ) {
								txt "「グシャグシャにしてやるわ」", "「地べたを這いずりなさい」", "「ウージッムシ♪ウージッムシ♪」", "「目障りよ」", "「もがけ。苦しめ！」", "「常識知らずの戦闘馬鹿！」", "「どうしようもない子ね、お仕置きよ」", "「その下品な眼をくりぬくの」"
							}
							else {
								txt "「このカタツムリが」", "「どうしたの？もう終わりなの？」", "「潔く、くたばりなさい」", "「生まれてきたことを後悔するのね」", "「このブタめ」", "「すぐにミンチにしてあげる」", "「貴方って本当に最低のクズだわ」", "「このエロオニギリ！」", "「あら？悦んでるの？気持ち悪いわ」"
							}
						}
					}
					else {
						if ( rnd(2) ) {
							txt cnvtalk("You suck!"), cnvtalk("You will die alone."), cnvtalk("Bow down before me."), cnvtalk("Go jump off a bridge."), cnvtalk("Bang your head against the wall!"), cnvtalk("Why do you sniff under your dog's tail?")
						}
						else {
							txt cnvtalk("The world is against you because you are a unsavory decomposing virus."), cnvtalk("You are no better than a immoral guzzling bureaucrat."), cnvtalk("You are so lowly."), cnvtalk("Get off me.")
						}
					}
				}
			}
		}
		dmgcon tc, CONDITION_DIM, 200
		if ( efid == SKILL_SPACT_EYE_OF_DIMNESS ) {
			if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
				snd SOUNDLIST_OFFER1
				txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
				dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
				healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
				dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
				healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
				cdata(CDATA_POWER_GAUGE, tc) -= 2
				if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
					cdata(CDATA_POWER_GAUGE, tc) = 0
				}
				cdata(CDATA_POWER_GAUGE, cc) += 2
				if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
					if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
						cdata(CDATA_POWER_GAUGE, cc) = 100
					}
				}
				if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
					cdata(CDATA_POWER_GAUGE, cc) = 200
				}
			}
			powsel = 0
			if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
					powsel = 100
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
					powsel = 100
				}
			}
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
				powsel = 100
			}
			if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
				powsel = 100
			}
			if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
				if ( exgauge != 100 ) {
					powsel = 0
				}
			}
			if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
				powsel = 0
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
				if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
					powsel = 0
				}
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
				powsel = 0
			}
			if ( cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
					powsel = 0
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( powsel == 100 ) {
					if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
						efid = SKILL_SPACT_MIND_BREAK
						gosub *effect
					}
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_MANA | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は魔力を込めて" + name(tc) + "を睨み付けた。", name(cc) + " gaze" + _s(cc) + " " + name(tc) + ".")
		}
		hostileaction cc, tc
		dmgcon tc, CONDITION_MPOISON, 100 + limit(sdata(SKILL_ATTR_MAG, cc), 1, 400)
		dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 4 + rnd(10 + sdata(SKILL_ATTR_MAG, cc) / 4)
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_ILLUSION | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は" + name(tc) + "に幻影を見せた。", name(cc) + " gaze" + _s(cc) + " " + name(tc) + ".")
		}
		dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 4 * sqrt(sdata(SKILL_ATTR_WIL, cc)) + rnd(sdata(SKILL_ATTR_WIL, cc) * 2), cc, SKILL_RES_MIND, sdata(SKILL_ATTR_MAG, cc) * 2 + 100
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_EYE_OF_STIFFEN | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は" + name(tc) + "に妖しい眼光を放った。", name(cc) + " gaze" + _s(cc) + " " + name(tc) + ".")
		}
		dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 4 * sqrt(sdata(SKILL_ATTR_WIL, cc)) + rnd(sdata(SKILL_ATTR_WIL, cc) * 2), cc, SKILL_RES_NERVE, sdata(SKILL_ATTR_MAG, cc) * 2 + 200
		cdata(CDATA_PROT_PENALTY, tc) = -3
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "の身体が石のように硬直した。", "Body of " + name(tc) + " was stiff like a stone.")
		}
		if ( findbuff(cc, BUFF_ABYSS_IN_THE_EYE) != (-1) ) {
			snd SOUNDLIST_OFFER1
			txt lang(name(cc) + "の瞳孔が開いた。", name(cc) + "'s pupils dilate.")
			dmghp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healhp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			dmgmp tc, sdata(SKILL_ATTR_MAG, cc) / 6 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 6)
			healmp cc, sdata(SKILL_ATTR_MAG, cc) / 2 + rnd(5 + sdata(SKILL_ATTR_MAG, cc) / 2)
			cdata(CDATA_POWER_GAUGE, tc) -= 2
			if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
				cdata(CDATA_POWER_GAUGE, tc) = 0
			}
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
				if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
					cdata(CDATA_POWER_GAUGE, cc) = 100
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
				cdata(CDATA_POWER_GAUGE, cc) = 200
			}
		}
		powsel = 0
		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
				powsel = 100
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
				powsel = 100
			}
		}
		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
			powsel = 100
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			powsel = 100
		}
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
			if ( exgauge != 100 ) {
				powsel = 0
			}
		}
		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
			powsel = 0
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
			powsel = 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
				powsel = 0
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			if ( powsel == 100 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					efid = SKILL_SPACT_MIND_BREAK
					gosub *effect
				}
			}
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_MIND_BREAK | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			weap = sdata(SKILL_ATTR_MAG, cc) / 2
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		txtef COLOR_GREEN
		txt lang(name(cc) + "の眼から眩い光が放たれた！", name(cc) + "'s eye shot a dazzling light.")
		snd SOUNDLIST_CRUSH2
		snd SOUNDLIST_ATK_ICE
		snd SOUNDLIST_ATK_ICE
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		dmgcon tc, CONDITION_DIM, 200
		dmgsan tc, rnd(rnd(1 + sdata(SKILL_ATTR_MAG, cc) / 20) * 10 + 2) + 1
		chara_vomit tc
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			dmgmp tc, (sdata(SKILL_ATTR_MAG, cc) / 10 + 1) * eqlv + rnd(10 + sdata(SKILL_ATTR_MAG, cc) / 4)
		}
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 10 + 1) * sqrt(sdata(SKILL_ATTR_WIL, cc)) * eqlv, cc, SKILL_RES_NERVE, sdata(SKILL_ATTR_MAG, cc) + 100
		}
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 10 + 1) * sqrt(sdata(SKILL_ATTR_WIL, cc)) * eqlv, cc, SKILL_RES_MIND, sdata(SKILL_ATTR_MAG, cc) + 100
		}
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_ATTR_MAG, cc, 200
		}
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_DATA_DELETE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		if ( cdata(CDATA_ID, cc) == CREATURE_ID_MAILE_THE_MARIONETTE_SHAMAN ) {
			txtef COLOR_YELLOW
			txt lang("「くっ…やはり合意がないと充分な力が出ませんね」", "Maile seems to not have enough power.")
		}
		else {
			if ( gdata(GDATA_FLAG_MAIN) >= 780 ) {
				txtef COLOR_RED
				txt lang("[システム]原因不明のエラーによりglobaltcda…", "[System]By unknown error, globalda...")
				txtef COLOR_GREEN
				txt lang("[記憶の灯]から放出された光が、記憶消去を緩和した！", "The light emitted from Light of memory relieved memory delete!")
			}
		}
		snd SOUNDLIST_CURSE2
		animeload ANIMATION_FIZZLE, tc
		repeat MAX_SKILL_ATTR - STARTING_SKILL_ATTR, STARTING_SKILL_ATTR
			skillmod cnt, tc, -1000
		loop
		if ( cdata(CDATA_POWER_GAUGE, tc) >= 0 ) {
			cdata(CDATA_POWER_GAUGE, tc) = 0
		}
		if ( cc < MAX_CHARA_FOLLOWER ) {
			hostileaction cc, tc
		}
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPACT_RESONANT_VOICE | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
            txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt lang("*" + skillname(efid) + "*　", "*" + skillname(efid) + "* ")
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		snd SOUNDLIST_ENC
		animeload 40, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		snd SOUNDLIST_WAVE
		animeload 23, tc
		txtef COLOR_GREEN
		txt lang(name(cc) + "の声が" + name(tc) + "の心に響く！", "The voice of " + name(cc) + " echoes in the mind of " + name(tc) + "!")
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		cdata(CDATA_POWER_GAUGE, tc) -= 50
		dmgtalk = (sdata(SKILL_ATTR_WIL, cc) + sdata(SKILL_NORMAL_NEGOTIATION, cc) + sdata(SKILL_NORMAL_SENSE_QUALITY, cc)) * 5 * eqlv / sdata(SKILL_ATTR_WIL, tc) + eqlv
		if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE ) {
			dmgtalk = dmgtalk / 5 + 1
		}
		dmgsptalk tc, dmgtalk
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_NORMAL_NEGOTIATION, cc, 400
			skillexp SKILL_NORMAL_SENSE_QUALITY, cc, 400
		}
		weap = 0
		if ( cdata(CDATA_SP, tc) <= (-100) & cbit(CHARA_BIT_SANDBAG, tc) != TRUE ) {
			skillexp SKILL_NORMAL_NEGOTIATION, cc, limit(cdata(CDATA_LEVEL, tc) * cdata(CDATA_LEVEL, tc) / 10, 10, 1000)
			cdata(CDATA_HP, tc) = -1
			if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | cdata(CDATA_ROLE, tc) != ROLE_NONE ) {
				dmghp tc, 10, DAMAGE_FROM_PERSUASION_HIGH
				if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
					txtef COLOR_GREEN
					txt lang(name(tc) + "は不敵に笑い、唐突に自害した。", name(tc) + " laughed fearlessly and abruptly committed suicide.")
				}
				check_talk cc, tc
			}
			else {
				dmghp tc, 10, DAMAGE_FROM_PERSUASION_LOW
				if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
					txtef COLOR_GREEN
					txt lang(name(tc) + "は戦いに疲れ、静かに去っていった。", name(tc) + " became too tired to fight and quietly went away.")
				}
				snd SOUNDLIST_EXITMAP1
				check_talk cc, tc
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == SKILL_SPACT_HAND_OF_SPLENDOR | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
			txt_nothinghappens
			goto *effect_end
		}
		cdata(CDATA_POWER_GAUGE, cc) -= 100
		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
			snd SOUNDLIST_POWER
			exgauge = 100
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				gdata(GDATA_TIME_STOP_TIME) = 2
			}
		}
		txtef COLOR_YELLOW
		txt_skillname
		if ( cc == CHARA_PLAYER ) {
			cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) = 0
		}
		if ( weap == 0 ) {
			weap = (sdata(SKILL_ATTR_WIL, cc) + sdata(SKILL_ATTR_MAG, cc)) / 3
		}
		if ( cbit(CHARA_BIT_BLUE_SPIRIT, cc) ) {
			weap += (sdata(SKILL_ATTR_WIL, cc) + sdata(SKILL_ATTR_MAG, cc)) / 3
			animeload 46, cc
			snd SOUNDLIST_ATK_MIND
		}
		snd SOUNDLIST_ENC
		animeload ANIMATION_UNISON_IMPACT2, cc
		customtalk cc, DBMODE_FLAVOR_SPECIAL
		gosub *convert_word
		snd SOUNDLIST_BOLT1
		animeload 59, tc
		txtef COLOR_GREEN
		txt lang(name(cc) + "は" + name(tc) + "に激しい閃光を叩きつけた！", name(cc) + " slammed the dazzling light to " + name(tc) + "!")
		inv_getheader cc
		eqlv = 1
		eqbui = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
				continue
			}
			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
			eqbui++
		loop
		if ( eqlv <= 0 ) {
			eqlv = 1
		}
		if ( eqbui <= 0 ) {
			eqbui = 1
		}
		eqlv = limit(eqlv / eqbui * 3, 3, 30)
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
		}
		eqlv = 0
		eqbui = 0
		if ( charaGivesExp(tc) ) {
			skillexp SKILL_ATTR_WIL, cc, 100
			skillexp SKILL_ATTR_MAG, cc, 100
		}
		weap = 0
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_COFFEE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "の眠気が和らいだ。", "" + name(tc) + your(tc) + " drowsiness fades away.")
		}
		if ( tc == CHARA_PLAYER ) {
			if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_SLEEP_PREVENTION, TWEAK_CATEGORY_GAMEPLAY) == TRUE) {
				gdata(GDATA_SLEEP) -= 20
			}
			else {
				gdata(GDATA_FLAG_SLEEP_PREVENTION) += 15 + rnd(11)
			}
		}
		cdata(CDATA_CONDITION_SLEEP, tc) = 0
		if ( ibit(ITEM_BIT_ACIDPROOF, ci) == 1 ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATK_ELEC
			}
			if ( efstatus >= 1 ) {
				modheight tc, rnd(2) + 1
			}
			if ( efstatus <= (-1) ) {
				modheight tc, (rnd(2) + 1) * (-1)
			}
			animeload ANIMATION_THROW, tc
		}
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_JUICE | _switch_sw ) {
		_switch_sw = 0
		if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
			goto *effect_end
		}
		juice = 1
		if ( tc != CHARA_PLAYER ) {
			juice = 15
		}
		if ( inv(INV_ITEM_PARAM1, ci) / 1000 == 2 ) {
			if ( ibit(ITEM_BIT_HERBED_IN, ci) != 1 ) {
				skillexp SKILL_ATTR_WIL, tc, 50 * juice
				skillexp SKILL_ATTR_LER, tc, 50 * juice
			}
			else {
				skillexp SKILL_ATTR_WIL, tc, 75 * juice
				skillexp SKILL_ATTR_LER, tc, 75 * juice
			}
		}
		if ( inv(INV_ITEM_PARAM1, ci) / 1000 == 3 ) {
			if ( ibit(ITEM_BIT_HERBED_IN, ci) != 1 ) {
				skillexp SKILL_ATTR_MAG, tc, 50 * juice
				skillexp SKILL_ATTR_CHA, tc, 20 * juice
				skillexp SKILL_ATTR_PER, tc, 30 * juice
			}
			else {
				skillexp SKILL_ATTR_MAG, tc, 75 * juice
				skillexp SKILL_ATTR_CHA, tc, 30 * juice
				skillexp SKILL_ATTR_PER, tc, 45 * juice
			}
		}
		if ( inv(INV_ITEM_PARAM1, ci) / 1000 == 4 ) {
			if ( ibit(ITEM_BIT_HERBED_IN, ci) != 1 ) {
				skillexp SKILL_ATTR_MAG, tc, 40 * juice
				skillexp SKILL_ATTR_DEX, tc, 30 * juice
				skillexp SKILL_ATTR_LER, tc, 30 * juice
			}
			else {
				skillexp SKILL_ATTR_MAG, tc, 60 * juice
				skillexp SKILL_ATTR_DEX, tc, 45 * juice
				skillexp SKILL_ATTR_LER, tc, 45 * juice
			}
		}
		juice = 0
		if ( ibit(ITEM_BIT_ACIDPROOF, ci) == 1 ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_ATK_ELEC
			}
			if ( efstatus >= 1 ) {
				modheight tc, rnd(2) + 1
			}
			if ( efstatus <= (-1) ) {
				modheight tc, (rnd(2) + 1) * (-1)
			}
		}
		cdata(CDATA_HUNGER, tc) += 500
		if ( tc == CHARA_PLAYER ) {
			gosub *eat_finish
		}
		eatstatus efstatus, tc
		goto *effect_end
	}
	if ( _switch_val == SKILL_EFFECT_POTION_MOLOTOV | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(tc) + "は炎に包まれた。", name(tc) + " " + is(tc) + " surrounded by flames.")
		}
		dmghp tc, (rnd(efp / 3 + 5) + efp / 3) * efstatusfix(50, 100, 200, 300) / 100 + 1, DAMAGE_FROM_FIRE, SKILL_RES_FIRE, efp
		addmef cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 5, 24, rnd(15) + 25, efp, cc
		mapitem_fire cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		return
	}
	if ( _switch_val == SKILL_EFFECT_VERNIS_ORIGINAL | _switch_sw ) {
		_switch_sw = 0
		txt lang("バリバリ…ゴクリ。なんと！状態異常が回復した！", "*Munch munch*... *Gulp*! Wow! All status conditions were cured!")
		cdata(CDATA_CONDITION_MPOISON, tc) = 0
		cdata(CDATA_CONDITION_POISON, tc) = 0
		cdata(CDATA_CONDITION_SLEEP, tc) = 0
		cdata(CDATA_CONDITION_CONFUSE, tc) = 0
		cdata(CDATA_CONDITION_BLIND, tc) = 0
		cdata(CDATA_CONDITION_PARALYZE, tc) = 0
		cdata(CDATA_CONDITION_SUFFOCATION, tc) = 0
		cdata(CDATA_CONDITION_DIM, tc) = 0
		cdata(CDATA_CONDITION_DRUNK, tc) = 0
		cdata(CDATA_CONDITION_BLEED, tc) = 0
		cdata(CDATA_CONDITION_GRAVITY, tc) = 0
		cdata(CDATA_CONDITION_WET, tc) = 0
		cdata(CDATA_CONDITION_ANGRY, tc) = 0
		cdata(CDATA_CONDITION_ATROPHY, tc) = 0
		cdata(CDATA_CONDITION_BIND, tc) = 0
		cdata(CDATA_CONDITION_OIL, tc) = 0
		if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
			cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
		}
		return
	}
	if ( _switch_val == SKILL_SPACT_SCAVENGE | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt lang(name(cc) + "は" + name(tc) + "のバックパックを漁った。", name(cc) + " loot" + _s(cc) + " " + name(tc) + your(tc) + " backpack.")
		}
		p = -1
		inv_getheader tc
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_FISH ) {
				p = cnt
				break
			}
		loop
		if ( p == (-1) ) {
			inv_getheader tc
			repeat invrange, invhead
				if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
					continue
				}
				if ( ibit(ITEM_BIT_PRECIOUS, cnt) ) {
					continue
				}
				if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE) != FILTER_ITEM_FOOD ) {
					continue
				}
				p = cnt
				break
			loop
		}
		if ( p == (-1) ) {
			goto *effect_end
		}
		if ( rnd(sdata(SKILL_ATTR_PER, tc)) > rnd(sdata(SKILL_ATTR_STR, cc) * 4) | cbit(CHARA_BIT_RES_STEAL, tc) == 1 ) {
			txt lang(name(tc) + "は自分の食料を守った。", name(tc) + " protect" + _s(tc) + " " + his(tc) + " food.")
			goto *effect_end
		}
		ci = p
		if ( ibit(ITEM_BIT_LOVE_BLEND, ci) ) {
			if ( synccheck(tc, -1) ) {
				txt lang(name(cc) + "は" + itemname(ci, 1) + "の異臭に気付き手をひっこめた。", name(cc) + " notice" + _s(cc) + " unusual odor from " + itemname(ci, 1) + " and step" + _s(cc) + " back.")
			}
			goto *effect_end
		}
		rowact_item ci
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_EAT1
			txt lang(name(cc) + "は" + itemname(ci, 1) + "を食べた！", name(cc) + " eat" + _s(cc) + " " + itemname(ci, 1) + "!")
		}
		healhp cc, cdata(CDATA_MAX_HP, cc) / 3
		if ( cdata(CDATA_ALLIED, cc) != 0 | cc == CHARA_PLAYER & (gdata(GDATA_AREA) == AREA_SHOW_HOUSE | gdata(GDATA_AREA) == AREA_PET_ARENA) ) {
			inv(INV_ITEM_NUM, ci)--
			chara_unequip ci
			if ( stat == 1 ) {
				r1 = cc
				gosub *charaRefresh
			}
		}
		else {
			gosub *insta_eat
		}
		gosub *calcBurdenPc
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_WIZARDS_HARVEST | _switch_sw ) {
		_switch_sw = 0
		animeload ANIMATION_BLOOD, tc
		repeat limit(4 + rnd(efp / 50 + 1), 1, 10)
			snd SOUNDLIST_PRAY1
			flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
			dbid = 0
			dbid = ITEM_ID_GOLD_PIECE
			p = limit(400 + rnd(efp), 400, 800)
			if ( rnd(90) == 0 ) {
				dbid = ITEM_ID_PLATINUM_COIN
				p = 1
			}
			if ( rnd(50) == 0 ) {
				dbid = ITEM_ID_ANCIENT_BOOK
				p = 1
			}
			if ( rnd(200) == 0 ) {
				dbid = ITEM_ID_SMALL_MEDAL
				p = 1
			}
			if ( rnd(1500) == 0 ) {
				dbid = ITEM_ID_TREASURE_MAP
				p = 1
			}
			itemcreate -1, dbid, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), p
			await 100
			redraw 1
		loop
		goto *effect_end
	}
	if ( _switch_val == SKILL_SPELL_4DIM_POCKET | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_TELEPORT1
		if ( gdata(GDATA_TEMPORARY_FLAGS3) != 104 ) {
			txt lang("あなたは四次元のポケットを召喚した。", "You summon a 4-dimensional pocket.")
		}
		else {
			txt lang("鏡が四次元につながった。", "The mirror led to the 4th dimension.")
			gdata(GDATA_TEMPORARY_FLAGS3) = 0
		}
		invfile = 8
		file = "shoptmp.s2"
		fmode = 4
		gosub *game_ctrlFile
		file = "shop" + invfile + ".s2"
		existwrapper exedir + "tmp\\" + file
		if ( strsize != (-1) ) {
			fmode = 3
			gosub *game_ctrlFile
		}
		else {
			inv_getheader -1
			repeat invrange, invhead
				inv(INV_ITEM_NUM, cnt) = 0
			loop
		}
		shoptrade = 0
		menucycle = 1
		invsubroutine = 1
		invctrl = 22, 5
		invcontainer = limit(efp / 10 + 10, 10, 300)
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			invcontainer = 4
		}
		mode = MODELIST_SHOP
		snd SOUNDLIST_INV
		gosub *com_inventory
		invcontainer = 0
		file = "shop" + invfile + ".s2"
		fmode = 4
		gosub *game_ctrlFile
		file = "shoptmp.s2"
		fmode = 3
		gosub *game_ctrlFile
		mode = MODELIST_MAIN
		goto *effect_end
	}
*effect_end
	ci = efcibk
	efstatus = 0
	efsource = 0
	return 1

*effect_heal
	subloop = 1
	if ( gdata(GDATA_RIDER) != 0 ) {
		if ( tc == gdata(GDATA_RIDER) | tc == CHARA_PLAYER ) {
			subloop = 2
			if ( tc == gdata(GDATA_RIDER) ) {
				tc(1) = 0
			}
			else {
				tc(1) = gdata(GDATA_RIDER)
			}
		}
	}
	if ( cdatan(CDATAN_CLASS, cc) == "priest" ) {
		hh = 25
	}
	else {
		hh = 0
	}
	if ( cdata(CDATA_SHIFT_FORM, cc) == SHIFT_FORM_DELTA ) {
		hh += 25
	}
	iyasi = role(dice1, dice2, bonus) * (100 + hh) / 100 + cdata(CDATA_MAX_HP, tc) / 50
	repeat subloop
		healhp tc(cnt), iyasi
		healcon tc(cnt), CONDITION_FEAR
		healcon tc(cnt), CONDITION_POISON, 50
		healcon tc(cnt), CONDITION_CONFUSE, 50
		healcon tc(cnt), CONDITION_DIM, 30
		healcon tc(cnt), CONDITION_BLEED, 20
		healsan tc(cnt), 1
	loop
	return

*individual_leading
	allyctrl = 4
	gosub *com_listNpc
	txt lang("誰を指導しようか。", "Who will you lead?")
	if ( p != (-1) ) {
		tc = p
		dx = cdata(CDATA_X, tc)
		dy = cdata(CDATA_Y, tc)
		if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
			snd SOUNDLIST_FAIL1
			txt lang("範囲外だ。", "Out of range.")
			goto *individual_leading
		}
		if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
			snd SOUNDLIST_FAIL1
			txt lang("範囲外だ。", "Out of range.")
			goto *individual_leading
		}
		if ( cdata(CDATA_DRAIN_HP, tc) >= 100 ) {
			snd SOUNDLIST_FAIL1
			txt lang("手遅れだ。", "It's too late to lead.")
			goto *individual_leading
		}
		if ( cdata(CDATA_DRAIN_HP, tc) <= 0 ) {
			snd SOUNDLIST_FAIL1
			txt lang("指導の必要はなさそうだ。", "There seems to be no need for leading.")
			goto *individual_leading
		}
		customtalk tc, DBMODE_FLAVOR_LEADING
		gosub *convert_word
		if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
			txtef COLOR_SKY_BLUE
			if ( jp ) {
				txt name(tc) + "「了解！」", name(tc) + "「気をつける" + _yo(3) + "」", name(tc) + "「なるほど…」", name(tc) + "「ＯＫ」"
			}
			if ( en ) {
				txt name(tc) + " " + cnvtalk("I got it."), name(tc) + " " + cnvtalk("I'll be careful."), name(tc) + " " + cnvtalk("Hmmm..."), name(tc) + " " + cnvtalk("Okay.")
			}
		}
		snd SOUNDLIST_ENC
		half = limit(cdata(CDATA_DRAIN_HP, tc) / 2, 1, 100 - cdata(CDATA_DRAIN_HP, cc))
		cdata(CDATA_DRAIN_HP, tc) -= half
		cdata(CDATA_DRAIN_HP, cc) += half
		if ( cdata(CDATA_DRAIN_HP, cc) >= 100 ) {
			cdata(CDATA_DRAIN_HP, cc) = 99
		}
	}
	return

*effect_directive
	signal = 0
	item_find ITEM_ID_VERY_PISTOL_OF_MANI, 3, 1
	if ( stat != (-1) ) {
		ci = stat
		if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
			signal = 100
		}
	}
	allyctrl = 6
	gosub *com_ally
	if ( stat != (-1) ) {
		tc = stat
		if ( signal == 0 ) {
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				snd SOUNDLIST_FAIL1
				txt lang("範囲外だ。", "Out of range.")
				goto *effect_directive
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				snd SOUNDLIST_FAIL1
				txt lang("範囲外だ。", "Out of range.")
				goto *effect_directive
			}
		}
		txt lang("仲間にどんな指示を出そうか。", "Which instruction should I give my allies?")
		txtsettactical 12
		repeat 12
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 220, 1
 		gosub *prompt_key
		if ( stat == 0 ) {
			goto *effect_directive
		}
		if ( rtval == 11 ) {
			if ( signal == 100 ) {
				signal = 0
				return 0
			}
			else {
				return
			}
		}
		if ( rtval == 0 ) {
			goto *effect_directive
		}
		if ( rtval == 1 ) {
			cdata(CDATA_DIRECTIVE_MODE, tc) = DIRECTIVE_MODE_OFFENSIVE
		}
		if ( rtval == 2 ) {
			cdata(CDATA_DIRECTIVE_MODE, tc) = DIRECTIVE_MODE_DEFENSIVE
		}
		if ( rtval == 3 ) {
			cdata(CDATA_DIRECTIVE_MODE, tc) = DIRECTIVE_MODE_INTERCEPT
		}
		if ( rtval == 4 ) {
			cdata(CDATA_DIRECTIVE_MODE, tc) = DIRECTIVE_MODE_TALKING
		}
		if ( rtval <= 3 ) {
			if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_OFFENSIVE ) {
				txtef COLOR_RED
				txt lang(cdatan(CDATAN_NAME, tc) + "は突撃の態勢に入った！", name(tc) + " switched to offensive mode!")
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_DEFENSIVE ) {
				txtef COLOR_BLUE
				txt lang(cdatan(CDATAN_NAME, tc) + "は防御の態勢に入った！", name(tc) + " switched to defensive mode!")
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_INTERCEPT ) {
				txtef COLOR_YELLOW
				txt lang(cdatan(CDATAN_NAME, tc) + "は迎撃の態勢に入った！", name(tc) + " switched to intercept mode!")
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_TALKING ) {
				txtef COLOR_GREEN
				txt lang(cdatan(CDATAN_NAME, tc) + "は交渉の態勢に入った！", name(tc) + " switched to talking mode!")
			}
		}
		if ( rtval >= 5 & rtval <= 10 ) {
			f = 0
			repeat MAX_EQUIP_SLOT_TOTAL
				body = CDATA_STARTING_EQUIP_SLOTS + cnt
				if ( cdata(body, tc) \ EXT_EQUIP_SLOTS == 0 ) {
					continue
				}
				if ( cdata(body, tc) / EXT_EQUIP_SLOTS == EQUIP_SLOT_AMMO ) {
					ci = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
					f = 1
					break
				}
			loop
			if ( f == 0 ) {
				snd SOUNDLIST_FAIL1
				txt lang(cdatan(CDATAN_NAME, tc) + "は矢弾を装備していない。", "You need to equip ammo.")
				goto *effect_directive
			}
			if ( rtval == 5 ) {
				inv(INV_ITEM_AMMO, ci) = -1
				s = lang("通常弾", "Normal"), lang("無限", "Unlimited")
				snd SOUNDLIST_AMMO
				txtef COLOR_GREEN
				txt lang(cdatan(CDATAN_NAME, tc) + "は" + s + "に切り替えた。", "Current Ammo Type")
			}
			else {
				if ( rtval == 6 ) {
					amp = ENCHANT_AMMO_BURST
				}
				if ( rtval == 7 ) {
					amp = ENCHANT_AMMO_MAGIC
				}
				if ( rtval == 8 ) {
					amp = ENCHANT_AMMO_PIERCING
				}
				if ( rtval == 9 ) {
					amp = ENCHANT_AMMO_EXPLOSIVE
				}
				if ( rtval == 10 ) {
					amp = ENCHANT_AMMO_RAPID
				}
				change = 0
				repeat RANGE_INV_ITEM_ENCHANT
					if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
						break
					}
					enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci)
					i = enc / EXT_ENCHANTMENT
					if ( i != 0 ) {
						enc = enc \ EXT_ENCHANTMENT
						if ( i == ENCHANT_AMMO ) {
							if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) \ EXT_ENCHANTMENT == amp ) {
								inv(INV_ITEM_AMMO, ci) = cnt
								change = 1
								break
							}
						}
					}
				loop
				if ( change == 0 ) {
					snd SOUNDLIST_FAIL1
					txt lang(cdatan(CDATAN_NAME, tc) + "の矢弾はその切替に対応していない。", itemname(ci) + " isn't capable of using that ammo.")
					goto *effect_directive
				}
				snd SOUNDLIST_AMMO
				change = 0
				i = inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ci) * 2 + 1, ci) \ EXT_ENCHANTMENT_AMMO, inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ci) * 2 + 1, ci) / EXT_ENCHANTMENT_AMMO
				s = ammoname(amp), "" + i + "/" + i(1)
				s = s + ":" + s(1)
				txtef COLOR_GREEN
				txt lang(cdatan(CDATAN_NAME, tc) + "は" + s + "に切り替えた。", "Current Ammo Type")
			}
		}
		goto *effect_directive
	}
	if ( signal == 100 ) {
		signal = 0
		return 0
	}
	return

*effect_elixer
	cdata(CDATA_CONDITION_MPOISON, tc) = 0
	cdata(CDATA_CONDITION_POISON, tc) = 0
	cdata(CDATA_CONDITION_SLEEP, tc) = 0
	cdata(CDATA_CONDITION_CONFUSE, tc) = 0
	cdata(CDATA_CONDITION_BLIND, tc) = 0
	cdata(CDATA_CONDITION_PARALYZE, tc) = 0
	cdata(CDATA_CONDITION_SUFFOCATION, tc) = 0
	cdata(CDATA_CONDITION_DIM, tc) = 0
	cdata(CDATA_CONDITION_FEAR, tc) = 0
	cdata(CDATA_CONDITION_DRUNK, tc) = 0
	cdata(CDATA_CONDITION_BLEED, tc) = 0
	cdata(CDATA_CONDITION_ATROPHY, tc) = 0
	cdata(CDATA_CONDITION_BIND, tc) = 0
	cdata(CDATA_CONDITION_OIL, tc) = 0
	if ( cdata(CDATA_CONDITION_BRAINWASH, tc) > 1 ) {
		cdata(CDATA_CONDITION_BRAINWASH, tc) = 1
	}
	gdata(GDATA_SLEEP) = 0
	cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc)
	cdata(CDATA_MP, tc) = cdata(CDATA_MAX_MP, tc)
	cdata(CDATA_SP, tc) = cdata(CDATA_MAX_SP, tc)
	return

