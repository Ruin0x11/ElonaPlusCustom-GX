#pack "scene1.hsp"
#pack "scene2.hsp"
#packopt type 0
#packopt name "ElonaPlusCGX"
#cmpopt varname 1

; Define this to enable Lua debugging features.
;#define CUSTOM_GX_LUA

; Define this to enable mocking features.
;#define CUSTOM_GX_MOCK

#uselib "exrand.dll"
#func exrand_randomize "_exrand_randomize@16" int, int, int, int
#func exrand_rnd "_exrand_rnd@16" var, int, int, int

; In HSP 3.6, sortnote was added as a standard library function. We need to
; use the version in hspda.dll for compatability reasons, so rename it to
; "sortnote2" to prevent name clashes.
#uselib "hspda.dll"
#func sortnote2 "_sortnote@16" pexinfo, nullptr, nullptr, nullptr
#ifndef _DEBUG
#func xnotesel "_xnotesel@16" pval, int, int, int
#func xnoteadd "_xnoteadd@16" bmscr, str, int, int
#endif

#uselib "hspext_ext.dll"
#func _gfini "_gfini@16" bmscr, int, int, int
#func gfdec "_gfdec@16" int, int, int, int
#func gfdec2 "_gfdec2@16" int, int, int, int
#func gfinc "_gfinc@16" int, int, int, int
#func ematan "_ematan@16" var, int, int, int
#func aplsel "_aplsel@16" bmscr, str, int, prefstr
#func aplobj "_aplobj@16" bmscr, str, int, prefstr
#func apledit "_apledit@16" var, int, int, prefstr

#uselib "elona.dll"
#func __grotate "_grotate@16" pexinfo, nullptr, nullptr, nullptr

#uselib "z.hpi"
#func zOpen "_zOpen@16" var, str, int, int
#func zRead "_zRead@16" var, int, int, int
#func zWrite "_zWrite@16" var, int, int, int
#func zClose "_zClose@16" int, int, int, int

#uselib "COMDLG32.DLL"
#func GetOpenFileNameA "GetOpenFileNameA" sptr
#func GetSaveFileNameA "GetSaveFileNameA" sptr

#uselib "hmm.dll"
#func DSINIT "_DSINIT@16" bmscr, int, int, int
#func DSEND "_DSEND@16" int, int, int, int
#func DSRELEASE "_DSRELEASE@16" int, int, int, int
#func DSLOADFNAME "_DSLOADFNAME@16" pexinfo, nullptr, nullptr, nullptr
#func DSPLAY "_DSPLAY@16" int, int, int, int
#func DSSTOP "_DSSTOP@16" int, int, int, int
#func DSSETVOLUME "_DSSETVOLUME@16" int, int, int, int
#func DSGETMASTERVOLUME "_DSGETMASTERVOLUME@16" int, int, int, int
#func CHECKPLAY "_CHECKPLAY@16" int, int, int, int
#func DMINIT "_DMINIT@16" bmscr, int, int, int
#func DMEND "_DMEND@16" int, int, int, int
#func DMLOADFNAME "_DMLOADFNAME@16" bmscr, str, int, int
#func DMPLAY "_DMPLAY@16" int, int, int, int
#func DMSTOP "_DMSTOP@16" bmscr, int, int, int
#func DIINIT "_DIINIT@16" bmscr, int, int, int
#func DIGETJOYNUM "_DIGETJOYNUM@16" int, int, int, int
#func DIGETJOYSTATE "_DIGETJOYSTATE@16" var, int, int, int
#func HMMBITON "_HMMBITON@16" var, int, int, int
#func HMMBITOFF "_HMMBITOFF@16" var, int, int, int
#func HMMBITCHECK "_HMMBITCHECK@16" int, int, int, int

#uselib "hspsock.dll"
#func sockopen "_sockopen@16" int, str, int, int
#func sockclose "_sockclose@16" int, int, int, int
#func sockget "_sockget@16" var, int, int, int
#func sockput "_sockput@16" bmscr, str, int, int

#uselib "hspinet.dll"
#func netinit "_netinit@16" int, int, int, int
#func netexec "_netexec@16" var, int, int, int
#func neterror "_neterror@16" pexinfo, nullptr, nullptr, nullptr
#func neturl "_neturl@16" bmscr, str, int, int
#func netdlname "_netdlname@16" bmscr, str, int, int
#func netrequest "_netrequest@16" bmscr, str, int, int

#uselib "kernel32.dll"
#func RemoveDirectoryA "RemoveDirectoryA" str
#cfunc GetLastError "GetLastError"
#func CreateMutexA "CreateMutexA" sptr, int, sptr
#func CloseHandle "CloseHandle" sptr
#func _GetLastError "GetLastError"
#cfunc LCMapStringA "LCMapStringA" int, int, sptr, int, var, int
#cfunc GetUserDefaultLCID "GetUserDefaultLCID"

#uselib "water.hpi"
#func water_getimage "_water_getimage@16" bmscr, int, int, int
#func water_refresh "_water_refresh@16" int, int, int, int
#func water_setripple "_water_setripple@16" int, int, int, int
#func water_calc "_water_calc@16" int, int, int, int
#func water_draw "_water_draw@16" bmscr, int, int, int

#uselib "user32.dll"
#func AppendMenuA "AppendMenuA" sptr, sptr, sptr, sptr
#func CheckMenuRadioItem "CheckMenuRadioItem" sptr, sptr, sptr, sptr, sptr
#func CreateMenu "CreateMenu"
#func CreatePopupMenu "CreatePopupMenu"
#func DrawMenuBar "DrawMenuBar" sptr
#func SetMenu "SetMenu" sptr, sptr
#func keybd_event "keybd_event" int, int, int
#func GetKeyboardState "GetKeyboardState" var
#func MonitorFromPoint "MonitorFromPoint" sptr, sptr, sptr
#func GetMonitorInfo "GetMonitorInfoA" sptr, sptr
#func EnumDisplaySettings "EnumDisplaySettingsA" sptr, sptr, sptr

#uselib "gdi32.dll"
#cfunc GetDeviceCaps "GetDeviceCaps" int,int

#uselib "winmm.dll"
#func timeBeginPeriod "timeBeginPeriod" int
#func timeEndPeriod "timeEndPeriod" int
#cfunc timeGetTime "timeGetTime"

#uselib "imm32"
#cfunc ImmGetContext "ImmGetContext" sptr
#func ImmReleaseContext "ImmReleaseContext" sptr, sptr
#func ImmSetOpenStatus "ImmSetOpenStatus" sptr, sptr
#cfunc ImmGetOpenStatus "ImmGetOpenStatus" sptr

#include "highdpi.hsp"

#ifdef CUSTOM_GX_MOCK
#include "mock_defines.hsp"
#endif

#define global VARIANT_NAME "ElonaPlus Custom-GX 2.14.1.0"
#define global VARIANT_TITLE "Elona+ Custom-GX 2.14.1.0"
#define global VERSION_STRING "6.14"
#define global VERSION_NUMBER int(double(VERSION_STRING) * 1000)

	develop = dirinfo(4) == "--develop"

	if ( develop ) {
		dbg_titleinfo = 1
		dbg_hpAlwaysFull = 0
		dbg_skipCm = 0
		dbg_figure = 1
		dbg_extraSkills = 1
		dbg_evolution = 0
		dbg_advMessages = 0
		dbg_subAmurdad = 0
		dbg_doNothing = 1
		dbg_quickStart = 0
		dbg_luaConsole = 1
		dbg_net = 0
	}

	sdim proclist, 50, 4
	dim fpss@d3m, 32


	#define global proc(%1) procId@=(procId@+1)\50:procList@(procId@)=%1+" ct:"+ct@

	; #include "exrand.as"

	; If we're running under hsed3, dir_exe will be the HSP installation folder
	; (C:\bin\hsp30), *not* the folder with Elona's assets.
	;
	; If the editor is being used, then _DEBUG will be defined as true, so check
	; that when setting the executable directory.
#ifdef _DEBUG
	exedir = dir_cur + "\\..\\assets\\2.05-custom-gx\\"
	exist exedir + "elona.dll"
	if ( strsize == (-1) ) {
		dialog "Could not find debug assets folder '" + exedir + "'. Please copy a full installation of Elona+ Custom-G to this folder first."
		end
	}
#else
	exedir = dir_exe + "\\"
	exist exedir + "elona.dll"
	if ( strsize == (-1) ) {
		dialog "Could not find an installation of Elona+. Please follow the install instructions to install Elona+ first before running this program."
		end
	}
#endif
	devfile = ""

	; HSP only provides the name of the file an error occurred in if it crashes
	; with its default error handler, and only if it's running from the editor.
	; (Did I mention that HSP sucks?)
#ifndef _DEBUG
	onerror goto *exit_game_error
#endif

	randomize
	randseed = rnd(2000)
	randomize randseed
	exrand_randomize randseed

	title VARIANT_TITLE

	goto *system_init

; No idea why this is necessary, but otherwise it crashes when calling xnotesel
; in debug mode, but not from an .exe or vice versa.
#ifdef _DEBUG
	#include "hspda.as"
#endif
	; #include "hspext_ext.as"
	; #include "elonadll.as"
	; #include "z.as"
	; #include "comdlg32.as"
	; #include "hspmath.as"
	; #include "hmm.as"
	; #include "hspsock.as"
	; #include "hspinet.as"
#ifdef CUSTOM_GX_LUA
	#include "hsplua.as"
#endif

	#include "init.hsp"
	#include "chips.hsp"

	; #if fastcmp=0
	; #include "db_defitem.hsp"
	; #else
	; #include "db_defitem_fake.hsp"
	; #endif

	#include "etc.hsp"

	#include "item_data.hsp"
	#include "item_func.hsp"
	#include "module.hsp"
	#include "material_data.hsp"

	; #if fastcmp=0
	#include "db_item.hsp"
	; #else
	; #include "db_item_fake.hsp"
	; #endif

	#include "chara_func.hsp"
	#include "net.hsp"
	#include "screen.hsp"
	#include "calculation.hsp"
	#include "chara.hsp"
	#include "item.hsp"
	#include "map_func.hsp"
	#include "map_rand.hsp"
	#include "map_user.hsp"
	#include "map.hsp"
	#include "tcg.hsp"

	#include "material.hsp"
	#include "txtadv.hsp"
	#include "god.hsp"

	#include "event.hsp"
	#include "blend.hsp"
	#include "command.hsp"
	#include "system.hsp"
	#include "proc.hsp"
	#include "action.hsp"
	#include "chat.hsp"
	#include "economy.hsp"

	; #if fastcmp=0
	#include "db_race.hsp"
	#include "db_class.hsp"
	#include "db_creature.hsp"
	; #else
	; #include "db_race_fake.hsp"
	; #include "db_class_fake.hsp"
	; #include "db_creature_fake.hsp"
	; #endif

	#include "randname.hsp"
	#include "adv.hsp"
	#include "quest.hsp"
	#include "scene.hsp"
	#include "ai.hsp"

	#include "help.hsp"

	#include "lua.hsp"

#ifdef CUSTOM_GX_MOCK
	#include "mock_lib.hsp"
#endif

*game_init
	gdata(GDATA_YEAR) = 517, 10, 12, 16, 10
	quickpage = 1
	if ( dirinfo(4) == "medit" ) {
		medit = 1
		goto *mapEditor_init
	}

#ifdef CUSTOM_GX_MOCK
	goto *mock_createPlayer
#endif

	if ( dbg_quickStart ) {
		mode = MODELIST_QUICK_START
		goto *world_init
	}

	if ( defload != "" ) {
		exist exedir + "save\\" + defload + "\\header.txt"
		if ( strsize == (-1) ) {
			exist exedir + "save\\sav_" + defload + "\\header.txt"
			if ( strsize != (-1) ) {
				defload = "sav_" + defload
			}
			else {
				defload = ""
			}
		}
		if ( defload == "" ) {
			dialog "Invalid defLoadFolder. name"
		}
		else {
			playerid = defload
			mode = MODELIST_CONTINUE
			music = MUSICLIST_NONE
			goto *world_init
		}
	}

	goto *game_title

*world_init
	mtilefilecur = -1
	firstturn = 1
	msgtemp = " Welcome traveler! "
	if ( cfg_net ) {
		gosub *net_init
	}
	if ( mode == MODELIST_QUICK_START ) {
		repeat 9
			gdata(STARTING_GDATA_RANK + cnt) = 5000
		loop
		gdata(GDATA_VERSION) = VERSION_NUMBER
		gdata(STARTING_GDATA_SHORTCUT + 1) = 424
		gdata(STARTING_GDATA_SHORTCUT + 2) = 300
		gdata(STARTING_GDATA_SHORTCUT + 3) = 631
		gdata(GDATA_COUNT_SHOP) = 1000
		gdata(GDATA_COUNT_SHELTER) = 100
		dbgchara = 23
		playerid = "sav_noa"
		gdata(GDATA_WORLD_X) = 22
		gdata(GDATA_WORLD_Y) = 21
		gdata(GDATA_AREA_PREV) = -1
		gdata(GDATA_RAND_SEED_A) = rnd(800) + 2
		gdata(GDATA_RAND_SEED_B) = rnd(200) + 2
		gdata(GDATA_AREA) = AREA_NORTH_TYRIS
		gdata(GDATA_LEVEL) = 0
		gdata(GDATA_LEVEL_START_ON) = 7
		mapstartx = 22
		mapstarty = 21
		gdata(GDATA_AREA) = AREA_VERNIS
		gdata(GDATA_LEVEL) = 1
		gdata(GDATA_LEVEL_START_ON) = 7
		mapstartx = 10
		mapstarty = 23
		initlv = 1000
		rc = CHARA_PLAYER
		flt 100
		characreate 0, CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE, -3, 0
		gosub *cm_finishPC
		gdata(GDATA_YEAR) = 517, 12, 30, 1, 10
		gdata(GDATA_STORY_BOOKMARK) = 10000
		gdata(GDATA_DEEPEST) = 100
		gdata(GDATA_FLAG_ALLY) = 1
		adata(ADATA_PARENT, AREA_HOME) = AREA_NORTH_TYRIS
		gdata(GDATA_WORLD) = adata(ADATA_PARENT, gdata(GDATA_AREA))
		gdata(GDATA_TRAIT_POINT) = 2
		gdata(GDATA_HEIR_DEED) = 1000
		gdata(GDATA_HOME_LEVEL) = 0
		gdata(GDATA_GUEST) = 10
		gdata(GDATA_ABSORB_CHARGE) = 1000
		gdata(GDATA_DEEPEST_LEVEL) = 500
		cdata(CDATA_GOD, CHARA_PLAYER) = GOD_LULWY, 1000, 1000
		gdata(GDATA_FLAG_SUB_MOTHER) = 1001
		gdata(GDATA_FLAG_SUB_URCAGUARY_THE_TENACIOUS_GEM) = 2
		gdata(GDATA_FLAG_SUB_DOGS_TAIL) = 1000
		gdata(GDATA_FLAG_SUB_YEEK) = 1000
		gdata(GDATA_FLAG_SUB_H_SISTER) = 1000
		gdata(GDATA_FLAG_SUB_CAT) = 1000
		gdata(GDATA_FLAG_SUB_MINOTAUR) = 1000
		gdata(GDATA_FLAG_SUB_PYRAMID) = 1000
		gdata(GDATA_FLAG_SUB_FALLEN_PRINCESS) = 1000
		gdata(GDATA_FLAG_SUB_MANSION_FOR_SALE) = 1004
		gdata(GDATA_FLAG_SUB_BIOLOGIST) = 1000
		gdata(GDATA_FLAG_LEOLD_LOCATION_STATE) = 4
		gdata(GDATA_FLAG_SUB_STRUGGLE_AGAINST_INSANITY) = 1000
		gdata(GDATA_FLAG_SUB_BEYOND_THE_GENERATIONS) = 1001
		gdata(GDATA_FLAG_SUB_BELPHAT_THE_COSMIC_SWORD) = 1000
		gdata(GDATA_FLAG_SUB_THE_TRUE_APPEARANCE) = 1003
		gdata(GDATA_FLAG_SUB_LAW_OF_NINJAS) = 1000
		gdata(GDATA_FLAG_CAN_RECEIVE_CHOCOLATE) = 1
		gdata(GDATA_FLAG_SUB_MANYTIA_THE_ADVENTURE_MERCHANT) = 3
		gdata(GDATA_FLAG_ENTHUMESIS_SPAWNED) = 100
		gdata(GDATA_FLAG_SUB_MONOCHROME_DELIVERY_SERVICE) = 1
		gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) = 1
		gdata(GDATA_FLAG_GUILD_MAGE) = 1
		cdata(CDATA_GOLD, CHARA_PLAYER) = 13000000
		gdata(STARTING_GDATA_FLAG + 359) = 100
		cdata(CDATA_PLATINUM, CHARA_PLAYER) = 3000
		cdata(CDATA_FAME, CHARA_PLAYER) = 132548
		cdata(CDATA_AP_CURRENT, CHARA_PLAYER) = 1800
		gdata(GDATA_FLAG_MAIN) = 1010
		gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) = 1000
		r1 = CHARA_PLAYER
		gosub *charaRefresh
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 2
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 3
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 4
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 5
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 6
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 7
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 8
		flt
		itemcreate 0, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 9
		flt
		itemcreate 0, ITEM_ID_TEA_LEAF, -1, -1, 0
		inv(INV_ITEM_LEVEL, ci) = 7
		inv(INV_ITEM_NUM, ci) = 60
		flt
		itemcreate 0, ITEM_ID_SOYBEAN, -1, -1, 0
		inv(INV_ITEM_LEVEL, ci) = 15
		inv(INV_ITEM_NUM, ci) = 60
		flt
		itemcreate 0, ITEM_ID_NECROMANTIS, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_BRONZE_COIN, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 60
		flt
		itemcreate 0, ITEM_ID_PANTY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 60
		flt
		itemcreate 0, ITEM_ID_JERKY, -1, -1, 0
		inv(INV_ITEM_LEVEL, ci) = 10
		flt
		itemcreate 0, ITEM_ID_SURVIVABILITY_EXTENDER_Y, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_SURVIVABILITY_EXTENDER_X, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_HAMAKI, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_CIGARETTE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_TOBACCO, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_TEAR_OF_GOD, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 1
		encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_FIRE, 400, 0, 1, 0, 1
		; flt
		; itemcreate 0, ITEM_ID_STATUE_OPATOS, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 300
		flt
		itemcreate 0, ITEM_ID_SCROLL_CHANGE_MATERIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 45
		flt
		itemcreate 0, ITEM_ID_PANZERFAUST_X, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_M202_SPECIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_ESSENTIAL_OIL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_GASOLINE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_JUKE_BOX, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_SCROLL_WONDER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_SOCKS, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_WAKE_UP_OF_NEFIA, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_ROD_WISHING, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 200
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_ABYSS_LUNCH, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_WOOD_MATERIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_STONE_MATERIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_WONDER_BODY_FORMER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_POTION_WEAKEN_RESISTANCE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_SCROLL_GROWTH, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 500
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_CORE_OF_NEFIA, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = 1
		flt
		itemcreate 0, ITEM_ID_RAW_RUBYNUS_ORE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_RAW_EMERALD_ORE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_RAW_DIAMOND_ORE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_EVITEM, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 13
		flt
		itemcreate 0, ITEM_ID_CAT_SISTERS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_LITTLE_SISTERS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_GIRLS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_OLDER_SISTERS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_DOG_SISTERS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_MYSTERIOUS_DIARY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_DEED_HOME_RELOCATION, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_KANEITUUHOU, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DOWNSTAIRS, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_UPSTAIRS, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SECRET_EXP_KUMIROMI, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_TOKEN_FRIENDSHIP, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_GIFT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_STETHOSCOPE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_ASTRAL_LIGHT_PEN, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_COCONUT_CRAB, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_GOD_BREAKER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		flt
		itemcreate 0, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_SMALL_MEDAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_SCROLL_SUPERIOR_MATERIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_FLYING_SCROLL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 200
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_FLYING_SCROLL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 200
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_DD_CEMETERY_KEY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		flt
		itemcreate 0, ITEM_ID_MATERIAL_KIT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_ETHER
		flt
		itemcreate 0, ITEM_ID_MATERIAL_KIT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_ADAMANTIUM
		flt
		itemcreate 0, ITEM_ID_MATERIAL_KIT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_DRAGON
		; flt
		; itemcreate 0, ITEM_ID_MANA_CRYSTAL, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 100
		; flt
		; itemcreate 0, ITEM_ID_COFFIN, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 100
		; flt
		; itemcreate 0, ITEM_ID_HEART, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 100
		; flt
		; itemcreate 0, ITEM_ID_EYE, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 100
		; flt
		; itemcreate 0, ITEM_ID_BLOOD, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_MUSIC_TICKET, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50000
		flt
		itemcreate 0, ITEM_ID_LEASH, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 5
		flt
		itemcreate 0, ITEM_ID_FORBIDDEN_MEAT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 5
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_BOTTLE_WATER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_BOTTLE_WATER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_SHELTER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		flt
		itemcreate 0, ITEM_ID_SAND_BAG, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 2
		flt
		itemcreate 0, ITEM_ID_LOCKPICK, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 3
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_FISHING_POLE, -1, -1, 0
		inv(INV_ITEM_CHARGE, ci) = 100
		flt
		itemcreate 0, ITEM_ID_EVITEM, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = EVITEM_HEART_KING
		inv(INV_ITEM_NUM, ci) = 5
		flt
		itemcreate 0, ITEM_ID_POTION_SACRED_HEALER_JURE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 5
		flt
		itemcreate 0, ITEM_ID_POTION_RESTORE_BODY, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_SCYTHE_OF_THE_VOID, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_BOTTLE_BEER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 200
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_POTION_SLOW, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_SCROLL_RETURN, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_BEJEWELED_CHEST, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 20
		flt
		itemcreate 0, ITEM_ID_SCROLL_GAIN_ATTRIBUTE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_POTION_POTENTIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_STAFF_OF_INSANITY, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_POTION_HERO, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_BOTTLE_SULFURIC, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 30
		flt
		itemcreate 0, ITEM_ID_SCROLL_GAIN_MATERIAL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 500
		flt
		itemcreate 0, ITEM_ID_MORGIA, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_MAREILON, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_SPENSEWEED, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_CURARIA, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_ALRAUNIA, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_STOMAFILLIA, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_POTION_MUTATION, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_LOVE_POTION, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_ROD_ALCHEMY, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_KITTY_BANK, -1, -1, 0
		; flt
		; itemcreate 0, ITEM_ID_MOON_GATE, -1, -1, 0
		; inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_COOLER_BOX, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DECK, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_POTION_DESCENT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate 0, ITEM_ID_GRENADE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_KILL_KILL_PIANO, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_BOTTLE_HERMES_BLOOD, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_LICENCE_THE_VOID_EXPLORER, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_TAMERS_WHIP, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_GAROKS_HAMMER, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_POT_FOR_FUSION, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_POT_OF_ALCHEMIST, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_GEMSTONE_YACATECT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 15
		flt
		itemcreate 0, ITEM_ID_GEMINI, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_G3_EXA, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DREADNOUGHT, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_FETTER_OF_EARTH, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_MECHANICAL_BINDER, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SMASH_TONFA, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_VITAL_FLAYER, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_COMMAND_FLAG, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SABER_TONFA, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_BLANK_BUSINESS_CARD, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_SLASH_JOKER, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_POTION_AQUA_SANCTIO, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		flt
		itemcreate 0, ITEM_ID_MOONLIGHT, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SUPER_LURE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_GRIFFON, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SHIELD_TONFA, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SONIC_TONFA, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_MANDRAKE_SALAD, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DEED_OF_CARRIAGE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DEED_OF_TRUCK, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DEED_OF_MAGIC_LOCOMOTIVE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DEED_OF_LAND_BATTLESHIP, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_AWESOME_SWIMWEAR, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_WAR_SUIT, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_DANGER_SWIMWEAR, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_SPELLBOOK_HOLY_RAIN, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_SCROLL_HOLY_LIGHT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_CLAYMORE, -1, -1, 0
		ibitmod ITEM_BIT_ULTIMATE, ci, 1
		flt
		itemcreate 0, ITEM_ID_CARD_PACK, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 50
		gdata(STARTING_GDATA_SHORTCUT + 1) = 789 + 14 * 10000
		gdata(STARTING_GDATA_SHORTCUT + 2) = 790 + 14 * 10000
		flt
		itemcreate 0, ITEM_ID_RECIPE, -1, -1, 0
		inv(INV_ITEM_SUB_NAME, ci) = 885 + 400
		flt
		itemcreate 0, ITEM_ID_RECIPE, -1, -1, 0
		inv(INV_ITEM_SUB_NAME, ci) = 884 + 400
		flt
		itemcreate 0, ITEM_ID_RECIPE, -1, -1, 0
		inv(INV_ITEM_SUB_NAME, ci) = 883 + 400
		flt
		itemcreate 0, ITEM_ID_RECIPE, -1, -1, 0
		inv(INV_ITEM_SUB_NAME, ci) = 882 + 400
		flt
		itemcreate 0, ITEM_ID_RECIPE, -1, -1, 0
		inv(INV_ITEM_SUB_NAME, ci) = 933 + 400
		itemcreate 0, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		inv(INV_ITEM_PARAM1, ci) = TRAIT_GOD_OPATOS
		flt
		itemcreate 0, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate 0, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
		flt
		itemcreate 0, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_PLATINUM_COIN, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_ROD_HOLY_LIGHT, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_PARAM1, ci) = TRAIT_OTHER_SAINT
		flt
		itemcreate 0, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		inv(INV_ITEM_PARAM1, ci) = TRAIT_OTHER_WICKED
		flt
		itemcreate 0, ITEM_ID_BLUE_CAPSULE_DRAG, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 100
		flt
		itemcreate 0, ITEM_ID_GOULDS_PIANO, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_MINIATURE_TREE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_PEDESTAL, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_COUNTER, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_NEW_YEARS_DECORATION, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_AA_12_ADVANCE, -1, -1, 0
		flt
		itemcreate 0, ITEM_ID_BLUE_STALL, -1, -1, 0
		flt , 4
		itemcreate 0, ITEM_ID_ENERGY_CELL, -1, -1, 0
		inv(INV_ITEM_NUM, ci) = 10
		flt
		itemcreate 0, ITEM_ID_PLAYBACK_DISC, -1, -1, 0
		repeat 30
			flt
			itemcreate 0, ITEM_ID_RED_BOOK, -1, -1, 0
		loop
        inv_getheader 0
		repeat invrange, invhead
			item_identify cnt, ITEM_KNOWN_FULL
        loop
		cbitmod CHARA_BIT_RAPID_MAGIC, 0, 1
		mode = MODELIST_MAIN
		gosub *calcBurdenPc
		repeat 59
			mat(cnt) = 200
		loop
		gosub *adv_init
		create_pcpic 0, 1
		cdatan(CDATAN_AKA, CHARA_PLAYER) = random_title()
		cdatan(CDATAN_NAME, CHARA_PLAYER) = randomname()
		mode = MODELIST_NEW
	}
	if ( mode == MODELIST_NORMAL_START ) {
		gdata(GDATA_YEAR) = 517, 10, 12, 1, 10
		gdata(GDATA_WORLD_X) = 22
		gdata(GDATA_WORLD_Y) = 21
		gdata(GDATA_AREA_PREV) = -1
		gdata(GDATA_WORLD) = AREA_NORTH_TYRIS
		ghelp = 1
		gdata(GDATA_AREA) = AREA_HOME
		gdata(GDATA_HOME_LEVEL) = 0
		gosub *setArea
		gdata(GDATA_LEVEL) = 1
		gdata(GDATA_LEVEL_START_ON) = 4
		gdata(GDATA_VERSION) = VERSION_NUMBER
		gdata(GDATA_WEATHER) = WEATHER_RAIN, 6
		repeat 20
			gdata(STARTING_GDATA_RANK + cnt) = 10000
		loop
		gosub *adv_init
		mode = MODELIST_NEW
		evadd EVENT_OPENING
		evadd EVENT_INIT_ECONOMY
		sceneid = 0
		gosub *scene
	}
	if ( mode == MODELIST_NEW ) {
		gdata(GDATA_COUNT_SHOP) = 1000
		gdata(GDATA_COUNT_SHELTER) = 100
		gosub *initial_recipe
	}
	if ( mode == MODELIST_CONTINUE ) {
		gosub *game_load
	}
	gosub *define_los
	goto *map_init

*main_init
#ifdef CUSTOM_GX_MOCK
	#include "mock.hsp"
	stop
#endif
	procid = (procid + 1) \ 4
	proclist(procid) = "main_init:Begin" + " ct:" + ct
	sound = SOUNDLIST_NONE
	ct = 0
	repeat 200
		if ( mef(0, cnt) == 0 ) {
			break
		}
		if ( mef(0, cnt) == 5 ) {
			if ( mdata(MDATA_FIELD) == 2 ) {
				if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
					if ( gdata(GDATA_WEATHER) == WEATHER_RAIN | gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN ) {
						delmef cnt
						continue
					}
					if ( gdata(GDATA_AREA) == AREA_NOYEL & gdata(GDATA_LEVEL) == 100 ) {
						delmef cnt
						continue
					}
					if ( gdata(GDATA_AREA) == AREA_BLIMP & gdata(GDATA_LEVEL) == 100 ) {
						delmef cnt
						continue
					}
					dx = mef(MEF_X, cnt)
					dy = mef(MEF_Y, cnt)
					i = mef(MEF_SOURCE, cnt)
					p = 0
					p2 = mef(MEF_POWER, cnt)
					if ( rnd(35) == 0 ) {
						p = 3
						if ( dist(dx, dy, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)) < 6 ) {
							sound = SOUNDLIST_FIRE1
						}
					}
					repeat p
						x = rnd(2) + dx - rnd(2)
						y = rnd(2) + dy - rnd(2)
						if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
							f = 0
							continue
						}
						if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
							map(x, y, 0) = 37
							continue 0
						}
						addmef x, y, 5, 24, rnd(15) + 20, p2, i
						mapitem_fire x, y
					loop
				}
			}
		}
		if ( mef(0, cnt) == 7 ) {
			txtef COLOR_RED
			txt lang(" *", "*") + mef(4, cnt) + lang("* ", "*")
		}
		if ( mef(4, cnt) != (-1) ) {
			mef(4, cnt)--
			if ( mef(4, cnt) == 0 ) {
				delmef cnt
			}
		}
	loop
	if ( sound != SOUNDLIST_NONE ) {
		snd sound
	}
	if ( gdata(STARTING_GDATA_FLAG + 381) != 0 ) {
		gdata(STARTING_GDATA_FLAG + 381) = 0
	}
	gspd = cdata(CDATA_SPEED, CHARA_PLAYER) * (100 + cdata(CDATA_TIME_SCALE, CHARA_PLAYER)) / 100
	if ( gspd < 10 ) {
		gspd = 10
	}
	turncost = (mdata(MDATA_TIMESCALE) - cdata(CDATA_SPEED_SUM, CHARA_PLAYER)) / gspd + 1
	if ( evnum != 0 ) {
		evproc = 1
		gosub *event
		evproc = 0
		evnum--
		evlist(evnum) = 0
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		goto *main_init
	}
	if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
		goto *pc_dead
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) > 2 ) {
			cdata(CDATA_SPEED_SUM, CHARA_PLAYER) = mdata(MDATA_TIMESCALE)
			goto *spdSkip
		}
	}
	repeat MAX_CHARA_TOTAL
		if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		spd = cdata(CDATA_SPEED, cnt) * (100 + cdata(CDATA_TIME_SCALE, cnt)) / 100
		if ( cnt != CHARA_PLAYER ) {
			if ( cdata(CDATA_SPEED, cnt) < cdata(CDATA_SPEED, CHARA_PLAYER) / 5 ) {
				spd = cdata(CDATA_SPEED, CHARA_PLAYER) / 5 * (100 + cdata(CDATA_TIME_SCALE, cnt)) / 100
			}
		}
		if ( cnt != CHARA_PLAYER ) {
			if ( cdata(CDATA_SPEED, cnt) > cdata(CDATA_SPEED, CHARA_PLAYER) * 5 ) {
				spd = cdata(CDATA_SPEED, CHARA_PLAYER) * 5 * (100 + cdata(CDATA_TIME_SCALE, cnt)) / 100
			}
		}
		if ( spd < 10 ) {
			spd = 10
		}
		if ( gdata(GDATA_FLAG_MAIN) >= 865 & gdata(GDATA_FLAG_MAIN) < 1000 & gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179 ) {
			spd = 100
		}
		cdata(CDATA_SPEED_SUM, cnt) += spd * turncost
	loop
*spdSkip
 	if ( gdata(GDATA_AREA) == AREA_VALM & gdata(GDATA_LEVEL) == 3 ) {
		gdata(GDATA_SEC) += limit(turncost / 5 + 1, 3000, 9000)
 	}
 	else {
		gdata(GDATA_SEC) += limit(turncost / 5 + 1, 7, 21)
    }
	if ( gdata(GDATA_AREA) == AREA_SHELTER ) {
		if ( gdata(GDATA_WEATHER) == WEATHER_SNOW | gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN | gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
			gdata(GDATA_SEC) += 3000
		}
	}
	if ( cdata(CDATA_ROW_ACT, CHARA_PLAYER) == ACTION_FISH ) {
		gdata(GDATA_SEC) += 420 + rnd(60)
	}
	if ( cdata(CDATA_ROW_ACT, CHARA_PLAYER) == ACTION_WORK_A | cdata(CDATA_ROW_ACT, CHARA_PLAYER) == ACTION_WORK_B | cdata(CDATA_ROW_ACT, CHARA_PLAYER) == ACTION_WORK_C ) {
		gdata(GDATA_SEC) += 30
	}
	if ( gdata(GDATA_SEC) >= 60 ) {
		gdata(GDATA_TURN)++
		cc = CHARA_PLAYER
		if ( gdata(GDATA_TURN) \ 10 == 0 ) {
			gosub *chara_spawn
		}
		if ( gdata(GDATA_TURN) \ 10 == 1 ) {
			gosub *item_senseQuality
		}
		gdata(GDATA_MIN) += gdata(GDATA_SEC) / 60
		if ( gdata(GDATA_TIME_LIMIT) > 0 ) {
			gdata(GDATA_TIME_LIMIT) -= gdata(GDATA_SEC) / 60
			if ( gdata(GDATA_COUNT_NOTICE) > gdata(GDATA_TIME_LIMIT) / 10 ) {
				txtef COLOR_SKY_BLUE
				txt lang("クエスト[残り" + (gdata(GDATA_TIME_LIMIT) + 1) + "分]", "" + (gdata(GDATA_TIME_LIMIT) + 1) + " min left for the quest.")
				gdata(GDATA_COUNT_NOTICE) = gdata(GDATA_TIME_LIMIT) / 10
			}
			if ( gdata(GDATA_TIME_LIMIT) <= 0 ) {
				gdata(GDATA_TIME_LIMIT) = 0
				qexit = 100
				evadd EVENT_QUEST_TIMEOUT
			}
		}
		gdata(GDATA_SEC) = gdata(GDATA_SEC) \ 60
		if ( gdata(GDATA_MIN) >= 60 ) {
			gdata(GDATA_HOUR) += gdata(GDATA_MIN) / 60
			gdata(GDATA_MIN) = gdata(GDATA_MIN) \ 60
			gosub *advance_hour
		}
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "main_init:End" + " ct:" + ct
	goto *game_main

*weather_change
	if ( gdata(GDATA_WEATHER) == WEATHER_SNOW ) {
		if ( gdata(GDATA_AREA) == AREA_NORTH_TYRIS & gdata(GDATA_WORLD_X) < 65 & gdata(GDATA_WORLD_Y) > 10 ) {
			gdata(GDATA_WEATHER) = WEATHER_RAIN
			envonly = 1
			gosub *music_play
			gdata(GDATA_NEXT_WEATHER) += 3
		}
	}
	if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN | gdata(GDATA_WEATHER) == WEATHER_RAIN ) {
		if ( gdata(GDATA_WORLD_X) > 65 | gdata(GDATA_WORLD_Y) < 10 ) {
			gdata(GDATA_WEATHER) = WEATHER_SNOW
			envonly = 1
			gosub *music_play
			gdata(GDATA_NEXT_WEATHER) += 3
		}
	}
	if ( gdata(GDATA_WEATHER) == WEATHER_SNOW ) {
		if ( gdata(GDATA_AREA) == AREA_SOUTH_TYRIS & gdata(GDATA_WORLD_X) < 55 ) {
			gdata(GDATA_WEATHER) = WEATHER_RAIN
			envonly = 1
			gosub *music_play
		}
	}
	if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN | gdata(GDATA_WEATHER) == WEATHER_RAIN | gdata(GDATA_WEATHER) == WEATHER_SNOW ) {
		if ( gdata(GDATA_AREA) == AREA_SOUTH_TYRIS & gdata(GDATA_WORLD_X) > 54 ) {
			gdata(GDATA_WEATHER) = WEATHER_CLEAR
		}
	}
	if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN | gdata(GDATA_WEATHER) == WEATHER_RAIN | gdata(GDATA_WEATHER) == WEATHER_SNOW ) {
		if ( gdata(GDATA_AREA) == AREA_LOST_YLVA & gdata(GDATA_WORLD_X) > 39 & gdata(GDATA_WORLD_Y) > 33 ) {
			gdata(GDATA_WEATHER) = WEATHER_CLEAR
		}
	}
	return

*advance_hour
	procid = (procid + 1) \ 4
	proclist(procid) = "Advance_hour:Begin" + " ct:" + ct
	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_MUSEUM ) {
		gosub *museum_update
	}
	if ( gdata(GDATA_AREA) == AREA_HOME ) {
		gosub *house_update
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		gdata(GDATA_WORLD_X) = cdata(CDATA_X, CHARA_PLAYER)
		gdata(GDATA_WORLD_Y) = cdata(CDATA_Y, CHARA_PLAYER)
	}
	if ( gdata(STARTING_GDATA_FLAG + 355) > 0 ) {
		gdata(STARTING_GDATA_FLAG + 355)--
	}
	if ( gdata(STARTING_GDATA_FLAG + 353) == 100 ) {
		if ( gdata(STARTING_GDATA_FLAG + 355) <= 0 | gdata(STARTING_GDATA_FLAG + 354) != gdata(GDATA_MONTH) ) {
			gdata(STARTING_GDATA_FLAG + 353) = 0
			txt lang("ネフィアは静まった。", "Nefia got quiet.")
		}
	}
	if ( gdata(GDATA_MONTH) \ 3 != 0 ) {
		if ( gdata(GDATA_DAY) >= 15 & gdata(GDATA_DAY) <= 24 ) {
			if ( rnd(14) < gdata(GDATA_DAY) - 10 ) {
				if ( gdata(STARTING_GDATA_FLAG + 354) != gdata(GDATA_MONTH) ) {
					gdata(STARTING_GDATA_FLAG + 354) = gdata(GDATA_MONTH)
					gdata(STARTING_GDATA_FLAG + 353) = 100
					gdata(STARTING_GDATA_FLAG + 355) = rnd(24) + 96
					snd SOUNDLIST_FIRE1
					snd SOUNDLIST_ATK_FIRE
					txtef COLOR_GREEN
					txt lang("ランダムネフィアが熱狂状態に突入した！", "Nefia have entered fever!")
					if ( cfg_extrahelp ) {
						if ( gdata(STARTING_GDATA_HELP + 18) == 0 ) {
							if ( mode == MODELIST_MAIN ) {
								if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
									gdata(STARTING_GDATA_HELP + 18) = 1
									ghelp = 18
									gosub *elona_help
								}
							}
						}
					}
				}
			}
		}
	}
	gdata(GDATA_NEXT_WEATHER)--
	gosub *weather_change
	if ( gdata(GDATA_NEXT_WEATHER) < 0 ) {
		gdata(GDATA_NEXT_WEATHER) = rnd(22) + 2
		p = gdata(GDATA_WEATHER)
		repeat 1
			if ( gdata(GDATA_MONTH) \ 3 == 0 ) {
				if ( gdata(GDATA_DAY) >= 1 & gdata(GDATA_DAY) <= 10 ) {
					if ( rnd(15 + gdata(GDATA_YEARS_AFTER_VICTORY)) < gdata(GDATA_DAY) + 5 ) {
						if ( gdata(GDATA_LAST_ETHER) != gdata(GDATA_MONTH) ) {
							gdata(GDATA_WEATHER) = WEATHER_ETHER
							txtef COLOR_RED
							txt lang("エーテルの風が吹き始めた。すぐに避難しなくては。", "Etherwind starts to blow. You need to find a shelter!")
							gdata(GDATA_LAST_ETHER) = gdata(GDATA_MONTH)
							gdata(GDATA_NEXT_WEATHER) = rnd(24) + limit(24 - gdata(GDATA_YEARS_AFTER_VICTORY) * 2, 1, 24)
							break
						}
					}
				}
			}
			if ( p == WEATHER_CLEAR ) {
				weatherbk = 0
				if ( trait(TRAIT_ETHER_RAIN_CLOUD) != 0 ) {
					if ( rnd(4) == 0 ) {
						gdata(GDATA_WEATHER) = WEATHER_RAIN
						txt lang("あなたは雨雲を引き寄せた。", "You draw a rain cloud.")
						break
					}
				}
				if ( gdata(GDATA_WORLD_X) > 65 | gdata(GDATA_WORLD_Y) < 10 ) {
					if ( rnd(2) == 0 ) {
						gdata(GDATA_WEATHER) = WEATHER_SNOW
						txt lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				}
				else {
					if ( rnd(10) == 0 ) {
						gdata(GDATA_WEATHER) = WEATHER_RAIN
						txt lang("雨が降り出した。", "It starts to rain.")
						break
					}
					if ( rnd(40) == 0 ) {
						gdata(GDATA_WEATHER) = WEATHER_HARD_RAIN
						txt lang("突然どしゃぶりになった。", "Suddenly, rain begins to pour down from the sky.")
						break
					}
					if ( rnd(60) == 0 ) {
						gdata(GDATA_WEATHER) = WEATHER_SNOW
						txt lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				}
			}
			if ( p == WEATHER_RAIN ) {
				if ( rnd(4) == 0 ) {
					gdata(GDATA_WEATHER) = WEATHER_CLEAR
					txt lang("雨は止んだ。", "It stops raining.")
					break
				}
				if ( rnd(15) == 0 ) {
					gdata(GDATA_WEATHER) = WEATHER_HARD_RAIN
					txt lang("雨が本格的に降り出した。", "The rain becomes heavier.")
					break
				}
			}
			if ( p == WEATHER_HARD_RAIN ) {
				if ( rnd(3) == 0 ) {
					gdata(GDATA_WEATHER) = WEATHER_RAIN
					txt lang("雨は小降りになった。", "The rain becomes lighter.")
					break
				}
			}
			if ( p == WEATHER_ETHER ) {
				if ( rnd(2) == 0 ) {
					gdata(GDATA_WEATHER) = WEATHER_CLEAR
					txt lang("エーテルの風は止んだ。", "The Etherwind dissipates.")
					break
				}
			}
			if ( p == WEATHER_SNOW ) {
				if ( rnd(3) == 0 ) {
					gdata(GDATA_WEATHER) = WEATHER_CLEAR
					txt lang("雪は止んだ。", "It stops raining.")
					break
				}
			}
		loop
		if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 11) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 11) = 1
							ghelp = 11
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_SNOW ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 12) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 12) = 1
							ghelp = 12
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 13) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 13) = 1
							ghelp = 13
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( p != gdata(GDATA_WEATHER) ) {
			envonly = 1
			gosub *music_play
		}
	}
	gosub *map_prepareTile
	gosub *adv_action
	gosub *item_rot
	gosub *calcThirst
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( rnd(3) == 0 ) {
			gdata(GDATA_SLEEP)++
		}
		if ( TweakData(53, 2) == 0 & rnd(15) == 0 ) {
			if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_SLEEP_PREVENTION, TWEAK_CATEGORY_GAMEPLAY) == TRUE | gdata(GDATA_FLAG_SLEEP_PREVENTION) <= 0 ) {
				if ( mode == MODELIST_MAIN ) {
					txt lang("仮眠をとった。", "You take a nap.")
					gdata(GDATA_SLEEP) -= 3
					if ( gdata(GDATA_SLEEP) < 0 ) {
						gdata(GDATA_SLEEP) = 0
					}
				}
			}
			else {
				txt lang("眠気を我慢した。", "You endure your sleepiness.")
				gdata(GDATA_FLAG_SLEEP_PREVENTION)--
			}
		}
	}
	else {
		if ( gdata(GDATA_AREA) != AREA_SHELTER ) {
			gdata(GDATA_SLEEP)++
		}
	}
	if ( gdata(GDATA_HOUR) == 6 ) {
		txtef COLOR_YELLOW
		txt lang("夜が明けた。", "Day breaks.")
	}
	if ( gdata(GDATA_SLEEP) >= 15 ) {
		if ( cfg_extrahelp ) {
			if ( gdata(STARTING_GDATA_HELP + 9) == 0 ) {
				if ( mode == MODELIST_MAIN ) {
					if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
						gdata(STARTING_GDATA_HELP + 9) = 1
						ghelp = 9
						gosub *elona_help
					}
				}
			}
		}
	}
	if ( cdata(CDATA_HUNGER, CHARA_PLAYER) < 5000 ) {
		if ( cfg_extrahelp ) {
			if ( gdata(STARTING_GDATA_HELP + 10) == 0 ) {
				if ( mode == MODELIST_MAIN ) {
					if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
						gdata(STARTING_GDATA_HELP + 10) = 1
						ghelp = 10
						gosub *elona_help
					}
				}
			}
		}
	}
	if ( gdata(GDATA_HOUR) == 12 ) {
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN ) {
			if ( mdata(MDATA_WEREWOLF_STAGE) == 2 ) {
				mdata(MDATA_WEREWOLF_STAGE) = 3
				gosub *random_event
			}
		}
	}
	if ( gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE) >= 1 ) {
		if ( gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE) \ 2 == 0 ) {
			if ( gdata(GDATA_YEAR) > gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_YEAR) | (gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_MONTH) != 12 & gdata(GDATA_MONTH) == gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_MONTH) + 1) | (gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_MONTH) == 12 & gdata(GDATA_MONTH) == 1) | (gdata(GDATA_MONTH) == gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_MONTH) & gdata(GDATA_DAY) > gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_DAY)) | (gdata(GDATA_MONTH) == gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_MONTH) & gdata(GDATA_DAY) == gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE_DAY) & gdata(GDATA_HOUR) > 14) ) {
				gdata(GDATA_FLAG_SUB_SOPHIA_THE_WISE)++
				txt_questupdate
			}
		}
	}
	if ( gdata(GDATA_HOUR) >= 24 ) {
		if ( gdata(GDATA_GUEST) < 0 ) {
			gdata(GDATA_GUEST) = 0
		}
		if ( gdata(GDATA_GUEST) < 3 ) {
			if ( rnd(8 + gdata(GDATA_GUEST) * 5) == 0 ) {
				gdata(GDATA_GUEST)++
			}
		}
		txtef COLOR_YELLOW
		txt lang("一日が終わり、日付が変わった。", "A day passes and a new day begins.")
		if ( TweakData(TWEAK_GAMEPLAY_DISABLE_STUDY_DAYS, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
			repeat 2
				if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 0 ) {
					if ( gdata(GDATA_FLAG_STUDY_BONUS_TRAINING_EXP) >= 15000 ) {
						gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 1
						break
					}
				}
				if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 1 ) {
					if ( gdata(GDATA_FLAG_STUDY_BONUS_COMBAT_EXP) >= 15000 ) {
						gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 2
						break
					}
				}
				if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 2 ) {
					if ( gdata(GDATA_FLAG_STUDY_BONUS_JOB_EXP) >= 15000 ) {
						gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 3
						break
					}
				}
				if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 3 ) {
					if ( gdata(GDATA_FLAG_STUDY_BONUS_EXPLORATION_EXP) >= 15000 ) {
						gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 4
						break
					}
				}
				if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 4 ) {
					if ( gdata(GDATA_FLAG_STUDY_BONUS_STUDY_EXP) >= 15000 ) {
						gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 0
						break
					}
				}
				gdata(GDATA_FLAG_STUDY_BONUS_KIND) = rnd(5)
			loop
			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 0 ) {
				txtef COLOR_YELLOW
				txt lang("今日は絶好の修行日和だ。", "It's a perfect day for training today.")
			}
			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 1 ) {
				txtef COLOR_YELLOW
				txt lang("今日は絶好の戦闘日和だ。", "It's a perfect day for combat today.")
			}
			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 2 ) {
				txtef COLOR_YELLOW
				txt lang("今日は絶好の仕事日和だ。", "It's a perfect day for work today.")
			}
			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 3 ) {
				txtef COLOR_YELLOW
				txt lang("今日は絶好の探索日和だ。", "It's a perfect day for exploring today.")
			}
			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 4 ) {
				txtef COLOR_YELLOW
				txt lang("今日は絶好の勉強日和だ。", "It's a perfect day for studying today.")
			}
		}
		if ( rnd(10) == 0 ) {
			gdata(GDATA_FLAG_NEGATE_SPAWN_FRON) = 0
		}
		else {
			gdata(GDATA_FLAG_NEGATE_SPAWN_FRON) = 1
		}
		if ( gdata(STARTING_GDATA_FLAG + 326) == 200 ) {
			gdata(STARTING_GDATA_FLAG + 326) = 100
		}
		if ( gdata(GDATA_AREA) != AREA_SEMINAR | gdata(GDATA_LEVEL) == 1 ) {
			gdata(STARTING_GDATA_FLAG + 330) = 0
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN ) {
			detect = 0
			kitune = 0
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_WEREWOLF | cdata(CDATA_ID, cnt) == CREATURE_ID_WEREWOLF_DETECTIVE ) {
					if ( cdata(CDATA_ALLIED, cnt) != 100 ) {
						if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
							if ( cdata(CDATA_RELATION_ORG, cnt) == 0 ) {
								kitune = 10
							}
						}
					}
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_DETECTIVE | cdata(CDATA_ID, cnt) == CREATURE_ID_WEREWOLF_DETECTIVE ) {
					if ( cdata(CDATA_ALLIED, cnt) != 100 ) {
						if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
							detect++
							cdata(CDATA_ROLE_SHOP_LEVEL, cnt) = 0
						}
					}
				}
			loop
			if ( kitune == 10 ) {
				if ( detect < 2 ) {
					if ( rnd(2) == 0 ) {
						txtef COLOR_YELLOW
						txt lang("探偵がやってきたようだ。「クン…こ、これは事件の匂い！！！」", "A detective seems to have come." + cnvtalk("*Sniff*... I smell a case!!"))
						if ( rnd(3) == 0 ) {
							flt
							characreate -1, CREATURE_ID_WEREWOLF_DETECTIVE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
						}
						else {
							flt
							characreate -1, CREATURE_ID_DETECTIVE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
						}
					}
				}
			}
			if ( kitune == 10 ) {
				gosub *random_event
			}
		}
		gosub *shop_turn
		repeat 9
			p = 120 + cnt
			if ( gdata(p) >= 10000 ) {
				gdata(p) = 10000
				continue
			}
			if ( cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8 ) {
				continue
			}
			gdata(STARTING_GDATA_RANK_NORMA + cnt)--
			if ( gdata(STARTING_GDATA_RANK_NORMA + cnt) <= 0 ) {
				modrank cnt, (gdata(p) / 12 + 100) * (-1)
				gdata(STARTING_GDATA_RANK_NORMA + cnt) = ranknorma(cnt)
			}
		loop
		snd SOUNDLIST_NIGHT
		evadd EVENT_QUEST_CHECK
		gdata(GDATA_DAY_PAST) += gdata(GDATA_HOUR) / 24
		gdata(GDATA_DAY) += gdata(GDATA_HOUR) / 24
		gdata(GDATA_HOUR) = gdata(GDATA_HOUR) \ 24
		if ( gdata(GDATA_DAY) >= 31 ) {
			gdata(GDATA_FLAG_MOST_EXPENSIVE_WORLD_MAP_VEHICLE_THIS_MONTH) = 0
			gdata(GDATA_MONTH)++
			gdata(GDATA_DAY) = gdata(GDATA_DAY) - 30
			gdata(GDATA_YACTECT_GEMSTONE_MSG) = 0
			if ( gdata(GDATA_MONTH) \ 2 == 0 ) {
				gdata(GDATA_FLAG_HOLY_WELL)++
			}
		}
		if ( gdata(GDATA_MONTH) == 2 & gdata(GDATA_DAY) == 1 ) {
			gdata(GDATA_FLAG_CAN_RECEIVE_CHOCOLATE) = 1
			gdata(GDATA_FLAG_CHOCOLATE_KIT_LIMIT) = 0
		}
		if ( gdata(GDATA_DAY) == 10 | gdata(GDATA_DAY) == 20 ) {
			gdata(GDATA_FLAG_PICNIC_BASKET_MAID_MANSION) = 100
		}
		if ( gdata(GDATA_MONTH) == 11 & gdata(GDATA_DAY) == 1 ) {
			gdata(GDATA_FLAG_TRUCE_GROUND_SUMMONING) = 0
		}
		if ( gdata(GDATA_MONTH) >= 13 ) {
			gdata(GDATA_YEAR)++
			gdata(GDATA_MONTH) = 1
			gdata(GDATA_GUILD_TRAINER) = 0
			gdata(GDATA_WELL_WISH) = limit(gdata(GDATA_WELL_WISH) - 1, 0, 3)
			gdata(GDATA_WALLET) = limit(gdata(GDATA_WALLET) - 50, 0, 99)
			if ( gdata(GDATA_YEARS_AFTER_VICTORY) > 0 ) {
				gdata(GDATA_YEARS_AFTER_VICTORY)++
			}
		}
		if ( gdata(GDATA_DAY) == 1 | gdata(GDATA_DAY) == 15 ) {
			gdata(GDATA_FLAG_MELGET_SCORE) = -1
		}
		if ( gdata(GDATA_DAY) == 1 | gdata(GDATA_DAY) == 15 ) {
			gosub *event_income
		}
		if ( gdata(GDATA_FLAG_SUB_KARAVIKA_OF_SONG_AND_DANCE) \ 3 == 1 ) {
			if ( gdata(GDATA_DAY) == 30 ) {
				gdata(GDATA_FLAG_SUB_KARAVIKA_OF_SONG_AND_DANCE)++
			}
		}
		if ( gdata(GDATA_FLAG_SUB_ARASIEL_OF_THE_SANDSTORM) != 0 ) {
			if ( gdata(GDATA_FLAG_SUB_ARASIEL_OF_THE_SANDSTORM_CREATURE) != 0 & rnd(20) == 0 | (gdata(GDATA_FLAG_SUB_ARASIEL_OF_THE_SANDSTORM_CREATURE) == 0 & rnd(2) == 0) ) {
				repeat
					flt 170
					characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
					if ( cdata(CDATA_RELATION, MAX_CHARA_NC) != (-3) ) {
						continue
					}
					if ( cdata(CDATA_QUALITY, MAX_CHARA_NC) >= FIX_QUALITY_MIRACLE ) {
						continue
					}
					if ( cdata(CDATA_LEVEL, MAX_CHARA_NC) < 100 ) {
						continue
					}
					break
				loop
				gdata(GDATA_FLAG_SUB_ARASIEL_OF_THE_SANDSTORM_CREATURE) = cdata(CDATA_ID, MAX_CHARA_NC)
				chara_vanquish MAX_CHARA_NC
				txt_questupdate
				txtef COLOR_PURPLE
				txt lang("ラシエルの気が変わったようだ。", "It seems that the mind of <Arasiel> has changed.")
			}
		}
		if ( gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM) >= 10 ) {
			if ( gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM) \ 10 == 0 ) {
				if ( adata(ADATA_ID, gdata(GDATA_AREA)) != AREA_DOCK ) {
					if ( rnd(10) == 0 ) {
						if ( gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM) >= 900 ) {
							gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM) = 10
						}
						snd SOUNDLIST_AMMO
						gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM)++
						snd SOUNDLIST_WRITE1
						txtef COLOR_GREEN
						txt lang("ジャーナルが更新された。", "Your journal has been updated.")
						txtef COLOR_RED
						txt lang("ガルジエムからの救援要請が入った。", "You have received a request for help from <Garziem>.")
					}
				}
			}
		}
		if ( gdata(GDATA_FLAG_SUB_AMURDAD) >= 10 & gdata(GDATA_FLAG_SUB_AMURDAD) \ 10 == 0 ) {
			if ( gdata(GDATA_AREA) != AREA_AMUR_CAGE ) {
				if ( rnd(10) == 0 ) {
					if ( gdata(GDATA_FLAG_SUB_AMURDAD) < 100 ) {
						gdata(GDATA_FLAG_SUB_AMURDAD) = 10
					}
					if ( gdata(GDATA_FLAG_SUB_AMURDAD) >= 900 ) {
						gdata(GDATA_FLAG_SUB_AMURDAD) = 100
					}
					snd SOUNDLIST_ENC
					gdata(GDATA_FLAG_SUB_AMURDAD)++
					snd SOUNDLIST_WRITE1
					txtef COLOR_GREEN
					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
					txtef COLOR_GREEN
					txt lang("ネヘルタードから依頼の電波を受けた。", "You have received a rescue request from <Amurdad>.")
				}
			}
		}
		if ( gdata(GDATA_FLAG_SUB_MOTHER) == 1 | gdata(GDATA_FLAG_SUB_MOTHER) == 3 | gdata(GDATA_FLAG_SUB_MOTHER) == 5 | gdata(GDATA_FLAG_SUB_MOTHER) == 7 | gdata(GDATA_FLAG_SUB_MOTHER) == 9 ) {
			if ( adata(ADATA_ID, gdata(GDATA_AREA)) != AREA_NOYEL ) {
				if ( rnd(20) == 0 ) {
					gdata(GDATA_FLAG_SUB_MOTHER)++
					txt_questupdate
				}
			}
		}
	}
	if ( mode == MODELIST_MAIN ) {
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			if ( rnd(40) == 0 ) {
				cdata(CDATA_PIETY, CHARA_PLAYER)--
			}
			cdata(CDATA_PRAY, CHARA_PLAYER) += 4
		}
		else {
			if ( rnd(5) == 0 ) {
				cdata(CDATA_PIETY, CHARA_PLAYER)--
			}
			cdata(CDATA_PRAY, CHARA_PLAYER) += 32
		}
	}
	if ( cdata(CDATA_PIETY, CHARA_PLAYER) < 0 ) {
		cdata(CDATA_PIETY, CHARA_PLAYER) = 0
	}
	if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) != 0 ) {
		if ( cdata(CDATA_ROW_ACT, CHARA_PLAYER) != ACTION_TRAVEL ) {
			gosub *screen_draw
		}
	}
	if ( gdata(GDATA_AREA) != AREA_SHELTER & gdata(GDATA_AREA) != AREA_JAIL & (gdata(GDATA_AREA) != AREA_CHAOS_CRADLE | gdata(GDATA_LEVEL) != 179) & (gdata(GDATA_AREA) != AREA_DOCK | gdata(GDATA_LEVEL) != 70) ) {
		gosub *random_event
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "Advance_hour:End" + " ct:" + ct
	return

*game_main
	if ( ct >= MAX_CHARA_TOTAL ) {
		goto *main_init
	}
	if ( cdata(CDATA_SPEED_SUM, ct) >= mdata(MDATA_TIMESCALE) ) {
		cdata(CDATA_SPEED_SUM, ct) -= mdata(MDATA_TIMESCALE)
	}
	else {
		ct++
		goto *game_main
	}
*game_main_redo
	cc = ct
	cdata(CDATA_TIME_SCALE, cc) = cdata(CDATA_SPEED_FIX, cc)
	cdata(CDATA_TURN, cc)++
	gosub *turn_init
	if ( ct == 0 ) {
		tnew = 1
		pcnoise = 0
		refreshspeed 0
		p = cdata(CDATA_TURN, CHARA_PLAYER) \ 10
		if ( p == 1 ) {
			repeat MAX_CHARA_FOLLOWER
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				r1 = cnt
				gosub *expRegen
				if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
					if ( cdata(CDATA_THIRST, cnt) >= 10000 ) {
						healsp cnt, 2, FALSE
					}
				}
			loop
		}
		if ( p == 2 ) {
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( findbuff(cnt, BUFF_REGENERATION) != (-1) ) {
					if ( cdata(CDATA_ROW_ACT, cnt) == ACTION_NONE ) {
						healsp cnt, 4, FALSE
					}
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					r1 = cnt
					gosub *expStealth
					r1 = cnt
					gosub *expArmor
					if ( gdata(GDATA_RIDER) != 0 ) {
						r1 = cnt
						gosub *expRiding
					}
				}
			loop
		}
		if ( p == 3 ) {
			repeat MAX_CHARA_FOLLOWER
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				r1 = cnt
				gosub *expWeightLifting
				r1 = cnt
				gosub *expSwimming
			loop
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_TURN, cnt) \ 4 == 0 ) {
				if ( cdata(CDATA_ROW_ACT, cnt) == ACTION_NONE ) {
					healsp cnt, 2, FALSE
				}
			}
		loop
		if ( gdata(GDATA_RETURN) != 0 ) {
*game_main_redo_WHILE1
			gdata(GDATA_RETURN)--
			if ( mdata(MDATA_TYPE) == MAP_TYPE_QUEST | gdata(GDATA_AREA) == AREA_SHELTER | gdata(GDATA_AREA) == AREA_JAIL | (gdata(GDATA_AREA) == AREA_AMUR_CAGE & gdata(GDATA_LEVEL) >= 10) ) {
				gdata(GDATA_RETURN) = 0
				txt lang("不思議な力が帰還を阻止した。", "A mysterious power prevents you from returning.")
				goto *game_main_redo_WEND1
			}
			if ( gdata(GDATA_RETURN) <= 0 & evnum == 0 ) {
				f = 0
				repeat MAX_CHARA_FOLLOWER - 1, 1
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cbit(CHARA_BIT_GUARD_TEMP, cnt) == 1 ) {
						if ( cdata(CDATA_ID, cnt) != CREATURE_ID_BELPHAT_THE_COSMIC_SWORD ) {
							f = 1
						}
					}
				loop
				if ( f ) {
					txt lang("今は帰還できない仲間を連れている。", "One of your allies prevents you from returning.")
					goto *game_main_redo_WEND1
				}
				if ( cdata(CDATA_BURDEN, CHARA_PLAYER) >= 4 ) {
					txt lang("どこからか声が聞こえた。「悪いが重量オーバーだ」", "Someone shouts, \"Sorry, overweight.\"")
					goto *game_main_redo_WEND1
				}
				if ( gdata(GDATA_TELEPORT_AREA) == gdata(GDATA_WORLD) ) {
					if ( gdata(GDATA_AREA) == gdata(GDATA_WORLD) ) {
						txt_nothinghappens
						goto *game_main_redo_WEND1
					}
				}
				gosub *check_return
				if ( stat == 1 ) {
					txtmore
					txt lang("あなたは法を犯した。", "You commit a crime.")
					modkarma CHARA_PLAYER, -10
				}
				snd SOUNDLIST_TELEPORT1
				txt lang("あなたは次元の扉を開けた。", "A dimensional door opens in front of you.")
				if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
					snd SOUNDLIST_FAIL1
					txt_duel2
					goto *game_main_redo_WEND1
				}
				if ( gdata(GDATA_CARGO_WEIGHT) > gdata(GDATA_CARGO_LIMIT) ) {
					txt lang("だが荷車が重すぎて帰還できなかった。", "Return failed because your cargo is too heavy.")
					goto *game_main_redo_WEND1
				}
				if ( gdata(GDATA_TELEPORT_AREA) == AREA_JAIL ) {
					txt lang("気まぐれな時の管理者により次元は歪められた！", "The capricious controller of time has changed your destination!")
				}
				msg_halt
				gosub *screen_draw
				levelexitby = 2
				goto *map_exit
			}
			goto *game_main_redo_WEND1
		}
*game_main_redo_WEND1
		gosub *mapEvent
		if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
			goto *pc_dead
		}
		if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
			if ( mdata(MDATA_FIELD) == 2 ) {
				if ( rnd(2) == 0 ) {
					if ( gdata(GDATA_RES_ETHERWIND) == 0 ) {
						modcorrupt 5 + limit(gdata(GDATA_TURN) / 20000, 0, 15)
					}
					else {
						if ( rnd(10) == 0 ) {
							modcorrupt 5
						}
					}
				}
				if ( gdata(GDATA_RES_ETHERWIND) == 0 | rnd(4) == 0 ) {
					if ( rnd(2000) == 0 ) {
						efid = SKILL_EFFECT_MUTATE
						efp = 100
						tc = cc
						gosub *effect
					}
				}
			}
		}
		else {
			if ( rnd(1500) == 0 ) {
				if ( adata(ADATA_ID, gdata(GDATA_AREA)) != AREA_HOME & gdata(GDATA_AREA) != AREA_SHELTER ) {
					modcorrupt 10
				}
			}
		}
	}
	tc = cc
	if ( map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) != 0 ) {
		ef = map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) - 1
		if ( mef(0, ef) == 3 ) {
			if ( cbit(CHARA_BIT_FLOAT, tc) == 0 | cdata(CDATA_CONDITION_GRAVITY, tc) > 0 ) {
				if ( findbuff(tc, BUFF_GRAVITY_ACCEL) == (-1) ) {
					if ( sdata(SKILL_RESDMG_ACID, tc) / 50 < 7 ) {
						if ( synccheck(tc, -1) ) {
							snd SOUNDLIST_WATER2
							txt lang(name(tc) + "は酸に焼かれた。", name(tc) + " melt" + _s(tc) + ".")
						}
						if ( mef(6, ef) == 0 ) {
							if ( tc != CHARA_PLAYER ) {
								hostileaction CHARA_PLAYER, tc
							}
						}
						dmghp tc, rnd(mef(5, ef) / 25 + 5) + 1, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, mef(5, ef)
						if ( stat == 0 ) {
							check_kill mef(6, ef), tc
						}
					}
				}
			}
		}
		if ( mef(0, ef) == 5 ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_FIRE1
				txt lang(name(tc) + "は燃えた。", name(tc) + " " + is(tc) + " burnt.")
			}
			if ( mef(6, ef) == 0 ) {
				if ( tc != CHARA_PLAYER ) {
					hostileaction CHARA_PLAYER, tc
				}
			}
			if ( mef(MEF_POWER, ef) >= 0 ) {
				dmghp tc, mef(MEF_POWER, ef) / 12 + rnd(mef(MEF_POWER, ef) / 12 + 5), DAMAGE_FROM_FIRE, SKILL_RES_FIRE, mef(MEF_POWER, ef)
			}
			if ( mef(MEF_POWER, ef) < 0 ) {
				dmgmp tc, rnd(10) - mef(MEF_POWER, ef) / 100
			}
			if ( stat == 0 ) {
				check_kill mef(6, ef), tc
			}
		}
		if ( mef(0, ef) == 6 ) {
			if ( cbit(CHARA_BIT_FLOAT, tc) == 0 | cdata(CDATA_CONDITION_GRAVITY, tc) > 0 ) {
				if ( findbuff(tc, BUFF_GRAVITY_ACCEL) == (-1) ) {
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_WATER2
						txt lang(name(tc) + "は地面の液体を浴びた。", name(tc) + " step" + _s(tc) + " in the pool.")
						txtmore
					}
					wet tc, 25
					if ( mef(6, ef) == 0 ) {
						if ( tc != CHARA_PLAYER ) {
							hostileaction CHARA_PLAYER, tc
						}
					}
					potionspill = 1
					efstatus = mef(8, ef)
					dbmode = DBMODE_ON_DRINK
					dbid = mef(7, ef)
					gosub *db_item
					if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_DEAD ) {
						check_kill mef(6, ef), tc
					}
					delmef ef
				}
			}
		}
	}
	if ( cdata(STARTING_CDATA_BUFF + 0 * ARRAY_CDATA_BUFF, cc) != 0 ) {
		repeat MAX_BLESSINGS + MAX_HEXES
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, cc) == 0 ) {
				break
			}
			cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF + 2, cc)--
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF + 2, cc) <= 0 ) {
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, cc) == BUFF_DEATH_WORD ) {
					dmghp cc, cdata(CDATA_MAX_HP, cc) + 1, DAMAGE_FROM_UNSEEN
				}
				delbuff cc, cnt
				continue cnt
			}
		loop
	}
	if ( cc == CHARA_PLAYER ) {
		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
			if ( gdata(GDATA_LEVEL) >= 10 ) {
				if ( soulimit <= 0 ) {
					await 60
					sxfix = 0
					syfix = 0
					gosub *screen_draw
					if ( soulstage >= 2 ) {
						soulstage = 0
						chara_vanquish findallyguard(CREATURE_ID_STRAY_SOUL)
					}
					evadd EVENT_AMURDEAD_SUB_CREATE_STAIRS, 0
					goto *turn_end
				}
			}
		}
	}
	if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) == 1 ) {
		if ( cdata(CDATA_CONDITION_PARALYZE, cc) == 0 ) {
			if ( rnd(2) == 0 ) {
				cdata(CDATA_CONDITION_PARALYZE, cc) = 1
			}
		}
	}
	if ( cbit(CHARA_BIT_BIRTHED_CHILD, cc) == TRUE ) {
		if ( cdata(CDATA_CONDITION_SLEEP, cc) == 0 ) {
			if ( cdata(CDATA_SPRITE_SIZE_MILK, cc) == (-5) ) {
				if ( rnd(100) < 5 ) {
					txt lang(cdatan(CDATAN_NAME, cc) + "はスヤスヤと眠り始めた…。", cdatan(CDATAN_NAME, cc) + " fell asleep soundly...")
					cdata(CDATA_CONDITION_SLEEP, cc) = rnd(301) + 100
				}
			}
			if ( cdata(CDATA_SPRITE_SIZE_MILK, cc) == (-4) ) {
				if ( rnd(100) < 5 ) {
					txt lang(cdatan(CDATAN_NAME, cc) + "はまるで電池が切れたように急に眠り始めた…。", cdatan(CDATAN_NAME, cc) + " suddenly fell asleep as if the battery had run out...")
					cdata(CDATA_CONDITION_SLEEP, cc) = rnd(151) + 50
				}
			}
			if ( cdata(CDATA_SPRITE_SIZE_MILK, cc) == (-3) ) {
				if ( rnd(100) < 5 ) {
					if ( gdata(GDATA_HOUR) <= 6 | gdata(GDATA_HOUR) >= 23 ) {
						txt lang(cdatan(CDATAN_NAME, cc) + "は遊び疲れて眠り始めた…。", cdatan(CDATAN_NAME, cc) + " got tired of playing and fell asleep...")
						cdata(CDATA_CONDITION_SLEEP, cc) = rnd(151) + 50
					}
				}
			}
			if ( cdata(CDATA_SPRITE_SIZE_MILK, cc) == (-2) ) {
				if ( rnd(100) < 2 ) {
					if ( gdata(GDATA_HOUR) <= 6 | gdata(GDATA_HOUR) >= 23 ) {
						txt lang(cdatan(CDATAN_NAME, cc) + "はあくびをすると、静かに眠り始めた…。", cdatan(CDATAN_NAME, cc) + " yawned and went to sleep...")
						cdata(CDATA_CONDITION_SLEEP, cc) = rnd(151) + 50
					}
				}
			}
		}
	}
	if ( cdata(CDATA_CONDITION_SUFFOCATION, cc) >= 15 | cdata(CDATA_CONDITION_SLEEP, cc) > 0 | cdata(CDATA_CONDITION_PARALYZE, cc) > 0 | cdata(CDATA_CONDITION_DIM, cc) >= 60 | (findbuff(cc, BUFF_MELANCHOLY) != (-1) & rnd(10) == 0) ) {
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_CONDITION_SUFFOCATION, cc) >= 15 ) {
				await 120
			}
			await 60
			sxfix = 0
			syfix = 0
			gosub *screen_draw
		}
		goto *turn_end
	}
	if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 5) != 0 ) {
		if ( mapitemfind(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), ITEM_ID_LULWYS_PHOTO_COLLECTION) != (-1) ) {
			if ( cdata(CDATA_ID, cc) != CREATURE_ID_LULWY & cdata(CDATA_ID, cc) != CREATURE_ID_DEVASTATE_LULWY ) {
				if ( rnd(20) == 0 ) {
					cdata(CDATA_EMO_ICON, cc) = 20 + 100
					kaiwa = rnd(3)
					if ( kaiwa == 0 ) {
						txt lang("「うわ…これ大丈夫なの" + _kana(3) + "？」", cnvtalk("Wow... Is this really okay?"))
					}
					if ( kaiwa == 1 ) {
						txt lang("「過激" + _dana(3) + "…」", cnvtalk("Too extreme..."))
					}
					if ( kaiwa == 2 ) {
						txt lang("「こ、これは！？」", cnvtalk("C-could this be!?"))
					}
					txtef COLOR_PURPLE
					txt lang(name(cc) + "はページをめくっている…。", name(cc) + " turn" + _s(cc) + " the page...")
					snd SOUNDLIST_BOOK1
					goto *turn_end
				}
				if ( rnd(10) == 0 ) {
					kaiwa = rnd(3)
					if ( kaiwa == 0 ) {
						txt lang("「わけがわからない" + _yo(3) + "」", cnvtalk("I don't get it!"))
					}
					if ( kaiwa == 1 ) {
						txt lang("「全裸が些細なことに思えるレベル" + _dana(3) + "…」", cnvtalk("This seems like a trivial level of nudity..."))
					}
					if ( kaiwa == 2 ) {
						txt lang("「なぁにこれぇ…」", cnvtalk("What's this?"))
					}
					dmgcon cc, CONDITION_CONFUSE, 100 + gdata(GDATA_LEVEL) * 2
				}
			}
		}
	}
	if ( cdata(CDATA_CONDITION_DRUNK, cc) != 0 ) {
		partyTimeDrunkkeness = 0
		if ( TweakData(TWEAK_AI_INCREASED_PARTYTIME_DRUNKENNESS , TWEAK_CATEGORY_AI) != 0 && gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
			partyTimeDrunkkeness = TweakData(TWEAK_AI_INCREASED_PARTYTIME_DRUNKENNESS , TWEAK_CATEGORY_AI)
		}
		if ( rnd(200 - int(partyTimeDrunkkeness * 1.99) ) == 0 ) {
			if ( cc != CHARA_PLAYER ) {
				repeat MAX_CHARA_TOTAL
					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > 5 ) {
						continue
					}
					if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) == 0 ) {
						continue
					}
					if ( cnt == cc | rnd(3) | mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
						continue
					}
					tc = cnt
					if ( synccheck(cc, -1) | synccheck(tc, -1) ) {
						txtef COLOR_SKY_BLUE
						txt lang(name(cc) + "は酔っ払って" + name(tc) + "にからんだ。", name(cc) + " gets the worse for drink and catches " + name(tc) + ".")
						txt lang("「一杯どうだい？」", cnvtalk("Have a drink baby.")), lang("「飲んでないよ」", cnvtalk("What are you looking at?")), lang("「何見てるのさ」", cnvtalk("I ain't drunk.")), lang("「遊ぼうぜ」", cnvtalk("Let's have fun."))
					}
					if ( rnd(4 - int(partyTimeDrunkkeness * 0.039) ) == 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( synccheck(cc, -1) | synccheck(tc, -1) ) {
								txtef COLOR_SKY_BLUE
								txt lang(name(tc) + "はカチンときた。", name(tc) + " is pretty annoyed with the drunkard.")
								txt lang("「酔っ払いにはうんざり！」", cnvtalk("Your time is over, drunk!"))
							}
							cdata(CDATA_AI_AGGRO, tc) = 20
							cdata(CDATA_TARGET, tc) = cc
							cdata(CDATA_EMO_ICON, tc) = 18 + 100 * 2
						}
					}
					break
				loop
			}
		}
	}
	if ( cdata(CDATA_CONDITION_DRUNK, cc) >= 45 | cdata(CDATA_HUNGER, cc) > 35000 ) {
		if ( rnd(60 + cdata(CDATA_ALCOHOL_CONSUMED, cc) * 5) == 0 ) {
			chara_vomit cc
			goto *turn_end
		}
	}
	if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_THIRST, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
		if ( cdata(CDATA_THIRST, cc) > 35000 ) {
			if ( rnd(60) == 0 ) {
				chara_morasi cc
				goto *turn_end
			}
		}
	}
	if ( cdata(CDATA_ROW_ACT_WARNING, cc) == 1 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_ROW_ACT, cc) != ACTION_PERFORM_DANCE & cdata(CDATA_ROW_ACT, cc) != ACTION_EAT & cdata(CDATA_ROW_ACT, cc) != ACTION_READ & cdata(CDATA_ROW_ACT, cc) != ACTION_TRAVEL & cdata(CDATA_ROW_ACT, cc) != ACTION_WRITING ) {
				rtval = 0
			}
			else {
				screenupdate = -1
				gosub *screen_draw
				gosub *com_rowActCancel
			}
		}
		if ( findbuff(cc, BUFF_HARMONIC_ASSAULT) != (-1) ) {
			if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PERSUASION | cdata(CDATA_ROW_ACT, cc) == ACTION_PECULIAR_JOKE | cdata(CDATA_ROW_ACT, cc) == ACTION_BLENDED_LIE | cdata(CDATA_ROW_ACT, cc) == ACTION_INTIMIDATION | cdata(CDATA_ROW_ACT, cc) == ACTION_MYSTERIOUS_SONG ) {
				rtval = 2
			}
		}
		if ( cdata(CDATA_ROW_ACT, cc) != ACTION_CHARGE & cdata(CDATA_ROW_ACT, cc) != ACTION_MEAL & cdata(CDATA_ROW_ACT, cc) != ACTION_XMAS_CAKE ) {
			if ( cc != CHARA_PLAYER | rtval == 0 ) {
				if ( rtval != 2 ) {
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は" + actlistn(cdata(CDATA_ROW_ACT, cc)) + "を中断した。", name(cc) + " stop" + _s(cc) + " " + actlistn(cdata(CDATA_ROW_ACT, cc)) + ".")
					}
					if ( cdata(CDATA_ID, cc) == CREATURE_ID_KARAVIKA ) {
						if ( cc >= MAX_CHARA_FOLLOWER ) {
							if ( gdata(GDATA_FLAG_SUB_KARAVIKA_OF_SONG_AND_DANCE) \ 3 == 2 ) {
								if ( gdata(GDATA_AREA) == AREA_OL_DRAN & gdata(GDATA_LEVEL) == 5 ) {
									gdata(GDATA_FLAG_SUB_KARAVIKA_OF_SONG_AND_DANCE)--
									evadd EVENT_KARAVIKA_SETUP_MAP, 0
								}
							}
						}
					}
					rowactend cc
 				}
			}
		}
		screenupdate = -1
		gosub *screen_draw
		cdata(CDATA_ROW_ACT_WARNING, cc) = 0
	}
	if ( cdata(CDATA_TURN, cc) \ 25 == 0 ) {
		if ( cdata(CDATA_CURSE, cc) != 0 ) {
			gosub *curse
		}
		if ( cbit(CHARA_BIT_RES_CURSE, cc) ) {
			gosub *curse_enc
		}
		if ( cbit(CHARA_BIT_PREGNANT, cc) ) {
			gosub *pregnant
		}
	}
	if ( cdata(CDATA_ROW_ACT, cc) != ACTION_NONE ) {
		ci = cdata(CDATA_ITEM_USING, cc)
		cdata(CDATA_ACTION_PERIOD, cc)--
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_FISH ) {
			at 40
			gosub *fishing
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_DIG ) {
			at 15
			gosub *dig
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PLANT ) {
			at 15
			gosub *plant
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_SEARCH ) {
			at 15
			gosub *search
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_REST ) {
			at 5
			gosub *rest
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_EAT ) {
			at 100
			goto *act_eat
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_READ ) {
			at 25
			goto *act_read
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_SEX ) {
			at 50
			gosub *sexsex
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_TUIN_DER_LUSTEN ) {
			at 50
			gosub *skill_tuin_der_lusten
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_CHARGE ) {
			at 5
			gosub *skill_charge
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_MEAL ) {
			at 5
			gosub *eat_meal
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_XMAS_CAKE ) {
			at 5
			gosub *eat_meal_xmas_cake
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PERSUASION ) {
			at 5
			gosub *skill_persuasion
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PECULIAR_JOKE ) {
			at 5
			gosub *skill_peculiar_joke
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_BLENDED_LIE ) {
			at 5
			gosub *skill_blended_lie
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_INTIMIDATION ) {
			at 5
			gosub *skill_intimidation
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_MYSTERIOUS_SONG ) {
			at 5
			gosub *skill_mysterious_song
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_A ) {
			at 5
			gosub *row_act_work
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_B ) {
			at 5
			gosub *row_act_work
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WORK_C ) {
			at 5
			gosub *row_act_work
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_GENERAL ) {
			if ( gdata(GDATA_ROW_ACT) == ACTION_HARVEST ) {
				at 40
			}
			else {
				if ( gdata(GDATA_ROW_ACT) == ACTION_TRAIN ) {
					at 40
				}
				else {
					if ( gdata(GDATA_ROW_ACT) == ACTION_STEAL ) {
						at 50
					}
					else {
						at 20
					}
				}
			}
			gosub *generalAct
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_BLEND ) {
			at 20
			gosub *blend
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PERFORM ) {
			at 40
			gosub *perform
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PERFORM_PREACH ) {
			at 40
			gosub *perform_preach
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_BEGGING ) {
			at 40
			gosub *perform_begging
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_PERFORM_DANCE ) {
			at 40
			gosub *perform_dance
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_WRITING ) {
			at 40
			gosub *start_writing
		}
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_TRAVEL ) {
			gosub *travel
			goto *act_move
		}
		if ( cdata(CDATA_ACTION_PERIOD, cc) > 0 ) {
			goto *turn_end
		}
		rowactend cc
		if ( cc == CHARA_PLAYER ) {
			if ( chatteleport == 1 ) {
				chatteleport = 0
				goto *map_exit
			}
		}
	}
	if ( cbit(CHARA_BIT_REFRESH, cc) ) {
		r1 = cc
		gosub *charaRefresh
	}
	if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
		if ( cc == CHARA_PLAYER ) {
 			gdata(GDATA_FLAG_ACTION_TALON_SOLDIER) = 0
		}
		else {
			if ( cdata(CDATA_ID, cc) == CREATURE_ID_TALON_SOLDIER | cdata(CDATA_ID, cc) == CREATURE_ID_TEZCATLIPOCA | cdata(CDATA_ID, cc) == CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA ) {
 				gdata(GDATA_FLAG_ACTION_TALON_SOLDIER) = 100
			}
			else {
 				gdata(GDATA_FLAG_ACTION_TALON_SOLDIER) = 0
			}
		}
	}
	if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
		if ( ct == 0 ) {
			goto *pc_turn_init
		}
		else {
			goto *ai_turn
		}
	}
	goto *game_main

*turn_init
	cdata(CDATA_EMO_ICON, cc) -= 100
	if ( cdata(CDATA_EMO_ICON, cc) < 0 ) {
		cdata(CDATA_EMO_ICON, cc) = 0
	}
	if ( mdata(MDATA_FIELD) == 2 ) {
		if ( gdata(GDATA_WEATHER) >= WEATHER_RAIN ) {
			cdata(CDATA_CONDITION_WET, cc) = 25
		}
	}
	if ( cdata(CDATA_EXP, cc) >= cdata(CDATA_EXP_TO_NEXT_LVL, cc) ) {
		if ( cc == CHARA_PLAYER ) {
			snd SOUNDLIST_DING1
			msgalert = 1
		}
		r1 = cc
		r2 = 0
		gosub *calcLevelUp
		goto *turn_init
	}
	return

*turn_end
	buffact = 0

	/********** ANNA CUSTOM - BEGINNING **********/

	if ( PreservedTarget != (-1) ) {
		tc = TrueTarget
		PreservedTarget = -1
	}

	/********** ANNA CUSTOM - ENDING **********/

	cc = ct
	if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
		goto *game_main
	}
	hear = 0
	r1 = cc
	gosub *calcCondition
	if ( cc == CHARA_PLAYER ) {
		chatturn = 10
		if ( gdata(GDATA_SLEEP_GENE) != 0 ) {
			if ( gdata(GDATA_SLEEP_GENE) < 10000 ) {
				gdata(GDATA_SLEEP_GENE) += 10000
				gdata(GDATA_ROW_ACT) = ACTION_SLEEP
				gosub *generalAct
			}
		}
		if ( cdata(CDATA_BURDEN, CHARA_PLAYER) >= 3 ) {
			if ( rnd(20) == 0 ) {
				txt lang(name(CHARA_PLAYER) + "は荷物に圧迫されもがいた。", "Your backpack is squashing you!")
				dmghp cc, cdata(CDATA_MAX_HP, cc) * (cdata(CDATA_INV_WEIGHT, CHARA_PLAYER) * 10 / cdata(CDATA_CARRY_LIMIT, CHARA_PLAYER) + 10) / 200 + 1, DAMAGE_FROM_BURDEN
			}
		}
		refreshspeed cc
		procid = (procid + 1) \ 4
		proclist(procid) = "turn_end:pc" + " ct:" + ct
	}
	else {
	}
	if ( gdata(GDATA_TIME_STOP_TIME) > 0 ) {
		gdata(GDATA_TIME_STOP_TIME)--
		if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE | gdata(GDATA_TIME_STOP_TIME) == 0 ) {
			if ( gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
				snd SOUNDLIST_ATK_DARK
				animeload 42, cc
				txtef COLOR_SKY_BLUE
				txt lang("時は再び動き出した。", "Time starts to run again.")
			}
		}
		else {
			if ( cc != CHARA_PLAYER ) {
				gosub *screen_draw
				await 200
			}
			txtef COLOR_SKY_BLUE
			txt " *tick* "
			gdata(GDATA_FLAG_STOP_TIME_OTHER_CHARA_INDEX) = 0
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cnt == cc ) {
					continue
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
						continue
					}
				}
				if ( cc >= MAX_CHARA_FOLLOWER ) {
					if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
						continue
					}
				}
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_MIKRAANESIS ) {
					gdata(GDATA_FLAG_STOP_TIME_OTHER_CHARA_INDEX) = cnt
					break
				}
			loop
			if ( gdata(GDATA_FLAG_STOP_TIME_OTHER_CHARA_INDEX) != 0 ) {
				if ( gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
					gdata(GDATA_FLAG_STOP_TIME_OTHER) = gdata(GDATA_TIME_STOP_TIME) + 1
				}
			}
			goto *game_main_redo
		}
	}
	if ( gdata(GDATA_FLAG_STOP_TIME_OTHER) > 0 ) {
		if ( cc == gdata(GDATA_FLAG_STOP_TIME_OTHER_CHARA_INDEX) & cc != CHARA_PLAYER ) {
			gdata(GDATA_FLAG_STOP_TIME_OTHER)--
			if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE | gdata(GDATA_FLAG_STOP_TIME_OTHER) == 0 ) {
				snd SOUNDLIST_ATK_DARK
				animeload 42, cc
				txtef COLOR_SKY_BLUE
				txt lang("時は再び動き出した。", "Time starts to run again.")
			}
			else {
				if ( cc != CHARA_PLAYER ) {
					gosub *screen_draw
					await 200
				}
				txtef COLOR_SKY_BLUE
				txt " *tick* "
				goto *game_main_redo
			}
		}
	}

	if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_CURTAIN_CALL, TWEAK_CATEGORY_GAMEPLAY) == FALSE ) {
		if ( gdata(GDATA_FLAG_CURTAIN_CALL) > 9999 ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
				evadd EVENT_RAGNAROK, 0
				repeat 4
					flt , 5
					initlv = 1800
					characreate -1, CREATURE_ID_LAST_DANCER, -3, 0
					cbitmod CHARA_BIT_SUMMONED, rc, TRUE
					cdata(CDATA_TARGET, rc) = 0
					cdata(CDATA_AI_AGGRO, rc) = 300
				loop
				gdata(GDATA_FLAG_CURTAIN_CALL) = -9999
			}
		}
	}

	goto *game_main

*pc_turn_init

	/********** ANNA CUSTOM - BEGINNING **********/ // Initialize tweak variable

	if ( TweakData(99, 0) == 0 ) {
		repeat 5
			LoopCount = 0

			while ( LoopCount < 100 )
				TweakData(LoopCount, cnt) = 0
				LoopCount++
			wend
		loop

		TweakData(99, 0) = 1
	}

	/********** ANNA CUSTOM - ENDING **********/

	procid = (procid + 1) \ 4
	proclist(procid) = "pc_turn_init" + " ct:" + ct
	if ( gdata(GDATA_GOD_TALK) ) {
		if ( rnd(1000) == 0 ) {
			txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_RANDOM
		}
	}
	gdata(GDATA_EQUIP_CHANGE) = 0
	tgloc = 0
	if ( gdata(GDATA_RIDER) != 0 ) {
		cdata(CDATA_X, gdata(GDATA_RIDER)) = cdata(CDATA_X, CHARA_PLAYER)
		cdata(CDATA_Y, gdata(GDATA_RIDER)) = cdata(CDATA_Y, CHARA_PLAYER)
	}
	if ( cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER) > 0 ) {
		cdata(CDATA_X, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) = cdata(CDATA_X, CHARA_PLAYER)
		cdata(CDATA_Y, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) = cdata(CDATA_Y, CHARA_PLAYER)
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1) = 0 + 1
	}
	if ( gdata(GDATA_CORRUPTION) >= 20000 ) {
		dmghp CHARA_PLAYER, 999999, DAMAGE_FROM_CORRUPT
	}
	if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
		goto *pc_dead
	}
	if ( gdata(GDATA_RUN) ) {
		await 10
		repeat 3
			y = cdata(CDATA_Y, CHARA_PLAYER) + cnt - 1
			if ( y < 0 | y <= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat 3
				x = cdata(CDATA_X, CHARA_PLAYER) + cnt - 1
				if ( x < 0 | x <= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( map(x, y, 1) != 0 ) {
					p = map(x, y, 1) - 1
					if ( p != 0 ) {
						if ( cdata(CDATA_RELATION, p) <= (-3) ) {
							gdata(GDATA_RUN) = 0
						}
					}
				}
			loop
		loop
		x = cdata(CDATA_X, CHARA_PLAYER)
		y = cdata(CDATA_Y, CHARA_PLAYER)
		cdata(CDATA_X_NEW, CHARA_PLAYER) = x + dirxy(0, gdata(GDATA_RUN_DIR))
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = y + dirxy(1, gdata(GDATA_RUN_DIR))
		if ( map(x, y, 5) != 0 ) {
			gdata(GDATA_RUN) = 0
		}
		if ( map(x, y, 6) != 0 & map(x, y, 6) != 999 ) {
			gdata(GDATA_RUN) = 0
		}
		cell_check cdata(CDATA_X, cc) + 1, cdata(CDATA_Y, cc)
		if ( cellaccess != gdata(GDATA_RUN_RIGHT) ) {
			if ( cellchara > MAX_CHARA_FOLLOWER | cellchara == (-1) ) {
				gdata(GDATA_RUN) = 0
			}
		}
		cell_check cdata(CDATA_X, cc) - 1, cdata(CDATA_Y, cc)
		if ( cellaccess != gdata(GDATA_RUN_LEFT) ) {
			if ( cellchara > MAX_CHARA_FOLLOWER | cellchara == (-1) ) {
				gdata(GDATA_RUN) = 0
			}
		}
		cell_check cdata(CDATA_X, cc), cdata(CDATA_Y, cc) + 1
		if ( cellaccess != gdata(GDATA_RUN_DOWN) ) {
			if ( cellchara > MAX_CHARA_FOLLOWER | cellchara == (-1) ) {
				gdata(GDATA_RUN) = 0
			}
		}
		cell_check cdata(CDATA_X, cc), cdata(CDATA_Y, cc) - 1
		if ( cellaccess != gdata(GDATA_RUN_UP) ) {
			if ( cellchara > MAX_CHARA_FOLLOWER | cellchara == (-1) ) {
				gdata(GDATA_RUN) = 0
			}
		}
		cell_check cdata(CDATA_X_NEW, CHARA_PLAYER), cdata(CDATA_Y_NEW, CHARA_PLAYER)
		if ( cellaccess == 0 ) {
			if ( cellchara > MAX_CHARA_FOLLOWER | cellchara == (-1) ) {
				gdata(GDATA_RUN) = 0
			}
		}
	}
	if ( autosave ) {
		autosave = 0

		/********** ORIGINAL - BEGINNING **********

		if ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 ) {
			if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) {
				if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
					snd SOUNDLIST_WRITE1
					gosub *game_save
					txtmore
					txtef COLOR_YELLOW
					txt_saving
				}
			}
		}

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Re-enable save-scumming.

		if ( ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 & gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) | TweakData(TWEAK_GAMEPLAY_ENABLE_SAVE_SCUMMING, TWEAK_CATEGORY_GAMEPLAY) == 0 ) {

		/********** BLOODYSHADE CUSTOM - ENDING **********/

			if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
				snd SOUNDLIST_WRITE1
				gosub *game_save
				txtmore
				txtef COLOR_YELLOW
				txt_saving
			}
		}
	}
	if ( autosave2 ) {
		autosave2 = 0

		/********** ORIGINAL - BEGINNING **********

		if ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 ) {
			if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) {
				if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
					gosub *game_save
					txtmore
					txtef COLOR_BLUE
					txt_saving
				}
			}
		}

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Re-enable save-scumming.

		if ( ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 & gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) | TweakData(TWEAK_GAMEPLAY_ENABLE_SAVE_SCUMMING, TWEAK_CATEGORY_GAMEPLAY) == 0 ) {

		/********** BLOODYSHADE CUSTOM - ENDING **********/

			if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
				gosub *game_save
				txtmore
				txtef COLOR_BLUE
				txt_saving
			}
		}
	}
	if ( autosave3 ) {
		autosave3 = 0

		/********** ORIGINAL - BEGINNING **********

		if ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 ) {
			if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) {
				if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
					gosub *game_save
				}
			}
		}

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Re-enable save-scumming.

		if ( ( dbg_noautosave == 0 & gdata(GDATA_WIZARD) == 0 & gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_PURGE ) | TweakData(TWEAK_GAMEPLAY_ENABLE_SAVE_SCUMMING, TWEAK_CATEGORY_GAMEPLAY) == 0 ) {

		/********** BLOODYSHADE CUSTOM - ENDING **********/

			if ( gdata(GDATA_AREA) != AREA_PET_ARENA ) {
				gosub *game_save
			}
		}
	}
	if ( autoturn == 1 ) {
		autoturn = 0
		gosub *screen_draw
	}
	else {
		gosub *screen_draw
	}
	if ( gdata(GDATA_AREA) == AREA_PET_ARENA ) {
		gdata(GDATA_QUEST_STATUS) = QUEST_STATE_SUCCESS
		f = 0
		repeat MAX_CHARA_FOLLOWER, 1
			if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
				if ( cdata(CDATA_RELATION, cnt) == 10 ) {
					f = 1
					break
				}
			}
		loop
		if ( f == 0 ) {
			if ( petarenawin == 0 ) {
				petarenawin = 2
			}
		}
		if ( petarenawin != 0 ) {
			gosub *quest_petArenaWin
			msg_halt
			levelexitby = 4
			snd SOUNDLIST_EXITMAP1
			repeat MAX_CHARA_FOLLOWER
				if ( arenaop == 0 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALLY_DEAD ) {
							continue
						}
					}
				}
				if ( petarenawin != 1 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALLY_DEAD ) {
							if ( rnd(5) == 0 ) {
								continue
							}
						}
					}
				}
				cdata(CDATA_EXIST, cnt) = followerexist(cnt)
			loop
			gdata(GDATA_FLAG_CURTAIN_CALL) = 0
			goto *map_exit
		}
*pc_turn_init_WHILE1
		await cfg_wait1
		cdata(CDATA_DIR, CHARA_PLAYER) = 0
		key_check
		f = 0
		repeat 16
			if ( key == key_south | key == key_west ) {
				p = 16 - 1 - cnt
			}
			else {
				p = cnt
			}
			if ( cdata(CDATA_EXIST, p) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( p == 0 ) {
				continue
			}
			if ( cdata(CDATA_RELATION, p) != 10 ) {
				continue
			}
			if ( cdata(CDATA_EXIST, camera) != CHAR_STATE_ALIVE | camera == CHARA_PLAYER ) {
				camera = p
				break
			}
			if ( key == key_north | key == key_east ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p > camera ) {
					camera = p
					key = ""
					break
				}
			}
			if ( key == key_south | key == key_west ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p < camera ) {
					camera = p
					key = ""
					break
				}
			}
		loop
		if ( f == 1 ) {
			key = ""
		}
		gosub *screen_draw
		if ( gdata(GDATA_FLAG_CURTAIN_CALL) > 999 ) {
			snd SOUNDLIST_GONG
			txtef COLOR_RED2
			txt lang("*判定負け*", "*Loss on points*")
			gdata(STARTING_GDATA_FLAG + 373) = 0
			await 1000
			petarenawin = 2
			goto *turn_end
		}
		if ( key == key_goup | key_escape == 1 ) {
			txt lang("試合を放棄する？", "Do you want to give up the game?")
			promptYesNo
			if ( rtval == 0 ) {
				petarenawin = 2
				goto *turn_end
			}
			goto *pc_turn_init_WHILE1_CONTINUE
		}
		if ( key != key_cancel ) {
			if ( key != "" ) {
				goto *turn_end
			}
		}
*pc_turn_init_WHILE1_CONTINUE
		goto *pc_turn_init_WHILE1
	}
*pc_turn_init_WEND1
 	if ( dbg_titleinfo ) {
		title VARIANT_NAME + " ver " + VERSION_STRING + " " + exedir + " Seed: " + randseed + "  Loop:" + looplev + " SubLoop:" + sublev + " x:" + cdata(CDATA_X, CHARA_PLAYER) + " y:" + cdata(CDATA_Y, CHARA_PLAYER) + " ev:" + evnum + " q:" + gdata(GDATA_QUEST) + " tile:" + map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), MAP_TILE_ID) + " unpc:" + usernpcmax + "/" + gdata(GDATA_USERNPC_COUNT)
 	}
	if ( trait(TRAIT_ETHER_ADDICTED_POTION) != 0 ) {
		if ( rnd(5) == 0 ) {
			inv_getheader 0
			ci = rnd(invrange) + invhead
			if ( inv(INV_ITEM_NUM, ci) > 0 ) {
				if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION ) {
					dbmode = DBMODE_ON_DRINK
					dbid = inv(INV_ITEM_ID, ci)
					gosub *db_item
				}
			}
		}
	}
	if ( trait(TRAIT_ETHER_RANDOM_TELEPORT) != 0 ) {
		if ( rnd(250) == 0 ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
				efid = SKILL_SPELL_TELEPORT
				gosub *effect
			}
		}
	}
	if ( cbit(CHARA_BIT_INVISIBLE, cdata(CDATA_TARGET, CHARA_PLAYER)) == 1 ) {
		if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == 0 ) {
			if ( cdata(CDATA_CONDITION_WET, cdata(CDATA_TARGET, CHARA_PLAYER)) == 0 ) {
				cdata(CDATA_TARGET, CHARA_PLAYER) = 0
			}
		}
	}
	t = 1
	keylog = ""
	key = ""
	objprm 0, ""

*pc_turn
	if ( firstturn == 1 ) {
		if ( gdata(GDATA_GOD_TALK) ) {
			txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_WELCOME
		}
		firstturn = 0
	}
	if ( gdata(GDATA_EQUIP_CHANGE) ) {
		if ( cdata(CDATA_CONDITION_BRAINWASH, CHARA_PLAYER) == 0 ) {
			txt lang("装備を変更した。", "You change your equipment.")
		}
		goto *turn_end
	}
	t++
	if ( cdata(CDATA_CHAIN_ATTACK_COUNT, CHARA_PLAYER) != 0 ) {
		cdata(CDATA_CHAIN_ATTACK_COUNT, CHARA_PLAYER) = 0
	}
	if ( t \ cfg_scrsync == 1 ) {
		scrturn++
		gosub *screen_sync
	}
	if ( cfg_net ) {
		if ( cfg_netwish ) {
			if ( key == "" ) {
				chatturn++
				if ( chatturn \ 250 == 1 ) {
					net_read
					notesel chatnew
					repeat noteinfo(0)
						noteget s, noteinfo(0) - cnt - 1
						s(1) = strmid(s, 4, 9999), strmid(s, 0, 4)
						if ( s(2) == "chat" ) {
							if ( cfg_netchat ) {
								continue
							}
						}
						if ( en ) {
							cnv_str s(1), "&quot;", "\""
						}
						txtef COLOR_BROWN
						txt "" + s(1)
					loop
				}
			}
		}
	}
	if ( timeGetTime() / 1000 - time_warn > 3600 ) {
		time_warn = timeGetTime() / 1000
		wishfilter = FALSE
		hour_played++
		s = lang("ElonaPlusをはじめてから" + hour_played + "時間が経過しています。", "You have been playing ElonaPlus for " + hour_played + " hour" + _s3(hour_played) + ". ")
		gosub *time_warn_talk
		txtmore
		txtef COLOR_YELLOW
		txt s
	}
	await cfg_wait1
	key_check 1
	if ( ginfo(2) != 0 ) {
		goto *pc_turn
	}

	/********** ORIGINAL - BEGINNING **********

	if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_PURGE ) {
		getkey a, 113
		if ( a ) {
			msg_newline
			msgtemp = "  "
			firstturn = 1
			gosub *game_load
			mode = MODELIST_CONTINUE
			goto *map_init
		}
	}

	 ********** ORIGINAL - ENDING **********/

	/********** BLOODYSHADE/ANNA CUSTOM - BEGINNING **********/ // Re-enable save-scumming. + Confirm Reload With F2.

	if ( TweakData(TWEAK_GAMEPLAY_ENABLE_SAVE_SCUMMING, TWEAK_CATEGORY_GAMEPLAY) == 1 | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_PURGE ) {
		getkey a, 113

		if ( a ) {
			if ( ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_LOSS | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_NATURAL ) & TweakData(TWEAK_MISC_CONFIRM_RELOAD_F2, TWEAK_CATEGORY_MISC) == 1 ) {
				dialog "Perform a quickload? You are playing in a mode where no-save penalties apply.", 3
				if ( stat == 6 ) {
					msg_newline
					msgtemp = "  "
					firstturn = 1
					gosub *game_load
					mode = MODELIST_CONTINUE
					goto *map_init
				}
			}
			else {
				msg_newline
				msgtemp = "  "
				firstturn = 1
				gosub *game_load
				mode = MODELIST_CONTINUE
				goto *map_init
			}
		}
	}

	/********** BLOODYSHADE/ANNA CUSTOM - ENDING **********/

	if ( gdata(GDATA_WIZARD) ) {
		getkey a, 113
		if ( a ) {
			msg_newline
			msgtemp = "  "
			firstturn = 1
			gosub *game_load
			mode = MODELIST_CONTINUE
			goto *map_init
		}
		getkey a, 114
		if ( a ) {
			buffer 3, 1440, 800
			picload exedir + "\\graphic\\interface" + devfile + ".bmp", 1
			gsel 0
			gosub *random_event
		}
		getkey a, 115
		if ( a ) {
			repeat RANGE_CDATA_FOOD_EXP, RANGE_CDATA_FOOD_EXP
				txt skillname(cnt) + ":" + cdata(STARTING_CDATA_FOOD_EXP + cnt - RANGE_CDATA_FOOD_EXP, CHARA_PLAYER) + "%"
			loop
			chara_vomit CHARA_PLAYER
			goto *turn_end
			repeat 100
				flt 100
				fltn "cnpc"
				characreate -1, CREATURE_ID_BUG, -3, 0
				cdatan(CDATAN_NAME, rc) += "" + cdata(CDATA_USERNPC_ID, rc)
			loop
		}
		getkey a, 116
		if ( a ) {
			gosub *com_wish
			goto *turn_end
		}
		getkey a, 117
		if ( a ) {
			dbg_skipevent = 1
			gdata(GDATA_HOUR)++
			gosub *advance_hour
			dbg_skipevent = 0
			mode = MODELIST_MAIN
			goto *turn_end
		}
		getkey a, 118
		if ( a ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_TOWN ) {
				dbg_revealmap = 1
				gdata(GDATA_LEVEL)++
				txt "lv:" + gdata(GDATA_LEVEL)
				fmode = 11
				gosub *game_ctrlFile
				mode = MODELIST_NEW
				levelexitby = 4
				goto *map_init
			}
		}
	}
	else {
		getkey a, 114
		if ( a ) {
			goto *turn_end
		}
	}
	getkey a, 112
	if ( a ) {
		gosub *game_save
		if ( gdata(GDATA_AREA) != AREA_CHAOS_CRADLE | gdata(GDATA_LEVEL) != 179 ) {
			snd SOUNDLIST_WRITE1
            txtef COLOR_YELLOW
			txt_saving
		}
	}
	getkey a, 119
	if ( a ) {
		gosub *com_dump
		gosub *screen_draw
		keywait = 1
		goto *pc_turn
	}
	getkey a, 120
	if ( a ) {
		redraw 0
		gmode 2
		sxfix = 0
		syfix = 0
		gosub *screen_setPos
		gosub *los
		gosub *los_draw
		p = windoww / 192
		repeat p + 1
			if ( cnt == p ) {
				sx = windoww \ 192
			}
			else {
				sx = 192
			}
			pos cnt * 192, inf_msgy
			gcopy 3, 496, 528, sx, 5
		loop
		redraw 1
		press
		gosub *screen_refreshFull
		snd SOUNDLIST_OK1
		goto *pc_turn
	}
	getkey a, 122
	if ( a ) {
		gosub *dump_chara
		await 500
		goto *pc_turn
	}
	getkey a, 123
	if ( a ) {
		goto *game_debug
	}
	if ( key == "" ) {
		goto *pc_turn
	}
	if ( key == key_enter ) {
		key = key_search
		cell_featread cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
		if ( feat(1) == CELL_FEATURE_DOWNSTAIRS | mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			key = key_godown
		}
		if ( feat(1) == CELL_FEATURE_UPSTAIRS ) {
			key = key_goup
		}
		if ( feat(1) >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & feat(1) <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
			key = key_search
		}
		inv_getheader -1
		p = 0
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_X, cnt) != cdata(CDATA_X, cc) | inv(INV_ITEM_Y, cnt) != cdata(CDATA_Y, cc) ) {
				continue
			}
			if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE) == FILTER_CONTAINER ) {
				p = 1
			}
			if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE_MINOR) == FILTER_FURNITURE_WELL ) {
				p = 2
			}
			if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE) == FILTER_FURNITURE_ALTAR ) {
				p = 3, cnt
			}
			if ( inv(INV_ITEM_EFFECT, cnt) != EFFECT_NONE | refitem(inv(INV_ITEM_ID, cnt), DBSPEC_CAN_USE) != 0 ) {
				p = 4
			}
			if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_CAN_READ) != 0 ) {
				p = 5
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_MOON_GATE ) {
				key = key_godown
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_UPSTAIRS ) {
				if ( gdata(GDATA_AREA) == AREA_HOME ) {
					key = key_goup
				}
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_DOWNSTAIRS ) {
				if ( gdata(GDATA_AREA) == AREA_HOME ) {
					key = key_godown
				}
			}
			if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_KOTATSU ) {
				key = key_godown
			}
		loop
		if ( key == key_godown | key == key_goup ) {
			p = -1
		}
		if ( p == 0 ) {
			if ( key == key_enter ) {
				key = key_search
			}
		}
		if ( p == 1 ) {
			key = key_open
		}
		if ( p == 2 ) {
			key = key_dip
		}
		if ( p == 3 ) {
			if ( cdata(CDATA_GOD, CHARA_PLAYER) != GOD_EYTH ) {
				key = key_offer
			}
			else {
				key = key_pray
			}
		}
		if ( p == 4 ) {
			key = key_use
		}
		if ( p == 5 ) {
			key = key_read
		}
	}
	if ( mousel == 1 ) {
		mousemove = 1
		automove--
		ematan p, windoww / 2 - mousex, (windowh - inf_verh) / 2 - mousey
		p = p * 360 / 255
		if ( p >= 338 ) {
			p = p - 360
		}
		s = key_south, key_southwest, key_west, key_northwest, key_north, key_northeast, key_east, key_southeast
		repeat 8
			if ( p <= cnt * 45 + 23 & p > cnt * 45 - 23 ) {
				key = s(cnt)
			}
		loop
		await 100
	}
	if ( key != "" ) {
		gosub *pcQuitY
	}
	if ( gdata(GDATA_FLAG_MAIN) < 875 | gdata(GDATA_FLAG_MAIN) >= 900 ) {
		if ( key == key_quick ) {
			gosub *com_quick
			gosub *screen_draw
		}
		if ( key == "sc" ) {
			goto *com_shortcut
		}
	}
	menucycle = 1
	if ( gdata(GDATA_FLAG_MAIN) < 875 | gdata(GDATA_FLAG_MAIN) >= 900 ) {
		if ( key == key_quickinv ) {
			invctrl = lastctrl
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_throw ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = INVCTRL_THROW
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_inventory ) {
			invctrl = INVCTRL_INFO
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_drop ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = INVCTRL_DROP
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_eat ) {
			invctrl = INVCTRL_EAT
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_read ) {
			invctrl = INVCTRL_READ
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_drink ) {
			invctrl = INVCTRL_DRINK
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_zap ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = INVCTRL_ZAP
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_use ) {
			invctrl = INVCTRL_USE
			snd SOUNDLIST_INV
			goto *com_inventory
		}
		if ( key == key_open ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = INVCTRL_OPEN
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_dip ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = INVCTRL_DIP_SOURCE
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_charainfo ) {
			csctrl = 0
			goto *com_charainfo
		}
		if ( key == key_material ) {
			goto *com_material
		}
		if ( key == key_trait ) {
			goto *com_trait
		}
		if ( key == key_wear ) {
			goto *com_wear
		}
		if ( key == key_cast ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				snd SOUNDLIST_SPELL
				goto *com_spell
			}
		}
		if ( key == key_skill ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				snd SOUNDLIST_SKILL
				goto *com_applySkill
			}
		}
		if ( key == key_wipe ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD & 0 == 0 ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				snd SOUNDLIST_SKILL
				goto *com_applyWideSkill
			}
		}
		if ( key == key_journal ) {
			goto *com_journal
		}
	}
	if ( key == key_msglog ) {
		goto *com_log
	}
	menucycle = 0
	if ( gdata(GDATA_FLAG_MAIN) < 875 | gdata(GDATA_FLAG_MAIN) >= 900 ) {
		if ( key == key_offer ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				invctrl = 19
				snd SOUNDLIST_INV
				goto *com_inventory
			}
		}
		if ( key == key_help ) {
			gosub *com_help
			gosub *screen_draw
			goto *pc_turn
		}
		if ( key == key_rest ) {
			goto *com_rest
		}
		if ( key == key_interact ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				goto *com_interact
			}
		}
		if ( key == key_itemstack ) {
			goto *com_stack
		}
		if ( key == key_target ) {
			findlocmode = 1
			gosub *findLocation
			findlocmode = 0
			goto *pc_turn
		}
		if ( key == key_fire ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				goto *com_fire
			}
		}

		/********** ORIGINAL - BEGINNING **********

		if ( key == key_give ) {

		********** ORIGINAL - ENDING **********/

		/********** ANNA CUSTOM - BEGINNING **********/ // Add Feed Option For Pets.

		if ( key == key_give | ( key == key_feed & TweakData(TWEAK_CONVENIENCE_FEED_OPTION_PETS, TWEAK_CATEGORY_CONVENIENCE) == 1) ) {

		/********** ANNA CUSTOM - ENDING **********/

			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {

				/********** ANNA CUSTOM - BEGINNING **********/ // Add Feed Option For Pets.

				if ( key == key_feed & TweakData(TWEAK_CONVENIENCE_FEED_OPTION_PETS, TWEAK_CATEGORY_CONVENIENCE) == 1 ) {
					Filter_Food = 1
				}
				else {
					Filter_Food = 0
				}

				/********** ANNA CUSTOM - ENDING **********/

				goto *com_give
			}
		}
		if ( key == key_get | key == key_get2 ) {
			goto *com_get
		}
		if ( key == key_look ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
				goto *com_target
			}
			else {
				gosub *findLocation
				goto *pc_turn
			}
		}
		if ( key == key_save | key_escape == 1 ) {
			goto *com_save
		}
		if ( key == key_dig ) {
			goto *com_dig
		}
		if ( key == key_bash ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				goto *com_bash
			}
		}
		if ( key == key_search ) {
			goto *act_search
		}
		if ( key == key_close ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				goto *act_close
			}
		}
		if ( key == key_pray ) {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				txtnew
				txt_globalarea
				display_msg
				redraw 1
				goto *pc_turn
			}
			else {
				goto *act_pray
			}
		}
		if ( key == key_ammo ) {
			goto *com_ammo
		}
		if ( key_tab ) {
			gosub *net_chat
			gosub *screen_draw
			goto *pc_turn
		}
	}
	p = 0
	if ( key == key_north ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER)
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) - 1
		gdata(GDATA_RUN_DIR) = 3
		dirsub = 0
	}
	if ( key == key_south ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER)
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) + 1
		gdata(GDATA_RUN_DIR) = 0
		dirsub = 4
	}
	if ( key == key_west ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) - 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER)
		gdata(GDATA_RUN_DIR) = 1
		dirsub = 6
	}
	if ( key == key_east ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) + 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER)
		gdata(GDATA_RUN_DIR) = 2
		dirsub = 2
	}
	if ( key == key_northwest ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) - 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) - 1
		gdata(GDATA_RUN_DIR) = 3
		dirsub = 7
	}
	if ( key == key_northeast ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) + 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) - 1
		gdata(GDATA_RUN_DIR) = 3
		dirsub = 1
	}
	if ( key == key_southwest ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) - 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) + 1
		gdata(GDATA_RUN_DIR) = 0
		dirsub = 5
	}
	if ( key == key_southeast ) {
		p = 1
		cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, CHARA_PLAYER) + 1
		cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, CHARA_PLAYER) + 1
		gdata(GDATA_RUN_DIR) = 0
		dirsub = 3
	}
	cdata(CDATA_DIR, CHARA_PLAYER) = gdata(GDATA_RUN_DIR)
	if ( p == 1 ) {
		goto *act_movePC
	}
	if ( key == key_godown ) {
		val = 1
		goto *act_moveLevel
	}
	if ( key == key_goup ) {
		val = 2
		goto *act_moveLevel
	}
	if ( key == key_wait ) {
		goto *turn_end
	}
	if ( key == key_enter ) {
		gosub *screen_draw
		goto *pc_turn
	}
	if ( gdata(GDATA_FLAG_MAIN) < 875 | gdata(GDATA_FLAG_MAIN) >= 900 ) {
		if ( key != "" ) {
			if ( key != key_cancel ) {
				if ( key != key_alter ) {
					msgdup++
					txt lang("?キーを押すと、コマンドの一覧が見られる。", "Hit ? key to display help.")
					gosub *screen_draw
				}
			}
		}
    }
	goto *pc_turn

*pcQuitY
	if ( gdata(GDATA_QUIT_Y) != (-1) ) {
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			if ( gdata(GDATA_QUIT_Y) == 0 ) {
				if ( key == "Q" ) {
					txt lang("え…", "What...")
					gdata(GDATA_QUIT_Y)++
					gosub *screen_draw
					goto *pc_turn
				}
			}
			else {
				if ( gdata(GDATA_QUIT_Y) == 1 ) {
					if ( key == "y" ) {
						txt lang("まさか…", "No... no...")
						gdata(GDATA_QUIT_Y)++
						gosub *screen_draw
						goto *pc_turn
					}
					gdata(GDATA_QUIT_Y) = 0
				}
				else {
					if ( gdata(GDATA_QUIT_Y) == 2 ) {
						if ( key == "\\" ) {
							gdata(GDATA_QUIT_Y)++
							goto *pc_turn
						}
						gdata(GDATA_QUIT_Y) = 0
					}
					else {
						if ( gdata(GDATA_QUIT_Y) == 3 ) {
							if ( key == "sc" ) {
								txt lang("うわぁぁぁ！！", "Ahhhhh!!")
								repeat 10
									flt
									characreate -1, CREATURE_ID_AT_SIGN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
								loop
								gdata(GDATA_QUIT_Y) = -1
								gosub *screen_draw
								goto *turn_end
							}
							gdata(GDATA_QUIT_Y) = 0
						}
					}
				}
			}
		}
	}
	return

*game_win
	snd SOUNDLIST_COMPLETE1
	music = -1
	gosub *music_play
	txt lang("信じられない！あなたはネフィアの迷宮「レシマス」を制覇した！", "Unbelievable! You conquered Lesimas!")
	gosub *screen_draw
	txtsetwinword 3
	repeat 3
		promptAdd s(cnt), key_select(cnt)
	loop
	val = promptx, prompty, 310, 0
	gosub *prompt_key
	wincomment = "" + promptl(0, rtval)
	mode = MODELIST_EVENT
	screenupdate = -1
	gosub *screen_draw
	msg_clear
	txt lang("お前がここに辿り着くことは」台座から、何かの声が聞こえる。", "From the pedestal, you can hear a voice.")
	flt
	characreate -1, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
	music = MUSICLIST_MCCHAOS
	gosub *music_play
	msg_halt
	msg_clear
	txt lang("「決まっていたことなのだ…遅かれ早かれな」", cnvtalk("Your arrival here was inevitable... sooner or later."))
	txt lang("部屋の空気が突然緊張し、あなたの前に端麗な青年が現れた。", "Space within the room distorts, and an elegant young man appears before you.")
	txt lang("「我々からすれば、複雑性の一面に過ぎないが、人間は運命とでも呼ぶのだろう？」", cnvtalk("For us, it's merely one facet of a vast, complex system, but I believe you humans know it as 'fate'?"))
	msg_halt
	msg_clear
	txt lang("あなたは懸命に脚の震えを抑えようとしたが、難しかった。", "You earnestly attempt to suppress the shaking in your legs, but it proves difficult.")
	txt lang("華奢に見える幼顔の男の影は、人のものではない。", "The shadow of the young man with an elegant face is not a man's shadow.")
	txt lang("あどけない瞳の奥に、あなたは底知れない力と闇を感じた。", "From the depths of his innocent eyes, you feel immeasurable strength and darkness.")
	msg_halt
	msg_clear
	txt lang("「ネフィアの永遠の盟約に基づき」青年は台座の横の死体を指し、皮肉な微笑を送った。", "The young man gestures at the corpse of Zeome with an ironic smile.")
	txt lang("「この哀れな老人が守っていたものは、今からお前のものだ」", cnvtalk("In accordance with the oath of the Eternal League of Nefia, the item that was guarded by this pathetic old man is now yours."))
	msg_halt
	msg_clear
	txt lang("あなたは、台座の上に置かれている絢爛な装飾の本を、いぶかしげに眺めた。", "You cast a suspicious gaze at the gorgeously adorned book resting on the pedestal as the man begins to speak to it...")
	msg_halt
	tc = findchara(CREATURE_ID_ORPHE_THE_CHAOS_CHILD)
	gosub *chat
	msg_clear
	txt lang("青年は悪戯っぽくニヤリと笑い、壁に寄りかかった。", "The young man laughs and leans against the wall, wearing a mischievous smile.")
	msg_halt
	msg_clear
	chara_vanquish findchara(CREATURE_ID_ORPHE_THE_CHAOS_CHILD)
	screenupdate = -1
	gosub *screen_draw
	txt lang("…どれくらい時間がたっただろう。氷の瞳の男は、いつの間にか姿を消していた。あなたは不安を振り払い、ゆっくりと本に手を伸ばした…。", "...An unknown amount of time passes. The man with the terrifying eyes vanished while you weren't looking. You shake off your uncertainty, slowly reaching your hand out to the book...")
	msg_halt
	mode = MODELIST_MAIN
	music = MUSICLIST_MCMARCH2
	gosub *music_play
	gosub *screen_fadeIn
	redraw 0
	buffer 4, windoww, windowh
	picload exedir + "\\graphic\\void.bmp", 1
	gsel 0
	gosub *screen_fadeOut
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gsel 4
	pos 0, 0
	picload exedir + "\\graphic\\g1.bmp", 1
	gsel 0
	s = lang("" + cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER) + "に祝福あれ！あなたは遂にレシマスの秘宝を手にいれた！", "Blessing to " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", " + cdatan(CDATAN_AKA, CHARA_PLAYER) + "! You've finally acquired the codex!")
	gosub *screen_drawMsg2
	s = lang("*勝利*", "*Win*"), "" + strhint3
	windowshadow = 1
	display_window 60, 70, 680, 488
	cmbg = 0
	x = ww / 3 - 20
	y = wh - 140
	gmode 4, 180, 300, 250
	pos wx + ww - 120, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("制覇までの軌跡", "Trace"), wx + 28, wy + 40
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	color 0, 0
	pos wx + 40, wy + 76
	mes lang("" + 517 + "年" + 10 + "月" + 12 + "日に、あなたはノースティリスに到着した。", "In the year " + 517 + ", " + 12 + "/" + 8 + ", you arrived at North Tyris.")
	mes ""
	mes lang("最深で" + gdata(GDATA_DEEPEST) + "階相当まで到達し、" + gdata(GDATA_KILLED) + "匹の敵を殺して、", "You've killed " + gdata(GDATA_KILLED) + " creatures and reached\nmaximum of " + cnvrank(gdata(GDATA_DEEPEST)) + " level of dungeons.")
	mes lang("現在" + calcscore() + "点のスコアを叩き出している。", "Your score is " + calcscore() + " points now.")
	mes ""
	mes lang("" + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日にレシマスを制覇して、", "In the year " + gdata(GDATA_YEAR) + ", " + gdata(GDATA_DAY) + "/" + gdata(GDATA_MONTH) + ", you conquered Lesimas.")
	mes lang("あなたは「" + wincomment + "」とコメントした。", "Upon killing Zeome, you said, " + cnvtalk("" + wincomment))
	mes ""
	mes lang("…あなたの旅はまだ終わらない。", "Your journey continues...")
	redraw 1
	key_list = key_enter
	keyrange = 0
*game_win_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_cancel ) {
		goto *game_win_WEND1
	}
	goto *game_win_WHILE1
*game_win_WEND1
	gosub *screen_refreshFull
	txt lang("達成のシーンをもう一度再現する？", "Do you want to watch this event again?")
	promptYesNo
	if ( rtval == 0 ) {
		goto *game_win
	}
	gdata(GDATA_FLAG_MAIN) = 180
	gosub *screen_draw
	return

*game_win2
	snd SOUNDLIST_COMPLETE1
	music = -1
	gosub *music_play
	txt lang("信じられない！あなたは古代遺跡「レミード」を制圧した！", "Unbelievable! You conquered Remido!")
	gosub *screen_draw
	txtsetwinword 3
	repeat 3
		promptAdd s(cnt), key_select(cnt)
	loop
	val = promptx, prompty, 310, 0
	gosub *prompt_key
	wincomment = "" + promptl(0, rtval)
	music = MUSICLIST_MCMARCH2
	gosub *music_play
	gosub *screen_fadeIn
	redraw 0
	buffer 4, windoww, windowh
	picload exedir + "\\graphic\\void.bmp", 1
	gsel 0
	gosub *screen_fadeOut
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gsel 4
	pos 0, 0
	picload exedir + "\\graphic\\g1.bmp", 1
	gsel 0
	s = lang("" + cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER) + "に祝福あれ！あなたは遂に災厄の根源を滅ぼした！", "Blessing to " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", " + cdatan(CDATAN_AKA, CHARA_PLAYER) + "! You've finally destroyed the source of disaster!")
	gosub *screen_drawMsg2
	s = lang("*勝利*", "*Win*"), "" + strhint3
	windowshadow = 1
	display_window 60, 70, 680, 488
	cmbg = 0
	x = ww / 3 - 20
	y = wh - 140
	gmode 4, 180, 300, 250
	pos wx + ww - 120, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("制覇までの軌跡", "Trace"), wx + 28, wy + 40
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	color 0, 0
	pos wx + 40, wy + 76
	mes lang("" + 517 + "年" + 10 + "月" + 12 + "日に、あなたはノースティリスに到着した。", "In the year " + 517 + ", " + 12 + "/" + 8 + ", you arrived at North Tyris.")
	mes ""
	mes lang("最深で" + gdata(GDATA_DEEPEST) + "階相当まで到達し、" + gdata(GDATA_KILLED) + "匹の敵を殺して、", "You've killed " + gdata(GDATA_KILLED) + " creatures and reached\nmaximum of " + cnvrank(gdata(GDATA_DEEPEST)) + " level of dungeons.")
	mes lang("現在" + calcscore() + "点のスコアを叩き出している。", "Your score is " + calcscore() + " points now.")
	mes ""
	mes lang("" + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日にレミードを制覇して、", "In the year " + gdata(GDATA_YEAR) + ", " + gdata(GDATA_DAY) + "/" + gdata(GDATA_MONTH) + ", you conquered Remido.")
	mes lang("あなたは「" + wincomment + "」とコメントした。", "Upon killing Meshera Alpha, you said, " + cnvtalk("" + wincomment))
	mes ""
	mes lang("…あなたの旅はまだ終わらない。", "Your journey continues...")
	redraw 1
	key_list = key_enter
	keyrange = 0
*game_win2_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_cancel ) {
		goto *game_win2_WEND1
	}
	goto *game_win2_WHILE1
*game_win2_WEND1
	gosub *screen_refreshFull
	txt lang("達成のシーンをもう一度再現する？", "Do you want to watch this event again?")
	promptYesNo
	if ( rtval == 0 ) {
		goto *game_win2
	}
	gdata(GDATA_FLAG_MAIN) = 340
	gdata(GDATA_YEARS_AFTER_VICTORY) = 1
	gosub *screen_draw
	return

*game_win3
	snd SOUNDLIST_COMPLETE1
	music = -1
	gosub *music_play
	txt lang("信じられない！あなたは神の間を制圧した！", "Unbelievable! You conquered the Eternal Seal!")
	gosub *screen_draw
	txtsetwinwordc 3
	repeat 3
		promptAdd s(cnt), key_select(cnt)
	loop
	val = promptx, prompty, 250, 0
	gosub *prompt_key
	wincomment = "" + promptl(0, rtval)
	music = MUSICLIST_MCMARCH2
	gosub *music_play
	gosub *screen_fadeIn
	redraw 0
	buffer 4, windoww, windowh
	picload exedir + "\\graphic\\void.bmp", 1
	gsel 0
	gosub *screen_fadeOut
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gsel 4
	pos 0, 0
	picload exedir + "\\graphic\\g1.bmp", 1
	gsel 0
	s = lang("" + cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER) + "に祝福あれ！あなたは遂に混沌の神を討伐した！", "Blessing to " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", " + cdatan(CDATAN_AKA, CHARA_PLAYER) + "! You've finally beat the god of chaos!")
	gosub *screen_drawMsg2
	s = lang("*勝利*", "*Win*"), "" + strhint3
	windowshadow = 1
	display_window 60, 70, 680, 488
	cmbg = 0
	x = ww / 3 - 20
	y = wh - 140
	gmode 4, 180, 300, 250
	pos wx + ww - 120, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("制覇までの軌跡", "Trace"), wx + 28, wy + 40
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	color 0, 0
	pos wx + 40, wy + 76
	mes lang("" + 517 + "年" + 10 + "月" + 12 + "日に、あなたはノースティリスに到着した。", "In the year " + 517 + ", " + 12 + "/" + 8 + ", you arrived at North Tyris.")
	mes ""
	mes lang("最深で" + gdata(GDATA_DEEPEST) + "階相当まで到達し、" + gdata(GDATA_KILLED) + "匹の敵を殺して、", "You've killed " + gdata(GDATA_KILLED) + " creatures and reached\nmaximum of " + cnvrank(gdata(GDATA_DEEPEST)) + " level of dungeons.")
	mes lang("現在" + calcscore() + "点のスコアを叩き出している。", "Your score is " + calcscore() + " points now.")
	mes ""
	mes lang("" + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日に神の間を制覇して、", "In the year " + gdata(GDATA_YEAR) + ", " + gdata(GDATA_DAY) + "/" + gdata(GDATA_MONTH) + ", you conquered the Eternal Seal.")
	mes lang("あなたは「" + wincomment + "」とコメントした。", "Upon killing Enthumesis, you said, " + cnvtalk("" + wincomment))
	mes ""
	mes lang("…あなたの旅はまだ終わらない。", "Your journey continues...")
	redraw 1
	key_list = key_enter
	keyrange = 0
*game_win3_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_cancel ) {
		goto *game_win3_WEND1
	}
	goto *game_win3_WHILE1
*game_win3_WEND1
	gosub *screen_refreshFull
	txt lang("達成のシーンをもう一度再現する？", "Do you want to watch this event again?")
	promptYesNo
	if ( rtval == 0 ) {
		goto *game_win3
	}
	gosub *screen_draw
	return

*pc_dead
	cc = CHARA_PLAYER
	snd SOUNDLIST_DEAD1
	screenupdate = -1
	gosub *screen_draw
	if ( gdata(GDATA_QUEST) == QUEST_TYPE_THIEVES ) {
		gdata(GDATA_QUEST) = QUEST_TYPE_NONE
	}
	if ( gdata(GDATA_QUEST) ) {
		goto *quest_death
	}
	txt lang("さようなら… ", "Good bye... ")
	txtmore
	txt lang("遺言は？", "You leave a dying message.")
	val = (windoww - 310) / 2 + inf_screenx, winposy(90), 16, 1, 0
	inputlog = ""
	gosub *prompt_word
	if ( inputlog == "" ) {
		txtsetlastword
	}
	else {
		lastword = lang("「", "\"") + inputlog + lang("」", "\"")
	}
	buff = ""
	notesel buff
	file = exedir + "save\\bone"
	exist file + ".txt"
	if ( strsize != (-1) ) {
		noteload file + ".txt"
	}
	s = cdatan(CDATAN_AKA, cc) + " " + cdatan(CDATAN_NAME, cc) + lang("", " ") + lastword
	lenfix s, 60
	s += lang("" + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日", "" + gdata(GDATA_YEAR) + "/" + gdata(GDATA_MONTH) + "/" + gdata(GDATA_DAY))
	noteadd "", 0
	noteadd s, 1
	s = lang(mdatan(MDATAN_NAME) + "で" + ndeathcause, cnven(ndeathcause) + " in " + mdatan(MDATAN_NAME) + ".")
	noteadd s, 2
	s = "" + calcscore() + "," + cdata(CDATA_PIC, cc)
	noteadd s, 3
	if ( noteinfo(0) >= 80 * 4 ) {
		repeat noteinfo(0) - 80 * 4, 80 * 4
			notedel 80 * 4
		loop
	}
	page = 0
	repeat
		p(1) = 0
		repeat 80 - 1
			p = cnt * 4
			noteget s(10), p + 3
			csvsort s, s(10), 44
			p(2) = int(s)
			noteget s(10), p + 7
			csvsort s, s(10), 44
			p(3) = int(s)
			if ( p(3) > p(2) ) {
				if ( cnt == page ) {
					page = cnt + 1
				}
				else {
					if ( cnt + 1 == page ) {
						page = cnt
					}
				}
				repeat 3, 1
					noteget s, p + cnt
					noteget s(1), p + 4 + cnt
					noteadd s, p + 4 + cnt, 1
					noteadd s(1), p + cnt, 1
				loop
				p(1) = 1
			}
		loop
		if ( p(1) == 0 ) {
			break
		}
	loop
	repeat noteinfo(0) / 4
		noteadd "" + cnvrank(cnt + 1) + lang("位", ""), cnt * 4, 1
	loop
	notesave file + ".txt"
	redraw 0
	gsel 4
	pos 0, 0
	picload exedir + "graphic\\void.bmp", 1
	gsel 0
*pc_dead_loop
	gosub *dead_draw
	s = lang("あともう少しで埋葬される…", "You are about to be buried...")
	gosub *screen_drawMsg2
	if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_LOSS | (gdata(GDATA_FLAG_MAIN) >= 715 & gdata(GDATA_FLAG_MAIN) < 760 & gdata(GDATA_AREA) == AREA_CHAOS_CRADLE) ) {
		gosub *dead_draw
		s = lang("あなたは埋められた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *screen_drawMsg2
		redraw 1
		press
		goto *exit_game
	}
	if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_ABNORMAL ) {
		if ( TweakData(TWEAK_CONVENIENCE_RELOAD_AFTER_DEATH_OPTION, TWEAK_CATEGORY_CONVENIENCE) == 1 ) {
			promptAdd lang("前回のセーブをリロードする", "Reload last save"), "null", 3
		}
	}
	promptAdd lang("這い上がる(ﾍﾟﾅﾙﾃｨあり復活)", "Crawl up"), "null", 2
	if ( gdata(GDATA_FLAG_GAME_MODE) != GAMEMODE_ABNORMAL ) {
		promptAdd lang("埋まる(保存したところから)", "Lie on your back"), "null", 1
	}
	val = promptx, 100, 300, 1
	gosub *prompt_key
	if ( rtval == 1 ) {
		gosub *dead_draw
		s = lang("あなたは埋められた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *screen_drawMsg2
		redraw 1
		press
		goto *exit_game
	}
	if ( rtval == 3 ) {
		if ( ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_LOSS | gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_NATURAL ) & TweakData(TWEAK_MISC_CONFIRM_RELOAD_F2, TWEAK_CATEGORY_MISC) == 1 ) {
			dialog "Perform a quickload? You are playing in a mode where no-save penalties apply.", 3
			if ( stat == 6 ) {
				msg_newline
				msgtemp = "  "
				firstturn = 1
				gosub *game_load
				mode = MODELIST_CONTINUE
				goto *map_init
			}
		}
		else {
			msg_newline
			msgtemp = "  "
			firstturn = 1
			gosub *game_load
			mode = MODELIST_CONTINUE
			goto *map_init
		}
		goto *pc_dead_loop
	}
	s = "dead" + lang(cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER) + "は" + mdatan(MDATAN_NAME) + "で" + ndeathcause + lastword, cdatan(CDATAN_AKA, CHARA_PLAYER) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + " " + ndeathcause + " in " + mdatan(MDATAN_NAME) + " " + lastword)
	if ( gdata(GDATA_WIZARD) == FALSE ) {
		net_send s
	}
	screenupdate = -1
	gosub *screen_refreshFull
	levelexitby = 3
	goto *map_exit

*dead_draw
	notesel buff
	redraw 0
	gmode 0
	pos 0, 0
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gmode 2
	x = 135
	y = 134
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 138, 131, 100
	p = page - 4
	if ( p >= 80 ) {
		p = 80 - 8
	}
	if ( p < 0 ) {
		p = 0
	}
	repeat 8, p
		p = cnt * 4
		y += 46
		if ( cnt == page ) {
			s = "New!"
		}
		else {
			s = " " + cnvrank(cnt + 1) + lang("位", "")
		}
		pos x - 80, y + 10
		color 10, 10, 10
		mes s
		if ( p >= noteinfo(0) ) {
			s = "no entry"
		}
		else {
			noteget s, p + 1
		}
		pos x, y
		color 10, 10, 10
		mes s
		if ( p >= noteinfo(0) ) {
			continue
		}
		noteget s, p + 2
		pos x, y + 20
		color 10, 10, 10
		mes s
		noteget s(10), p + 3
		csvsort s, s(10), 44
		pos x + 480, y + 20
		color 10, 10, 10
		mes "" + s + lang("点", "")
		p = int(s(1)) \ 1000
		chara_preparepic p
		pos x - 22, y + 12
		gmode 2, chipc(CHIPC_WIDTH, p), chipc(CHIPC_HEIGHT, p)
		grotate 5, 0, 960, 0, chipc(CHIPC_WIDTH, p) / (1 + (chipc(CHIPC_HEIGHT, p) > inf_tiles)), inf_tiles
	loop
	return

*event
	procid = (procid + 1) \ 4
	proclist(procid) = "event" + " ct:" + ct
	_switch_val = evid()
	if ( _switch_val == EVENT_QUEST_ELEMINATE | _switch_sw ) {
		_switch_sw = 0
		gosub *quest_eliminate
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_KARAVIKA_SETUP_MAP | _switch_sw ) {
		_switch_sw = 0
		qexit = 0
		mdata(MDATA_DOWNSTAIRS_POS) = cdata(CDATA_Y, CHARA_PLAYER) * 1000 + cdata(CDATA_X, CHARA_PLAYER)
		gdata(GDATA_TELEPORT_AREA) = AREA_OL_DRAN
		gdata(GDATA_TELEPORT_LEVEL) = 1
		levelexitby = 2
		gdata(GDATA_LEVEL_START_ON) = 7
		mapstartx = 40
		mapstarty = 12
		snd SOUNDLIST_EXITMAP1
		chatteleport = 1
		return
	}
	if ( _switch_val == EVENT_AMURDEAD_SUB_CREATE_STAIRS | _switch_sw ) {
		_switch_sw = 0
		qexit = 0
		mdata(MDATA_DOWNSTAIRS_POS) = cdata(CDATA_Y, CHARA_PLAYER) * 1000 + cdata(CDATA_X, CHARA_PLAYER)
		gdata(GDATA_TELEPORT_AREA) = AREA_AMUR_CAGE
		gdata(GDATA_TELEPORT_LEVEL) = 1
		levelexitby = MAP_EXIT_TELEPORT
		gdata(GDATA_LEVEL_START_ON) = 7
		mapstartx = 27
		mapstarty = 19
		snd SOUNDLIST_EXITMAP1
		chatteleport = 1
		return
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_QUEST_TIMEOUT | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY ) {
			calcpartyscore
			calcpartyscore2
			txt lang("最終得点は" + qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) + "ポイントだった！", "Your final score is " + qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) + " points!")

			/********** ANNA CUSTOM - BEGINNING **********/ // Gather Items At End Of Party Time.

			if ( TweakData(TWEAK_GAMEPLAY_GATHER_ITEM_PARTYTIME, TWEAK_CATEGORY_GAMEPLAY) == 1 ) {
				Party_End = 1
				gosub *com_txtAdvQuit
				Party_End = 0
			}

			/********** ANNA CUSTOM - ENDING **********/

			if ( qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) <= qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) ) {
				gdata(GDATA_QUEST_STATUS) = QUEST_STATE_SUCCESS
				qdata(QDATA_STATUS, gdata(GDATA_QUEST_REF)) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt lang("パーティーは大盛況だった！", "People had a hell of a good time!")
				msg_halt
			}
			else {
				txtef COLOR_PURPLE
				txt lang("パーティーはぐだぐだになった…", "The party turned out to be a big flop...")
			}
		}
		if ( gdata(GDATA_QUEST) == QUEST_TYPE_HARVEST ) {
			if ( qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) < qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) ) {
				gdata(GDATA_QUEST_STATUS) = QUEST_STATE_SUCCESS
				qdata(QDATA_STATUS, gdata(GDATA_QUEST_REF)) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt lang("無事に納入を終えた！", "You complete the task!")
				msg_halt
			}
			else {
				txtef COLOR_PURPLE
				txt lang("納入は間に合わなかった…", "You fail to fulfill your task...")
			}
		}
		if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
			if ( qdata(QDATA_PARAM1, gdata(GDATA_QUEST_REF)) <= qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF)) ) {
				gdata(GDATA_QUEST_STATUS) = QUEST_STATE_SUCCESS
				qdata(QDATA_STATUS, gdata(GDATA_QUEST_REF)) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt lang("無事に撤去を終えた！", "You complete the task!")
				msg_halt
			}
			else {
				txtef COLOR_PURPLE
				txt lang("撤去は間に合わなかった…", "You fail to fulfill your task...")
			}
		}
		if ( gdata(GDATA_QUEST) == QUEST_TYPE_CONQUER ) {
			txtef COLOR_PURPLE
			txt lang("討伐に失敗した…", "You failed to slay the target...")
		}
		qexit = 0
		levelexitby = 4
		snd SOUNDLIST_EXITMAP1
		chatteleport = 1
		return
	}
	if ( _switch_val == EVENT_WIN_LESIMAS | _switch_sw ) {
		_switch_sw = 0
		gosub *game_win
		flt
		characreate -1, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_WIN_REMIDO | _switch_sw ) {
		_switch_sw = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) == 10 | cnt < MAX_CHARA_FOLLOWER ) {
				continue
			}
			tc = cnt
			if ( tc != CHARA_PLAYER ) {
				chara_vanquish tc
			}
		loop
		gosub *game_win2
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_LITTLE_SISTER | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			goto *event_SWEND1
		}
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_LITTLE_SISTER, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		txtef COLOR_BLUE
		txt lang("ビッグダディの肩から、リトルシスターが滑り落ちた。「Mr Bubbles！！」", "The Little Sister slips from the Big Daddy's shoulder. \"Mr. Bubbles!\"")
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_LULWY | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("愚かね…死ぬ準備をしなさい！！！", "Fool... Prepare to die!!!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		msg_halt
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_DEVASTATE_LULWY, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) == 10 | cnt < MAX_CHARA_FOLLOWER ) {
				continue
			}
			tc = cnt
			if ( cdata(CDATA_ID, tc) == CREATURE_ID_RUDRAS ) {
				if ( tc != CHARA_PLAYER ) {
					chara_vanquish tc
				}
			}
		loop
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_EHEKATL | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("…ぅっぅぅ…っぅぅっぅううううみみゃぁ！！！", "memememw...MEMEMEM...MEWWWWWW!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_GOD_INSIDE_EHEKATL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_OPATOS | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("…ッハハハ…フハハハッツッハハハハー！！！", "...Muwahahaha...wahahahaha!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_BUILDUP_OPATOS, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_KUMIROMI | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("許さない…絶対に…！！！", "I absolutely... can't forgive...!!!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_INSANE_KUMIROMI, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_MANI | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("さぁ、終幕といこうか！！！", "Come, let us bring this farce to a close!!!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_DEUS_EX_MANINA, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_JURE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("バ、バカは死ななきゃ治らないんだから！！！", "I-if you won't die, then my only choice is to heal your foolishness!!!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_BLESSED_JURE, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_ITZPALT | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("渦巻け炎よ！取巻け冷気よ！そして瞬け電光よ！今こそ、あるべき姿へと還るのだ！", "Roaring flames! Biting cold! Savage lightning! Return this fool to the dust from whence " + he(cc) + " came!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_THE_ELEMENT, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GOD_INSIDE_YACATECT | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt lang("許さへん…今のは高くつくで！！！", "Unacceptable... Now you shall pay!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_HYPER_YACATECT, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MESHERA_ALPHA | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_MAIN) >= 325 ) {
			txtef COLOR_YELLOW
			txt lang("あなたが肉塊に向けてエーテルブラスターを放つと、肉塊の再生が止まり崩壊を始めた。", "You fire the ether blaster into the mass of flesh. Its regeneration stops and it begins to collapse.")
			txtef COLOR_RED
			txt lang("崩壊していく肉塊の中から何かが飛び出してきた！", "Something suddenly emerges from the mass of flesh as it collapses!")
			msg_halt
			flt
			characreate -1, CREATURE_ID_MESHERA_ALPHA_THE_DEFORMED_ANGEL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
			music = MUSICLIST_MCLASTBOSS3
			gosub *music_play
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_RELATION, cnt) == 10 | cnt < MAX_CHARA_FOLLOWER ) {
					continue
				}
				tc = cnt
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_INFECTED_YERLES_SOLDIER ) {
					if ( tc != CHARA_PLAYER ) {
						cdata(CDATA_RELATION, tc) = 10
						txt lang(name(tc) + "は束の間の自我を取り戻した！", name(tc) + " momentarily regained consciousness!")
					}
				}
			loop
		}
		if ( gdata(GDATA_FLAG_MAIN) < 325 ) {
			txtef COLOR_RED
			txt lang("倒したはずの怪物がみるみる再生していく！これではキリがない！一時撤退し、対策を練った方がいいだろう。", "The enemy you thought you had struck down revives instantly before your eyes! There's no way to defeat it! You should withdraw for now and develop countermeasures to its regeneration.")
			msg_halt
			flt
			characreate -1, CREATURE_ID_MESHERA_PLANT, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
			cbitmod CHARA_BIT_SUMMONED, rc, 1
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_OPENING | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE)
		gosub *chat
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_INIT_ECONOMY | _switch_sw ) {
		_switch_sw = 0
		initeco = 1
		gosub *renew_economy
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_BOSS_LESIMAS | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_ZEOME_THE_FALSE_PROPHET)
		gosub *chat
		music = MUSICLIST_MCLASTBOSS
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SHOP_WANDER | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_SHOPKEEPER)
		gosub *chat
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_ROGUE | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_ROGUE_BOSS)
		gosub *chat
		music = MUSICLIST_MCBOSS
		gosub *music_play
		gdata(GDATA_MAP_EVENT) = 23
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_CHESTNUT_GIANT | _switch_sw ) {
		_switch_sw = 0
		music = MUSICLIST_MCBOSS5
		gosub *music_play
		snd SOUNDLIST_CURSE2
		gdata(GDATA_FLAG_THROWN_CHESTNUTS) = gdata(GDATA_FLAG_THROWN_CHESTNUTS) / 2
		item_find ITEM_ID_CHESTNUT, 3, 1
		if ( stat != (-1) ) {
			ci = stat
			if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
				inv(INV_ITEM_NUM, ci) = 0
				txt lang("突然、手持ちの栗をひったくられた！", "Suddenly, a chestnut was snatched from the stores.")
			}
		}
		txtef COLOR_RED
		txtmore
		txt lang("「栗を粗末にしたのは…お前だなああっ！！」", "Chestnut giant yells, " + cnvtalk("You idiot!"))
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_H_SISTER | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_H_SISTER)
		gosub *chat
		music = MUSICLIST_MCBOSS4
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_FESTIVAL_MUSIC | _switch_sw ) {
		_switch_sw = 0
		music = MUSICLIST_MCFEST
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_ORPHE | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_ORPHE_THE_CHAOS_FOLLOWER)
		gosub *chat
		music = MUSICLIST_MCLASTBOSS
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MESHERA_PLANT | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_MESHERA_PLANT)
		gosub *chat
		music = MUSICLIST_MCLASTBOSS
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_ENTHUMESIS | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_ENTHUMESIS)
		gosub *chat
		music = MUSICLIST_MCLASTBOSS3
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_NAGAREW | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_MAIN) == 755 ) {
			tc = findchara(CREATURE_ID_NAGAREW_THE_OBLIVION_BEAST)
			if ( tc != CHARA_PLAYER ) {
				cdata(CDATA_HP, tc) = 1
			}
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_MELUGAST_AO_I_THE_DIMENSION_DRIVER)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_RAIZEL_THE_OLD_WIZARD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			gdata(GDATA_FLAG_MAIN) = 760
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc == CHARA_PLAYER ) {
				flt
				initlv = 200
				novoidlv = 1
				characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_AI_CALM, rc) = 4
				cdata(CDATA_RELATION, rc) = 10
				cdata(CDATA_RELATION_ORG, rc) = 10
			}
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			gosub *chat
		}
		if ( gdata(GDATA_FLAG_MAIN) == 745 ) {
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_MELUGAST_AO_I_THE_DIMENSION_DRIVER)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			snd SOUNDLIST_EXITMAP1
			tc = findchara(CREATURE_ID_THE_CHAOS_CHILD)
			if ( tc != CHARA_PLAYER ) {
				target = tc
			}
			flt
			initlv = 210
			novoidlv = 1
			characreate -1, CREATURE_ID_NAGAREW_THE_OBLIVION_BEAST, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_CALM, rc) = 4
			cdata(CDATA_TARGET, rc) = target
			cdata(CDATA_RELATION, rc) = 10
			cdata(CDATA_RELATION_ORG, rc) = 10
			flt
			initlv = 164
			novoidlv = 1
			characreate -1, CREATURE_ID_RAIZEL_THE_OLD_WIZARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_CALM, rc) = 4
			cdata(CDATA_TARGET, rc) = target
			cdata(CDATA_RELATION, rc) = 10
			cdata(CDATA_RELATION_ORG, rc) = 10
			tc = findchara(CREATURE_ID_RAIZEL_THE_OLD_WIZARD)
			gosub *chat
			gdata(GDATA_FLAG_MAIN) = 750
		}
		if ( gdata(GDATA_FLAG_MAIN) == 735 ) {
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			tc = findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			snd SOUNDLIST_TELEPORT1
			txtef COLOR_YELLOW
			txt lang("「どうやら間に合ったようだな！」", cnvtalk("Apparently that went well!"))
			msg_halt
			tc = findchara(CREATURE_ID_THE_CHAOS_CHILD)
			if ( tc != CHARA_PLAYER ) {
				target = tc
			}
			flt
			initlv = 210
			novoidlv = 1
			characreate -1, CREATURE_ID_MELUGAST_AO_I_THE_DIMENSION_DRIVER, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_CALM, rc) = 4
			cdata(CDATA_TARGET, rc) = target
			cdata(CDATA_RELATION, rc) = 10
			cdata(CDATA_RELATION_ORG, rc) = 10
			tc = findchara(CREATURE_ID_MELUGAST_AO_I_THE_DIMENSION_DRIVER)
			gosub *chat
			gdata(GDATA_FLAG_MAIN) = 740
		}
		if ( gdata(GDATA_FLAG_MAIN) == 725 ) {
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
			repeat 4
				await 50
				snd SOUNDLIST_FOOT1A
				await 50
				snd SOUNDLIST_FOOT1B
				await 50
			loop
			txtef COLOR_YELLOW
			txt lang("「ここが神の間か！？」", cnvtalk("Is this the Eternal Seal!?"))
			msg_halt
			tc = findchara(CREATURE_ID_THE_CHAOS_CHILD)
			if ( tc != CHARA_PLAYER ) {
				target = tc
			}
			flt
			initlv = 200
			novoidlv = 1
			characreate -1, CREATURE_ID_BETHEL_THE_WHITE_HAWK, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_CALM, rc) = 4
			cdata(CDATA_TARGET, rc) = target
			cdata(CDATA_RELATION, rc) = 10
			cdata(CDATA_RELATION_ORG, rc) = 10
			tc = findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK)
			gosub *chat
			gdata(GDATA_FLAG_MAIN) = 730
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_ENTHUMESIS2 | _switch_sw ) {
		_switch_sw = 0
		gdata(STARTING_GDATA_FLAG + 360) = 100
		if ( gdata(GDATA_FLAG_MAIN) == 715 ) {
			txtef COLOR_YELLOW
			txt lang("来光の牙がアストラル光を放ち始めた…。", "The Origin of Light began to release astral light...")
			msg_halt
			txtef COLOR_YELLOW
			txt lang("放たれた光が神の間を包み込む！", "The light emitted enveloped the Eternal Seal!!")
			animeid = ANIMATION_GAMEWIN3
			gosub *anime
			gosub *game_win3
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			if ( tc == CHARA_PLAYER ) {
				flt
				initlv = 200
				novoidlv = 1
				characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_AI_CALM, rc) = 4
				cdata(CDATA_RELATION, rc) = 10
				cdata(CDATA_RELATION_ORG, rc) = 10
			}
			tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
			gosub *chat
			txtef COLOR_RED
			txt lang("何かがエンテュメイシスの腹から飛び出してきた！獣の咆哮が辺りに響く…。", "Something splits <Enthumesis> body and breaks out!")
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			await 50
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			await 50
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			await 50
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			snd SOUNDLIST_BEAST02
			gdata(GDATA_FLAG_MAIN) = 720
		}
		music = MUSICLIST_MCLASTBOSS3
		gosub *music_play
		flt
		initlv = 3500
		novoidlv = 1
		characreate -1, CREATURE_ID_THE_CHAOS_CHILD, 10, 10
		cbitmod CHARA_BIT_SUMMONED, rc, 1
		tc = findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
		gosub *chat
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_KARAVIKA_MUSIC | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_KAMIKAZE) = 0
		tc = findchara(CREATURE_ID_KARAVIKA)
		if ( cdata(CDATA_RELATION, tc) != (-1) ) {
			gosub *chat
		}
		kaiwa = rnd(5)
		if ( kaiwa == 0 ) {
			music = MUSICLIST_MCPETARENA
			gosub *music_play
		}
		if ( kaiwa == 1 ) {
			music = MUSICLIST_MCTOWN9
			gosub *music_play
		}
		if ( kaiwa == 2 ) {
			music = MUSICLIST_MCLASTBOSS3
			gosub *music_play
		}
		if ( kaiwa == 3 ) {
			music = MUSICLIST_MCHUGE
			gosub *music_play
		}
		if ( kaiwa == 4 ) {
			music = MUSICLIST_MCARENA
			gosub *music_play
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MOBILE_COMM_EQUIP | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_MOBILE_COMMUNICATION_EQUIPMENT)
		gosub *chat
		if ( gdata(GDATA_FLAG_MAIN) >= 265 & gdata(GDATA_FLAG_MAIN) < 266 & gdata(GDATA_LEVEL) == 106 ) {
			music = MUSICLIST_MCBATTLE2
			gosub *music_play
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_LESIMAS | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_LEVEL) == 20 ) {
			snd SOUNDLIST_BASH1
			txtef COLOR_YELLOW
			txt lang("「レシマスの真実の書に近づく者は殺す」", cnvtalk("You can not reach the bottom of Lesimas."))
			repeat 3
				flt
				characreate -1, CREATURE_ID_ZANAN_ASSASSIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_TARGET, rc) = 0
				cdata(CDATA_AI_AGGRO, rc) = 30
			loop
			music = MUSICLIST_MCBOSS
			gosub *music_play
		}
		if ( gdata(GDATA_LEVEL) == 25 ) {
			snd SOUNDLIST_BASH1
			txtef COLOR_YELLOW
			txt lang("「《常闇の眼》を狙う冒険者だな？死んでもらおうか！」", cnvtalk("An adventurer seeking the <Origin of Vice>? You seek your own death?!"))
			repeat 6
				flt
				characreate -1, CREATURE_ID_ZANAN_ASSASSIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_TARGET, rc) = 0
				cdata(CDATA_AI_AGGRO, rc) = 30
			loop
			music = MUSICLIST_MCBOSS
			gosub *music_play
		}
		if ( gdata(GDATA_LEVEL) == 30 ) {
			snd SOUNDLIST_BASH1
			repeat 9
				flt
				characreate -1, CREATURE_ID_ZANAN_ASSASSIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_TARGET, rc) = 0
				cdata(CDATA_AI_AGGRO, rc) = 30
			loop
			flt
			characreate -1, CREATURE_ID_ALSAPIA_THE_MURDERER_MASK, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_TARGET, rc) = 0
			cdata(CDATA_AI_AGGRO, rc) = 30
			tc = findchara(CREATURE_ID_ALSAPIA_THE_MURDERER_MASK)
			gosub *chat
			music = MUSICLIST_MCBATTLE2
			gosub *music_play
		}
		if ( gdata(GDATA_LEVEL) == 34 ) {
			snd SOUNDLIST_CURSE2
			txtef COLOR_PURPLE
			txt lang("足を踏み入れた瞬間、周囲の屍が一斉に起き上がった！", "The moment you set foot on this floor, a dozen corpses rise up and attack!")
			repeat 12
				flt
				characreate -1, CREATURE_ID_SKELETON_MAGICIAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_TARGET, rc) = 0
				cdata(CDATA_AI_AGGRO, rc) = 30
			loop
			music = MUSICLIST_MCBOSS
			gosub *music_play
		}
		if ( gdata(GDATA_LEVEL) == 40 ) {
			snd SOUNDLIST_BASH1
			repeat 4
				flt
				characreate -1, CREATURE_ID_GOLDEN_ARMOR, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_TARGET, rc) = 0
				cdata(CDATA_AI_AGGRO, rc) = 30
			loop
			flt
			characreate -1, CREATURE_ID_GILPHEM_THE_MAGIC_STEEL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_TARGET, rc) = 0
			cdata(CDATA_AI_AGGRO, rc) = 30
			tc = findchara(CREATURE_ID_GILPHEM_THE_MAGIC_STEEL)
			gosub *chat
			music = MUSICLIST_MCBATTLE2
			gosub *music_play
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_BIRTHDAY | _switch_sw ) {
		_switch_sw = 0
		music = MUSICLIST_MCMARCH1
		gosub *music_play
		birth = 0
		repeat MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
				continue
			}
			if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
				continue
			}
			birth++
		loop
		repeat MAX_CHARA_TOTAL - MAX_CHARA_FOLLOWER, MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
				continue
			}
			if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
				continue
			}
			birth++
		loop
		if ( birth > 5 ) {
			snd SOUNDLIST_CHEER
			await 2000
			snd SOUNDLIST_CLAP4F
		}
		birth = 0
		repeat MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
				continue
			}
			if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
				continue
			}
			if ( birth > 15 ) {
				continue
			}
			birth++
			tc = cnt
			gosub *chat
		loop
		repeat MAX_CHARA_TOTAL - MAX_CHARA_FOLLOWER, MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_SLEEP, cnt) > 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) >= 60 ) {
				continue
			}
			if ( cdata(CDATA_INTEREST, cnt) <= 0 ) {
				continue
			}
			if ( birth > 15 ) {
				continue
			}
			birth++
			tc = cnt
			gosub *chat
		loop
		flt
		itemcreate -1, ITEM_ID_PRESENT, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		txt lang("へぇ、今日誕生日なんだ？おめでとう！", "Happy birthday!")
		txtmore
		await 2000
		txtsetbirth 2
		repeat 2
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 300, 0
		gosub *prompt_key
		if ( rtval == 0 ) {
			if ( birth > 5 ) {
				snd SOUNDLIST_CHEER
			}
		}
		birth = 0
		txt_questitem
		gdata(STARTING_GDATA_FLAG + 327) = int(gettime(0)) + 1
		gosub *music_play
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_LANKATA | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE)
		gosub *chat
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_AIKAGE | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_AIKAGE_THE_SHINOBI_MASK)
		gosub *chat
		music = MUSICLIST_MCBOSS4
		gosub *music_play
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MARKA | _switch_sw ) {
		_switch_sw = 0
		characreate -1, CREATURE_ID_MARKA_THE_SILVER_BEAR, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		snd SOUNDLIST_BASH1
		snd SOUNDLIST_BASH1
		txt lang("階段を下りた瞬間、あなたは銀髪の冒険者とぶつかった。", "So you are also of the same genus as the others...")
		tc = findchara(CREATURE_ID_MARKA_THE_SILVER_BEAR)
		gosub *chat
		if ( tc > MAX_CHARA_FOLLOWER ) {
			chara_vanquish tc
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_AMURDEAD_SUB_FIREWORKS | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
			if ( gdata(GDATA_LEVEL) == 31 | gdata(GDATA_LEVEL) == 32 ) {
				if ( soulstage == 2 ) {
					tc = findunique(CREATURE_ID_STRAY_SOUL)
					gosub *chat
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
			if ( gdata(GDATA_LEVEL) == 1 ) {
				tc = findunique(CREATURE_ID_STRAY_SOUL)
				gosub *chat
			}
		}
		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
			if ( gdata(GDATA_LEVEL) == 11 | gdata(GDATA_LEVEL) == 12 ) {
				if ( soulstage == 3 ) {
					tc = findunique(CREATURE_ID_HELLABYRINTH_RULER)
					gosub *chat
				}
			}
		}
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_ERYSTIA | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_NT_SOUTH_BORDER ) {
			snd SOUNDLIST_LOCKED1
			await 300
			snd SOUNDLIST_BOLT1
			await 300
			snd SOUNDLIST_BOLT1
			await 300
			snd SOUNDLIST_VOMIT
			await 300
			snd SOUNDLIST_BALL1
		}
		if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
			snd SOUNDLIST_BOLT1
			await 300
			snd SOUNDLIST_BOLT1
			await 300
			snd SOUNDLIST_ATK_ICE
			await 300
			snd SOUNDLIST_ATK_ICE
			await 300
			snd SOUNDLIST_ATK_ICE
		}
		if ( gdata(GDATA_AREA) == AREA_BLIMP ) {
			snd SOUNDLIST_BOLT1
		}
		if ( gdata(GDATA_AREA) == AREA_DOCK ) {
			snd SOUNDLIST_BOLT1
			repeat 4
				await 60
				snd SOUNDLIST_FOOT1A
				snd SOUNDLIST_FOOT1B
				await 60
				snd SOUNDLIST_FOOT1B
				snd SOUNDLIST_FOOT1A
				await 60
			loop
		}
		await 300
		snd SOUNDLIST_EXITMAP1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) == (-3) ) {
				continue
			}
			if ( gdata(GDATA_AREA) == AREA_NT_SOUTH_BORDER ) {
				cdata(CDATA_HP, cnt) -= 2000
				if ( cdata(CDATA_HP, cnt) < 0 ) {
					cdata(CDATA_HP, cnt) = 1
				}
			}
			if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
				if ( cdata(CDATA_ID, cnt) != CREATURE_ID_MARKA_THE_SILVER_BEAR ) {
					cdata(CDATA_CONDITION_CHILLS, cnt) = 50
					cdata(CDATA_HP, cnt) -= 2000 - sdata(SKILL_RES_COLD, cnt) / 50 * 10
					if ( cdata(CDATA_HP, cnt) < 0 ) {
						cdata(CDATA_HP, cnt) = 1
					}
				}
			}
		loop
		txt lang("あなた達は目的地まで辿り着いた…。", "You arrive at your destination...")
		if ( gdata(GDATA_AREA) == AREA_NT_SOUTH_BORDER ) {
			if ( gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) < 5 ) {
				tc = findchara(CREATURE_ID_REGULUS_THE_ALTERED)
				gosub *chat
			}
		}
		if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
			if ( gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) < 5 ) {
				tc = findchara(CREATURE_ID_MARKA_THE_SILVER_BEAR)
				gosub *chat
				music = MUSICLIST_MCBOSS5
				gosub *music_play
			}
		}
		if ( gdata(GDATA_AREA) == AREA_BLIMP ) {
			if ( gdata(GDATA_FLAG_SUB_REGULUS_EULDERNA) < 5 ) {
				tc = findchara(CREATURE_ID_RAIZEL_THE_OLD_WIZARD)
				gosub *chat
				music = MUSICLIST_MCBOSS5
				gosub *music_play
			}
		}
		if ( gdata(GDATA_AREA) == AREA_DOCK ) {
			if ( gdata(GDATA_FLAG_SUB_REGULUS_KIKKASU) < 5 ) {
				tc = findchara(CREATURE_ID_SHURAIDA_THE_EXPERT_MERC)
				gosub *chat
				music = MUSICLIST_MCBOSS5
				gosub *music_play
			}
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SEMINAR | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_CHIME000R
		if ( gdata(GDATA_LEVEL) == 2 ) {
			tc = findchara(CREATURE_ID_AJETALIO_THE_SEMINAR_LECTURER)
			gosub *chat
		}
		if ( gdata(GDATA_LEVEL) == 3 ) {
			tc = findchara(CREATURE_ID_CRESCE_THE_SEMINAR_LECTURER)
			gosub *chat
		}
		if ( gdata(GDATA_LEVEL) == 4 ) {
			tc = findchara(CREATURE_ID_IDURU_THE_SEMINAR_LECTURER)
			gosub *chat
		}
		if ( gdata(GDATA_LEVEL) == 5 ) {
			tc = findchara(CREATURE_ID_MITO_THE_SEMINAR_LECTURER)
			gosub *chat
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_DOCK_WORKER | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_SUB_MISSION_FROM_GARZIEM) \ 10 == 2 ) {
			flt , 4
			characreate -1, CREATURE_ID_WORKER_02, 13, 16
			cdata(CDATA_SEX, rc) = 0
			cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
			cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
			cdata(CDATA_ROLE, rc) = ROLE_CARAVAN_MASTER
			cdata(CDATA_PIC, rc) = 761 + 7 * 1000
			cdata(CDATA_AI_CALM, rc) = 3
			tc = rc
			cbitmod CHARA_BIT_EVENT_TALK, tc, TRUE
			gosub *chat
		}
		tc = findcharawork(CREATURE_ID_WORKER_02)
		if ( tc != 0 ) {
			cdata(CDATA_CONDITION_SLEEP, tc) = 0
			rowactend tc
		}
		gosub *chat
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_CHAOS_CRADLE_CHAT_ORPHE | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_MAIN) = 850
		tc = findchara(CREATURE_ID_ORPHE_THE_CHAOS_DISCPLE)
		gosub *chat
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_CHAOS_CRADLE_CHAT_YAYAUHQUI | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_MAIN) = 860
		if ( findchara(CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA) == 0 ) {
			flt
			initlv = 12000
			novoidlv = 1
			characreate -1, CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_RELATION, rc) = RELATION_ALLY
			cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
		}
		tc = findchara(CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA)
		gosub *chat
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_CHAOS_CRADLE_SPAWN_YAYAUHQUI | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_MAIN) = 870
		if ( findchara(CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA) == 0 ) {
			flt
			initlv = 12000
			novoidlv = 1
			characreate -1, CREATURE_ID_YAYAUHQUI_TEZCATLIPOCA, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_RELATION, rc) = RELATION_ALLY
			cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
		}
		tc = findchara(CREATURE_ID_JALDABAOTH_THE_CHAOS_CHILD)
		gosub *chat
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_CHAOS_CRADLE_CHAT_JALDABAOTH | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_MAIN) == 880 ) {
			tc = findchara(CREATURE_ID_JALDABAOTH_THE_CHAOS_CHILD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
		}
		if ( gdata(GDATA_FLAG_MAIN) == 890 ) {
			tc = findchara(CREATURE_ID_JALDABAOTH_THE_CHAOS_CHILD)
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
		}
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_CHAOS_CRADLE_SPAWN_JALDABAOTH | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_MAIN) = 990
		music = MUSICLIST_SCENE_MUSIC
		gosub *music_play
		flt
		initlv = 1
		novoidlv = 1
		characreate -1, CREATURE_ID_JALDABAOTH_THE_CHAOS_CHILD, 10, 8
		cdata(CDATA_PIC, rc) = xy2pic(0, 24)
		tc = findchara(CREATURE_ID_JALDABAOTH_THE_CHAOS_CHILD)
		if ( tc != CHARA_PLAYER ) {
			gosub *chat
		}
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_NORNE | _switch_sw ) {
		_switch_sw = 0
		characreate -1, CREATURE_ID_NORNE_THE_GUIDE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		snd SOUNDLIST_CHIME
		if ( gdata(GDATA_AREA) == AREA_LOST_YLVA ) {
			music = MUSICLIST_MCLOST1
			gosub *music_play
		}
		tc = findchara(CREATURE_ID_NORNE_THE_GUIDE)
		gosub *chat
		if ( tc > MAX_CHARA_FOLLOWER ) {
			chara_vanquish tc
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MELUGAST | _switch_sw ) {
		_switch_sw = 0
		characreate -1, CREATURE_ID_MELUGAST_TYPE0_THE_DIMENSION_DRIVER, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		tc = findchara(CREATURE_ID_MELUGAST_TYPE0_THE_DIMENSION_DRIVER)
		gosub *chat
		if ( tc > MAX_CHARA_FOLLOWER ) {
			chara_vanquish tc
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SECRET_CHAR | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_draw
		s = lang("隠れていたもの", "Reunion with your pet")
		file = "bg_re13"
		buff = lang("あなたは背後の気配に気付いて、ふと歩みを止めた。振り向いた先にいたのは…", "As you approach the mining town, you notice a familiar call and stop walking. Your old pet who got separated from you during the shipwreck is now running towards you joyfully! Your pet is...")
		listmax = 0
		chatList 1, lang("妹だ！", "a sister!")
		chatList 2, lang("お嬢様だ！", "a young lady!")
		chatList 3, lang("姉だ！", "an older sister!")
		chatList 4, lang("少女だ！", "a little girl!")
		chatList 5, lang("少年だ！", "a little boy!")
		chatList 6, lang("弟だ！", "a brother!")
		chatList 7, lang("執事だ！", "a butler!")
		chatList 8, lang("兄だ！", "an older brother!")
		gosub *re_select
		p = 3
		if ( rtval == 1 ) {
			p = CREATURE_ID_H_SISTER2
		}
		if ( rtval == 2 ) {
			p = CREATURE_ID_WHITE_YOUNG_LADY
		}
		if ( rtval == 3 ) {
			p = CREATURE_ID_LAZY_OLDER_SISTER
		}
		if ( rtval == 4 ) {
			p = CREATURE_ID_M_GIRL
		}
		if ( rtval == 5 ) {
			p = CREATURE_ID_S_BOY
		}
		if ( rtval == 6 ) {
			p = CREATURE_ID_SILVER_FOX_BROTHER
		}
		if ( rtval == 7 ) {
			p = CREATURE_ID_OLD_BUTLER
		}
		if ( rtval == 8 ) {
			p = CREATURE_ID_SICKFULL_OLDER_BROTHER
		}
		flt
		initlv = limit(cdata(CDATA_LEVEL, CHARA_PLAYER) * 2 / 3 + 1, 1, 50)
		novoidlv = 1
		characreate -1, p, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		wishally = 100
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_FIRST_ALLY | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_draw
		s = lang("ペットとの再会", "Reunion with your pet")
		file = "bg_re13"
		buff = lang("あなたは懐かしい鳴き声に気付いて、ふと歩みを止めた。なんと、船が難破した時に居なくなったあなたのペットが、嬉しそうに走ってくる！あなたのペットは…", "As you approach the mining town, you notice a familiar call and stop walking. Your old pet who got separated from you during the shipwreck is now running towards you joyfully! Your pet is...")
		listmax = 0
		chatList 1, lang("犬だ！", "a dog!")
		chatList 2, lang("猫だ！", "a cat!")
		chatList 3, lang("クマだ！", "a bear!")
		chatList 4, lang("少女だ！", "a little girl!")
		gosub *re_select
		p = 3
		if ( rtval == 1 ) {
			p = CREATURE_ID_DOG
		}
		if ( rtval == 2 ) {
			p = CREATURE_ID_CAT
		}
		if ( rtval == 3 ) {
			p = CREATURE_ID_BROWN_BEAR
		}
		if ( rtval == 4 ) {
			p = CREATURE_ID_LITTLE_GIRL
		}
		flt
		initlv = limit(cdata(CDATA_LEVEL, CHARA_PLAYER) * 2 / 3 + 1, 1, 50)
		novoidlv = 1
		characreate -1, p, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		wishally = 100
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_COFFIN | _switch_sw ) {
		_switch_sw = 0
		flt
		itemcreate -1, ITEM_ID_COFFIN_OF_NECROMANCY, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1), 0
		inv(INV_ITEM_PARAM1, ci) = gnecroid
		inv(INV_ITEM_WEIGHT, ci) += gnecroid * 1000
		inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_PARAM3, ci) * 24
		snd SOUNDLIST_CURSE3
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_GODA | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒したオークが起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたはオークにトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_MAD_SCIENTIST | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒した科学者が起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたは科学者にトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_MAD_SCIENTIST, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_ISCA | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒した堕天使が起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたは堕天使にトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_ISCA_THE_FALLEN_ANGEL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_DUNGEON_CLEANER | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒したダンジョンクリーナーが起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたはダンジョンクリーナーにトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_DUNGEON_CLEANER, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_LITYOU | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒した白虎が起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたは白虎にトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_LITYOU, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_MUDER_KNIGHT | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒した騎士が起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたは騎士にトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_MURDER_KNIGHT, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_SUNRISE | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒した龍が起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたは龍にトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_SUNRISE_THE_ARCHIPELAGO_DRAGON, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_WING_SNAIL | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒したかたつむりが起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたはかたつむりにトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_WING_SNAIL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_JOIN_PASCAL | _switch_sw ) {
		_switch_sw = 0
		rc = tc
		txt lang("倒したイヌが起き上がり仲間になりたそうにこちらを見ている。仲間にしますか？", "This monster seems to want to be friends. Do you want to befriend them?")
		promptYesNo
		if ( rtval != 0 ) {
			txt lang("あなたはイヌにトドメを刺した。", "You stabbed the monster in the coffin.")
			goto *event_SWEND1
		}
		if ( rtval == 0 ) {
			txt lang("こんごともよろしく…。", "Thanks in advance.")
			flt
			novoidlv = 1
			characreate -1, CREATURE_ID_PASCAL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		}
		gosub *add_ally
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_MARRY | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_WIZARD) == FALSE ) {
			s = lang(cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER) + "は" + name(marry) + "に永遠の愛を誓った。", cdatan(CDATAN_AKA, CHARA_PLAYER) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + " pledged " + his3(CHARA_PLAYER) + " eternal love to " + name(marry) + ".")
			net_send "marr" + s
		}
		music = MUSICLIST_MCWEDDING
		gosub *music_play
		s = lang("結婚", "Marriage")
		file = "bg_re14"
		buff = lang("長い交際の末、遂にあなたと" + name(marry) + "は固い絆で結ばれた。婚儀の後、あなたの元に幾つか祝儀品が届けられた。", "At last, you and " + name(marry) + " are united in marriage! After the wedding ceremony, you receive some gifts.")
		listmax = 0
		chatList 1, lang("生涯をあなたに捧げる", "Without you, life has no meaning.")
		gosub *re_select
		repeat 3
			flt calcobjlv(cdata(CDATA_LEVEL, marry) + 5), calcfixlv(FIX_QUALITY_GREAT)
			flttypemajor = fsetchest(rnd(length(fsetchest)))
			itemcreate -1, ITEM_ID_DUMMY, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		loop
		if ( gdata(GDATA_MONTH) == 1 ) {
			flt
			itemcreate -1, ITEM_ID_M01_GARNET, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 2 ) {
			flt
			itemcreate -1, ITEM_ID_M02_AMETHYST, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 3 ) {
			flt
			itemcreate -1, ITEM_ID_M03_AQUAMARINE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 4 ) {
			flt
			itemcreate -1, ITEM_ID_M04_DIAMOND, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 5 ) {
			flt
			itemcreate -1, ITEM_ID_M05_EMERALD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 6 ) {
			flt
			itemcreate -1, ITEM_ID_M06_ALEXANDRITE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 7 ) {
			flt
			itemcreate -1, ITEM_ID_M07_RUBY, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 8 ) {
			flt
			itemcreate -1, ITEM_ID_M08_SARDONYX, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 9 ) {
			flt
			itemcreate -1, ITEM_ID_M09_SAPPHIRE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 10 ) {
			flt
			itemcreate -1, ITEM_ID_M10_OPAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 11 ) {
			flt
			itemcreate -1, ITEM_ID_M11_TOPAZ, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		if ( gdata(GDATA_MONTH) == 12 ) {
			flt
			itemcreate -1, ITEM_ID_M12_LAPIS_LAZULI, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
		}
		picols = cdata(CDATA_CHARA_PIC, marry)
		if ( cdata(CDATA_PIC, marry) >= xy2pic(1, 21) & cdata(CDATA_PIC, marry) <= xy2pic(31, 21) ) {
			picols = 0
		}
		itemcreate -1, ITEM_ID_POTION_CURE_CORRUPTION, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), rnd(3) + 2
		flt
		itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, marry) \ COLOR_TINT_MULT + picols * COLOR_TINT_MULT
		inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, marry)
		txt_questitem
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_EAR_CLEANING | _switch_sw ) {
		_switch_sw = 0
		tc = tcbk
		if ( komaku >= 3 ) {
			mimikaki = 10
			komaku = 0
			haretu = 0
			snd SOUNDLIST_STAB
			txt lang("「〜〜〜〜〜〜〜〜〜っ！！！！！？？」", cnvtalk("!!!???")), lang("「耳が、耳がぁ〜！！」", cnvtalk("Eeeeeeeeeek!"))
			modimp tc, -20
			dmghp tc, rnd(sdata(SKILL_ATTR_STR, CHARA_PLAYER) * sqrt(sdata(SKILL_ATTR_STR, CHARA_PLAYER)) + sdata(SKILL_ATTR_STR, CHARA_PLAYER)), tc, SKILL_RES_SOUND, 1000
			goto *event_SWEND1
		}
		if ( haretu >= 3 ) {
			mimikaki = 10
			komaku = 0
			haretu = 0
			snd SOUNDLIST_BALL1
			txt lang("「ひぎぃ！？」", cnvtalk("What are you doing!?")), lang("「もうイヤー！」", cnvtalk("No...No...!"))
			modimp tc, -10
			dmgcon tc, CONDITION_BLEED, 100
			goto *event_SWEND1
		}
		if ( mimikaki < 3 ) {
			s = lang("耳掃除", "Mimikaki")
			file = "bg40"
			buff = lang("耳の中は見えづらい…。", "It's hard to see inside " + his(tc) + " ear...")
			listmax = 0
			if ( rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + sdata(SKILL_ATTR_PER, CHARA_PLAYER) + sdata(SKILL_ATTR_CON, tc) + sdata(SKILL_ATTR_WIL, tc)) > rnd(sorg(SKILL_ATTR_SPD, tc) + 10) ) {
				if ( mimikaki == 0 ) {
					chatList 1, lang("慎重に入れる", "Put in carefully")
				}
				if ( mimikaki == 1 ) {
					chatList 2, lang("奥まで入れる", "Put in all the way")
				}
				if ( mimikaki == 2 ) {
					chatList 3, lang("丹念に掻き出す", "Carefully scrape")
				}
			}
			if ( rnd(sdata(SKILL_ATTR_WIL, CHARA_PLAYER) + 10) > rnd(sdata(SKILL_ATTR_WIL, tc) + 10) ) {
				chatList 4, lang("サイズの調整", "Size adjustment")
			}
			if ( haretu == 0 ) {
				chatList 8, lang("サイズ膨張", "Size expansion")
			}
			if ( haretu == 1 ) {
				chatList 9, lang("サイズ大膨張", "Size expansion (large)")
			}
			if ( haretu == 2 ) {
				chatList 10, lang("耳穴破裂", "Rupture ear canal")
			}
			if ( komaku == 0 ) {
				chatList 5, lang("突き入れる", "Shove in")
			}
			if ( komaku == 1 ) {
				chatList 6, lang("奥まで突き刺す", "Thrust in deeply")
			}
			if ( komaku == 2 ) {
				chatList 7, lang("鼓膜をぶち破る", "Break through the eardrum")
			}
			gosub *re_select
			p = rtval
			if ( p == 1 | p == 2 | p == 3 ) {
				mimikaki++
				snd SOUNDLIST_SNOW
				if ( mimikaki == 1 ) {
					txt lang("「なんだか変な感じ" + _da(3) + "」", cnvtalk("It is somehow strange feeling.")), lang("「少しこわい" + _na(3) + "」", cnvtalk("A little scary.")), lang("「優しくして" + _kure(3) + "…」", cnvtalk("Please be gentle..."))
				}
				if ( mimikaki == 2 ) {
					txt lang("「くっ…♪」", cnvtalk("Oh…")), lang("「気持ちいい" + _na(3) + "♪」", cnvtalk("It feels good...!")), lang("「くすぐったい" + _yo(3) + "♪」", cnvtalk("That tickles!"))
				}
			}
			if ( p == 4 ) {
				haretu = 0
				snd SOUNDLIST_OFFER2
			}
			if ( p == 5 | p == 6 | p == 7 ) {
				komaku++
				snd SOUNDLIST_CRACK
				if ( komaku < 3 ) {
					txt lang("「痛っ！」", cnvtalk("Ouch!")), lang("「鼓膜に当たった" + _yo(3) + "！？」", cnvtalk("You are hurting my eardrum!")), lang("「乱暴にしないで" + _kure(3) + "！」", cnvtalk("Don't be rough!"))
				}
			}
			if ( p == 8 | p == 9 | p == 10 ) {
				haretu++
				snd SOUNDLIST_CRACK2
				if ( haretu < 3 ) {
					txt lang("「なんか膨らんできた" + _yo(3) + "！？」", cnvtalk("Something has swelled!?")), lang("「" + _ore(3) + "には大きすぎる" + _na(3) + "…」", cnvtalk("It's too big for me...")), lang("「ちょっと落ち着いて" + _kure(3) + "！」", cnvtalk("Calm down a little!"))
				}
			}
			if ( mimikaki >= 3 ) {
				komaku = 0
				haretu = 0
				snd SOUNDLIST_DING3
				mimikaki = rnd(sqrt(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 1) + 10)
				if ( mimikaki < 5 ) {
					txt lang("粉末みみくそがとれた！", "Some powdered earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 5000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 5000
					skillexp SKILL_ATTR_CON, tc, 5000
					skillexp SKILL_ATTR_WIL, tc, 5000
				}
				if ( mimikaki >= 5 & mimikaki < 15 ) {
					txt lang("欠片みみくそがとれた！", "Some pieces of earwax have been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 6000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 6000
					skillexp SKILL_ATTR_CON, tc, 6000
					skillexp SKILL_ATTR_WIL, tc, 6000
				}
				if ( mimikaki >= 15 & mimikaki < 20 ) {
					txt lang("膜状みみくそがとれた！", "Some membranous earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 7000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 7000
					skillexp SKILL_ATTR_CON, tc, 7000
					skillexp SKILL_ATTR_WIL, tc, 7000
				}
				if ( mimikaki >= 20 & mimikaki < 25 ) {
					txt lang("塊みみくそがとれた！", "A clump of earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 8000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 8000
					skillexp SKILL_ATTR_CON, tc, 8000
					skillexp SKILL_ATTR_WIL, tc, 8000
				}
				if ( mimikaki >= 25 ) {
					txt lang("ひとつなぎのみみくそがとれた！", "A mass of collected earwax was removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 9000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 9000
					skillexp SKILL_ATTR_CON, tc, 9000
					skillexp SKILL_ATTR_WIL, tc, 9000
				}
				mimikaki = 3
			}
			evadd EVENT_EAR_CLEANING
		}
		if ( mimikaki >= 3 & mimikaki < 10 ) {
			s = lang("反対側の耳", "Opposite ear")
			file = "bg41"
			buff = lang("構造が反転していてやりづらい…。", "It's difficult to do the same thing with everything reversed...")
			listmax = 0
			if ( rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + sdata(SKILL_ATTR_PER, CHARA_PLAYER) + sdata(SKILL_ATTR_CON, tc) + sdata(SKILL_ATTR_WIL, tc)) > rnd(sorg(SKILL_ATTR_SPD, tc) + 10) ) {
				if ( mimikaki == 3 ) {
					chatList 1, lang("慎重に入れる", "Put in carefully")
				}
				if ( mimikaki == 4 ) {
					chatList 2, lang("奥まで入れる", "Put in all the way")
				}
				if ( mimikaki == 5 ) {
					chatList 3, lang("丹念に掻き出す", "Carefully scrape")
				}
			}
			if ( rnd(sdata(SKILL_ATTR_WIL, CHARA_PLAYER) + 10) > rnd(sdata(SKILL_ATTR_WIL, tc) + 10) ) {
				chatList 4, lang("サイズの調整", "Size adjustment")
			}
			if ( haretu == 0 ) {
				chatList 8, lang("サイズ膨張", "Size expansion")
			}
			if ( haretu == 1 ) {
				chatList 9, lang("サイズ大膨張", "Size large expansion")
			}
			if ( haretu == 2 ) {
				chatList 10, lang("耳穴破裂", "Rupture ear canal")
			}
			if ( komaku == 0 ) {
				chatList 5, lang("突き入れる", "Shove in")
			}
			if ( komaku == 1 ) {
				chatList 6, lang("奥まで突き刺す", "Thrust in deeply")
			}
			if ( komaku == 2 ) {
				chatList 7, lang("鼓膜をぶち破る", "Break through the eardrum")
			}
			gosub *re_select
			p = rtval
			if ( p == 1 | p == 2 | p == 3 ) {
				mimikaki++
				snd SOUNDLIST_SNOW
				if ( mimikaki == 4 ) {
					txt lang("「なんだか変な感じ" + _da(3) + "」", cnvtalk("It is somehow strange feeling.")), lang("「少しこわい" + _na(3) + "」", cnvtalk("A little scary.")), lang("「優しくして" + _kure(3) + "…」", cnvtalk("Please be gentle..."))
				}
				if ( mimikaki == 5 ) {
					txt lang("「くっ…♪」", cnvtalk("Oh…")), lang("「気持ちいい" + _na(3) + "♪」", cnvtalk("It feels good...!")), lang("「くすぐったい" + _yo(3) + "♪」", cnvtalk("That tickles!"))
				}
			}
			if ( p == 4 ) {
				haretu = 0
				snd SOUNDLIST_OFFER2
			}
			if ( p == 5 | p == 6 | p == 7 ) {
				komaku++
				snd SOUNDLIST_CRACK
				if ( komaku < 3 ) {
					txt lang("「痛っ！」", cnvtalk("Ouch!")), lang("「鼓膜に当たった" + _yo(3) + "！？」", cnvtalk("You are hurting my eardrum!")), lang("「乱暴にしないで" + _kure(3) + "！」", cnvtalk("Don't be rough!"))
				}
			}
			if ( p == 8 | p == 9 | p == 10 ) {
				haretu++
				snd SOUNDLIST_CRACK2
				if ( haretu < 3 ) {
					txt lang("「なんか膨らんできた" + _yo(3) + "！？」", cnvtalk("Something has swelled!?")), lang("「" + _ore(3) + "には大きすぎる" + _na(3) + "…」", cnvtalk("It's too big for me...")), lang("「ちょっと落ち着いて" + _kure(3) + "！」", cnvtalk("Calm down a little!"))
				}
			}
			if ( mimikaki >= 6 ) {
				komaku = 0
				haretu = 0
				snd SOUNDLIST_COMPLETE1
				mimikaki = rnd(sqrt(sdata(SKILL_ATTR_DEX, CHARA_PLAYER) + 1) + 10)
				if ( mimikaki < 5 ) {
					txt lang("粉末みみくそがとれた！", "The powdered earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 5000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 5000
					skillexp SKILL_ATTR_CON, tc, 5000
					skillexp SKILL_ATTR_WIL, tc, 5000
				}
				if ( mimikaki >= 5 & mimikaki < 15 ) {
					txt lang("欠片みみくそがとれた！", "The debris of the earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 6000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 6000
					skillexp SKILL_ATTR_CON, tc, 6000
					skillexp SKILL_ATTR_WIL, tc, 6000
				}
				if ( mimikaki >= 15 & mimikaki < 20 ) {
					txt lang("膜状みみくそがとれた！", "The membranous earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 7000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 7000
					skillexp SKILL_ATTR_CON, tc, 7000
					skillexp SKILL_ATTR_WIL, tc, 7000
				}
				if ( mimikaki >= 20 & mimikaki < 25 ) {
					txt lang("塊みみくそがとれた！", "The lump of earwax has been removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 8000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 8000
					skillexp SKILL_ATTR_CON, tc, 8000
					skillexp SKILL_ATTR_WIL, tc, 8000
				}
				if ( mimikaki >= 25 ) {
					txt lang("ひとつなぎのみみくそがとれた！", "All the earwax was connected and removed!")
					skillexp SKILL_ATTR_DEX, CHARA_PLAYER, 9000
					skillexp SKILL_ATTR_PER, CHARA_PLAYER, 9000
					skillexp SKILL_ATTR_CON, tc, 9000
					skillexp SKILL_ATTR_WIL, tc, 9000
				}
				txt lang("「こんなに出た" + _noka(3) + "？」", cnvtalk("Is it over?")), lang("「気持ちよかった" + _yo(3) + "」", cnvtalk("It was comfortable!")), lang("「またして" + _kure(3) + "…」", cnvtalk("Please do more...!"))
				mimikaki = 10
				cdata(CDATA_EMO_ICON, tc) = 17 + 100 * 3
				goto *event_SWEND1
			}
			evadd EVENT_EAR_CLEANING
		}
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_BIRTH | _switch_sw ) {
		_switch_sw = 0
		s = lang("誕生", "Birth")
		file = "bg39"
		buff = lang("今、この世界で新たな生命活動が開始…産まれたのだ。", "Now, a small first cry echoes in this world...")
		listmax = 0
		chatList 1, lang("遂に…！", "Finally!")
		chatList 2, lang("おぉぉぉぉ！", "Woooooo!")
		chatList 3, lang("今日は眠れないな", "I can't sleep tonight.")
		gosub *re_select
		snd SOUNDLIST_OFFER2
		if ( ccbk != 0 ) {
			babyid = cdata(CDATA_ID, ccbk)
		}
		if ( ccbk == 0 ) {
			babyid = cdata(CDATA_INFANT, ccbk)
		}
		babyai = cdata(CDATA_INFANT, ccbk)
		cdata(CDATA_SP_EARNED, ccbk) = -cdata(CDATA_SP_EARNED, ccbk) \ 10000
		if ( 0 ) {
			txt lang(name(ccbk) + "の" + babyid + "と" + babyai + "ステージ端数" + cdata(CDATA_SP_EARNED, ccbk) + "。", name(cc) + " get genes of " + _s(cc) + ".")
		}
		bsid = cdata(CDATA_SP_EARNED, ccbk) / 100
		bsids = cdata(CDATA_SP_EARNED, ccbk) \ 100
		babymake = 1
		repeat 20
			if ( cdata(CDATA_TAMER_WHIP_PICKUP, ccbk) <= 0 & cdata(CDATA_TAMER_WHIP_EAT, ccbk) <= 0 ) {
				break
			}
			if ( cdata(CDATA_TAMER_WHIP_PICKUP, ccbk) > 0 ) {
				babysex = 10
				flt
				characreate MAX_CHARA_NC, babyai, -3, 0
				flt
				initlv = 1
				novoidlv = 1
				characreate -1, babyid, cdata(CDATA_X, ccbk), cdata(CDATA_Y, ccbk)
				cdata(CDATA_SPRITE_SIZE_MILK, rc) = -5
				cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR)
				cdata(CDATA_QUALITY, rc) = FIX_QUALITY_UNIQUE
				cbitmod CHARA_BIT_BIRTHED_CHILD, rc, TRUE
				cdata(CDATA_SEX, rc) = 0
				cdata(CDATA_PORTRAIT, rc) = -1
				cdatan(CDATAN_NAME, rc) = lang(cdatan(CDATAN_NAME, ccbk) + "の息子", "son of " + cdatan(CDATAN_NAME, ccbk))
				cdatan(CDATAN_NAME, rc) = lang("《", "{") + cdatan(CDATAN_NAME, rc) + lang("》", "}")
				cdata(CDATA_AI_MOVE_FREQ, rc) = cdata(CDATA_AI_MOVE_FREQ, MAX_CHARA_NC)
				cdata(CDATA_AI_DISTANCE, rc) = cdata(CDATA_AI_DISTANCE, MAX_CHARA_NC)
				cdata(CDATA_AI_SUB, rc) = cdata(CDATA_AI_SUB, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN, rc) = cdata(STARTING_CDATA_ACT_MAIN, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 1, rc) = cdata(STARTING_CDATA_ACT_MAIN + 1, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 2, rc) = cdata(STARTING_CDATA_ACT_MAIN + 2, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 3, rc) = cdata(STARTING_CDATA_ACT_MAIN + 3, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 4, rc) = cdata(STARTING_CDATA_ACT_MAIN + 4, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB, rc) = cdata(STARTING_CDATA_ACT_SUB, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 1, rc) = cdata(STARTING_CDATA_ACT_SUB + 1, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 2, rc) = cdata(STARTING_CDATA_ACT_SUB + 2, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 3, rc) = cdata(STARTING_CDATA_ACT_SUB + 3, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 4, rc) = cdata(STARTING_CDATA_ACT_SUB + 4, MAX_CHARA_NC)
				cdata(CDATA_ACT_INDEX, rc) = cdata(CDATA_ACT_INDEX, MAX_CHARA_NC)
				chara_vanquish MAX_CHARA_NC
				cdata(CDATA_TAMER_WHIP_PICKUP, ccbk)--
				wishally = 200
				gdata(GDATA_TEMPORARY_FLAGS2) = 200
				gosub *add_ally
			}
			if ( cdata(CDATA_TAMER_WHIP_EAT, ccbk) > 0 ) {
				babysex = 11
				flt
				characreate MAX_CHARA_NC, babyai, -3, 0
				flt
				initlv = 1
				novoidlv = 1
				characreate -1, babyid, cdata(CDATA_X, ccbk), cdata(CDATA_Y, ccbk)
				cdata(CDATA_SPRITE_SIZE_MILK, rc) = -5
				cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR)
				cdata(CDATA_QUALITY, rc) = FIX_QUALITY_UNIQUE
				cbitmod CHARA_BIT_BIRTHED_CHILD, rc, TRUE
				cdata(CDATA_SEX, rc) = 1
				cdata(CDATA_PORTRAIT, rc) = -1
				cdatan(CDATAN_NAME, rc) = lang(cdatan(CDATAN_NAME, ccbk) + "の娘", "daughter of " + cdatan(CDATAN_NAME, ccbk))
				cdatan(CDATAN_NAME, rc) = lang("《", "{") + cdatan(CDATAN_NAME, rc) + lang("》", "}")
				cdata(CDATA_AI_MOVE_FREQ, rc) = cdata(CDATA_AI_MOVE_FREQ, MAX_CHARA_NC)
				cdata(CDATA_AI_DISTANCE, rc) = cdata(CDATA_AI_DISTANCE, MAX_CHARA_NC)
				cdata(CDATA_AI_SUB, rc) = cdata(CDATA_AI_SUB, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN, rc) = cdata(STARTING_CDATA_ACT_MAIN, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 1, rc) = cdata(STARTING_CDATA_ACT_MAIN + 1, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 2, rc) = cdata(STARTING_CDATA_ACT_MAIN + 2, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 3, rc) = cdata(STARTING_CDATA_ACT_MAIN + 3, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_MAIN + 4, rc) = cdata(STARTING_CDATA_ACT_MAIN + 4, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB, rc) = cdata(STARTING_CDATA_ACT_SUB, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 1, rc) = cdata(STARTING_CDATA_ACT_SUB + 1, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 2, rc) = cdata(STARTING_CDATA_ACT_SUB + 2, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 3, rc) = cdata(STARTING_CDATA_ACT_SUB + 3, MAX_CHARA_NC)
				cdata(STARTING_CDATA_ACT_SUB + 4, rc) = cdata(STARTING_CDATA_ACT_SUB + 4, MAX_CHARA_NC)
				cdata(CDATA_ACT_INDEX, rc) = cdata(CDATA_ACT_INDEX, MAX_CHARA_NC)
				chara_vanquish MAX_CHARA_NC
				cdata(CDATA_TAMER_WHIP_EAT, ccbk)--
				wishally = 200
				gdata(GDATA_TEMPORARY_FLAGS2) = 200
				gosub *add_ally
			}
		loop
		gdata(GDATA_TEMPORARY_FLAGS2) = 0
		babymake = 0
		babysex = 0
		wishally = 0
		cdata(CDATA_SP_EARNED, ccbk) = 0
		cdata(CDATA_INFANT, ccbk) = 0
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_BOYCIANA, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_ARTIFACT_LOTTERY | _switch_sw ) {
		_switch_sw = 0
		s = lang("くじ引き", "Lottery")
		file = "bg38"
		buff = lang("あなたの目の前に富の女神が現れ、くじ引きの箱を置いた。", "The goddess of wealth appears in front of you and places down a lottery box.")
		listmax = 0
		chatList 1, lang("祈りながらくじを選ぶ", "Good luck to me.")
		chatList 2, lang("最初に手に触れたくじを選ぶ", "First lottery ticket that touches my hand is fated.")
		chatList 3, lang("漁りながら、これだ！と感じたくじを選ぶ", "I leave it to my intuition!")
		gosub *re_select
		redraw 0
		gosub *screen_draw
		gosub *screen_fade
		gsel BUFFER_BUF
		buffer 4, FACE_SIZE_WIDTH, FACE_SIZE_HEIGHT
		pos 0, 0
		picload exedir + "graphic\\face1" + devfile + ".bmp", 1
		gsel BUFFER_SCREEN
		snd SOUNDLIST_CHIME
		await 300
		snd SOUNDLIST_CHIME
		await 300
		snd SOUNDLIST_CHIME
		s = lang("星の光", "Result")
		file = "bg39"
		buff = lang("手にしたくじが光の粒子に変わり、あなたの足元に集まっていく…。", "The lottery ticket in your hand turns into light particles, which start to gather at your feet...")
		listmax = 0
		chatList 1, lang("何だろう？", "What could it be?")
		chatList 2, lang("これは…！", "This is...!")
		chatList 3, lang("来いッ！", "Come on!")
		gosub *re_select
		snd SOUNDLIST_OFFER2
		animeload 32, 0
		kaiwa = rnd(25)
		if ( kaiwa == 0 ) {
			id = ITEM_ID_GO_RENGE
		}
		if ( kaiwa == 1 ) {
			id = ITEM_ID_EPECLAIR
		}
		if ( kaiwa == 2 ) {
			id = ITEM_ID_GOUTEN
		}
		if ( kaiwa == 3 ) {
			id = ITEM_ID_DGT_101
		}
		if ( kaiwa == 4 ) {
			id = ITEM_ID_NUMENIUS
		}
		if ( kaiwa == 5 ) {
			id = ITEM_ID_ENGOKU
		}
		if ( kaiwa == 6 ) {
			id = ITEM_ID_POWER_TRIANGLE
		}
		if ( kaiwa == 7 ) {
			id = ITEM_ID_CROSS_RAIL
		}
		if ( kaiwa == 8 ) {
			id = ITEM_ID_NAZUNAS_SOX
		}
		if ( kaiwa == 9 ) {
			id = ITEM_ID_SCORPIERCE
		}
		if ( kaiwa == 10 ) {
			id = ITEM_ID_YOMI_TO
		}
		if ( kaiwa == 11 ) {
			id = ITEM_ID_RINKHALS
		}
		if ( kaiwa == 12 ) {
			id = ITEM_ID_LINGS_BOW
		}
		if ( kaiwa == 13 ) {
			id = ITEM_ID_BEETLE_CYBORG
		}
		if ( kaiwa == 14 ) {
			id = ITEM_ID_ASSAULT_GOLD
		}
		if ( kaiwa == 15 ) {
			id = ITEM_ID_DOKURO_MIKADUKI
		}
		if ( kaiwa == 16 ) {
			id = ITEM_ID_BLOODY_TEARS
		}
		if ( kaiwa == 17 ) {
			id = ITEM_ID_NIGHTMARE
		}
		if ( kaiwa == 18 ) {
			id = ITEM_ID_GEMINI
		}
		if ( kaiwa == 19 ) {
			id = ITEM_ID_HIRYU_TO
		}
		if ( kaiwa == 20 ) {
			id = ITEM_ID_MAUSER_C96_CUSTOM
		}
		if ( kaiwa == 21 ) {
			id = ITEM_ID_FIVE_HORNED_HELM
		}
		if ( kaiwa == 22 ) {
			id = ITEM_ID_GOULDS_PIANO
		}
		if ( kaiwa == 23 ) {
			id = ITEM_ID_BAMBNIR
		}
		if ( kaiwa == 24 ) {
			id = ITEM_ID_ZANTETSUKEN
		}
		flt
		itemcreate -1, id, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		txt_questitem
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_VOID | _switch_sw ) {
		_switch_sw = 0
		voidboss = CREATURE_ID_UNGAGA_THE_MINOTAUR_KING, CREATURE_ID_WHOM_DWELL_IN_THE_VANITY, CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN, CREATURE_ID_VESDA_THE_FIRE_DRAGON, CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE, CREATURE_ID_ISSIZZLE_THE_DARK_ABOMINATION, CREATURE_ID_WYNAN_THE_LORD_OF_THE_ANCIENT_CASTLE, CREATURE_ID_QURUIZA_THE_RED_EYED_DECEIVER, CREATURE_ID_CORGON_THE_STEEL_DRAGON, CREATURE_ID_RODLOB_THE_YEEK_CHIEF, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID, CREATURE_ID_CACY_THE_CAT_TAMER, CREATURE_ID_EBON_THE_FIRE_GIANT, CREATURE_ID_AT_SIGN, CREATURE_ID_LARNNEIRE_THE_LISTENER_OF_WIND, CREATURE_ID_XABI_THE_KING_OF_PALMIA, CREATURE_ID_STRAY_CAT, CREATURE_ID_SLAN_THE_SHADOW_OF_PALMIA, CREATURE_ID_KARAM_THE_LONELY_WOLF_OF_KARUNE, CREATURE_ID_GWEN_THE_INNOCENT
		if ( gdata(GDATA_FLAG_MAIN) > 180 ) {
			voidboss = CREATURE_ID_AZZRSSIL_THE_IMPURE, CREATURE_ID_WHOM_DWELL_IN_THE_VANITY, CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN, CREATURE_ID_VESDA_THE_FIRE_DRAGON, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN, CREATURE_ID_ISSIZZLE_THE_DARK_ABOMINATION, CREATURE_ID_WYNAN_THE_LORD_OF_THE_ANCIENT_CASTLE, CREATURE_ID_QURUIZA_THE_RED_EYED_DECEIVER, CREATURE_ID_CORGON_THE_STEEL_DRAGON, CREATURE_ID_RODLOB_THE_YEEK_CHIEF, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID, CREATURE_ID_CACY_THE_CAT_TAMER, CREATURE_ID_AT_SIGN, CREATURE_ID_XABI_THE_KING_OF_PALMIA, CREATURE_ID_SLAN_THE_SHADOW_OF_PALMIA, CREATURE_ID_KARAM_THE_LONELY_WOLF_OF_KARUNE, CREATURE_ID_GWEN_THE_INNOCENT, CREATURE_ID_ZEOME_THE_FALSE_PROPHET, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, CREATURE_ID_GETUEI_THE_NINJA_MASTER
		}
		if ( gdata(GDATA_FLAG_MAIN) > 350 ) {
			voidboss = CREATURE_ID_AZZRSSIL_THE_IMPURE, CREATURE_ID_WHOM_DWELL_IN_THE_VANITY, CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN, CREATURE_ID_VESDA_THE_FIRE_DRAGON, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN, CREATURE_ID_ISSIZZLE_THE_DARK_ABOMINATION, CREATURE_ID_WYNAN_THE_LORD_OF_THE_ANCIENT_CASTLE, CREATURE_ID_QURUIZA_THE_RED_EYED_DECEIVER, CREATURE_ID_CORGON_THE_STEEL_DRAGON, CREATURE_ID_RODLOB_THE_YEEK_CHIEF, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID, CREATURE_ID_CACY_THE_CAT_TAMER, CREATURE_ID_AT_SIGN, CREATURE_ID_XABI_THE_KING_OF_PALMIA, CREATURE_ID_SLAN_THE_SHADOW_OF_PALMIA, CREATURE_ID_KARAM_THE_LONELY_WOLF_OF_KARUNE, CREATURE_ID_GWEN_THE_INNOCENT, CREATURE_ID_SIVA_THE_DESTRUCTION, CREATURE_ID_YERLESWOOD_THE_SAVAGE_MACHINE, CREATURE_ID_ULZASSIL_THE_DEAD_EMPEROR, CREATURE_ID_ZEOME_THE_FALSE_PROPHET, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, CREATURE_ID_GETUEI_THE_NINJA_MASTER, CREATURE_ID_ORPHE_THE_CHAOS_FOLLOWER, CREATURE_ID_MURDER_COCKROACH, CREATURE_ID_GOKIBURI
		}
		randomize gdata(GDATA_YEAR) + gdata(GDATA_LEVEL)
		c = voidboss(rnd(length(voidboss)))
		randomize
		flt
		fixlv = FIX_QUALITY_MIRACLE
		initlv = limit(gdata(GDATA_LEVEL) + 20, 1, 6666)
		novoidlv = 1
		characreate -1, c, -3, 0
		cbitmod CHARA_BIT_PRECIOUS, rc, 1
		cdata(CDATA_RELATION, rc) = -3
		cdata(CDATA_RELATION_ORG, rc) = -3
		tc = rc
		adata(ADATA_BOSS, gdata(GDATA_AREA)) = tc
		txtef COLOR_RED
		txtmore
		txt lang("気をつけろ！この階は" + mapname(gdata(GDATA_AREA)) + "の守護者、" + cdatan(CDATAN_NAME, tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gdata(GDATA_AREA)) + ", " + cdatan(CDATAN_NAME, tc) + ".")
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_BOSS_RANDOM | _switch_sw ) {
		_switch_sw = 0
		repeat
			if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) == WAKEUP_NEFIA_NONE ) {
				gosub *fltChara
				fixlv = FIX_QUALITY_MIRACLE
				initlv = gdata(GDATA_LEVEL) + rnd(5)
				characreate -1, CREATURE_ID_BUG, -3, 0
				if ( stat == 0 ) {
					continue
				}
				else {
					cbitmod CHARA_BIT_PRECIOUS, rc, 1
					break
				}
			}
			if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) != WAKEUP_NEFIA_NONE ) {
				gosub *fltChara
				fixlv = FIX_QUALITY_MIRACLE
				initlv = gdata(GDATA_LEVEL) + 100
				characreate -1, CREATURE_ID_BUG, -3, 0
				if ( stat == 0 ) {
					continue
				}
				else {
					cbitmod CHARA_BIT_PRECIOUS, rc, 1
					cbitmod CHARA_BIT_AWAKE_NEAR_DEATH_DAMAGE, rc, 1
					cbitmod CHARA_BIT_AWAKE_NEAR_DEATH_EVASION, rc, 1
					break
				}
			}
		loop
		tc = rc
		adata(ADATA_BOSS, gdata(GDATA_AREA)) = tc
		cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
		txt lang("どうやら最深層まで辿り着いたらしい…", "It seems you have reached the deepest level of this dungeon.")
		txtef COLOR_RED
		txtmore
		txt lang("気をつけろ！この階は" + mapname(gdata(GDATA_AREA)) + "の守護者、" + cdatan(CDATAN_NAME, tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gdata(GDATA_AREA)) + ", " + cdatan(CDATAN_NAME, tc) + ".")
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_WIN_BOSS_RANDOM | _switch_sw ) {
		_switch_sw = 0
		if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) == (-1) ) {
			goto *event_SWEND1
		}
		music = MUSICLIST_MCVICTORY
		gosub *music_play
		snd SOUNDLIST_COMPLETE1
		nkane = limit(gdata(GDATA_LEVEL), 1, 400)
		flt calcobjlv(), calcfixlv()
		flttypemajor = FILTER_ITEM_SPELLBOOK
		itemcreate -1, ITEM_ID_DUMMY, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		flt
		itemcreate -1, ITEM_ID_SCROLL_ESCAPE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		flt
		itemcreate -1, ITEM_ID_SCROLL_RETURN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		flt
		itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), limit(nkane * 1000 + nkane * nkane * 5, 1000, 999999)
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), limit(1 + gdata(GDATA_LEVEL) / 20, 1, 5)
		flt
		itemcreate -1, ITEM_ID_BEJEWELED_CHEST, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_PARAM2, ci) = 0
		if ( gdata(GDATA_AREA) != AREA_VOID ) {
			if ( gdata(GDATA_FLAG_DESTINY_NEFIA_BOSSES_DEFEATED) < 1 ) {
				gdata(GDATA_FLAG_DESTINY_NEFIA_BOSSES_DEFEATED)++
				if ( gdata(GDATA_FLAG_DESTINY_NEFIA_BOSSES_DEFEATED) >= 1 ) {
					if ( gdata(GDATA_FLAG_DESTINY_LETTERS) < 7 ) {
						gdata(GDATA_FLAG_DESTINY_LETTERS)++
					}
				}
			}
			gskill = SKILL_NORMAL_DISARM_TRAP
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "kobolt" ) {
				gskill = SKILL_ACTIVE_PICKPOCKET
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "orc" ) {
				gskill = SKILL_NORMAL_SHIELD
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "largeanimal" ) {
				gskill = SKILL_NORMAL_SENSE_QUALITY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "lizardman" ) {
				gskill = SKILL_NORMAL_SHIELD
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "minotaur" ) {
				gskill = SKILL_NORMAL_EYE_OF_MIND
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "yerles" ) {
				gskill = SKILL_WEAPON_THROWING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "norland" ) {
				gskill = SKILL_NORMAL_TWO_HAND
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "eulderna" ) {
				gskill = SKILL_NORMAL_INVESTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "fairy" ) {
				gskill = SKILL_ACTIVE_PICKPOCKET
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "asura" ) {
				gskill = SKILL_NORMAL_DUAL_WIELD
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "slime" ) {
				gskill = SKILL_NORMAL_EVASION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "doggod" ) {
				gskill = SKILL_NORMAL_EYE_OF_MIND
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "dwarf" ) {
				gskill = SKILL_NORMAL_MINING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "juere" ) {
				gskill = SKILL_NORMAL_PERFORMER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "zombie" ) {
				gskill = SKILL_NORMAL_COOKING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "elea" ) {
				gskill = SKILL_NORMAL_MEMORIZATION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "rabbit" ) {
				gskill = SKILL_NORMAL_TRAVELING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "sheep" ) {
				gskill = SKILL_NORMAL_TAILORING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "frog" ) {
				gskill = SKILL_NORMAL_SWIMMING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "worm" ) {
				gskill = SKILL_NORMAL_MINING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "snail" ) {
				gskill = SKILL_WEAPON_THROWING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "mandrake" ) {
				gskill = SKILL_NORMAL_MEMORIZATION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "beetle" ) {
				gskill = SKILL_NORMAL_CASTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "mushroom" ) {
				gskill = SKILL_NORMAL_GARDENING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "bat" ) {
				gskill = SKILL_NORMAL_GREATER_EVASION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "ent" ) {
				gskill = SKILL_NORMAL_CARPENTRY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "lich" ) {
				gskill = SKILL_NORMAL_MAGIC_DEVICE
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "bacteria" ) {
				gskill = SKILL_NORMAL_GENE_ENGINEER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "ghost" ) {
				gskill = SKILL_NORMAL_DISARM_TRAP
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "spirit" ) {
				gskill = SKILL_NORMAL_INVESTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "eye" ) {
				gskill = SKILL_NORMAL_GENE_ENGINEER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "mazin" ) {
				gskill = SKILL_NORMAL_TACTICS
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "wasp" ) {
				gskill = SKILL_NORMAL_GARDENING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "giant" ) {
				gskill = SKILL_NORMAL_ANATOMY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "imp" ) {
				gskill = SKILL_NORMAL_NEGOTIATION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "hand" ) {
				gskill = SKILL_NORMAL_COOKING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "snake" ) {
				gskill = SKILL_NORMAL_STEALTH
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "drake" ) {
				gskill = SKILL_NORMAL_CONTROL_MAGIC
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "goblin" ) {
				gskill = SKILL_NORMAL_FISHING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "bear" ) {
				gskill = SKILL_NORMAL_EYE_OF_MIND
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "armor" ) {
				gskill = SKILL_NORMAL_LOCK_PICKING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "medusa" ) {
				gskill = SKILL_NORMAL_ALCHEMY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "cupid" ) {
				gskill = SKILL_NORMAL_CONTROL_MAGIC
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "karune" ) {
				gskill = SKILL_NORMAL_GARDENING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "harpy" ) {
				gskill = SKILL_NORMAL_MAGIC_CAPACITY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "dragon" ) {
				gskill = SKILL_NORMAL_JEWELER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "dinosaur" ) {
				gskill = SKILL_NORMAL_TRAVELING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "beast" ) {
				gskill = SKILL_NORMAL_CASTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "spider" ) {
				gskill = SKILL_NORMAL_TAILORING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "golem" ) {
				gskill = SKILL_NORMAL_WEIGHT_LIFTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "rock" ) {
				gskill = SKILL_NORMAL_MARKSMAN
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "zanan" ) {
				gskill = SKILL_NORMAL_PERFORMER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "skeleton" ) {
				gskill = SKILL_NORMAL_LOCK_PICKING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "piece" ) {
				gskill = SKILL_NORMAL_TACTICS
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "cat" ) {
				gskill = SKILL_NORMAL_GREATER_EVASION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "dog" ) {
				gskill = SKILL_NORMAL_SWIMMING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "roran" ) {
				gskill = SKILL_NORMAL_LITERACY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "rat" ) {
				gskill = SKILL_NORMAL_STEALTH
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "shell" ) {
				gskill = SKILL_NORMAL_SENSE_QUALITY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "catgod" ) {
				gskill = SKILL_NORMAL_GREATER_EVASION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "machinegod" ) {
				gskill = SKILL_NORMAL_MARKSMAN
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "undeadgod" ) {
				gskill = SKILL_NORMAL_CONTROL_MAGIC
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "machine" ) {
				gskill = SKILL_NORMAL_CARPENTRY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "wisp" ) {
				gskill = SKILL_NORMAL_MEDITATION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "bird" ) {
				gskill = SKILL_NORMAL_ANATOMY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "seamonster" ) {
				gskill = SKILL_NORMAL_FAITH
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "catsister" ) {
				gskill = SKILL_NORMAL_TWO_HAND
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "mutant" ) {
				gskill = SKILL_NORMAL_MAGIC_CAPACITY
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "yeek" ) {
				gskill = SKILL_NORMAL_NEGOTIATION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "yith" ) {
				gskill = SKILL_NORMAL_MAGIC_DEVICE
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "servant" ) {
				gskill = SKILL_NORMAL_CASTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "horse" ) {
				gskill = SKILL_NORMAL_WEIGHT_LIFTING
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "god" ) {
				gskill = SKILL_NORMAL_DUAL_WIELD
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "quickling" ) {
				gskill = SKILL_NORMAL_EVASION
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "metal" ) {
				gskill = SKILL_NORMAL_JEWELER
			}
			if ( cdatan(CDATAN_RACE, adata(ADATA_BOSS, gdata(GDATA_AREA))) == "vehicle" ) {
				gskill = SKILL_NORMAL_DISARM_TRAP
			}
			kazu = 0
			if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) != 0 ) {
				kazu++
			}
			if ( gdata(GDATA_FLAG_NEFIA_FEVER_ACTIVE) == 100 ) {
				kazu++
			}
			flt
			itemcreate -1, ITEM_ID_MEMORY_FRAGMENT, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 5 + kazu
			inv(INV_ITEM_PARAM1, ci) = gskill
			inv(INV_ITEM_PARAM2, ci) = limit(gdata(GDATA_LEVEL), 1, 999)
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
			flt
			itemcreate -1, ITEM_ID_MEMORY_CONVERTER, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), limit(gdata(GDATA_LEVEL) / 50 + 1, 1, 5) + kazu
			inv(INV_ITEM_PARAM1, ci) = gskill
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		}
		if ( adata(ADATA_EXTRA_MEDAL, gdata(GDATA_AREA)) > 0 ) {
			flt
			itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			if ( gdata(GDATA_FLAG_NEFIA_FEVER_ACTIVE) == 100 ) {
				flt
				itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			}
			if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) != WAKEUP_NEFIA_NONE ) {
				flt
				itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			}
		}
		adata(ADATA_EXTRA_MEDAL, gdata(GDATA_AREA)) = 0
		if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) != WAKEUP_NEFIA_NONE ) {
			if ( adata(ADATA_NEFIA_GEM_CHANCE, gdata(GDATA_AREA)) > 0 ) {
				flt
				itemcreate -1, ITEM_ID_CORE_OF_NEFIA, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			}
		}
		adata(ADATA_NEFIA_GEM_CHANCE, gdata(GDATA_AREA)) = 0
		if ( gdata(GDATA_DEEPEST_LEVEL) < gdata(GDATA_LEVEL) ) {
			gdata(GDATA_DEEPEST_LEVEL) = gdata(GDATA_LEVEL)
		}
		txtef COLOR_GREEN
		txt_questcompleted
		txtmore
		txt_questitem
		modrank 2, 300, 8
		gdata(GDATA_QUEST_FAME) = calcfame(0, gdata(GDATA_LEVEL) * 30 + 200)
		txtef COLOR_GREEN
		txtmore
		txt lang("" + gdata(GDATA_QUEST_FAME) + "の名声値を手に入れた。", "You gain " + gdata(GDATA_QUEST_FAME) + " fame.")
		cdata(CDATA_FAME, CHARA_PLAYER) += gdata(GDATA_QUEST_FAME)
		if ( gdata(GDATA_AREA) == AREA_VOID ) {
			adata(ADATA_BOSS, gdata(GDATA_AREA)) = 0
			gdata(GDATA_VOID_BOSS) = gdata(GDATA_VOID_BOSS) + 5
			txt lang("この階の封印が解けたようだ！", "The seal of this level is now broken!")
		}
		else {
			gdata(GDATA_FLAG_NEFIA_CONQUERED)++
			adata(ADATA_BOSS, gdata(GDATA_AREA)) = -1
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_CLIENT_REACHED | _switch_sw ) {
		_switch_sw = 0
		txt lang("あなたは無事に護衛の任務を終えた。", "You complete the escort.")
		tc = evdata2(evnum - (evnum != 0) * 1)
		gosub *chat
		rq = evdata1(evnum - (evnum != 0) * 1)
		gosub *quest_success
		chara_vanquish evdata2(evnum - (evnum != 0) * 1)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_CLIENT_DEAD | _switch_sw ) {
		_switch_sw = 0
		repeat gdata(GDATA_CLIENT)
			if ( qdata(QDATA_EXIST, cnt) == QUEST_TYPE_ESCORT ) {
				if ( qdata(QDATA_STATUS, cnt) == QUEST_STATE_ONGOING ) {
					if ( qdata(QDATA_PARAM2, cnt) == evdata1(evnum - (evnum != 0) * 1) ) {
						rq = cnt
						val = qdata(QDATA_EXIST, rq)
						gosub *quest_fail
						break
					}
				}
			}
		loop
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_DEAD | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_LEVEL, CHARA_PLAYER) >= 10 ) {
			repeat STARTING_SKILL_RESIST - STARTING_SKILL_ATTR, STARTING_SKILL_ATTR
				if ( cnt < (STARTING_SKILL_ATTR + MAX_SKILL_ATTR_BASIC) ) {
					if ( sdata(cnt, CHARA_PLAYER) != 0 ) {
						if ( rnd(3) == 0 ) {
							txtmore
							skillexp cnt, CHARA_PLAYER, -500
						}
					}
				}
			loop
			if ( cdata(CDATA_KARMA, CHARA_PLAYER) < (-30) ) {
				modkarma CHARA_PLAYER, 10
			}
		}
		else {
			txt lang("レベル10に達していないので能力値の減少はない。", "Death penalty won't be applied until you hit Lv 10.")
		}
		if ( gdata(GDATA_CORRUPTION) >= 20000 ) {
			modcorrupt -2000
		}

		txtmore

		/********** ORIGINAL - BEGINNING **********

		txt lang("金貨を幾らか失った…", "You lost some money.")
		cdata(CDATA_GOLD, CHARA_PLAYER) -= cdata(CDATA_GOLD, CHARA_PLAYER) / 3

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Show items and gold lost on death.

		msg_newline
		if ( items_lost_on_death != "" ) {
			txtef COLOR_RED
			txt lang("落としたアイテム: ", "Dropped items: ") + items_lost_on_death
			msg_newline
		}

		gold_lost_on_death = cdata(CDATA_GOLD, CHARA_PLAYER) / 3
		if ( gold_lost_on_death > 0 ) {
			cdata(CDATA_GOLD, CHARA_PLAYER) -= gold_lost_on_death

			txtef COLOR_RED
			txt lang("落とした金貨: ", "Dropped gold: ") + gold_lost_on_death + "gp."
		}

		/********** BLOODYSHADE CUSTOM - ENDING **********/

		decfame CHARA_PLAYER, 10
		r1 = CHARA_PLAYER
		gosub *charaRefresh
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_KILL_MOTHER | _switch_sw ) {
		_switch_sw = 0
		dmghp evdata1(evnum - (evnum != 0) * 1), 9999, DAMAGE_FROM_UNSEEN
		cdata(CDATA_ROLE, evdata1(evnum - (evnum != 0) * 1)) = ROLE_NONE
		cdata(CDATA_EXIST, evdata1(evnum - (evnum != 0) * 1)) = CHAR_STATE_DEAD
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, evdata1(evnum - (evnum != 0) * 1)), cdata(CDATA_Y, evdata1(evnum - (evnum != 0) * 1)), 4
		gdata(GDATA_FLAG_SUB_MOTHER) = 1001
		tc = findchara(CREATURE_ID_LONELY_PAEL)
		if ( tc != CHARA_PLAYER ) {
			if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				txtef COLOR_BLUE
				txt lang("パエル「おかあさんーー！！」", cnvtalk("M-mom...!!"))
				cdata(CDATA_RELATION, tc) = -3
				cdata(CDATA_AI_AGGRO, tc) = 1000
				cdata(CDATA_TARGET, tc) = 0
			}
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_TEZCATLIPOCA_ADDS2 | _switch_sw ) {
		_switch_sw = 0
		flt
		initlv = 200
		novoidlv = 1
		characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, 10, 7
		cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_TEZCATLIPOCA2 | _switch_sw ) {
		_switch_sw = 0
		flt
		initlv = 200
		novoidlv = 1
		characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		msg_halt
		msg_clear
		txtef COLOR_YELLOW
		txt lang("「合格だ！」", cnvtalk("You passed!"))
		msg_halt
		txtef COLOR_YELLOW
		txt lang("「お前は決戦因子としてふさわしい力を示した」", cnvtalk("You've shown you have suitable strength to be considered the Deciding Factor in a decisive battle."))
		msg_halt
		txtef COLOR_YELLOW
		txt lang("「これなら混沌の神も倒せるかもしれん…いや、きっと倒せる！」", cnvtalk("As you are now, you might even be able to defeat the God of Chaos... No, I'm certain you can!"))
		msg_halt
		repeat 2
			tc = findchara(CREATURE_ID_TALON_SOLDIER)
			if ( tc > CHARA_PLAYER ) {
				chara_vanquish tc
			}
		loop
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_TEZCATLIPOCA | _switch_sw ) {
		_switch_sw = 0
		chara_vanquish findchara(CREATURE_ID_BLACK_GAUNTLET_LEOLD)
		txtef COLOR_YELLOW
		txt lang("「望み通り戦ってやろう！」", cnvtalk("Let's fight as you wish!!"))
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_TEZCATLIPOCA, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
		cdata(CDATA_POWER_GAUGE, rc) = 100
		cdata(CDATA_RELATION, rc) = -3
		cdata(CDATA_AI_AGGRO, rc) = 1000
		cdata(CDATA_TARGET, rc) = 0
		music = MUSICLIST_MCBOSS5
		gosub *music_play
		gdata(GDATA_FLAG_MAIN) = 675
		tc = findchara(CREATURE_ID_TEZCATLIPOCA)
		if ( tc != CHARA_PLAYER ) {
			if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				animeid = ANIMATION_GENE
				anic = tc
				gosub *anime
				cc = tc
				efid = SKILL_SPACT_SMOKE_MIRROR
				gosub *effect
				evadd EVENT_TEZCATLIPOCA_ADDS
			}
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_TEZCATLIPOCA_ADDS | _switch_sw ) {
		_switch_sw = 0
		txtsettezca 3
		repeat 3
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 250, 0
		gosub *prompt_key
		txtef COLOR_YELLOW
		txt lang("「これが返事だ」", cnvtalk("This is my reply!!"))
		snd SOUNDLIST_PUNISH1
		if ( cfg_attackanime ) {
			animeload ANIMATION_UNISON_IMPACT1, CHARA_PLAYER
		}
		cdata(CDATA_HP, CHARA_PLAYER) = (cdata(CDATA_HP, CHARA_PLAYER) + 1) * 3 / 5
		cc = tc
		efid = SKILL_SPACT_DIMENSIONAL_MOVE
		gosub *effect
		flt
		characreate -1, CREATURE_ID_TALON_SOLDIER, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
		cdata(CDATA_AI_AGGRO, rc) = 1000
		cdata(CDATA_TARGET, rc) = 0
		flt
		characreate -1, CREATURE_ID_TALON_SOLDIER, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
		cdata(CDATA_AI_AGGRO, rc) = 1000
		cdata(CDATA_TARGET, rc) = 0
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SQUEEZE | _switch_sw ) {
		_switch_sw = 0
		cdata(CDATA_HP, evdata1(evnum - (evnum != 0) * 1)) = 0
		dmghp evdata1(evnum - (evnum != 0) * 1), 10, DAMAGE_FROM_SCALP
		cdata(CDATA_ROLE, evdata1(evnum - (evnum != 0) * 1)) = ROLE_NONE
		cdata(CDATA_EXIST, evdata1(evnum - (evnum != 0) * 1)) = CHAR_STATE_DEAD
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_KUNOICHI | _switch_sw ) {
		_switch_sw = 0
		dmghp evdata1(evnum - (evnum != 0) * 1), 99999, DAMAGE_FROM_UNSEEN
		cdata(CDATA_ROLE, evdata1(evnum - (evnum != 0) * 1)) = ROLE_NONE
		cdata(CDATA_EXIST, evdata1(evnum - (evnum != 0) * 1)) = CHAR_STATE_DEAD
		flt
		itemcreate -1, ITEM_ID_SPEED_RING, cdata(CDATA_X, evdata1(evnum - (evnum != 0) * 1)), cdata(CDATA_Y, evdata1(evnum - (evnum != 0) * 1)), 0
		flt
		itemcreate -1, ITEM_ID_GERBERA_CROSS, cdata(CDATA_X, evdata1(evnum - (evnum != 0) * 1)), cdata(CDATA_Y, evdata1(evnum - (evnum != 0) * 1)), 0
		txtef COLOR_BLUE
		txt lang("？？？「本当に忍をやめたければ死ぬしかない。これが忍の掟だ」", "??? says: \"If you truly wish to no longer be a ninja, then you must die. This is the law of ninjas.\"")
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SPECIAL_SPAWN_COND | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN ) {
			flt
			characreate -1, CREATURE_ID_FRON_THE_TOUR_PLANNER, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_CALM, rc) = 3
			cbitmod CHARA_BIT_GUEST, rc, 1
		}
		if ( mdata(MDATA_TYPE) >= MAP_TYPE_DUNGEON_MIN ) {
			flt
			initlv = limit(gdata(GDATA_LEVEL) * 3 / 4, 1, 1300)
			novoidlv = 1
			characreate -1, CREATURE_ID_13TH_STEP_GHOST, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			cdata(CDATA_AI_AGGRO, rc) = 80
			cdata(CDATA_TARGET, rc) = 0
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SPAWN_EVENT_NPCS | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_HOME ) {
			if ( gdata(GDATA_FLAG_INVITED_GOD) != 0 ) {
				gdata(GDATA_TEMPORARY_FLAGS2) = 10
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_MANI ) {
					dbid = CREATURE_ID_MANI
					txt lang("機械のマニ「これが定命の住居か。記録しておこう」", cnvtalk("Well done. After all, you might be useful than I thought."))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_LULWY ) {
					dbid = CREATURE_ID_LULWY
					txt lang("風のルルウィ「この中で嵐を起こしたらさぞかし爽快でしょうね…冗談よ」", cnvtalk("Oh my little puppet, you serve me well."))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_ITZPALT ) {
					dbid = CREATURE_ID_ITZPALT
					txt lang("元素のイツパロトル「楽園か…懐かしい響きだ」", cnvtalk("Impressive. Your action shall be remembered."))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_EHEKATL ) {
					dbid = CREATURE_ID_EHEKATL
					txt lang("幸運のエヘカトル「うみみゃ！たらばがに！たらばがにどこ？」", cnvtalk("Wheeee! I'm so happy. I like you! I like you!"))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_OPATOS ) {
					dbid = CREATURE_ID_OPATOS
					txt lang("地のオパートス「フッハハハハー！フハハハー！お邪魔するぞ！」", cnvtalk("Muwahaha muwaha. Good. Good!"))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_JURE ) {
					dbid = CREATURE_ID_JURE
					txt lang("癒しのジュア「お、お邪魔します…うっ！私の部屋より片付いてる…」", cnvtalk("W-What? I-I'm not gonna praise you. I'm not!"))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_KUMIROMI ) {
					dbid = CREATURE_ID_KUMIROMI
					txt lang("収穫のクミロミ「ここが君の家なんだね…。隅々まで見ても…いいかな…？」", cnvtalk("Good work... truly..."))
				}
				if ( gdata(GDATA_FLAG_INVITED_GOD) == CREATURE_ID_YACATECT ) {
					dbid = CREATURE_ID_YACATECT
					txt lang("富のヤカテクト「へぇぇ、これで入場料タダなん？もったいないわぁ…」", cnvtalk("Good job, just like that! Keep it up!"))
				}
				flt
				novoidlv = 1
				characreate -1, dbid, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_AI_CALM, rc) = 2
				gdata(GDATA_FLAG_INVITED_GOD) = 0
			}
		}
		if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
			flt
			characreate -1, CREATURE_ID_MARKA_THE_SILVER_BEAR, 50, 13
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
		}
		if ( gdata(GDATA_AREA) == AREA_NT_SOUTH_BORDER ) {
			if ( gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) < 100 ) {
				flt
				characreate -1, CREATURE_ID_REGULUS_THE_ALTERED, 15, 22
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
			if ( gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) >= 1000 ) {
				flt
				characreate -1, CREATURE_ID_RENAI_THE_OVER_MESHERA, 16, 22
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
		}
		if ( gdata(GDATA_AREA) == AREA_ST_NORTH_BORDER ) {
			flt
			characreate -1, CREATURE_ID_ZISILION_THE_MINE_KING, 9, 10
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_TRUCE_GROUND ) {
			flt
			characreate -1, CREATURE_ID_TALKA_THE_LONG_TWINTAIL, 16, 4
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			flt
			itemcreate -1, ITEM_ID_AURTEHOM, 25, 16, 0
		}
		if ( gdata(GDATA_AREA) == AREA_PALMIA ) {
			flt
			characreate -1, CREATURE_ID_KURON_THE_BLACK_CLOTH, 51, 30
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_YOWYN ) {
			flt
			characreate -1, CREATURE_ID_GWEN_THE_PITILESS, 14, 12
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_KURUALM ) {
			flt
			characreate -1, CREATURE_ID_NEW_CITIZEN, 21, 34
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_LARNA ) {
			if ( gdata(GDATA_FLAG_VISITED_LARNA) == 0 ) {
				gdata(GDATA_FLAG_VISITED_LARNA) = 1
				if ( findchara(CREATURE_ID_CHILD_WEL) != 0 ) {
					chara_vanquish findchara(CREATURE_ID_CHILD_WEL)
				}
				flt
				characreate -1, CREATURE_ID_CHILD_WEL, 13, 20
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
			if ( gdata(GDATA_FLAG_SUB_NORNE_THE_GUIDE) == 0 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 394 ) {
					gdata(GDATA_FLAG_SUB_NORNE_THE_GUIDE) = 1
					if ( findchara(CREATURE_ID_NORNE_THE_GUIDE) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_NORNE_THE_GUIDE)
					}
					flt
					characreate -1, CREATURE_ID_NORNE_THE_GUIDE, 23, 4
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
					cdata(CDATA_AI_CALM, rc) = 3
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_MAID_MANSION ) {
			flt
			characreate -1, CREATURE_ID_GOKIBURI, 25, 13
		}
		if ( gdata(GDATA_AREA) == AREA_ARCBELC ) {
			flt
			characreate -1, CREATURE_ID_LENAS_THE_MAGE_REPORTER, 27, 13
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_VALM ) {
			flt
			characreate -1, CREATURE_ID_RATIN_THE_FIGHTER_REPORTER, 8, 13
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_MELKAWN ) {
			flt
			characreate -1, CREATURE_ID_NAGA_THE_THIEF_REPORTER, 11, 6
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_MELUGAS ) {
			if ( gdata(GDATA_FLAG_VISITED_MELUGAS) == 0 ) {
				gdata(GDATA_FLAG_VISITED_MELUGAS) = 1
				if ( findchara(CREATURE_ID_YERLESWOOD_NEO) != 0 ) {
					chara_vanquish findchara(CREATURE_ID_YERLESWOOD_NEO)
				}
				flt
				characreate -1, CREATURE_ID_YERLESWOOD_NEO, 26, 18
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 480 ) {
				gdata(GDATA_FLAG_VISITED_MELUGAS) = 2
				if ( findchara(CREATURE_ID_MELUGAST_TYPEM) != 0 ) {
					chara_vanquish findchara(CREATURE_ID_MELUGAST_TYPEM)
				}
				flt
				characreate -1, CREATURE_ID_MELUGAST_TYPEM, 26, 23
				if ( stat != 0 ) {
					cdata(CDATA_AI_CALM, rc) = 3
					cdata(CDATA_RELATION, rc) = -1
					cdata(CDATA_RELATION_ORG, rc) = -1
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_OL_DRAN ) {
			flt
			characreate -1, CREATURE_ID_MELGET_THE_INFORMER, 42, 12
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_DOCK ) {
			if ( gdata(GDATA_LEVEL) == 1 ) {
				flt
				characreate -1, CREATURE_ID_KUROYA_THE_LOOKING_UNIVERSE, 6, 14
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
			if ( gdata(GDATA_LEVEL) == 60 ) {
				flt
				characreate -1, CREATURE_ID_SHURAIDA_THE_EXPERT_MERC, 12, 29
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
				cdata(CDATA_AI_CALM, rc) = 3
			}
		}
		if ( gdata(GDATA_AREA) == AREA_HARVEST_SHIP ) {
			flt
			characreate -1, CREATURE_ID_JIN_THE_MACHINE_REBEL, 2, 19
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
		}
		if ( gdata(GDATA_AREA) == AREA_ULM_LESON ) {
			flt
			characreate -1, CREATURE_ID_MELUGAST_TYPE0_THE_DIMENSION_DRIVER, 24, 4
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_YLVA_LIBRARY ) {
			flt
			characreate -1, CREATURE_ID_ARIBEL_THE_WHITE_ARMS, 24, 16
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
		}
		if ( gdata(GDATA_AREA) == AREA_ANCIENT_GARDEN ) {
			flt
			characreate -1, CREATURE_ID_MELUGAST_TYPE0_THE_DIMENSION_DRIVER, 5, 29
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_CYBER_DOME ) {
			flt
			characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, 15, 21
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_RUOZA ) {
			flt
			initlv = 100
			novoidlv = 1
			characreate -1, CREATURE_ID_BLACK_GAUNTLET_LEOLD, 12, 5
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_GUARDIAN_SHRINE ) {
			flt
			characreate -1, CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE, 11, 5
			cdata(CDATA_RELATION, rc) = 0
			cdata(CDATA_RELATION_ORG, rc) = 0
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
			flt
			characreate -1, CREATURE_ID_ALFRED_THE_CANGNAN_WIND, 12, 5
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
		}
		if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE ) {
			if ( gdata(GDATA_LEVEL) == 173 ) {
				flt
				novoidlv = 1
				characreate -1, CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
				cdata(CDATA_RELATION, rc) = 0
				cdata(CDATA_RELATION_ORG, rc) = 0
				cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			}
		}
		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
			if ( gdata(GDATA_LEVEL) == 1 ) {
				if ( gdata(GDATA_FLAG_SUB_BEILGENA_THE_ARTIFICIAL_DRAGON) == 1000 ) {
					gdata(GDATA_FLAG_SUB_BEILGENA_THE_ARTIFICIAL_DRAGON) = 1001
					if ( findchara(CREATURE_ID_BEILGENA_THE_ARTIFICIAL_DRAGON) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_BEILGENA_THE_ARTIFICIAL_DRAGON)
					}
					flt
					characreate -1, CREATURE_ID_BEILGENA_THE_ARTIFICIAL_DRAGON, 9, 8
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_GRAVEED_THE_GRAVITY_VALLEY) == 1000 ) {
					gdata(GDATA_FLAG_SUB_GRAVEED_THE_GRAVITY_VALLEY) = 1001
					if ( findchara(CREATURE_ID_GRAVEED_THE_GRAVITY_VALLEY) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_GRAVEED_THE_GRAVITY_VALLEY)
					}
					flt
					characreate -1, CREATURE_ID_GRAVEED_THE_GRAVITY_VALLEY, 10, 9
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_DOROTHIA_STANDING_IN_THE_WETLAND) == 1000 ) {
					gdata(GDATA_FLAG_SUB_DOROTHIA_STANDING_IN_THE_WETLAND) = 1001
					if ( findchara(CREATURE_ID_DOROTHIA_STANDING_IN_THE_WETLAND) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_DOROTHIA_STANDING_IN_THE_WETLAND)
					}
					flt
					characreate -1, CREATURE_ID_DOROTHIA_STANDING_IN_THE_WETLAND, 12, 9
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_MINOTAUR) == 1000 ) {
					gdata(GDATA_FLAG_SUB_MINOTAUR) = 1001
					if ( findchara(CREATURE_ID_UNGAGA_THE_MINOTAUR_KING) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_UNGAGA_THE_MINOTAUR_KING)
					}
					flt
					characreate -1, CREATURE_ID_UNGAGA_THE_MINOTAUR_KING, 39, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_CAT) == 1000 ) {
					gdata(GDATA_FLAG_SUB_CAT) = 1001
					if ( findchara(CREATURE_ID_CACY_THE_CAT_TAMER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_CACY_THE_CAT_TAMER)
					}
					flt
					characreate -1, CREATURE_ID_CACY_THE_CAT_TAMER, 35, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_PYRAMID) == 1000 ) {
					gdata(GDATA_FLAG_SUB_PYRAMID) = 1001
					if ( findchara(CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID)
					}
					flt
					characreate -1, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID, 44, 23
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_YEEK) == 1000 ) {
					gdata(GDATA_FLAG_SUB_YEEK) = 1001
					if ( findchara(CREATURE_ID_RODLOB_THE_YEEK_CHIEF) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_RODLOB_THE_YEEK_CHIEF)
					}
					flt
					characreate -1, CREATURE_ID_RODLOB_THE_YEEK_CHIEF, 42, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_H_SISTER) == 1000 ) {
					gdata(GDATA_FLAG_SUB_H_SISTER) = 1001
					if ( findchara(CREATURE_ID_H_SISTER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_H_SISTER)
					}
					flt
					characreate -1, CREATURE_ID_H_SISTER, 39, 28
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_PIRATE_HUNTING) == 1000 ) {
					gdata(GDATA_FLAG_SUB_PIRATE_HUNTING) = 1001
					if ( findchara(CREATURE_ID_EBARTH_THE_PIRATE_BOSS) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_EBARTH_THE_PIRATE_BOSS)
					}
					flt
					characreate -1, CREATURE_ID_EBARTH_THE_PIRATE_BOSS, 33, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_DOGS_TAIL) == 1000 ) {
					gdata(GDATA_FLAG_SUB_DOGS_TAIL) = 1001
					if ( findchara(CREATURE_ID_ESTORK_THE_DOGGOD) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ESTORK_THE_DOGGOD)
					}
					flt
					characreate -1, CREATURE_ID_ESTORK_THE_DOGGOD, 37, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_MANSION_FOR_SALE) == 1004 ) {
					gdata(GDATA_FLAG_SUB_MANSION_FOR_SALE) = 1005
					if ( findchara(CREATURE_ID_KING_COCKROACH) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_KING_COCKROACH)
					}
					flt
					characreate -1, CREATURE_ID_KING_COCKROACH, 41, 28
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_MOTHER) == 1001 ) {
					gdata(GDATA_FLAG_SUB_MOTHER) = 1006
					if ( findchara(CREATURE_ID_PAELS_MOM_LILY) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_PAELS_MOM_LILY)
					}
					flt
					characreate -1, CREATURE_ID_PAELS_MOM_LILY, 45, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_WHEN_THE_FLAME_BURNS_OUT) == 1000 ) {
					gdata(GDATA_FLAG_SUB_WHEN_THE_FLAME_BURNS_OUT) = 1001
					if ( findchara(CREATURE_ID_VANSESDA_THE_ANCIENT_FIRE) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_VANSESDA_THE_ANCIENT_FIRE)
					}
					flt
					characreate -1, CREATURE_ID_VANSESDA_THE_ANCIENT_FIRE, 16, 23
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_REGULUS_EULDERNA) == 1000 ) {
					gdata(GDATA_FLAG_SUB_REGULUS_EULDERNA) = 1001
					if ( findchara(CREATURE_ID_INQTUAL_THE_REVENGE) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_INQTUAL_THE_REVENGE)
					}
					if ( findchara(CREATURE_ID_PALACE_MAGICIAN) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_PALACE_MAGICIAN)
					}
					flt
					characreate -1, CREATURE_ID_INQTUAL_THE_REVENGE, 10, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					flt
					characreate -1, CREATURE_ID_PALACE_MAGICIAN, -3, 0
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 2
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) == 1000 ) {
					gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) = 1001
					if ( findchara(CREATURE_ID_LAZASYE_THE_DESTROY) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LAZASYE_THE_DESTROY)
					}
					flt
					characreate -1, CREATURE_ID_LAZASYE_THE_DESTROY, 13, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) == 1004 ) {
					gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) = 1005
					if ( findchara(CREATURE_ID_TESTER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_TESTER)
					}
					flt
					characreate -1, CREATURE_ID_TESTER, 19, 25
					cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
					cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_REGULUS_KIKKASU) == 1000 ) {
					gdata(GDATA_FLAG_SUB_REGULUS_KIKKASU) = 1001
					if ( findchara(CREATURE_ID_ROATONIS_THE_INFECTIONS) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ROATONIS_THE_INFECTIONS)
					}
					flt
					characreate -1, CREATURE_ID_ROATONIS_THE_INFECTIONS, 16, 25
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_THE_RESULT_OF_REVENGE) == 1003 ) {
					gdata(GDATA_FLAG_SUB_THE_RESULT_OF_REVENGE) = 1004
					if ( findchara(CREATURE_ID_CONDUCTOR_KOALA) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_CONDUCTOR_KOALA)
					}
					flt
					characreate -1, CREATURE_ID_CONDUCTOR_KOALA, 10, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_SUB_NINE_HEAD_DRAGON) == 4 ) {
					gdata(GDATA_FLAG_SUB_NINE_HEAD_DRAGON) = 5
					if ( findchara(CREATURE_ID_NINE_HEAD_DRAGON_THE_ABYSS) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_NINE_HEAD_DRAGON_THE_ABYSS)
					}
					flt
					characreate -1, CREATURE_ID_NINE_HEAD_DRAGON_THE_ABYSS, 13, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_VISITED_MELUGAS) == 2 ) {
					gdata(GDATA_FLAG_VISITED_MELUGAS) = 3
					if ( findchara(CREATURE_ID_EGELVEIL_THE_BIND) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_EGELVEIL_THE_BIND)
					}
					flt
					characreate -1, CREATURE_ID_EGELVEIL_THE_BIND, 16, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_34) == 1 ) {
					gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_34) = 2
					if ( findchara(CREATURE_ID_ALFRED_THE_CANGNAN_WIND) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ALFRED_THE_CANGNAN_WIND)
					}
					flt
					characreate -1, CREATURE_ID_ALFRED_THE_CANGNAN_WIND, 19, 28
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
				}
				if ( gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_25) == 1000 ) {
					gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_25) = 1001
					if ( findchara(CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE)
					}
					if ( findchara(CREATURE_ID_ZANAN_ENHANCED_SOLDIER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ZANAN_ENHANCED_SOLDIER)
					}
					if ( findchara(CREATURE_ID_LOTHRIAN_AGENT) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LOTHRIAN_AGENT)
					}
					flt
					characreate -1, CREATURE_ID_LANKATA_THE_LIGHTNING_OF_BLUE, 19, 29
					cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
					cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
					cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					flt
					characreate -1, CREATURE_ID_ZANAN_ENHANCED_SOLDIER, -3, 0
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 2
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
					flt
					characreate -1, CREATURE_ID_LOTHRIAN_AGENT, -3, 0
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 2
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_25) == 100 ) {
					gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_25) = 101
					if ( findchara(CREATURE_ID_ZANAN_ENHANCED_SOLDIER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ZANAN_ENHANCED_SOLDIER)
					}
					if ( findchara(CREATURE_ID_LOTHRIAN_AGENT) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LOTHRIAN_AGENT)
					}
					flt
					characreate -1, CREATURE_ID_ZANAN_ENHANCED_SOLDIER, -3, 0
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 2
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
					flt
					characreate -1, CREATURE_ID_LOTHRIAN_AGENT, -3, 0
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 2
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_ENTHUMESIS_SPAWNED) == 100 ) {
					gdata(GDATA_FLAG_ENTHUMESIS_SPAWNED) = 101
					if ( findchara(CREATURE_ID_ENTHUMESIS) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ENTHUMESIS)
					}
					flt
					characreate -1, CREATURE_ID_ENTHUMESIS, 27, 16
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 3
						cdata(CDATA_RELATION, rc) = RELATION_DISLIKE
						cdata(CDATA_RELATION_ORG, rc) = RELATION_DISLIKE
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_ASSASSIN_EVENTS_FOR_ALSAPIA_GILPHEM) == 55 ) {
					gdata(GDATA_FLAG_ASSASSIN_EVENTS_FOR_ALSAPIA_GILPHEM) = 60
					if ( findchara(CREATURE_ID_ALSAPIA_THE_MURDERER_MASK) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_ALSAPIA_THE_MURDERER_MASK)
					}
					if ( findchara(CREATURE_ID_GILPHEM_THE_MAGIC_STEEL) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_GILPHEM_THE_MAGIC_STEEL)
					}
					flt
					characreate -1, CREATURE_ID_ALSAPIA_THE_MURDERER_MASK, 36, 9
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 3
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
					flt
					characreate -1, CREATURE_ID_GILPHEM_THE_MAGIC_STEEL, 39, 9
					if ( stat != 0 ) {
						cdata(CDATA_AI_CALM, rc) = 3
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
			}
			if ( gdata(GDATA_LEVEL) == 2 ) {
				if ( gdata(GDATA_FLAG_AMUR_CAGE_SIVA) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_SIVA_THE_DESTRUCTION) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_SIVA) = 1
						if ( findchara(CREATURE_ID_SIVA_THE_DESTRUCTION) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_SIVA_THE_DESTRUCTION)
						}
						flt
						characreate -1, CREATURE_ID_SIVA_THE_DESTRUCTION, 43, 20
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_YERLESWOOD) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_YERLESWOOD_THE_SAVAGE_MACHINE) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_YERLESWOOD) = 1
						if ( findchara(CREATURE_ID_YERLESWOOD_THE_SAVAGE_MACHINE) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_YERLESWOOD_THE_SAVAGE_MACHINE)
						}
						flt
						characreate -1, CREATURE_ID_YERLESWOOD_THE_SAVAGE_MACHINE, 45, 20
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_ULZASSIL) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_ULZASSIL_THE_DEAD_EMPEROR) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_ULZASSIL) = 1
						if ( findchara(CREATURE_ID_ULZASSIL_THE_DEAD_EMPEROR) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_ULZASSIL_THE_DEAD_EMPEROR)
						}
						flt
						characreate -1, CREATURE_ID_ULZASSIL_THE_DEAD_EMPEROR, 47, 20
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_FRISIA) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_FRISIA_THE_CAT_QUEEN) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_FRISIA) = 1
						if ( findchara(CREATURE_ID_FRISIA_THE_CAT_QUEEN) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_FRISIA_THE_CAT_QUEEN)
						}
						flt
						characreate -1, CREATURE_ID_FRISIA_THE_CAT_QUEEN, 43, 17
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_UTIMA) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_UTIMA) = 1
						if ( findchara(CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN)
						}
						flt
						characreate -1, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN, 45, 17
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_AZZRSSIL) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_AZZRSSIL_THE_IMPURE) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_AZZRSSIL) = 1
						if ( findchara(CREATURE_ID_AZZRSSIL_THE_IMPURE) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_AZZRSSIL_THE_IMPURE)
						}
						flt
						characreate -1, CREATURE_ID_AZZRSSIL_THE_IMPURE, 47, 17
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_SUNRISE) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_SUNRISE_THE_ARCHIPELAGO_DRAGON) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_SUNRISE) = 1
						if ( findchara(CREATURE_ID_SUNRISE_THE_ARCHIPELAGO_DRAGON) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_SUNRISE_THE_ARCHIPELAGO_DRAGON)
						}
						flt
						characreate -1, CREATURE_ID_SUNRISE_THE_ARCHIPELAGO_DRAGON, 21, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_PASCAL) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_PASCAL) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_PASCAL) = 1
						if ( findchara(CREATURE_ID_PASCAL) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_PASCAL)
						}
						flt
						characreate -1, CREATURE_ID_PASCAL, 23, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_WING_SNAIL) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_WING_SNAIL) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_WING_SNAIL) = 1
						if ( findchara(CREATURE_ID_WING_SNAIL) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_WING_SNAIL)
						}
						flt
						characreate -1, CREATURE_ID_WING_SNAIL, 23, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_MURDER_KNIGHT) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_MURDER_KNIGHT) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_MURDER_KNIGHT) = 1
						if ( findchara(CREATURE_ID_MURDER_KNIGHT) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_MURDER_KNIGHT)
						}
						flt
						characreate -1, CREATURE_ID_MURDER_KNIGHT, 27, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_LITYOU) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_LITYOU) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_LITYOU) = 1
						if ( findchara(CREATURE_ID_LITYOU) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_LITYOU)
						}
						flt
						characreate -1, CREATURE_ID_LITYOU, 29, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_MAD_SCIENTIST) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_MAD_SCIENTIST) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_MAD_SCIENTIST) = 1
						if ( findchara(CREATURE_ID_MAD_SCIENTIST) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_MAD_SCIENTIST)
						}
						flt
						characreate -1, CREATURE_ID_MAD_SCIENTIST, 31, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_ISCA) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_ISCA_THE_FALLEN_ANGEL) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_ISCA) = 1
						if ( findchara(CREATURE_ID_ISCA_THE_FALLEN_ANGEL) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_ISCA_THE_FALLEN_ANGEL)
						}
						flt
						characreate -1, CREATURE_ID_ISCA_THE_FALLEN_ANGEL, 33, 6
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_DUNGEON_CLEANER) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_DUNGEON_CLEANER) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_DUNGEON_CLEANER) = 1
						if ( findchara(CREATURE_ID_DUNGEON_CLEANER) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_DUNGEON_CLEANER)
						}
						flt
						characreate -1, CREATURE_ID_DUNGEON_CLEANER, 21, 10
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
				if ( gdata(GDATA_FLAG_AMUR_CAGE_GODA) == 0 ) {
					if ( npcmemory(0, CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC) > 0 ) {
						gdata(GDATA_FLAG_AMUR_CAGE_GODA) = 1
						if ( findchara(CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC) != 0 ) {
							chara_vanquish findchara(CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC)
						}
						flt
						characreate -1, CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC, 23, 10
						cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
						cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
						cdata(CDATA_ROLE, rc) = ROLE_CITIZEN
					}
				}
			}
		}
		if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_CROP ) {
			p = limit(rnd((sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 20 + 1), 1, 5)
			repeat p
				flt calcobjlv((sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 3 + 1), 2
				dbid = 0
				fltn "wild"
				characreate -1, dbid, -3, 0
				cbitmod CHARA_BIT_SUMMONED, rc, 1
			loop
			if ( allitemfind(ITEM_ID_KUMIROMI_GURUMI) != (-1) ) {
				flt
				itemcreate -1, ITEM_ID_ARTIFACT_SEED, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
				kaiwa = rnd(4)
				if ( kaiwa == 0 ) {
					txt lang("「害獣…許さない」", cnvtalk("A vermin... I can't... tolerate..."))
				}
				if ( kaiwa == 1 ) {
					txt lang("「悪い虫は…殺さなきゃ…」", cnvtalk("I... will have no mercy... for vermin..."))
				}
				if ( kaiwa == 2 ) {
					txt lang("「早く…駆除…しないと…」", cnvtalk("I have to... get rid of it..."))
				}
				if ( kaiwa == 3 ) {
					txt lang("「ずっと…見守ってあげるからね…？」", cnvtalk("I always... watch over you..."))
				}
				if ( rc > MAX_CHARA_FOLLOWER ) {
					dmghp rc, 99999, DAMAGE_FROM_UNSEEN
				}
			}
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SOUTH_TYRIS | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_GUARDIAN_SHRINE ) {
			flt
			characreate -1, CREATURE_ID_AIME_THE_STORY_TELLER, 20, 8
			cdata(CDATA_RELATION, rc) = RELATION_NEUTRAL
			cdata(CDATA_RELATION_ORG, rc) = RELATION_NEUTRAL
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			cdata(CDATA_AI_CALM, rc) = 3
		}
		if ( gdata(GDATA_AREA) == AREA_VALM ) {
			flt
			characreate -1, CREATURE_ID_SNAIL_THE_ANDROID_RIDER, 41, 9
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			flt
			characreate -1, CREATURE_ID_RECONCILED_CLEANER, 8, 7
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		if ( gdata(GDATA_AREA) == AREA_ULM_LESON ) {
			if ( gdata(GDATA_FLAG_MAIN) >= 605 ) {
				if ( gdata(STARTING_GDATA_FLAG + 319) == 0 ) {
					if ( findchara(CREATURE_ID_RIANNA_THE_DAYDREAMER) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_RIANNA_THE_DAYDREAMER)
					}
					if ( findchara(CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE)
					}
					if ( findchara(CREATURE_ID_LARNNEIRE_THE_LISTENER_OF_WIND) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_LARNNEIRE_THE_LISTENER_OF_WIND)
					}
					flt
					characreate -1, CREATURE_ID_RIANNA_THE_DAYDREAMER, 30, 6
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
					flt
					characreate -1, CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE, 22, 28
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
					flt
					characreate -1, CREATURE_ID_LARNNEIRE_THE_LISTENER_OF_WIND, 32, 1
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
					gdata(STARTING_GDATA_FLAG + 319) = 1
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 760 ) {
				if ( gdata(GDATA_FLAG_BETHEL_THE_WHITE_HAWK_SPAWNED) == 0 ) {
					if ( findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK) != 0 ) {
						chara_vanquish findchara(CREATURE_ID_BETHEL_THE_WHITE_HAWK)
					}
					flt
					initlv = 200
					characreate -1, CREATURE_ID_BETHEL_THE_WHITE_HAWK, 32, 2
					cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
					cdata(CDATA_AI_CALM, rc) = 3
					gdata(STARTING_GDATA_FLAG + 367) = 1
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_RUOZA ) {
			flt
			characreate -1, CREATURE_ID_MILOS_OF_THE_FORGOTTEN_WORLD, 22, 2
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
			flt
			characreate -1, CREATURE_ID_HALION_THE_EXTREMIST, 19, 18
			cdata(CDATA_ROLE, rc) = ROLE_SPECIAL
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_BOSS_MUSIC | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 0 ) {
			music = MUSICLIST_SCENE_MUSIC
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 1 ) {
			music = MUSICLIST_MCBOSS
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 2 ) {
			music = MUSICLIST_MCRUIN
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 3 ) {
			music = MUSICLIST_MCJAPAN
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 4 ) {
			music = MUSICLIST_MCLASTBOSS
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 5 ) {
			music = MUSICLIST_MCVICTORY
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 6 ) {
			gosub *music_play
		}
		if ( gdata(GDATA_FLAG_BOSS_MUSIC) == 7 ) {
			music = MUSICLIST_MCZANGYOU
			gosub *music_play
		}
		gdata(GDATA_FLAG_BOSS_MUSIC) = 0
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_VERNIS_SPEECH | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_drawEventFull
		press
		screenupdate = -1
		gosub *screen_refreshFull
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_QUEST_CHECK | _switch_sw ) {
		_switch_sw = 0
		gosub *quest_check
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SHOW_HOUSE | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BROWN
		txt "" + usermsg
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_VISITOR | _switch_sw ) {
		_switch_sw = 0
		if ( get_freechara() == (-1) | gdata(GDATA_GUEST) <= 0 ) {
			txt lang("ゲストは行方不明になった。", "The guest lost his way.")
			goto *event_SWEND1
		}
		ehemeka = 0
		if ( allitemfind(ITEM_ID_PAINTING_OF_EHEKATL_AND_SWORDFISH) != (-1) ) {
			kaiwa = rnd(4)
			if ( kaiwa == 0 ) {
				txt lang("「うみゅ〜!」", cnvtalk("Meow!"))
			}
			if ( kaiwa == 1 ) {
				txt lang("「うっみゅ!」", cnvtalk("Mew mew!"))
			}
			if ( kaiwa == 2 ) {
				txt lang("「招くよ!よ！」", cnvtalk("I invite guests! guests!"))
			}
			if ( kaiwa == 3 ) {
				txt lang("「めかじき!」", cnvtalk("Swordfish!"))
			}
			ehemeka = 100
		}
		if ( rnd(3) & gdata(GDATA_MONTH) != 10 ) {
			p = 0
			tc = CHARA_PLAYER
			repeat 100
				i = rnd(MAX_CHARA_ADVENTURER) + MAX_CHARA_FOLLOWER
				if ( cdata(CDATA_EXIST, i) == CHAR_STATE_ADV ) {
					if ( cbit(CHARA_BIT_HIRED, i) == 0 ) {
						cdata(CDATA_AREA, i) != gdata(GDATA_AREA)
						if ( cdata(CDATA_RELATION, i) >= 0 ) {
							if ( cdata(CDATA_ADVENTURER_MESSAGE_RECEIVED, i) == ADVENTURER_MESSAGE_COME_TO_MY_HOUSE ) {
								cdata(CDATA_ADVENTURER_MESSAGE_RECEIVED, i) = ADVENTURER_MESSAGE_NONE
								tc = i
								break
							}
							if ( rnd(25) < p ) {
								break
							}
							if ( tc == CHARA_PLAYER ) {
								tc = i
								p++
								if ( cdata(CDATA_IMPRESSION, tc) < 25 ) {
									if ( rnd(12) == 0 & ehemeka == 0 ) {
										break
									}
								}
								if ( cdata(CDATA_IMPRESSION, tc) < 0 ) {
									if ( rnd(4) == 0 & ehemeka == 0 ) {
										break
									}
								}
								continue
							}
							if ( cdata(CDATA_IMPRESSION, cnt) < cdata(CDATA_IMPRESSION, i) ) {
								tc = i
								p++
							}
						}
					}
				}
			loop
			if ( tc == CHARA_PLAYER ) {
				txt lang("ゲストはすでに居なくなっていた。", "It seems the guest has already left your house.")
				goto *event_SWEND1
			}
			cdata(CDATA_EXIST, tc) = CHAR_STATE_ALIVE
			rc = tc
			cxinit = cdata(CDATA_X, CHARA_PLAYER)
			cyinit = cdata(CDATA_Y, CHARA_PLAYER)
			gosub *place_chara
		}
		else {
			flt 0, 2
			repeat 1
				if ( gdata(GDATA_MONTH) == 10 ) {
					if ( rnd(2) == 0 ) {
						if ( rnd(2) == 0 ) {
							characreate -1, CREATURE_ID_HALLOWEEN_CHILDREN2, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HALLOWEEN
							break
						}
						else {
							characreate -1, CREATURE_ID_HALLOWEEN_CHILDREN, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HALLOWEEN
							break
						}
					}
				}
				if ( gdata(GDATA_GUILD_TRAINER) != gdata(GDATA_MONTH) | rnd(5) == 0 ) {
					if ( rnd(3) ) {
						characreate -1, CREATURE_ID_GUILD_TRAINER, -3, 0
						cdata(CDATA_ROLE, rc) = ROLE_GUEST_TRAINER
						break
					}
				}
				if ( rnd(10) == 0 ) {
					homeu++
					if ( (gdata(GDATA_DAY) + homeu) \ 4 == 0 ) {
						if ( findcharahome(CREATURE_ID_SCARD_THE_HAPPY_SWALLOW) == 0 ) {
							characreate -1, CREATURE_ID_SCARD_THE_HAPPY_SWALLOW, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HOUSEMATE
							break
						}
					}
					if ( (gdata(GDATA_DAY) + homeu) \ 4 == 1 ) {
						if ( findcharahome(CREATURE_ID_OXODE_THE_QUEEN_BEE) == 0 ) {
							characreate -1, CREATURE_ID_OXODE_THE_QUEEN_BEE, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HOUSEMATE
							break
						}
					}
					if ( (gdata(GDATA_DAY) + homeu) \ 4 == 2 ) {
						if ( findcharahome(CREATURE_ID_IMARITUKA_THE_ZASIKI_WARAI) == 0 ) {
							characreate -1, CREATURE_ID_IMARITUKA_THE_ZASIKI_WARAI, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HOUSEMATE
							break
						}
					}
					if ( (gdata(GDATA_DAY) + homeu) \ 4 == 3 ) {
						if ( findcharahome(CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD) == 0 ) {
							characreate -1, CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD, -3, 0
							cdata(CDATA_ROLE, rc) = ROLE_GUEST_HOUSEMATE
							break
						}
					}
				}
				if ( rnd(10) == 0 & ehemeka == 0 ) {
					characreate -1, CREATURE_ID_MYSTERIOUS_PRODUCER, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_PRODUCER
					break
				}
				if ( rnd(10) == 0 ) {
					characreate -1, CREATURE_ID_SHOPKEEPER, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_MERCHANT
					cdata(CDATA_ROLE_SHOP_LEVEL, rc) = limit(cdata(CDATA_FAME, CHARA_PLAYER) / 100, 20, 100)
					break
				}
				if ( rnd(4) == 0 & ehemeka == 0 ) {
					characreate -1, CREATURE_ID_BEGGAR, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_BEGGAR
					break
				}
				if ( rnd(4) == 0 & ehemeka == 0 ) {
					characreate -1, CREATURE_ID_PUNK, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_SEX
					break
				}
				if ( ehemeka == 0 ) {
					characreate -1, CREATURE_ID_CITIZEN, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_CITIZEN
					break
				}
				else {
					characreate -1, CREATURE_ID_SHOPKEEPER, -3, 0
					cdata(CDATA_ROLE, rc) = ROLE_GUEST_MERCHANT
					cdata(CDATA_ROLE_SHOP_LEVEL, rc) = limit(cdata(CDATA_FAME, CHARA_PLAYER) / 100, 20, 100)
					break
				}
			loop
			tc = rc
			cdata(CDATA_RELATION, tc) = 0
			cdata(CDATA_RELATION_ORG, tc) = 0
			cbitmod CHARA_BIT_GUEST, tc, 1
		}
		ehemeka = 0
		cbitmod CHARA_BIT_EVENT_TALK, tc, 1
		i = 0
		repeat MAX_CHARA_FOLLOWER + 1
			if ( cnt == CHARA_PLAYER ) {
				c = tc
			}
			else {
				c = cnt - 1
			}
			if ( cdata(CDATA_EXIST, c) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( gdata(GDATA_RIDER) != 0 ) {
				if ( c == gdata(GDATA_RIDER) ) {
					continue
				}
			}
			inv_getheader -1
			p = 0, 6
			repeat invrange, invhead
				if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
					continue
				}
				if ( inv(INV_ITEM_EFFECT, cnt) != EFFECT_CHAIR ) {
					continue
				}
				if ( c == tc ) {
					if ( inv(INV_ITEM_PARAM1, cnt) == 2 ) {
						cell_swap c, -1, inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt)
						i = cnt
						p = cnt
						break
					}
					else {
						continue
					}
				}
				if ( i == 0 ) {
					break
				}
				else {
					if ( cnt == i ) {
						continue
					}
				}
				p(2) = dist(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), inv(INV_ITEM_X, i), inv(INV_ITEM_Y, i))
				if ( p(2) < p(1) ) {
					if ( map(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), 1) == 0 | c == 0 | c == tc ) {
						p = cnt, p(2)
					}
				}
				if ( c == 0 ) {
					if ( inv(INV_ITEM_PARAM1, cnt) == 1 ) {
						p = cnt
						break
					}
				}
			loop
			if ( p != 0 ) {
				if ( cdata(CDATA_IN_TAGTEAM, c) == 0 ) {
					cell_swap c, -1, inv(INV_ITEM_X, p), inv(INV_ITEM_Y, p)
				}
			}
			cdata(CDATA_DIR, c) = direction(cdata(CDATA_X, c), cdata(CDATA_Y, c), cdata(CDATA_X, tc), cdata(CDATA_Y, tc))
			if ( c == 0 ) {
				gdata(GDATA_RUN_DIR) = cdata(CDATA_DIR, c)
			}
		loop
		gosub *chat
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_NORTH_BORDER | _switch_sw ) {
		_switch_sw = 0
		i = 0
		repeat MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_ROLE, cnt) != ROLE_ADVENTURER ) {
				if ( cdata(CDATA_ROLE, cnt) != ROLE_SPECIAL ) {
					cdata(CDATA_EMO_ICON, cnt) = 10 + 100 * 20
					txt lang(name(cnt) + "「目が！目がー！！」", name(cnt) + " shout" + _s(cnt) + " " + cnvtalk("Eyes! My eyes!"))
				}
			}
		loop
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_RETURN_FROM_CHAOS_CRADLE | _switch_sw ) {
		_switch_sw = 0
		txt lang("おかえり。", "Welcome back.")
		snd SOUNDLIST_DING3
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			p = cnt
			repeat 8 + 8
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_NONE ) {
					break
				}
				if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, p) == BUFF_DEATH_WORD ) {
					delbuff p, cnt
					continue cnt
				}
			loop
		loop
		i = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == 0 ) {
				continue
			}
			cdata(CDATA_EMO_ICON, cnt) = 6 + 100 * 20
			tc = cnt
			customtalk tc, DBMODE_FLAVOR_WELCOME
			gosub *convert_word
			if ( stat == 0 ) {
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					i++
				}
			}
		loop
		repeat limit(i, 0, 5)
			txtef COLOR_SKY_BLUE
			if ( jp ) {
				txt "「おかえり」", "「おかえりなさい」", "「お疲れさま」", "「よかった…」", "「ずっと待ってたよ」", "「おかえりなさい」", "「おかえり」", "「泣きそう…」"
			}
			if ( en ) {
				txt cnvtalk("Welcome back!!"), cnvtalk("Hey, dear..."), cnvtalk("You're back!"), cnvtalk("I was waiting for you."), cnvtalk("Nice to see you again."), cnvtalk("I'm about to cry..."), cnvtalk("Cheers for good work.")
			}
		loop
		await 500
		txtsetendword 3
		repeat 3
			promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
			promptmax++
		loop
		val = promptx, prompty, 300, 0
		gosub *prompt_key
		snd SOUNDLIST_DING1
		goto *event_SWEND1
		_switch_sw++
	}
	if ( _switch_val == EVENT_WELCOME | _switch_sw ) {
		_switch_sw = 0
		i = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			if ( cdata(CDATA_ROLE, cnt) != ROLE_ADVENTURER ) {
				if ( cdata(CDATA_ROLE, cnt) != ROLE_SPECIAL ) {
					if ( cdata(CDATA_ROLE, cnt) != ROLE_NONE | cdata(CDATA_RELATION, cnt) == 0 | cdata(CDATA_AREA, cnt) == gdata(GDATA_AREA) ) {
						cdata(CDATA_EMO_ICON, cnt) = 6 + 100 * 20
						tc = cnt
						customtalk tc, DBMODE_FLAVOR_WELCOME
						gosub *convert_word
						if ( stat == 0 ) {
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								i++
							}
						}
					}
				}
			}
		loop
		repeat limit(i, 0, 3)
			txtef COLOR_SKY_BLUE
			txt lang("「おかえり」", cnvtalk("Welcome home!")), lang("「よう戻ったか」", cnvtalk("Hey, dear.")), lang("「無事で何よりです」", cnvtalk("You're back safely!")), lang("「おかか♪」", cnvtalk("Welcome back♪")), lang("「待ってたよ」", cnvtalk("I was waiting for you.")), lang("「おかえりなさい！」", cnvtalk("Nice to see you again."))
		loop
		if ( gdata(GDATA_GUEST) > 0 ) {
			tc = CHARA_PLAYER
			repeat MAX_CHARA_TOTAL
				if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cdata(CDATA_ROLE, cnt) == ROLE_MAID ) {
					tc = cnt
					break
				}
			loop
			if ( tc != CHARA_PLAYER ) {
				gosub *chat
			}
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_NUKE | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *event_SWEND1
		}
		gdata(GDATA_FLAG_NUCLEAR_EXPLOSIONS)++
		txtef COLOR_RED
		txt lang(" *ゴゴゴゴゴゴ* ", " *RRROOM-KABOOOOM* ")
		msg_halt
		gsel 7
		pos 0, 0
		picload exedir + "graphic\\bg22.bmp"
		gsel 4
		pos windoww / 2 - 1, windowh / 2 - 1
		gmode 0, 640, 480
		grotate 7, 0, 0, 0, windoww + 4, windowh + 4
		gsel 7
		picload exedir + "graphic\\anime9.bmp"
		gsel 0
		dx = windoww / 2
		dy = (windowh - inf_verh) / 2
		p = 0, 0, 0, 0, 0
		color 0, 0, 0
		repeat 40
			if ( cnt == 14 ) {
				snd SOUNDLIST_ATK_FIRE
			}
			redraw 0
			color 0, 0, 0
			if ( cnt < 16 ) {
				pos 0, 0
			}
			else {
				pos 5 - rnd(10), 5 - rnd(10)
			}
			gmode 0
			gcopy 4, 0, 0, windoww, windowh
			if ( cnt > 8 ) {
				p--
			}
			else {
				p++
			}
			gmode 4, 192, 48, 255 - p * 5
			pos dx, dy
			grotate 7, cnt / 2 \ 2 * 192, 408, 0, limit(p * 32, 0, 192), limit(p * 8, 0, 48)
			if ( cnt > 14 ) {
				p(1)++
			}
			else {
				if ( cnt < 12 ) {
					p(1) = cnt / 2 \ 2
				}
				else {
					if ( cnt >= 12 ) {
						p(1) = cnt \ 3
					}
				}
			}
			gmode 2, 96, 48
			pos dx, dy - limit(cnt * 3 / 2, 0, 18) - 16
			grotate 7, p(1) * 96, 288, 0, limit(cnt * 12, 0, 144), limit(cnt * 6, 0, 72)
			if ( cnt > 4 ) {
				p(2)++
				p(3)++
			}
			gmode 4, 96, 96, limit(p(2) * 6, 0, 100)
			pos dx, dy - limit(p(2) * 2, 0, 40)
			grotate 7, 0, 0, 0, limit(p(2) * 8, 0, 240), limit(p(2) * 5, 0, 96)
			gmode 4, 96, 96, p(3) * 10
			pos dx, dy - limit(p(3) * 2, 0, 160) - 6
			grotate 7, 96, 0, 0, limit(p(3) * 10, 0, 96), limit(p(3) * 10, 0, 96)
			gmode 4, 192, 80, limit(p(3) * 5, 0, 100)
			pos dx, dy - 4
			grotate 7, cnt / 4 \ 2 * 192, 96, 0, limit(p(2) * 8, 0, 400), limit(p(2), 0, 48)
			gmode 4, 192, 96, p(3) * 10
			pos dx, dy - 48 - limit(p(3) * 2, 0, 148)
			grotate 7, cnt / 3 \ 2 * 192, 96, 0, 192, 96
			redraw 1
			await cfg_animewait + 50
		loop
		gmode 2
		gosub *screen_refreshFull
		tlocx = evdata1(evnum - (evnum != 0) * 1)
		tlocy = evdata2(evnum - (evnum != 0) * 1)
		range = 31
		ele = SKILL_RES_CHAOS
		aniref = range
		animeid = ANIMATION_BALL_NUKE
		anix = tlocx
		aniy = tlocy
		gosub *anime
		gosub *screen_draw
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if ( dy < 0 | dy >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if ( dx < 0 | dx >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( dist(tlocx, tlocy, dx, dy) > range ) {
					continue
				}
				f = 0
				if ( chipm(CHIPM_ATTRIB, map(dx, dy, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					f = 1
				}
				if ( rnd(4) | f == 1 ) {
					map(dx, dy, 0) = 37
				}
				if ( rnd(10) == 0 | f == 1 ) {
					addmef dx, dy, 5, 24, rnd(15) + 20, 50
				}
				if ( map(dx, dy, 1) != 0 ) {
					tc = map(dx, dy, 1) - 1
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = 1000
					dmghp tc, dmg, DAMAGE_FROM_NUKE
				}
				mapitem_fire dx, dy
			loop
		loop
		if ( evdata1(evnum - (evnum != 0) * 1) == 33 ) {
			if ( evdata2(evnum - (evnum != 0) * 1) == 16 ) {
				if ( gdata(GDATA_AREA) == AREA_PALMIA ) {
					if ( gdata(GDATA_FLAG_SUB_NUKE) == 1 ) {
						gdata(GDATA_FLAG_SUB_NUKE) = 2
						txt_questupdate
					}
				}
			}
		}
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
			modkarma CHARA_PLAYER, (-80) + trait(TRAIT_OTHER_WICKED) * 60
		}
		else {
			modkarma CHARA_PLAYER, -10
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_RAGNAROK | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *event_SWEND1
		}
		gdata(GDATA_FLAG_RAGNAROK_STARTED)++
		gdata(GDATA_WEATHER) = WEATHER_ETHER
		envonly = 1
		gosub *music_play
		if ( TweakData(TWEAK_GAMEPLAY_CG_DISABLE_CURTAIN_CALL, TWEAK_CATEGORY_GAMEPLAY) == TRUE ) {
			if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
				cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = -1
			}
			txt lang("終末の日が訪れた。", "Let's Ragnarok!")
			msg_halt
		}
		else {
			if ( gdata(GDATA_FLAG_CURTAIN_CALL) < 9999 & gdata(GDATA_FLAG_CURTAIN_CALL) >= 0 ) {
				if ( cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) >= 0 ) {
					cdata(CDATA_FRIENDSHIP, CHARA_PLAYER) = -1
				}
				txt lang("終末の日が訪れた。", "Let's Ragnarok!")
				msg_halt
			}
			if ( gdata(GDATA_FLAG_CURTAIN_CALL) >= 9999 | gdata(GDATA_FLAG_CURTAIN_CALL) < 0 ) {
				txt lang("*カーテンコール*", " *Curtain Call* ")
				await 2000
			}
		}
		animeid = ANIMATION_RAGNA
		gosub *anime
		repeat 200
			repeat 2
				x = rnd(mdata(MDATA_WIDTH))
				y = rnd(mdata(MDATA_HEIGHT))
				map(x, y, 0) = 37
				cell_featread x, y
				if ( feat(1) == CELL_FEATURE_DOOR_CLOSED ) {
					cell_featset x, y, 0, 0, 0, 0
				}
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) | rnd(5) == 0 ) {
				x = rnd(mdata(MDATA_WIDTH))
				y = rnd(mdata(MDATA_HEIGHT))
			}
			addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if ( cnt \ 4 == 0 ) {
				if ( gdata(STARTING_GDATA_FLAG + 380) == 0 ) {
					flt 100, calcfixlv(FIX_QUALITY_GREAT)
					if ( rnd(4) ) {
						fltnrace = "dragon"
					}
					else {
						fltnrace = "giant"
					}
					characreate -1, CREATURE_ID_BUG, x, y
					if ( stat != 0 ) {
						cbitmod CHARA_BIT_SUMMONED, rc, 1
					}
					if ( gdata(GDATA_AREA) != AREA_VOID ) {
						if ( gdata(GDATA_DEEPEST_LEVEL) < 60 ) {
							if ( cdata(CDATA_LEVEL, rc) > 50 ) {
								chara_vanquish rc
							}
						}
					}
				}
			}
			if ( cnt \ 4 == 0 ) {
				if ( gdata(STARTING_GDATA_FLAG + 380) != 0 ) {
					flt
					characreate -1, CREATURE_ID_UNIVERSE_INVADER, x, y
					if ( stat != 0 ) {
						cbitmod CHARA_BIT_SUMMONED, rc, 1
					}
				}
			}
			if ( cnt \ 7 == 0 ) {
				gosub *screen_draw
				if ( rnd(7) ) {
					snd SOUNDLIST_FIRE1
				}
				else {
					snd SOUNDLIST_CRUSH1
				}
				await 25
			}
		loop
		gdata(STARTING_GDATA_FLAG + 380) = 0
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_GUILD | _switch_sw ) {
		_switch_sw = 0
		if ( evdata1(evnum - (evnum != 0) * 1) == 0 ) {
			txtef COLOR_RED
			txt lang("けたたましい警報が鳴り響いた！", "*beeeeeep* An alarm sounds loudly!")
			repeat MAX_CHARA_TOTAL - MAX_CHARA_SAVE, MAX_CHARA_SAVE
				if ( cdata(CDATA_ID, cnt) == CREATURE_ID_MELUGAST_TYPE0_THE_DIMENSION_DRIVER ) {
					continue
				}
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
					cdata(CDATA_RELATION, cnt) = -3
					cdata(CDATA_TARGET, cnt) = 0
					cdata(CDATA_AI_AGGRO, cnt) = 250
				}
			loop
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_NEFIA_EFFECT | _switch_sw ) {
		_switch_sw = 0
		if ( evdata1(evnum - (evnum != 0) * 1) == 0 ) {
			repeat MAX_CHARA_TOTAL - MAX_CHARA_SAVE, MAX_CHARA_SAVE
				if ( cbit(CHARA_BIT_NECRO, cnt) == 1 ) {
					continue
				}
				if ( cdata(CDATA_EXIST, cnt) == CHAR_STATE_ALIVE ) {
					if ( cdata(CDATA_RELATION, cnt) == (-3) ) {
						cdata(CDATA_TARGET, cnt) = 0
						cdata(CDATA_AI_AGGRO, cnt) = 250
					}
				}
			loop
		}
		goto *event_SWEND1
	}
	if ( _switch_val == EVENT_SLEEP_AMBUSH | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			txt lang("強盗があなたに目をつけた！", "The robber turns their attention to you!")
			repeat 3
				flt
				initlv = limit(cdata(CDATA_LEVEL, CHARA_PLAYER), 1, 50)
				novoidlv = 1
				characreate -1, CREATURE_ID_ROBBER, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			loop
		}
		goto *event_SWEND1
	}
*event_SWEND1
	return
